<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="关于AvalonJsavalon是一个简单易用迷你的MVVM框架，它最早发布于2012.09.15，为解决同一业务逻辑存在各种视图呈现而开发出来的。 事实上，这问题其实也可以简单地利用一般的前端模板加jQuery 事件委托 搞定，但随着业务的膨胀， 代码就充满了各种选择器与事件回调，难以维护。因此彻底的将业务与逻辑分离，就只能求助于架构。 最初想到的是MVC，尝试过backbone，但代码不降反升">
<meta property="og:type" content="article">
<meta property="og:title" content="avalon.js入门教程">
<meta property="og:url" content="http://example.com/2021/07/13/avalonjs%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/index.html">
<meta property="og:site_name" content="Cai">
<meta property="og:description" content="关于AvalonJsavalon是一个简单易用迷你的MVVM框架，它最早发布于2012.09.15，为解决同一业务逻辑存在各种视图呈现而开发出来的。 事实上，这问题其实也可以简单地利用一般的前端模板加jQuery 事件委托 搞定，但随着业务的膨胀， 代码就充满了各种选择器与事件回调，难以维护。因此彻底的将业务与逻辑分离，就只能求助于架构。 最初想到的是MVC，尝试过backbone，但代码不降反升">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/avalon/avalon01.png">
<meta property="og:image" content="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/avalon/avalon02.jpg">
<meta property="og:image" content="http://www.itprobie.com/jc/avalon/avalon_html/img/filterBy.png">
<meta property="article:published_time" content="2021-07-13T00:53:29.000Z">
<meta property="article:modified_time" content="2021-10-19T07:21:00.723Z">
<meta property="article:author" content="wotzc">
<meta property="article:tag" content="JavaWeb">
<meta property="article:tag" content="前端框架">
<meta property="article:tag" content="avalon">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/avalon/avalon01.png">


<link rel="canonical" href="http://example.com/2021/07/13/avalonjs%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2021/07/13/avalonjs%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/","path":"2021/07/13/avalonjs入门教程/","title":"avalon.js入门教程"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>avalon.js入门教程 | Cai</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Cai</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8EAvalonJs"><span class="nav-number">1.</span> <span class="nav-text">关于AvalonJs</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9E%8B"><span class="nav-number">2.</span> <span class="nav-text">视图模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%91%E5%AE%9A"><span class="nav-number">3.</span> <span class="nav-text">绑定</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%80%BC%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">4.1.</span> <span class="nav-text">插值表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%BD%E7%95%A5%E6%89%AB%E6%8F%8F%E7%BB%91%E5%AE%9A-ms-skip"><span class="nav-number">4.2.</span> <span class="nav-text">忽略扫描绑定(ms-skip)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-controller"><span class="nav-number">4.3.</span> <span class="nav-text">ms-controller</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-important"><span class="nav-number">4.4.</span> <span class="nav-text">ms-important</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-attr"><span class="nav-number">4.5.</span> <span class="nav-text">ms-attr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-css"><span class="nav-number">4.6.</span> <span class="nav-text">ms-css</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-text"><span class="nav-number">4.7.</span> <span class="nav-text">ms-text</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-html"><span class="nav-number">4.8.</span> <span class="nav-text">ms-html</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-duplex"><span class="nav-number">4.9.</span> <span class="nav-text">ms-duplex</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-for"><span class="nav-number">4.10.</span> <span class="nav-text">ms-for</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-class"><span class="nav-number">4.11.</span> <span class="nav-text">ms-class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-if"><span class="nav-number">4.12.</span> <span class="nav-text">ms-if</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-visible"><span class="nav-number">4.13.</span> <span class="nav-text">ms-visible</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-on"><span class="nav-number">4.14.</span> <span class="nav-text">ms-on</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ms-rules"><span class="nav-number">4.15.</span> <span class="nav-text">ms-rules</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">5.</span> <span class="nav-text">过滤器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">5.1.</span> <span class="nav-text">格式化过滤器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uppercase"><span class="nav-number">5.2.</span> <span class="nav-text">uppercase</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lowercase"><span class="nav-number">5.3.</span> <span class="nav-text">lowercase</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#truncate"><span class="nav-number">5.4.</span> <span class="nav-text">truncate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#camelize"><span class="nav-number">5.5.</span> <span class="nav-text">camelize</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#escape"><span class="nav-number">5.6.</span> <span class="nav-text">escape</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sanitize"><span class="nav-number">5.7.</span> <span class="nav-text">sanitize</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#number"><span class="nav-number">5.8.</span> <span class="nav-text">number</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#currency"><span class="nav-number">5.9.</span> <span class="nav-text">currency</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#date"><span class="nav-number">5.10.</span> <span class="nav-text">date</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">5.11.</span> <span class="nav-text">循环过滤器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#limitBy"><span class="nav-number">5.12.</span> <span class="nav-text">limitBy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#orderBy"><span class="nav-number">5.13.</span> <span class="nav-text">orderBy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#filterBy"><span class="nav-number">5.14.</span> <span class="nav-text">filterBy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#selectBy"><span class="nav-number">5.15.</span> <span class="nav-text">selectBy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">5.16.</span> <span class="nav-text">事件过滤器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#esc"><span class="nav-number">5.17.</span> <span class="nav-text">esc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tab"><span class="nav-number">5.18.</span> <span class="nav-text">tab</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#enter"><span class="nav-number">5.19.</span> <span class="nav-text">enter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#space"><span class="nav-number">5.20.</span> <span class="nav-text">space</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#del"><span class="nav-number">5.21.</span> <span class="nav-text">del</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#up"><span class="nav-number">5.22.</span> <span class="nav-text">up</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#down"><span class="nav-number">5.23.</span> <span class="nav-text">down</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#left"><span class="nav-number">5.24.</span> <span class="nav-text">left</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#right"><span class="nav-number">5.25.</span> <span class="nav-text">right</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prevent"><span class="nav-number">5.26.</span> <span class="nav-text">prevent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stop"><span class="nav-number">5.27.</span> <span class="nav-text">stop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E9%A2%91%E7%8E%87%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">5.28.</span> <span class="nav-text">同步频率过滤器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#change"><span class="nav-number">5.29.</span> <span class="nav-text">change</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#debounce"><span class="nav-number">5.30.</span> <span class="nav-text">debounce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E5%86%99%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">5.31.</span> <span class="nav-text">编写过滤器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#watch%EF%BC%8C-fire-unwatch"><span class="nav-number">6.</span> <span class="nav-text">$watch，$fire, $unwatch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8EjQuery%E5%85%B1%E5%AD%98"><span class="nav-number">7.</span> <span class="nav-text">与jQuery共存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#domReady%E5%90%8E%E5%A6%82%E4%BD%95%E6%89%AB%E6%8F%8F"><span class="nav-number">7.1.</span> <span class="nav-text">domReady后如何扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95AJAX%E6%8F%90%E4%BA%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">7.2.</span> <span class="nav-text">如何AJAX提交数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E8%AE%A9%E5%90%8E%E5%8F%B0%E5%9B%9E%E6%9D%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0VM"><span class="nav-number">7.3.</span> <span class="nav-text">如何让后台回来的数据更新VM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%90%8C%E6%AD%A5%E8%A1%A8%E5%8D%95%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="nav-number">7.4.</span> <span class="nav-text">如何同步表单的数据</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wotzc"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">wotzc</p>
  <div class="site-description" itemprop="description">真正的大师永远都怀着一颗学徒的心</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">61</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/07/13/avalonjs%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="avalon.js入门教程 | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          avalon.js入门教程
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-13 08:53:29" itemprop="dateCreated datePublished" datetime="2021-07-13T08:53:29+08:00">2021-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-10-19 15:21:00" itemprop="dateModified" datetime="2021-10-19T15:21:00+08:00">2021-10-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="关于AvalonJs"><a href="#关于AvalonJs" class="headerlink" title="关于AvalonJs"></a>关于AvalonJs</h2><p>avalon是一个简单易用迷你的MVVM框架，它最早发布于2012.09.15，为解决同一业务逻辑存在各种视图呈现而开发出来的。 事实上，这问题其实也可以简单地利用一般的前端模板加jQuery 事件委托 搞定，但随着业务的膨胀， 代码就充满了各种选择器与事件回调，难以维护。因此彻底的将业务与逻辑分离，就只能求助于架构。 最初想到的是MVC，尝试过backbone，但代码不降反升，很偶尔的机会，碰上微软的WPF， 优雅的MVVM架构立即吸引住了作者，作者觉得这就是他一直追求的解决之道。</p>
<p>MVVM将所有前端代码彻底分成两部分，视图的处理通过绑定实现（angular有个更炫酷的名词叫指令）， 业务逻辑则集中在一个个叫VM的对象中处理。我们只要操作VM的数据，它就自然而然地神奇地同步到视图。</p>
<p>我们从一个完整的例子开始认识 avalon ：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;avalon.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot; background: #a9ea00;&quot;</span> <span class="attr">ms-css-width</span>=<span class="string">&quot;w&quot;</span> <span class="attr">ms-css-height</span>=<span class="string">&quot;h&quot;</span>  <span class="attr">ms-click</span>=<span class="string">&quot;click&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; w &#125;&#125; x &#123;&#123; h &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>W: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;w&quot;</span> <span class="attr">data-duplex-event</span>=<span class="string">&quot;change&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>H: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;h&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">                 $id: <span class="string">&quot;box&quot;</span>,<span class="comment">//告诉avalon这个Model是作用于哪个ms-controller的</span></span></span><br><span class="line">                  w: 100,</span><br><span class="line">                  h: 100,</span><br><span class="line"><span class="javascript">                  click: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    vm.w = <span class="built_in">parseFloat</span>(vm.w) + <span class="number">10</span>;</span></span><br><span class="line"><span class="javascript">                    vm.h = <span class="built_in">parseFloat</span>(vm.h) + <span class="number">10</span>;</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的代码中，我们可以看到在JS中，没有任何一行操作DOM的代码，也没有选择器，非常干净。在HTML中， 我们发现就是多了一些以ms-开始的属性与<code> {{ }} </code>标记，有的是用于渲染样式， 有的是用于绑定事件。这些属性或标记，实质就是avalon的<strong>绑定系统</strong>的一部分。绑定（有的框架也将之称为指令）， 负责帮我们完成视图的各种操作，相当于一个隐形的<strong>jQuery</strong>。正因为有了绑定，我们就可以在JS代码专注业务逻辑本身， 写得更易维护的代码！</p>
<hr>
<h2 id="视图模型"><a href="#视图模型" class="headerlink" title="视图模型"></a>视图模型</h2><p>视图模型，ViewModel，也经常被略写成VM，是通过avalon.define方法进行定义。生成的对象会默认放到avalon.vmodels对象上。 每个VM在定义时必须指定$id。如果你有某些属性不想监听，可以直接将此属性名放到$skipArray数组中。</p>
<p>接着我们说一些重要的概念：</p>
<ul>
<li>$id， 每个VM都有$id，VM的ID，方便在avalon.vmodels里查找到它，或用在ms-controller、ms-important上。如果VM的某一个属性是对象（并且它是可监控的），也会转换为一个VM，这个子VM也会默认加上一个$id。 但只有用户添加的那个最外面的$id会注册到avalon.vmodels对象上。</li>
<li>监控属性，一般地，VM中的属性都会转换为此种属性，当我们以vm.aaa = yyy这种形式更改其值时，就会同步到视图上的对应位置上。</li>
<li>计算属性，定义时为一个对象，并且只存在set,get两个函数或只有一个get一个函数。它是监控属性的高级形式，表示它的值是通过函数计算出来的，是依赖于其他属性合成出来的。</li>
<li>监控数组，定义时为一个数组，它会添加了许多新方法，但一般情况下与普通数组无异，但调用它的push, unshift, remove, pop等方法会同步视图。</li>
<li>非监控属性，这包括框架添加的$id属性，以$开头的属性，放在$skipArray数组中的属性，值为函数、元素节点、文本节点的属性，总之，改变它们的值不会产生同步视图的效果。</li>
</ul>
<p>$skipArray 是一个字符串数组，只能放当前对象的直接属性名，想禁止子对象的某个属性的监听，在那个子对象上再添加一个$skipAray数组就行了。</p>
<p>视图里面，我们可以使用ms-controller, ms-important指定一个VM的作用域。</p>
<p>此外，在ms-each, ms-with，ms-repeat绑定属性中，它们会创建一个临时的VM，我们称之为代理VM， 用于放置$key, $val, $index, $last, $first, $remove等变量或方法。</p>
<p>另外，avalon不允许在VM定义之后，再追加新属性与方法，比如下面的方式是错误的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = avalon.define(&#123;</span><br><span class="line">    $id:   <span class="string">&quot;test&quot;</span>, </span><br><span class="line">    test1: <span class="string">&quot;点击测试按钮没反应 绑定失败&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line">vm.one = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    vm.test1 = <span class="string">&quot;绑定成功&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>也不允许在define里面直接调用方法或ajax。</p>
<p><strong>我们再看看如何更新VM中的属性(重点)：</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> model : avalon.define(&#123;</span><br><span class="line">     $id:  <span class="string">&quot;update&quot;</span>, </span><br><span class="line">     aaa : <span class="string">&quot;str&quot;</span>,</span><br><span class="line">     bbb : <span class="literal">false</span>,</span><br><span class="line">     ccc : <span class="number">1223</span>,</span><br><span class="line">     time : <span class="keyword">new</span> <span class="built_in">Date</span>,</span><br><span class="line">     simpleArray : [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">     objectArray : [&#123;<span class="attr">name</span>: <span class="string">&quot;a&quot;</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;b&quot;</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;c&quot;</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;d&quot;</span>&#125;],</span><br><span class="line">     object : &#123;</span><br><span class="line">         o1: <span class="string">&quot;k1&quot;</span>,</span><br><span class="line">         o2: <span class="string">&quot;k2&quot;</span>,</span><br><span class="line">         o3: <span class="string">&quot;k3&quot;</span></span><br><span class="line">     &#125;,</span><br><span class="line">     simpleArray : [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">     objectArray : [&#123;<span class="attr">name</span>: <span class="string">&quot;a&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;aa&quot;</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;b&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;bb&quot;</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;c&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;cc&quot;</span>&#125;, &#123;<span class="attr">name</span>: <span class="string">&quot;d&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;dd&quot;</span>&#125;],</span><br><span class="line">     object : &#123;</span><br><span class="line">         o1: <span class="string">&quot;k1&quot;</span>,</span><br><span class="line">         o2: <span class="string">&quot;k2&quot;</span>,</span><br><span class="line">         o3: <span class="string">&quot;k3&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;)</span><br><span class="line"> </span><br><span class="line">       <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="comment">//如果是更新简单数据类型（string, boolean, number）或Date类型</span></span><br><span class="line">           model.aaa = <span class="string">&quot;这是字符串&quot;</span></span><br><span class="line">           model.bbb = <span class="literal">true</span></span><br><span class="line">           model.ccc = <span class="number">999999999999</span></span><br><span class="line">           <span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span></span><br><span class="line">           model.time = <span class="keyword">new</span> <span class="built_in">Date</span>(date.setFullYear(<span class="number">2005</span>))</span><br><span class="line">       &#125;, <span class="number">2000</span>)</span><br><span class="line"> </span><br><span class="line">       <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="comment">//如果是数组，注意保证它们的元素的类型是一致的</span></span><br><span class="line">           <span class="comment">//只能全是字符串，或是全是布尔，不能有一些是这种类型，另一些是其他类型</span></span><br><span class="line">           <span class="comment">//这时我们可以使用set方法来更新（它有两个参数，第一个是index，第2个是新值）</span></span><br><span class="line">           model.simpleArray.set(<span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">           model.simpleArray.set(<span class="number">2</span>, <span class="number">3000</span>)</span><br><span class="line">           model.objectArray.set(<span class="number">0</span>, &#123;<span class="attr">name</span>: <span class="string">&quot;xxxxxxxxxxxxxxxx&quot;</span>, <span class="attr">value</span>: <span class="string">&quot;xxx&quot;</span>&#125;)</span><br><span class="line">       &#125;, <span class="number">2500</span>)</span><br><span class="line">       <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           model.objectArray[<span class="number">1</span>].name = <span class="string">&quot;5555&quot;</span></span><br><span class="line">       &#125;, <span class="number">3000</span>)</span><br><span class="line">       <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">           <span class="comment">//如果要更新对象，直接赋给它一个对象，注意不能将一个VM赋给它，可以到VM的$model赋给它（要不会在IE6-8中报错）</span></span><br><span class="line">           model.object = &#123;</span><br><span class="line">               aaaa: <span class="string">&quot;aaaa&quot;</span>,</span><br><span class="line">               bbbb: <span class="string">&quot;bbbb&quot;</span>,</span><br><span class="line">               cccc: <span class="string">&quot;cccc&quot;</span>,</span><br><span class="line">               dddd: <span class="string">&quot;dddd&quot;</span></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, <span class="number">3000</span>)</span><br><span class="line">   &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;aaa&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;bbb&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;ccc&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;time | date(&quot;yyyy - MM - dd mm:ss&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">ul</span> <span class="attr">ms-each</span>=<span class="string">&quot;simpleArray&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">div</span>&gt;</span>  <span class="tag">&lt;<span class="name">select</span> <span class="attr">ms-each</span>=<span class="string">&quot;objectArray&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">option</span> <span class="attr">ms-value</span>=<span class="string">&quot;el.value&quot;</span>&gt;</span>&#123;&#123;el.name&#125;&#125;<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">ol</span> <span class="attr">ms-with</span>=<span class="string">&quot;object&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;$key&#125;&#125;                &#123;&#123;$val&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="绑定"><a href="#绑定" class="headerlink" title="绑定"></a>绑定</h2><p>avalon的绑定（或指令），拥有以下三种类型：</p>
<ul>
<li><code> {{ }} </code>插值表达式， 这是开标签与闭标签间，换言之，也是位于文本节点中，innerText里。<code> {{ }} </code>里面可以添加各种过滤器（以|进行标识）。值得注意的是<code> {{ }} </code>实际是文本绑定(ms-text)的一种形式。</li>
<li>ms-<em>绑定属性， 这是位于开标签的内部， 95%的绑定都以这种形式存在。 它们的格式大概是这样划分的</em>“ms” + type + “-“ + param1 + “-“ + param1 + “-“ + param2 + … + number = value</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ms-skip                &#x2F;&#x2F;这个绑定属性没有值</span><br><span class="line">ms-controller&#x3D;&quot;expr&quot;   &#x2F;&#x2F;这个绑定属性没有参数</span><br><span class="line">ms-if&#x3D;&quot;expr&quot;           &#x2F;&#x2F;这个绑定属性没有参数</span><br><span class="line">ms-if-loop&#x3D;&quot;expr&quot;       &#x2F;&#x2F;这个绑定属性有一个参数</span><br><span class="line">ms-repeat-el&#x3D;&quot;array&quot;    &#x2F;&#x2F;这个绑定属性有一个参数</span><br><span class="line">ms-attr-href&#x3D;&quot;xxxx&quot;    &#x2F;&#x2F;这个绑定属性有一个参数</span><br><span class="line">ms-attr-src&#x3D;&quot;xxx&#x2F;&#123;&#123;a&#125;&#125;&#x2F;yyy&#x2F;&#123;&#123;b&#125;&#125;&quot;   &#x2F;&#x2F;这个绑定属性的值包含插值表达式，注意只有少部分表示字符串类型的属性可以使用插值表达式</span><br><span class="line">ms-click-1&#x3D;&quot;fn&quot;       &#x2F;&#x2F;这个绑定属性的名字最后有数字，这是方便我们绑定更多点击事件 ms-click-2&#x3D;&quot;fn&quot;  ms-click-3&#x3D;&quot;fn&quot;  </span><br><span class="line">ms-on-click&#x3D;&quot;fn&quot;     &#x2F;&#x2F;只有表示事件与类名的绑定属性的可以加数字，如这个也可以写成  ms-on-click-0&#x3D;&quot;fn&quot;    </span><br><span class="line">ms-class-1&#x3D;&quot;xxx&quot; ms-class-2&#x3D;&quot;yyy&quot; ms-class-3&#x3D;&quot;xxx&quot; &#x2F;&#x2F;数字还表示绑定的次序</span><br><span class="line">ms-css-background-color&#x3D;&quot;xxx&quot; &#x2F;&#x2F;这个绑定属性有两个参数，但在css绑定里，相当于一个，会内部转换为backgroundColor </span><br><span class="line">ms-duplex-aaa-bbb-string&#x3D;&quot;xxx&quot;&#x2F;&#x2F;这个绑定属性有三个参数，表示三种不同的拦截操作</span><br></pre></td></tr></table></figure>

<ul>
<li>data-xxx-yyy=”xxx”，辅助指令，比如ms-duplex的某一个辅助指令为data-duplex-event=”change”，ms-repeat的某一个辅助指令为data-repeat-rendered=”yyy”</li>
</ul>
<hr>
<h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><p>avalon的指令是一个非常重要的东西,它用来引入一些新的HTML语法, 使元素拥有特定的行为。 举例来说，静态的HTML不知道如何来创建和展现一个日期选择器控件。 让HTML能识别这个语法，我们需要使用指令。 指令通过某种方法来创建一个能够支持日期选择的元素。</p>
<p>指令一共拥有3种形式</p>
<ol>
<li>插值表达式</li>
<li>自定义标签</li>
<li>绑定属性</li>
</ol>
<p>其中<code>绑定属性</code>的种类是最多的，它们都位置于元素节点中，以ms-开头或以:开头(avalon2.1.7新增)</p>
<p>绑定属性的属性名是以-分成几段 其中第二个就是指令的名字, 如ms-css, ms-attr, ms-html, ms-text, ms-on都是来源于jQuery同名方法名, 简单好记.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ms-on-click</span>=<span class="string">&quot;@clickFn&quot;</span> <span class="attr">ms-if</span>=<span class="string">&quot;@toggle&quot;</span>&gt;</span>&#123;&#123;@name&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/avalon/avalon01.png"></p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/avalon/avalon02.jpg"></p>
<hr>
<h3 id="插值表达式"><a href="#插值表达式" class="headerlink" title="插值表达式"></a>插值表达式</h3><p>位于文本节点中的双重花括号,当然这个可以配置.此指令其中文本ms-text指令的简单形式.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            aaa: <span class="string">&#x27;aaa&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            bbb: <span class="string">&#x27;bbb&#x27;</span></span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;@aaa&#125;&#125;&#123;&#123;@bbb&#125;&#125; 这个性能差些<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;@aaa+@bbb&#125;&#125; 这个性能好些<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;@aaa+@bbb  | uppercase&#125;&#125; 选择器必须放在表达值的后端<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code> {{ }} </code>里面可以添加各种过滤器（以|进行标识）。值得注意的是<code> {{ }} </code>实际是文本绑定(ms-text)的一种形式。</p>
<h3 id="忽略扫描绑定-ms-skip"><a href="#忽略扫描绑定-ms-skip" class="headerlink" title="忽略扫描绑定(ms-skip)"></a>忽略扫描绑定(ms-skip)</h3><p>这是ms-skip负责。只要元素定义了这个属性，无论它的值是什么，它都不会扫描其他属性及它的子孙节点了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span> <span class="attr">ms-skip</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ms-repeat-num</span>=<span class="string">&quot;cd&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">ms-attr-name</span>=<span class="string">&quot;num&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">ms-data-xxx</span>=<span class="string">&quot;$index&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;$index&#125;&#125; - &#123;&#123;num&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    A：<span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-each</span>=<span class="string">&quot;arr&quot;</span>&gt;</span>&#123;&#123;yy&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ms-controller"><a href="#ms-controller" class="headerlink" title="ms-controller"></a>ms-controller</h3><p>这个指令是用于圈定某个VM的作用域范围(换言之,这个元素的outerHTML会被扫描编译,所有ms-*及双花括号替换成vm中的内容),ms-controller的属性值只能是某个VM的$id</p>
<p>ms-controller的元素节点下面的其他节点也可以使用ms-controller</p>
<p>每个VM的$id可以在页面上出现一次, 因此不要在ms-for内使用ms-controller.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  avalon.define(&#123;</span><br><span class="line"><span class="javascript">      $id: <span class="string">&quot;AAA&quot;</span>,</span></span><br><span class="line"><span class="javascript">      name: <span class="string">&quot;liger&quot;</span>,</span></span><br><span class="line"><span class="javascript">      color: <span class="string">&quot;green&quot;</span>　　</span></span><br><span class="line">  &#125;);</span><br><span class="line">  avalon.define(&#123;</span><br><span class="line"><span class="javascript">      $id: <span class="string">&quot;BBB&quot;</span>,</span></span><br><span class="line"><span class="javascript">      name: <span class="string">&quot;sphinx&quot;</span>,</span></span><br><span class="line"><span class="javascript">      color: <span class="string">&quot;red&quot;</span>　　</span></span><br><span class="line">  &#125;);　　</span><br><span class="line">  avalon.define(&#123;</span><br><span class="line"><span class="javascript">      $id: <span class="string">&quot;CCC&quot;</span>,</span></span><br><span class="line"><span class="javascript">      name: <span class="string">&quot;dragon&quot;</span> <span class="comment">//不存在color</span></span></span><br><span class="line"></span><br><span class="line">  &#125;);</span><br><span class="line">  avalon.define(&#123;</span><br><span class="line"><span class="javascript">      $id: <span class="string">&quot;DDD&quot;</span>,</span></span><br><span class="line"><span class="javascript">      name: <span class="string">&quot;sirenia&quot;</span> <span class="comment">//不存在color</span></span></span><br><span class="line"></span><br><span class="line">  &#125;);　</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;AAA&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;@name&#125;&#125; : &#123;&#123;@color&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;BBB&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;@name&#125;&#125; : &#123;&#123;@color&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;CCC&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;@name&#125;&#125; : &#123;&#123;@color&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-important</span>=<span class="string">&quot;DDD&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;@name&#125;&#125; : &#123;&#123;@color&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当avalon的扫描引擎打描到ms-controller/ms-important所在元素时, 会尝试移除ms-controller类名.因此基于此特性,我们可以在首页渲染页面时, 想挡住双花括号乱码问题,可以尝试这样干(与avalon1有点不一样):</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.ms-controller</span>&#123;</span><br><span class="line">   <span class="attribute">visibility</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-important"><a href="#ms-important" class="headerlink" title="ms-important"></a>ms-important</h3><p>这个指令是用于圈定某个VM的作用域范围(换言之,这个元素的outerHTML会被扫描编译,所有<code>ms-*</code>及双花括号替换成vm中的内容),ms-important的属性值只能是某个VM的$id</p>
<p>ms-important的元素节点下面的其他节点也可以使用<a target="_blank" rel="noopener" href="http://www.itprobie.com/jc/avalon/avalon_html/ms-controller.html">ms-controller</a>或ms-important</p>
<blockquote>
<p>与ms-controller不一同的是,当某个属性在ms-important的VM找不到时,就不会所上寻找</p>
</blockquote>
<blockquote>
<p>不要在ms-for内使用ms-important.</p>
</blockquote>
<p>ms-important这特性有利协作开发,每个人的VM都不会影响其他人,并能大大提高性能</p>
<p>ms-important只能用于ms-controller的元素里面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-important</span>=<span class="string">&#x27;aaa&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;ccc&#x27;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-important</span>=<span class="string">&#x27;ddd&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;bbb&#x27;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-attr"><a href="#ms-attr" class="headerlink" title="ms-attr"></a>ms-attr</h3><p>属性绑定用于为元素节点添加一组属性, 因此要求属性值为对象或数组形式. 数组最后也会合并成一个对象.然后取此对象的键名为属性名, 键值为属性值为元素添加属性</p>
<p>如果键名如果为for, char这样的关键字,请务必在两边加上引号</p>
<p>如果键名如果带横杠,请务必转换为驼峰风格或两边加上引号</p>
<p>注意,不能在ms-attr中设置style属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">ms-attr</span>=<span class="string">&quot;&#123;style:&#x27;width:20px&#x27;&#125;&quot;</span>&gt;</span>这样写是错的,需要用ms-css指令!!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>示例:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            obj: &#123;<span class="attr">title</span>: <span class="string">&#x27;普通 &#x27;</span>, <span class="attr">algin</span>: <span class="string">&#x27;left&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">            active: &#123;<span class="attr">title</span>: <span class="string">&#x27;激活&#x27;</span>&#125;,</span></span><br><span class="line">            width: 111,</span><br><span class="line">            height: 222,</span><br><span class="line"><span class="javascript">            arr: [&#123;<span class="attr">img</span>: <span class="string">&#x27;aaa&#x27;</span>&#125;, &#123;<span class="attr">img</span>: <span class="string">&#x27;bbb&#x27;</span>&#125;, &#123;<span class="attr">img</span>: <span class="string">&#x27;ccc&#x27;</span>&#125;],</span></span><br><span class="line"><span class="javascript">            path: <span class="string">&#x27;../aaa/image.jpg&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            toggle: <span class="literal">false</span>,</span></span><br><span class="line">            array: [&#123;width: 1&#125;, &#123;height: 2&#125;]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">ms-attr</span>=<span class="string">&quot;@obj&quot;</span>&gt;</span>直接引用对象<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">ms-attr</span>=<span class="string">&quot;&#123;src: @path&#125;&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&quot;el in @arr&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">ms-attr</span>=<span class="string">&quot;&#123;href:&#x27;http://www.ccc.xxx/ddd/&#x27;+ el.img&#125;&quot;</span>&gt;</span>下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:attr</span>=<span class="string">&quot;&#123;width: @width, height: @height&#125;&quot;</span>&gt;</span>使用对象字面量<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:attr</span>=<span class="string">&quot;@array&quot;</span>&gt;</span>直接引用数组<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:attr</span>=<span class="string">&quot;[@obj, @toggle &amp;&amp; @active ]&quot;</span> <span class="attr">:click</span>=<span class="string">&quot;@toggle = !@toggle&quot;</span>&gt;</span>选择性添加多余属性或重写已有属性<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-css"><a href="#ms-css" class="headerlink" title="ms-css"></a>ms-css</h3><p>CSS绑定用于为元素节点添加一组样式, 因此要求属性值为对象或数组形式. 数组最后也会合并成一个对象.然后取此对象的键名为样式名, 键值为样式值为元素添加样式</p>
<blockquote>
<p>如果键名为表示长宽,字体大小这样的样式, 那么键值不需要加单位,会自动加上px</p>
<p>如果键名如果为float,请务必在两边加上引号</p>
<p>如果键名如果为font-size,请务必转换为驼峰风格或两边加上引号</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            obj: &#123;<span class="attr">backgroundColor</span>: <span class="string">&#x27;#3bb0d0&#x27;</span>,<span class="attr">width</span>:<span class="number">300</span>, <span class="attr">height</span>:<span class="number">50</span>, <span class="string">&#x27;text-align&#x27;</span>: <span class="string">&#x27;center&#x27;</span>&#125;,<span class="comment">//属性名带-,必须用引号括起</span></span></span><br><span class="line"><span class="javascript">            active: &#123;<span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>&#125;,</span></span><br><span class="line">            width:  300,</span><br><span class="line">            height: 60,</span><br><span class="line"><span class="javascript">            toggle: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            array: [&#123;<span class="attr">width</span>:<span class="number">100</span>&#125;,&#123;<span class="attr">height</span>:<span class="number">50</span>&#125;,&#123;<span class="attr">border</span>: <span class="string">&#x27;1px solid #5cb85c&#x27;</span>&#125;]</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-css</span>=<span class="string">&quot;@obj&quot;</span>&gt;</span>直接引用对象<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:css</span>=<span class="string">&quot;&#123;width: @width, height: @height,background: &#x27;pink&#x27;&#125;&quot;</span>&gt;</span>使用对象字面量<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:css</span>=<span class="string">&quot;@array&quot;</span>&gt;</span>直接引用数组<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:css</span>=<span class="string">&quot;[@obj, @toggle &amp;&amp; @active ]&quot;</span> <span class="attr">:click</span>=<span class="string">&quot;@toggle = !@toggle&quot;</span>&gt;</span>选择性添加多余属性或重写已有属性<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是 设置背景图片是比较复杂</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">:css</span>=<span class="string">&quot;&#123;background: &#x27;url(&#x27;+@imageUrl + &#x27;) no-repeat center center;&#x27;&#125;&quot;</span>&gt;</span>图片<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">:css</span>=<span class="string">&quot;&#123;backgroundImage: &#x27;url(&#x27;+@imageUrl + &#x27;)&#x27;&#125;&quot;</span>&gt;</span>图片<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-text"><a href="#ms-text" class="headerlink" title="ms-text"></a>ms-text</h3><p>文本绑定是最简单的绑定,它其实是双花括号插值表达式的一种形式</p>
<p>它要求VM对应的属性的类型为字符串, 数值及布尔, 如果是null, undefined将会被转换为空字符串</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ms-text</span>=<span class="string">&quot;@aaa&quot;</span>&gt;</span>不使用过滤器<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ms-text</span>=<span class="string">&quot;@aaa | uppercase&quot;</span>&gt;</span>使用过滤器<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-html"><a href="#ms-html" class="headerlink" title="ms-html"></a>ms-html</h3><p>HTML绑定类似于文本绑定,能将一个元素清空,填上你需要的内容</p>
<p>它要求VM对应的属性的类型为字符串</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ms-html</span>=<span class="string">&quot;@aaa&quot;</span>&gt;</span>不使用过滤器<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">ms-html</span>=<span class="string">&quot;@aaa | uppercase&quot;</span>&gt;</span>使用过滤器<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们可以通过ms-html异步加载大片内容。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">:controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">  $id: <span class="string">&quot;test&quot;</span>,</span></span><br><span class="line"><span class="javascript">  aaa: <span class="string">&quot;loading...&quot;</span></span></span><br><span class="line">&#125;)</span><br><span class="line">jQuery.ajax(&#123;</span><br><span class="line"><span class="javascript">   url:<span class="string">&#x27;action.do&#x27;</span>,</span></span><br><span class="line"><span class="javascript">   success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span></span><br><span class="line">      vm.aaa = data.html</span><br><span class="line">   &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-html</span>=<span class="string">&quot;@aaa&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-duplex"><a href="#ms-duplex" class="headerlink" title="ms-duplex"></a>ms-duplex</h3><p>双工绑定是MVVM框架中最强大的指令.react推崇单向数据流,没有双工绑定, 那么需要rudex等额外的库来实现相同的功能.</p>
<p>双工绑定只要用于表单元素上.或当一个div设置了contenteditable为true,也可以用ms-duplex指令.</p>
<p>注意：ms-duplex与ms-checked不能在同时使用于一个元素节点上。</p>
<p>注意：如果表单元素同时绑定了ms-duplex=xxx与ms-click或ms-change，而事件回调要立即得到这个vm.xxx的值，input[type=radio]是存在问题，它不能立即得到当前值，而是之前的值，需要在回调里面加个setTimeout。</p>
<p><strong>各个表单元素的用法</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            aaa: <span class="string">&#x27;aaa&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            bbb: <span class="string">&#x27;bbb&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            ccc: <span class="string">&#x27;ccc&#x27;</span></span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa&quot;</span>/&gt;</span>&#123;&#123;@aaa&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@bbb&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span>/&gt;</span>&#123;&#123;@bbb&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@ccc&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span>&#123;&#123;@ccc&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面有三个控件,text, password, textarea它们都是属于输入型控件, 只要每为控件敲入一个字符, 后面的文本都会立即变化.那是因为它们默认是绑定<strong>oninput</strong>事件,如果想控件全部输入好,失去焦点时 才同步,那么可以使用<code>change</code>过滤器</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa | change&quot;</span>/&gt;</span>&#123;&#123;@aaa&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>如果你是做智能提示, 控件是绑定了一个AJAX请求与后端不断交互, 使用oninput事件会太频繁, 使用onchange事件会太迟钝,那么我们可以使用<code>debounce</code>过滤器</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa | debounce(300)&quot;</span>/&gt;</span>&#123;&#123;@aaa&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>300ms同步一次.</p>
<p>另外,可编辑元素的用法与过滤器与上面三种控件一样.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">contenteditable</span>=<span class="string">&quot;true&quot;</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa | debounce(300)&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;@aaa&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这两个过滤器只能适用于上面的情况.</p>
</blockquote>
<p>此外, 控件还有许多种, 像checkbox, radio,它们的同步机制也不一样.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            aaa: <span class="string">&#x27;33&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            bbb: [<span class="string">&#x27;22&#x27;</span>]</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>  <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;22&quot;</span>  <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;33&quot;</span>  <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>  <span class="attr">ms-duplex</span>=<span class="string">&quot;@bbb&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;22&quot;</span>  <span class="attr">ms-duplex</span>=<span class="string">&quot;@bbb&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;33&quot;</span>  <span class="attr">ms-duplex</span>=<span class="string">&quot;@bbb&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>radio: &#123;&#123;@aaa&#125;&#125;; checkbox:&#123;&#123;@bbb&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>checkbox与radio是一点击就会更新.radio要求在vm中为一个简单数据类型数据,字符串,数字或布尔. 而checkbox则要求是一个数组.并且在最开始时,ms-duplex会令radio钩上其value值等vm属性的控件, checkbox则可以勾选多个.如此一来,vm中的属性些总是等于radio与checkbox的属性值.但我们也可以让 vm的属性值等于此控件的勾选状态,这时需要用上<code>ms-duplex-checked</code>转换器.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            aaa: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">            bbb: <span class="literal">false</span></span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span>  <span class="attr">ms-duplex-checked</span>=<span class="string">&quot;@aaa&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span>  <span class="attr">ms-duplex-checked</span>=<span class="string">&quot;@bbb&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>radio: &#123;&#123;@aaa&#125;&#125;; checkbox:&#123;&#123;@bbb&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后表单元素还有select控件,它根据其multiple属性分为单选下拉框与复选下拉框, 其在vm中的值与radio,checkbox一样.即单选时,必须是一个简单数据类型, 复选时为一个数组. 在最开始时, 当option元素的value值或innerText(不在value值)与数据相同,它们就会被选上.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            aaa: <span class="string">&#x27;bbb&#x27;</span></span></span><br><span class="line"><span class="javascript">            bbb: [<span class="string">&#x27;bbb&#x27;</span>,<span class="string">&#x27;ccc&#x27;</span>],</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">:duplex</span>=<span class="string">&quot;@aaa&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">multiple</span>=<span class="string">&quot;true&quot;</span> <span class="attr">:duplex</span>=<span class="string">&quot;@bbb&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>aaa<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>bbb<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;<span class="name">option</span>&gt;</span>ccc<span class="tag">&lt;/<span class="name">option</span>&gt;</span><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">控件</th>
<th align="center">触发时机</th>
<th align="right">数据</th>
</tr>
</thead>
<tbody><tr>
<td align="left">text,password,textarea及可编辑元表</td>
<td align="center">oninput,onchange, debounce</td>
<td align="right">简单数据</td>
</tr>
<tr>
<td align="left">radio,checkbox</td>
<td align="center">onclick</td>
<td align="right">简单数据或数组</td>
</tr>
<tr>
<td align="left">select</td>
<td align="center">onchange</td>
<td align="right">简单数据或数组</td>
</tr>
</tbody></table>
<p><strong>数据转换</strong></p>
<p>上面我们已经提到一个数据转换器ms-duplex-checked了.那只能用于checkbox与radio.</p>
<p>为什么会有这种东西呢?因为无论我们原来的数据类型是什么,跑到表单中都会变成字符串,然后我们通过事件取出来 它们也是字符串,不会主动变回<code>原来的类型</code>.我们需要一种机制保持数据原来的类型,这就是数据转换器.</p>
<p>avalon内置了4种过滤器</p>
<ol>
<li>ms-duplex-string=”@aaa”</li>
<li>ms-duplex-number=”@aaa”</li>
<li>ms-duplex-boolean=”@aaa”</li>
<li>ms-duplex-checked=”@aaa”</li>
</ol>
<p>前三个是将元素的value值转换成string, number, boolean（只有为’false’时转换为false）</p>
<p>最后是根据当前元素（它只能是radio或checkbox）的checked属性值转换为vm对应属性的值。</p>
<p>它们都是放在属性名上。当数据从元素节点往vmodel同步时，转换成预期的数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>  <span class="attr">ms-duplex-number</span>=<span class="string">&quot;@aaa&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>数据格式化</strong></p>
<p>一般来说,数据格式化是由过滤器实现的,如</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>  <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa | uppercase&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>但这里有一个隐患,可能导致死循环, 因此建议放在事件回调中实现.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">        $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        aaa: <span class="string">&#x27;111&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        bbb: <span class="string">&#x27;222&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        format1: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="comment">//只能输入数字</span></span></span><br><span class="line"><span class="javascript">           vm.aaa = e.target.value.replace(<span class="regexp">/\D/g</span>,<span class="string">&#x27;&#x27;</span>)</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        format1: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="comment">//只能输入数字</span></span></span><br><span class="line"><span class="javascript">           vm.bbb = avalon.filter.date(e.target.value, <span class="string">&#x27;yyyy-MM-dd&#x27;</span>)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">:duplex</span>=<span class="string">&quot;@aaa&quot;</span> <span class="attr">:on-input</span>=<span class="string">&quot;@format1&quot;</span>/&gt;</span>&#123;&#123;@aaa&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">:duplex</span>=<span class="string">&quot;@bbb&quot;</span> <span class="attr">:on-change</span>=<span class="string">&quot;@format2&quot;</span>/&gt;</span>&#123;&#123;@bbb&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>数据格式化是放在属性值时，以过滤器形式存在，如</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ms-duplex=<span class="string">&#x27;@aaa | uppercase&#x27;</span></span><br><span class="line">ms-duplex=<span class="string">&#x27;@aaa | date(&#x27;</span>yyyy:MM:dd<span class="string">&#x27;)&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>数据验证</strong></p>
<p>这必须在所有表单元素的上方form元素加上ms-validate指令, 当前元素加上ms-rules才会生效</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">ms-validate</span>=<span class="string">&quot;@validation&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&#x27;@aaa&#x27;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">ms-rules</span>=<span class="string">&#x27;require,email,maxlength&#x27;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">data-maxlength</span>=<span class="string">&#x27;4&#x27;</span> </span></span><br><span class="line"><span class="tag">       <span class="attr">data-maxlength-message</span>=<span class="string">&#x27;太长了&#x27;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>详见<a target="_blank" rel="noopener" href="http://www.itprobie.com/jc/avalon/avalon_html/ms-rules.html">ms-rules</a>指令</p>
<p><strong>同步后的回调</strong></p>
<p>ms-duplex还有一个回调，data-duplex-changed，用于与事件绑定一样， 默认第一个参数为事件对象。如果传入多个参数，那么使用$event为事件对象占位。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;11&quot;</span>  <span class="attr">ms-duplex-number</span>=<span class="string">&quot;@aaa&quot;</span> <span class="attr">data-duplex-changed</span>=<span class="string">&quot;@fn&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>示例</strong></p>
<p>现在我们来一些实际的例子!</p>
<p><strong>全选与非全选</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = avalon.define(&#123;</span><br><span class="line">    $id: <span class="string">&quot;duplex1&quot;</span>,</span><br><span class="line">    data: [&#123;<span class="attr">checked</span>: <span class="literal">false</span>&#125;, &#123;<span class="attr">checked</span>: <span class="literal">false</span>&#125;, &#123;<span class="attr">checked</span>: <span class="literal">false</span>&#125;],</span><br><span class="line">    allchecked: <span class="literal">false</span>,</span><br><span class="line">    checkAll: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> checked = e.target.checked</span><br><span class="line">        vm.data.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">            el.checked = checked</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    checkOne: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> checked = e.target.checked</span><br><span class="line">        <span class="keyword">if</span> (checked === <span class="literal">false</span>) &#123;</span><br><span class="line">            vm.allchecked = <span class="literal">false</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="comment">//avalon已经为数组添加了ecma262v5的一些新方法</span></span><br><span class="line">            vm.allchecked = vm.data.every(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> el.checked</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;table ms-controller=<span class="string">&quot; duplex1&quot;</span> border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">        &lt;td&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> </span></span></span><br><span class="line"><span class="xml">                   ms-duplex-checked=&quot;@allchecked&quot; </span></span><br><span class="line"><span class="xml">                   data-duplex-changed=&quot;@checkAll&quot;/&gt;</span>全选&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">    &lt;tr ms-<span class="keyword">for</span>=<span class="string">&quot;($index, el) in @data&quot;</span>&gt;</span><br><span class="line">        &lt;td&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">ms-duplex-checked</span>=<span class="string">&quot;el.checked&quot;</span> <span class="attr">data-duplex-changed</span>=<span class="string">&quot;@checkOne&quot;</span> /&gt;</span></span>&#123;&#123;$index&#125;&#125;::&#123;&#123;el.checked&#125;&#125;&lt;/td&gt;</span><br><span class="line">    &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>

<p>我们仔细分析其源码，allchecked是用来控制最上面的复选框的打勾情况， 数组中的checked是用来控制下面每个复选框的下勾情况。由于是使用ms-duplex，因此会监听用户行为， 当复选框的状态发生改变时，就会触发data-duplex-changed回调，将当前值传给回调。 但这里我们不需要用它的value值，只用它的checked值。</p>
<p>最上面的复选框对应的回调是checkAll，它是用来更新数组的每个元素的checked属性，因此一个forEach循环赋值就是。</p>
<p>下面的复选框对应的checkOne，它们是用来同步最上面的复选框，只要它们有一个为false上面的复选框就不能打勾， 当它们被打勾了，它们就得循环整个数组，检查是否所有元素都为true，是才给上面的checkall属性置为true。</p>
<p>现在我们学了循环指令，结合它来做一个表格看看。现在有了强大无比的orderBy, limitBy, filterBy, selectBy。 我们做高性能的大表格是得心应手的！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> (!<span class="built_in">Date</span>.now) &#123;<span class="comment">//fix 旧式IE</span></span><br><span class="line">    <span class="built_in">Date</span>.now = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Date</span> - <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">avalon.define(&#123;</span><br><span class="line">    $id: <span class="string">&quot;duplex2&quot;</span>,</span><br><span class="line">    selected: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">    options: [<span class="string">&quot;name&quot;</span>, <span class="string">&quot;size&quot;</span>, <span class="string">&quot;date&quot;</span>],</span><br><span class="line">    trend: <span class="number">1</span>,</span><br><span class="line">    data: [</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;aaa&quot;</span>, <span class="attr">size</span>: <span class="number">213</span>, <span class="attr">date</span>: <span class="built_in">Date</span>.now() + <span class="number">20</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;bbb&quot;</span>, <span class="attr">size</span>: <span class="number">4576</span>, <span class="attr">date</span>:<span class="built_in">Date</span>.now() - <span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;ccc&quot;</span>, <span class="attr">size</span>: <span class="number">563</span>, <span class="attr">date</span>: <span class="built_in">Date</span>.now() - <span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;eee&quot;</span>, <span class="attr">size</span>: <span class="number">3713</span>, <span class="attr">date</span>: <span class="built_in">Date</span>.now() + <span class="number">9</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;555&quot;</span>, <span class="attr">size</span>: <span class="number">389</span>, <span class="attr">date</span>: <span class="built_in">Date</span>.now() - <span class="number">20</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br><span class="line">&lt;div ms-controller=<span class="string">&quot; duplex2&quot;</span>&gt;</span><br><span class="line">&lt;div style=<span class="string">&quot;color:red&quot;</span>&gt;</span><br><span class="line">    &lt;p&gt;本例子用于显示如何做一个简单的表格排序&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;p&gt;</span><br><span class="line">    &lt;select ms-duplex=<span class="string">&quot;@selected&quot;</span>&gt;</span><br><span class="line">        &lt;option  ms-<span class="keyword">for</span>=<span class="string">&quot;el in @options&quot;</span>&gt;&#123;&#123;el&#125;&#125;&lt;/option&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">    &lt;select ms-duplex-number=<span class="string">&quot;@trend&quot;</span>&gt;</span><br><span class="line">        &lt;option value=<span class="string">&quot;1&quot;</span>&gt;up&lt;/option&gt;</span><br><span class="line">        &lt;option value=<span class="string">&quot;-1&quot;</span>&gt;down&lt;/option&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/p&gt;</span><br><span class="line">&lt;table width=<span class="string">&quot;500px&quot;</span> border=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">    &lt;tbody &gt;</span><br><span class="line">        &lt;tr ms-<span class="keyword">for</span>=<span class="string">&quot;el in @data | orderBy(@selected, @trend)&quot;</span>&gt;</span><br><span class="line">            &lt;td&gt;&#123;&#123;el.name&#125;&#125;&lt;<span class="regexp">/td&gt; &lt;td&gt;&#123;&#123;el.size&#125;&#125;&lt;/</span>td&gt; <span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;el.date&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span></span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/tbody&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>我们再来一个文本域与下拉框的联动例子，它只用到ms-duplex，不过两个控件都是绑定同一个属性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">avalon.define(&#123;</span><br><span class="line">    $id: &quot;fruit&quot;,</span><br><span class="line">    options: [&quot;苹果&quot;, &quot;香蕉&quot;, &quot;桃子&quot;, &quot;雪梨&quot;, &quot;葡萄&quot;,</span><br><span class="line">        &quot;哈蜜瓜&quot;, &quot;橙子&quot;, &quot;火龙果&quot;, &quot;荔技&quot;, &quot;黄皮&quot;],</span><br><span class="line">    selected: &quot;桃子&quot;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot; fruit&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>文本域与下拉框的联动<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span>  <span class="attr">ms-duplex</span>=<span class="string">&quot;@selected&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@selected&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">ms-for</span>=<span class="string">&quot;el in @options&quot;</span> <span class="attr">ms-attr</span>=<span class="string">&quot;&#123;value: el&#125;&quot;</span> &gt;</span></span><br><span class="line">        &#123;&#123;el&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>下拉框三级联动</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = &#123;</span><br><span class="line">    <span class="string">&quot;中国&quot;</span>: [<span class="string">&quot;江南四大才子&quot;</span>, <span class="string">&quot;初唐四杰&quot;</span>, <span class="string">&quot;战国四君子&quot;</span>],</span><br><span class="line">    <span class="string">&quot;日本&quot;</span>: [<span class="string">&quot;日本武将&quot;</span>, <span class="string">&quot;日本城堡&quot;</span>, <span class="string">&quot;幕府时代&quot;</span>],</span><br><span class="line">    <span class="string">&quot;欧美&quot;</span>: [<span class="string">&quot;三大骑士团&quot;</span>, <span class="string">&quot;三大魔幻小说&quot;</span>, <span class="string">&quot;七大奇迹&quot;</span>],</span><br><span class="line">    <span class="string">&quot;江南四大才子&quot;</span>: [<span class="string">&quot;祝枝山&quot;</span>, <span class="string">&quot;文征明&quot;</span>, <span class="string">&quot;唐伯虎&quot;</span>, <span class="string">&quot;周文宾&quot;</span>],</span><br><span class="line">    <span class="string">&quot;初唐四杰&quot;</span>: [<span class="string">&quot;王勃&quot;</span>, <span class="string">&quot;杨炯&quot;</span>, <span class="string">&quot;卢照邻&quot;</span>, <span class="string">&quot;骆宾王&quot;</span>],</span><br><span class="line">    <span class="string">&quot;战国四君子&quot;</span>: [<span class="string">&quot;楚国春申君黄歇&quot;</span>, <span class="string">&quot;齐国孟尝君田文&quot;</span>, <span class="string">&quot;赵国平原君赵胜&quot;</span>, <span class="string">&quot;魏国信陵君魏无忌&quot;</span>],</span><br><span class="line">    <span class="string">&quot;日本武将&quot;</span>: [<span class="string">&quot;织田信长&quot;</span>, <span class="string">&quot;德川家康&quot;</span>, <span class="string">&quot;丰臣秀吉&quot;</span>],</span><br><span class="line">    <span class="string">&quot;日本城堡&quot;</span>: [<span class="string">&quot;安土城&quot;</span>, <span class="string">&quot;熊本城&quot;</span>, <span class="string">&quot;大坂城&quot;</span>, <span class="string">&quot;姬路城&quot;</span>],</span><br><span class="line">    <span class="string">&quot;幕府时代&quot;</span>: [<span class="string">&quot;镰仓&quot;</span>, <span class="string">&quot;室町&quot;</span>, <span class="string">&quot;丰臣&quot;</span>, <span class="string">&quot;江户&quot;</span>],</span><br><span class="line">    <span class="string">&quot;三大骑士团&quot;</span>: [<span class="string">&quot;圣殿骑士团&quot;</span>, <span class="string">&quot;医院骑士团&quot;</span>, <span class="string">&quot;条顿骑士团&quot;</span>],</span><br><span class="line">    <span class="string">&quot;三大魔幻小说&quot;</span>: [<span class="string">&quot;冰与火之歌&quot;</span>, <span class="string">&quot;时光之轮&quot;</span>, <span class="string">&quot;荆刺与白骨之王国&quot;</span>],</span><br><span class="line">    <span class="string">&quot;七大奇迹&quot;</span>: [<span class="string">&quot;埃及胡夫金字塔&quot;</span>, <span class="string">&quot;奥林匹亚宙斯巨像&quot;</span>, <span class="string">&quot;阿尔忒弥斯月神殿&quot;</span>, <span class="string">&quot;摩索拉斯陵墓&quot;</span>, <span class="string">&quot;亚历山大港灯塔&quot;</span>, <span class="string">&quot;巴比伦空中花园&quot;</span>, <span class="string">&quot;罗德岛太阳神巨像&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> vm = avalon.define(&#123;</span><br><span class="line">    $id: <span class="string">&#x27;linkage&#x27;</span>,</span><br><span class="line">    first: [<span class="string">&quot;中国&quot;</span>, <span class="string">&quot;日本&quot;</span>, <span class="string">&quot;欧美&quot;</span>],</span><br><span class="line">    second: map[<span class="string">&#x27;日本&#x27;</span>].concat(),</span><br><span class="line">    third: map[<span class="string">&#x27;日本武将&#x27;</span>].concat(),</span><br><span class="line">    firstSelected: <span class="string">&quot;日本&quot;</span>,</span><br><span class="line">    secondSelected: <span class="string">&quot;日本武将&quot;</span>,</span><br><span class="line">    thirdSelected: <span class="string">&quot;织田信长&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vm.$watch(<span class="string">&quot;firstSelected&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">    vm.second = map[a].concat()</span><br><span class="line">    vm.secondSelected = vm.second[<span class="number">0</span>]</span><br><span class="line">&#125;)</span><br><span class="line">vm.$watch(<span class="string">&quot;secondSelected&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">    vm.third = map[a].concat()</span><br><span class="line">    vm.thirdSelected = vm.third[<span class="number">0</span>]</span><br><span class="line">&#125;)</span><br><span class="line">&lt;div ms-controller=<span class="string">&quot; linkage&quot;</span>&gt;</span><br><span class="line">&lt;h3&gt;下拉框三级联动&lt;/h3&gt;</span><br><span class="line">&lt;select ms-duplex=<span class="string">&quot;@firstSelected&quot;</span> &gt;</span><br><span class="line">    &lt;option  ms-<span class="keyword">for</span>=<span class="string">&quot;el in @first&quot;</span> ms-attr=<span class="string">&quot;&#123;value:el&#125;&quot;</span> &gt;&#123;&#123;el&#125;&#125;&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;select ms-duplex=<span class="string">&quot;@secondSelected&quot;</span> &gt;</span><br><span class="line">    &lt;option  ms-<span class="keyword">for</span>=<span class="string">&quot;el in @second&quot;</span> ms-attr=<span class="string">&quot;&#123;value:el&#125;&quot;</span> &gt;&#123;&#123;el&#125;&#125;&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;select ms-duplex=<span class="string">&quot;@thirdSelected&quot;</span> &gt;</span><br><span class="line">    &lt;option  ms-<span class="keyword">for</span>=<span class="string">&quot;el in @third&quot;</span> ms-attr=<span class="string">&quot;&#123;value:el&#125;&quot;</span> &gt;&#123;&#123;el&#125;&#125;&lt;/option&gt;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>这里的技巧在于使用$watch回调来同步下一级的数组与选中项。注意，使用concat方法来复制数组。</p>
<hr>
<h3 id="ms-for"><a href="#ms-for" class="headerlink" title="ms-for"></a>ms-for</h3><p>avalon2.0的ms-for绑定集齐了ms-repeat, ms-each, ms-with的所有功能, 并且更好用, 性能提升七八倍</p>
<p>ms-for可以同时循环对象与数组</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&quot;el in @aaa&quot;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在采用类似angular的语法, in前面如果只有一个变量,那么它就是数组元素或对象的属性名</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vm.aaa = [<span class="string">&#x27;aaa&#x27;</span>,<span class="string">&#x27;bbb&#x27;</span>,<span class="string">&#x27;ccc&#x27;</span>]</span><br><span class="line">vm.bbb = &#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span>&#125;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li ms-<span class="keyword">for</span>=<span class="string">&quot;(aaa, el) in @aaa&quot;</span>&gt;&#123;&#123;aaa&#125;&#125;-&#123;&#123;el&#125;&#125;&lt;/li&gt;</span><br><span class="line">&lt;/ul</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li ms-<span class="keyword">for</span>=<span class="string">&quot;(k, v) in @bbb&quot;</span>&gt;&#123;&#123;k&#125;&#125;-&#123;&#123;v&#125;&#125;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<p>依次输出的LI元素内容为0-aaa,1-bbb,2-ccc, a-1,b-2,c-3</p>
<p>in 前面有两个变量, 它们需要放在小括号里,以逗号隔开, 那么分别代表数组有索引值与元素, 或对象的键名与键值, 这个与jQuery或avalon的each方法的回调参数一致。</p>
<blockquote>
<p>小括号里面的变量是随便起的,主要能符合JS变量命名规范就行,当然,也不要与window, this这样变量冲突.</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&quot;($index, el) in @arr&quot;</span>&gt;</span>&#123;&#123;$index&#125;&#125;-&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&quot;($key, $val) in @obj&quot;</span>&gt;</span>&#123;&#123;$key&#125;&#125;-&#123;&#123;$val&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>写成这样,就与avalon1.*很相像了</p>
<p>ms-for还可以配套<strong>data-for-rendered</strong>回调,当列表渲染好时执行此方法</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&quot;el in @arr&quot;</span> <span class="attr">data-for-rendered</span>=<span class="string">&#x27;@fn&#x27;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>fn为vm中的一个函数，用法与<code>ms-on-*</code>差不多，如果不传参，默认第一个参数为事件对象，类型type为<code>rendered</code>， target为当前循环区域的父节点，这里为｀ul`元素。并且回调中的this指向vm。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">type</span>: <span class="string">&#x27;rendered&#x27;</span>, <span class="attr">target</span>: ULElement &#125;</span><br></pre></td></tr></table></figure>

<p>你也可以在回调里面传入其他东西，使用<code>$event</code>代表事件对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&quot;el in @arr&quot;</span> <span class="attr">data-for-rendered</span>=<span class="string">&quot;@fn(&#x27;xxx&#x27;,$event)&quot;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你想截取数组的一部分出来单独循环,可以用limitBy过滤器, 使用as来引用新数组</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&quot;el in @aaa | limitBy(10) as items&quot;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上例是显示数组的前10个元素, 并且将这10个元素存放在items数组中, 以保存过滤或排序结果</p>
<p>使用注释节点实现循环,解决同时循环多个元素的问题</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>TODO supply a title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/avalon.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">            vm = avalon.define(&#123;</span><br><span class="line"><span class="javascript">                $id: <span class="string">&#x27;for4&#x27;</span>,</span></span><br><span class="line">                arr: [1, 2, 3, 4]</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;for4&#x27;</span>  &gt;</span></span><br><span class="line">            <span class="comment">&lt;!--ms-for: el in @arr--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--ms-for-end:--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>avalon 不需要像angular那样要求用户指定trace by或像react 那样使用key属性来提高性能,内部帮你搞定一切</p>
<p>如果你只想循环输出数组的其中一部分,请使用filterBy,只想循环输出对象某一些键值并设置默认值,则用selectBy. 不要在同一个元素上使用ms-for与ms-if,因为这样做会在页面上生成大量的注释节点,影响页面性能</p>
<p>可用于ms-for中的过滤器有limitBy, filterBy, selectby, orderBy</p>
<blockquote>
<p>ms-for支持下面的元素节点继续使用ms-for,形成双重循环与多级循环, 但要求双重循环对应的二维数组.几维循环对应几维数组</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vm.array = [&#123;<span class="attr">arr</span>: [<span class="number">111</span>,<span class="number">222</span>, <span class="number">333</span>]&#125;,&#123;<span class="attr">arr</span>: [<span class="number">111</span>,<span class="number">222</span>, <span class="number">333</span>]&#125;,&#123;<span class="attr">arr</span>: [<span class="number">111</span>,<span class="number">222</span>, <span class="number">333</span>]&#125;]</span><br><span class="line">&lt;p&gt;array的元素里面有子数组,形成<span class="number">2</span>维数组&lt;/p&gt;        </span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li ms-<span class="keyword">for</span>=<span class="string">&quot;el in @array&quot;</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-for</span>=<span class="string">&#x27;elem in el.arr&#x27;</span>&gt;</span>&#123;&#123;elem&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<p><strong>如何双向绑定ms-for中生成的变量?</strong></p>
<p>由于 循环生成的变量前面不带@, 因此就找不到其对应的属性,需要特别处理一下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-for</span>=<span class="string">&quot;(key,el) in @styles&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123; key &#125;&#125;::&#123;&#123; el &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@styles[key]&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!--不能ms-duplex=&quot;el&quot;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> root = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">        $id: <span class="string">&quot;test&quot;</span>,</span></span><br><span class="line">        styles: &#123;</span><br><span class="line">            width: 200,</span><br><span class="line">            height: 200,</span><br><span class="line">            borderWidth: 1,</span><br><span class="line"><span class="javascript">            borderColor: <span class="string">&quot;red&quot;</span>,</span></span><br><span class="line"><span class="javascript">            borderStyle: <span class="string">&quot;solid&quot;</span>,</span></span><br><span class="line"><span class="javascript">            backgroundColor: <span class="string">&quot;gray&quot;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-class"><a href="#ms-class" class="headerlink" title="ms-class"></a>ms-class</h3><p><strong>类名绑定</strong></p>
<p>属性绑定用于为元素节点添加几个类名, 因此要求属性值为字符串或字符串数组.</p>
<p>字符串形式下,可以使用空格隔开多个类名</p>
<p>字符串数组形下, 可以在里面使用三元运算符或与或号</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            aaa: <span class="string">&quot;aaa bbb ccc&quot;</span>,</span></span><br><span class="line"><span class="javascript">            bbb: <span class="string">&#x27;ddd&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            ccc: [<span class="string">&#x27;xxx&#x27;</span>, <span class="string">&#x27;yyy&#x27;</span>, <span class="string">&#x27;zzz&#x27;</span>],</span></span><br><span class="line"><span class="javascript">            ddd: <span class="string">&#x27;eee&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            toggle: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            toggle2: <span class="literal">false</span></span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;@aaa&quot;</span>&gt;</span>直接引用字符串<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;@ccc&quot;</span>&gt;</span>直接引用数组<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;[@aaa, @bbb]&quot;</span>&gt;</span>使用数组字面量<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;[&#x27;aaa&#x27;, &#x27;bbb&#x27;,(@toggle? &#x27;ccc&#x27;:&#x27;ddd&#x27;)]&quot;</span>&gt;</span>选择性添加类名<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;[@toggle &amp;&amp; &#x27;aaa&#x27;]&quot;</span>&gt;</span>选择性添加类名<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">:class</span>=<span class="string">&quot;[ @ddd + 4]&quot;</span>&gt;</span>动态生成类名<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-if"><a href="#ms-if" class="headerlink" title="ms-if"></a>ms-if</h3><p>通过属性值决定是否渲染目标元素, 为否时原位置上变成一个注释节点</p>
<blockquote>
<p><code>avalon1.*</code>中ms-if-loop指令已经被废掉,请使用limitBy, selectBy, filterBy过滤器代替相应功能</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">:controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">  $id: <span class="string">&quot;test&quot;</span>,</span></span><br><span class="line"><span class="javascript">  aaa: <span class="string">&quot;这是被隐藏的内容&quot;</span></span></span><br><span class="line"><span class="javascript">  toggle: <span class="literal">false</span></span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">:click</span>=<span class="string">&#x27;@toggle = !@toggle&#x27;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:if</span>=<span class="string">&quot;@toggle&quot;</span>&gt;</span>&#123;&#123;@aaa&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意,有许多人喜欢用ms-if做非空处理,这是不对的,因此ms-if只是决定它是否插入DOM树与否,ms-if里面的 **ms-**指令还是会执行.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">avalon.define(&#123;</span><br><span class="line">  $id: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">  aaa: &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;div ms-controller=<span class="string">&quot;test&quot;</span>&gt;</span><br><span class="line">   &lt;div ms-<span class="keyword">if</span>=<span class="string">&quot;@aaa.bbb&quot;</span>&gt;</span><br><span class="line">     &#123;&#123;@aaa.bbb.ccc&#125;&#125;这里肯定会出错</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>正确的做法是,当你知道这里面有非空判定,需要用方法包起来</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">avalon.define(&#123;</span><br><span class="line">  $id: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">  aaa: &#123;&#125;,</span><br><span class="line">  show: <span class="function"><span class="keyword">function</span>(<span class="params">aaa, bbb, ccc</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">var</span> obj = aaa[bbb]</span><br><span class="line">     <span class="function"><span class="title">if</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj[ccc]</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;div ms-controller=<span class="string">&quot;test&quot;</span>&gt;</span><br><span class="line">   &lt;div ms-<span class="keyword">if</span>=<span class="string">&quot;@aaa.bbb&quot;</span>&gt;</span><br><span class="line">     &#123;&#123;@show(@aaa, <span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>)&#125;&#125;</span><br><span class="line">   &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-visible"><a href="#ms-visible" class="headerlink" title="ms-visible"></a>ms-visible</h3><p>这是通过修改元素的style.display值改变元素的可见性, 要求属性值对应一个布尔，如果不是布尔， avalon会自动转换值为布尔。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">:controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">  $id: <span class="string">&quot;test&quot;</span>,</span></span><br><span class="line"><span class="javascript">  aaa: <span class="string">&quot;这是被隐藏的内容&quot;</span></span></span><br><span class="line"><span class="javascript">  toggle: <span class="literal">false</span></span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">:click</span>=<span class="string">&#x27;@toggle = !@toggle&#x27;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:visible</span>=<span class="string">&quot;@toggle&quot;</span>&gt;</span>&#123;&#123;@aaa&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="ms-on"><a href="#ms-on" class="headerlink" title="ms-on"></a>ms-on</h3><p><strong>事件绑定</strong></p>
<p>此绑定为元素添加交互功能，对用户行为作出响应. <code>ms-on-*=&quot;xxx&quot;</code>是其使用形式, <code>*</code>代表click, mouseover, touchstart等事件名，只能与小写形式定义， xxx是事件回调本身，可以是方法名，或表达式。 默认,事件回调的第一个参数是事件对象,并进行标准化处理. 如果你是用<code>ms-on-click=&quot;@fn(el, 1)&quot;</code>这样的传参方式，第一个传参被你占用， 而你又想用事件对象，可以使用**$event**标识符，即<code>ms-on-click=&quot;@fn(el, 1, $event)&quot;</code> 那么第三个参数就是事件对象。</p>
<p>如果你想绑定多个点击事件,可以用<code>ms-on-click-1=&quot;@fn(el)&quot;, ms-on-click-2=&quot;@fn2(el)&quot;,ms-on-click-3=&quot;@fn3(el)&quot;</code>来添加。</p>
<p>并且,avalon对常用的事件,还做了快捷处理,你可以省掉中间的on。</p>
<p>avalon默认对以下事件做快捷处理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">animationend、 blur、 change、 input、 click、 dblclick、 focus、 keydown、 keypress、 keyup、 mousedown、 mouseenter、 mouseleave、 mousemove、 mouseout、 mouseover、 mouseup、 scroll、 submit</span><br></pre></td></tr></table></figure>

<p>此外,avalon2相对avalon1，还做了以下强化:</p>
<p>以前<code>ms-on-*</code>的值只能是vm中的一个函数名<code>ms-on-click=&quot;fnName&quot;</code>, 现在其值可以是表达式,如<code>ms-on-click=&quot;el.open = !el.open&quot;</code>, 与原生的onclick定义方式更相近. 以前<code>ms-on-*</code>的函数,this是指向绑定事件的元素本身,现在this是指向vm, 元素本身可以直接从e.target中取得.</p>
<p><code>ms-on-*</code>会优先考虑使用事件代理方式绑定事件,将事件绑在根节点上!这会带来极大的性能优化! <code>ms-on-*</code>的值转换为函数后,如果发现其内部不存在ms-for动态生成的变量,框架会将它们缓存起来! 添加了一系列针对事件的过滤器 对按键进行限制的过滤器esc，tab，enter，space，del，up，left，right，down 对事件方法stopPropagation, preventDefault进行简化的过滤器stop, prevent</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = avalon.define(&#123;</span><br><span class="line">    $id: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">    firstName: <span class="string">&quot;司徒&quot;</span>,</span><br><span class="line">    array: [<span class="string">&quot;aaa&quot;</span>, <span class="string">&quot;bbb&quot;</span>, <span class="string">&quot;ccc&quot;</span>],</span><br><span class="line">    argsClick: <span class="function"><span class="keyword">function</span>(<span class="params">e, a, b</span>) </span>&#123;</span><br><span class="line">        alert([].slice.call(<span class="built_in">arguments</span>).join(<span class="string">&quot; &quot;</span>))</span><br><span class="line">    &#125;,</span><br><span class="line">    loopClick: <span class="function"><span class="keyword">function</span>(<span class="params">a, e</span>) </span>&#123;</span><br><span class="line">        alert(a + <span class="string">&quot;  &quot;</span> + e.type)</span><br><span class="line">    &#125;,</span><br><span class="line">    status: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    callback: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        vm.status = e.type</span><br><span class="line">    &#125;,</span><br><span class="line">    field: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    check: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">        vm.field = e.target.value + <span class="string">&quot;  &quot;</span> + e.type</span><br><span class="line">    &#125;,</span><br><span class="line">    submit: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = vm.$model</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">window</span>.JSON) &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                alert(<span class="built_in">JSON</span>.stringify(data))</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;fieldset ms-controller=<span class="string">&quot;test&quot;</span>&gt;</span><br><span class="line">    &lt;legend&gt;有关事件回调传参&lt;/legend&gt;</span><br><span class="line">    &lt;div ms-mouseenter=<span class="string">&quot;@callback&quot;</span> ms-mouseleave=<span class="string">&quot;@callback&quot;</span>&gt;&#123;&#123;@status&#125;&#125;&lt;br/&gt;</span><br><span class="line">        &lt;input ms-on-input=<span class="string">&quot;@check&quot;</span>/&gt;&#123;&#123;@field&#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div ms-click=<span class="string">&quot;@argsClick($event, 100, @firstName)&quot;</span>&gt;点我&lt;/div&gt;</span><br><span class="line">    &lt;div ms-<span class="keyword">for</span>=<span class="string">&quot;el in @array&quot;</span> &gt;</span><br><span class="line">        &lt;p ms-click=<span class="string">&quot;@loopClick(el, $event)&quot;</span>&gt;&#123;&#123;el&#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;button ms-click=<span class="string">&quot;@submit&quot;</span> type=<span class="string">&quot;button&quot;</span>&gt;点我&lt;/button&gt;</span><br><span class="line">&lt;/fieldset&gt;</span><br></pre></td></tr></table></figure>

<p>绑定多个同种事件的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> model = avalon.define(&#123;</span><br><span class="line">    $id: <span class="string">&quot;multi-click&quot;</span>,</span><br><span class="line">    str1: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    str2: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    str3: <span class="string">&quot;3&quot;</span>,</span><br><span class="line">    click0: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        model.str1 = <span class="string">&quot;xxxxxxxxx&quot;</span> + (count++)</span><br><span class="line">    &#125;,</span><br><span class="line">    click1: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        model.str2 = <span class="string">&quot;xxxxxxxxx&quot;</span> + (count++)</span><br><span class="line">    &#125;,</span><br><span class="line">    click2: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        model.str3 = <span class="string">&quot;xxxxxxxxx&quot;</span> + (count++)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">&lt;fieldset&gt;</span><br><span class="line">    &lt;legend&gt;一个元素绑定多个同种事件的回调&lt;/legend&gt;</span><br><span class="line">    &lt;div ms-controller=<span class="string">&quot;multi-click&quot;</span>&gt;</span><br><span class="line">        &lt;div ms-click=<span class="string">&quot;@click0&quot;</span> ms-click-<span class="number">1</span>=<span class="string">&quot;@click1&quot;</span> ms-click-<span class="number">2</span>=<span class="string">&quot;@click2&quot;</span> &gt;请点我&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123;@str1&#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123;@str2&#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&#123;&#123;@str3&#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/fieldset&gt;</span><br></pre></td></tr></table></figure>

<p>回调执行顺序的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> avalon.define(&#123;</span><br><span class="line">      $id: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">      fn: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&quot;11111111&quot;</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fn1: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&quot;2222222&quot;</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fn2: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">&quot;3333333&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;div ms-controller=<span class="string">&quot;xxx&quot;</span> </span><br><span class="line">    ms-on-mouseenter-<span class="number">3</span>=<span class="string">&quot;@fn&quot;</span></span><br><span class="line">    ms-on-mouseenter-<span class="number">2</span>=<span class="string">&quot;@fn1&quot;</span></span><br><span class="line">    ms-on-mouseenter-<span class="number">1</span>=<span class="string">&quot;@fn2&quot;</span></span><br><span class="line">    style=<span class="string">&quot;width:100px;height:100px;background: red;&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>avalon已经对ms-mouseenter, ms-mouseleave进行修复，可以在这里与这里了解这两个事件。 到chrome30时，所有浏览器都原生支持这两个事件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">avalon.define(&#123;</span><br><span class="line">    $id: &quot;test&quot;,</span><br><span class="line">    text: &quot;&quot;,</span><br><span class="line">    fn1: function (e) &#123;</span><br><span class="line">       this.text &#x3D; e.target.className + &quot; &quot;+ e.type</span><br><span class="line">    &#125;,</span><br><span class="line">    fn2: function (e) &#123;</span><br><span class="line">       this.text &#x3D; e.target.className + &quot; &quot;+ e.type</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">.bbb&#123;</span><br><span class="line">    background: #1ba9ba;</span><br><span class="line">    width:200px;</span><br><span class="line">    height: 200px;</span><br><span class="line">    padding:20px;</span><br><span class="line">    box-sizing:content-box;</span><br><span class="line">&#125;</span><br><span class="line">.ccc&#123;</span><br><span class="line">    background: #168795;</span><br><span class="line">    width:160px;</span><br><span class="line">    text-align: center;</span><br><span class="line">    line-height: 160px;</span><br><span class="line">    height: 160px;</span><br><span class="line">    margin:20px;</span><br><span class="line">    box-sizing:content-box;</span><br><span class="line">&#125;</span><br><span class="line">    &lt;div class&#x3D;&quot;aaa&quot; ms-controller&#x3D;&quot;test&quot;&gt;</span><br><span class="line">      &lt;div class&#x3D;&quot;bbb&quot; ms-mouseenter&#x3D;&quot;@fn1&quot; ms-mouseleave&#x3D;&quot;@fn2&quot;&gt;</span><br><span class="line">          &lt;div class&#x3D;&quot;ccc&quot; &gt;</span><br><span class="line">              &#123;&#123;@text&#125;&#125;</span><br><span class="line">          &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>最后是mousewheel事件的修改，主要问题是出现firefox上， 它死活也不愿意支持mousewheel，在avalon里是用DOMMouseScroll或wheel实现模拟的。 我们在事件对象通过wheelDelta属性是否为正数判定它在向上滚动。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> avalon.define(&#123;</span><br><span class="line">      $id: <span class="string">&quot;event4&quot;</span>,</span><br><span class="line">      text: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      callback: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">          <span class="built_in">this</span>.text = e.wheelDelta + <span class="string">&quot;  &quot;</span> + e.type</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;div ms-controller=<span class="string">&quot;event4&quot;</span>&gt;</span><br><span class="line">    &lt;div ms-on-mousewheel=<span class="string">&quot;@callback&quot;</span> id=<span class="string">&quot;aaa&quot;</span> style=<span class="string">&quot;background: #1ba9ba;width:200px;height: 200px;&quot;</span>&gt;</span><br><span class="line">        &#123;&#123;@text&#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>此外avalon还对input，animationend事件进行修复，大家也可以直接用avalon.bind, avalon.fn.bind来绑定这些事件。但建议都用ms-on绑定来处理。</p>
<hr>
<h3 id="ms-rules"><a href="#ms-rules" class="headerlink" title="ms-rules"></a>ms-rules</h3><p><strong>验证规则绑定</strong></p>
<p>avalon2砍掉了不少功能（如<code>ms-include</code>,<code>ms-data</code>），腾出空间加了其他更有用的功能。 数据验证就是其中之一。现在avalon2内置的验证指令是参考之前的oniui验证框架与jquery validation。</p>
<p>此指令只能用于添加ms-duplex指令的表单元素上。</p>
<p>avalon内置验证规则有</p>
<table>
<thead>
<tr>
<th align="left">规则</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">required(true)</td>
<td align="left">必须输入的字段</td>
</tr>
<tr>
<td align="left">norequired(true)</td>
<td align="left">不是必填的字段</td>
</tr>
<tr>
<td align="left">email(true)</td>
<td align="left">必须输入正确格式的电子邮件</td>
</tr>
<tr>
<td align="left">url(true)</td>
<td align="left">必须输入正确格式的网址</td>
</tr>
<tr>
<td align="left">date(true或正则)</td>
<td align="left">必须输入正确格式的日期。默认是要求YYYY-MM-dd这样的格式</td>
</tr>
<tr>
<td align="left">number(true)</td>
<td align="left">必须输入合法的数字（负数，小数）</td>
</tr>
<tr>
<td align="left">digits(true)</td>
<td align="left">必须输入整数</td>
</tr>
<tr>
<td align="left">pattern(正则或true）</td>
<td align="left">让输入数据匹配给定的正则，如果没有指定，那么会到元素上找pattern属性转换成正则再匹配</td>
</tr>
<tr>
<td align="left">equalto(ID名）</td>
<td align="left">输入值必须和 #id 元素的value 相同</td>
</tr>
<tr>
<td align="left">maxlength：5</td>
<td align="left">输入长度最多是 5 的字符串（汉字算一个字符）</td>
</tr>
<tr>
<td align="left">minlength：10</td>
<td align="left">输入长度最小是 10 的字符串（汉字算一个字符）</td>
</tr>
<tr>
<td align="left">chs（true）</td>
<td align="left">要求输入全部是中文</td>
</tr>
<tr>
<td align="left">max:5</td>
<td align="left">输入值不能大于 5</td>
</tr>
<tr>
<td align="left">min:10</td>
<td align="left">输入值不能小于 10</td>
</tr>
</tbody></table>
<p>这些验证规则要求使用ms-rules指令表示，要求为一个普通的JS对象。</p>
<p>此外要求验征框架能动起来，还必须在所有表单元素外包一个form元素，在form元素上加ms-validate指令。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> vm = avalon.define(&#123;</span><br><span class="line">        $id: <span class="string">&quot;validate1&quot;</span>,</span><br><span class="line">        aaa: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        bbb: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        ccc: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        validate: &#123;</span><br><span class="line">            onError: <span class="function"><span class="keyword">function</span> (<span class="params">reasons</span>) </span>&#123;</span><br><span class="line">                reasons.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(reason.getMessage())</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            onValidateAll: <span class="function"><span class="keyword">function</span> (<span class="params">reasons</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (reasons.length) &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;有表单没有通过&#x27;</span>)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">console</span>.log(<span class="string">&#x27;全部通过&#x27;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;div ms-controller=<span class="string">&quot;validate1&quot;</span>&gt;</span><br><span class="line">  &lt;form ms-validate=<span class="string">&quot;@validate&quot;</span>&gt;</span><br><span class="line">      &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username&quot;</span></span></span></span><br><span class="line"><span class="xml">                ms-rules=&#x27;&#123;required:true,chs:true&#125;&#x27; &gt;&#123;&#123;@aaa&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">      &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pw&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;password&quot;</span></span></span></span><br><span class="line"><span class="xml">                ms-rules=&#x27;&#123;required:true&#125;&#x27; </span></span><br><span class="line"><span class="xml">                ms-duplex=&quot;@bbb&quot; /&gt;</span>&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> </span></span></span><br><span class="line"><span class="xml">             ms-rules=&quot;&#123;required:true,equalto:&#x27;pw&#x27;&#125;&quot; placeholder=&quot;再填一次&quot;</span></span><br><span class="line"><span class="xml">             ms-duplex=&quot;@ccc | change&quot; /&gt;</span>&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span>/&gt;</span></span>&lt;/p&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>因此，要运行起avalon2的内置验证框架，必须同时使用三个指令。ms-validate用于定义各种回调与全局的配置项（如什么时候进行验证）。<a target="_blank" rel="noopener" href="http://www.itprobie.com/jc/avalon/avalon_html/ms-duplex.html">ms-duplex</a>用于将单个表单元素及相关信息组成一个Field对象，放到ms-validater指令的fields数组中。ms-rules用于定义验证规则。如果验证规则不满足你，你可以自行在<strong>avalon.validators</strong>对象上添加。</p>
<p>现在我们可以一下ms-validate的用法。其对应一个对象。</p>
<table>
<thead>
<tr>
<th align="left">配置项</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">fields</td>
<td align="left">框架自行添加，用户不用写。为一个数组，放置ms-duplex生成的Field对象。</td>
</tr>
<tr>
<td align="left">onSuccess</td>
<td align="left">空函数，单个验证成功时触发，this指向被验证元素this指向被验证元素，传参为一个对象数组外加一个可能存在的事件对象。</td>
</tr>
<tr>
<td align="left">onError</td>
<td align="left">空函数，单个验证失败时触发，this与传参情况同上</td>
</tr>
<tr>
<td align="left">onComplete</td>
<td align="left">空函数，单个验证无论成功与否都触发，this与传参情况同上。</td>
</tr>
<tr>
<td align="left">onValidateAll</td>
<td align="left">空函数，整体验证后或调用了validateAll方法后触发；有了这东西你就不需要在form元素上ms-on-submit=”submitForm”，直接将提交逻辑写在onValidateAll回调上</td>
</tr>
<tr>
<td align="left">onReset</td>
<td align="left">空函数，表单元素获取焦点时触发，this指向被验证元素，大家可以在这里清理className、value</td>
</tr>
<tr>
<td align="left">validateInBlur</td>
<td align="left">true，在blur事件中进行验证,触发onSuccess, onError, onComplete回调</td>
</tr>
<tr>
<td align="left">validateInKeyup</td>
<td align="left">true, 在keyup事件中进行验证,触发onSuccess, onError, onComplete回调。当用户在ms-duplex中使用change debounce过滤器时会失效</td>
</tr>
<tr>
<td align="left">validateAllInSubmit</td>
<td align="left">true，在submit事件中执行onValidateAll回调</td>
</tr>
<tr>
<td align="left">resetInFocus</td>
<td align="left">true，在focus事件中执行onReset回调</td>
</tr>
<tr>
<td align="left">deduplicateInValidateAll</td>
<td align="left">false，在validateAll回调中对reason数组根据元素节点进行去重</td>
</tr>
</tbody></table>
<p>我们看一下如何自定义验证规则.</p>
<p>比如说我们有一个变态的需求,一个字段可以不填，但如果要填的话一定要是合法的数字,并且大于零. 这就需要自定义规则了.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>ms-validate<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/avalon.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">            avalon.validators.aaa = &#123;</span><br><span class="line"><span class="javascript">                message: <span class="string">&#x27;必须数字并大于0&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                get: <span class="function"><span class="keyword">function</span> (<span class="params">value, field, next</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                   <span class="comment">//想知道它们三个参数是什么,可以console.log(value, field,next)</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> ok = (value === <span class="string">&#x27;&#x27;</span> || (<span class="built_in">Number</span>(value) &gt; <span class="number">0</span>))</span></span><br><span class="line">                    next(ok)</span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> value</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">                $id: <span class="string">&quot;test&quot;</span>,</span></span><br><span class="line"><span class="javascript">                aaa: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">                validate: &#123;</span><br><span class="line"><span class="javascript">                    onError: <span class="function"><span class="keyword">function</span> (<span class="params">reasons</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        reasons.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(reason.getMessage())</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;,</span><br><span class="line"><span class="javascript">                    onValidateAll: <span class="function"><span class="keyword">function</span> (<span class="params">reasons</span>) </span>&#123;</span></span><br><span class="line">                        if (reasons.length) &#123;</span><br><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(<span class="string">&#x27;有表单没有通过&#x27;</span>)</span></span><br><span class="line"><span class="javascript">                        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(<span class="string">&#x27;全部通过&#x27;</span>)</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;cmxform&quot;</span> <span class="attr">ms-validate</span>=<span class="string">&quot;@validate&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">legend</span>&gt;</span>自定义规则<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> </span></span><br><span class="line"><span class="tag">                        <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;aaa: true&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                        &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在上表还有一个没有提到的东西是如何显示错误信息，这个avalon不帮你处理。但提示信息会帮你拼好，如果你没有写，直接用验证规则的message，否则在元素上找data-message或data-required-message这样的属性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>ms-validate<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../dist/avalon.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">                $id: <span class="string">&quot;test&quot;</span>,</span></span><br><span class="line"><span class="javascript">                rules:&#123;<span class="attr">required</span>:<span class="literal">true</span>,<span class="attr">email</span>:<span class="literal">true</span>&#125;,</span></span><br><span class="line"><span class="javascript">                email:<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">                validate: &#123;</span><br><span class="line"><span class="javascript">                    onError: <span class="function"><span class="keyword">function</span> (<span class="params">reasons</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                        reasons.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(reason.getMessage())</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;,</span><br><span class="line"><span class="javascript">                    onValidateAll: <span class="function"><span class="keyword">function</span> (<span class="params">reasons</span>) </span>&#123;</span></span><br><span class="line">                        if (reasons.length) &#123;</span><br><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(<span class="string">&#x27;有表单没有通过&#x27;</span>)</span></span><br><span class="line"><span class="javascript">                        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                            <span class="built_in">console</span>.log(<span class="string">&#x27;全部通过&#x27;</span>)</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;cmxform&quot;</span> <span class="attr">ms-validate</span>=<span class="string">&quot;@validate&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">legend</span>&gt;</span>验证完整的表单<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">type</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex</span>=<span class="string">&quot;@email&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-rules</span>=<span class="string">&quot;@rules&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">data-required-message</span>=<span class="string">&quot;请输入&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">data-email-message</span>=<span class="string">&quot;请输入一个正确的邮箱&quot;</span></span></span><br><span class="line"><span class="tag">                           &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后给一个复杂的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">        $id: <span class="string">&quot;validate2&quot;</span>,</span></span><br><span class="line"><span class="javascript">        firstname: <span class="string">&#x27;司徒正美&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        lastname: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        username: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        password: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        confirm_password: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        email: <span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        agree: <span class="literal">false</span>,</span></span><br><span class="line">        topic: [],</span><br><span class="line"><span class="javascript">        toggle: <span class="literal">false</span>,</span></span><br><span class="line">        validate: &#123;</span><br><span class="line"><span class="javascript">            onError: <span class="function"><span class="keyword">function</span> (<span class="params">reasons</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                reasons.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(reason.getMessage())</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            onValidateAll: <span class="function"><span class="keyword">function</span> (<span class="params">reasons</span>) </span>&#123;</span></span><br><span class="line">                if (reasons.length) &#123;</span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&#x27;有表单没有通过&#x27;</span>)</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&#x27;全部通过&#x27;</span>)</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    avalon.validators.checked = &#123;</span><br><span class="line"><span class="javascript">        message: <span class="string">&#x27;必须扣上&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        get: <span class="function"><span class="keyword">function</span> (<span class="params">value, field, next</span>) </span>&#123;</span></span><br><span class="line">            next(value)</span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> value</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    avalon.validators.selecttwo = &#123;</span><br><span class="line"><span class="javascript">        message: <span class="string">&#x27;至少选择两个&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        get: <span class="function"><span class="keyword">function</span> (<span class="params">value, field, next</span>) </span>&#123;</span></span><br><span class="line">            next(!vm.toggle || value.length &gt;= 2)</span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> value</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;validate2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;cmxform&quot;</span> <span class="attr">ms-validate</span>=<span class="string">&quot;@validate&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">legend</span>&gt;</span>验证完整的表单<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;firstname&quot;</span>&gt;</span>名字<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;firstname&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">name</span>=<span class="string">&quot;firstname&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex</span>=<span class="string">&quot;@firstname&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;required:true, pattern: /[\u4e00-\u9fa5a-z]&#123;2-8&#125;/i &#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">data-required-message</span>=<span class="string">&quot;必须是中文或字母(3-8个字符)&quot;</span> &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;lastname&quot;</span>&gt;</span>姓氏<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;lastname&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">name</span>=<span class="string">&quot;lastname&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex</span>=<span class="string">&quot;@lastname&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;required:true&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">data-required-message</span>=<span class="string">&quot;请输入您的姓氏&quot;</span></span></span><br><span class="line"><span class="tag">                           &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;username&quot;</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">name</span>=<span class="string">&quot;username&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex</span>=<span class="string">&quot;@username | change&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;required:true, minlength:2&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                           &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;password&quot;</span>&gt;</span>密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex</span>=<span class="string">&quot;@password&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;required:true,minlength:5&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">data-required-message</span>=<span class="string">&quot;请输入密码&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">data-required-message</span>=<span class="string">&quot;密码长度不能小于 5 个字母&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">                           &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;confirm_password&quot;</span>&gt;</span>验证密码<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;confirm_password&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">name</span>=<span class="string">&quot;confirm_password&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">type</span>=<span class="string">&quot;password&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex</span>=<span class="string">&quot;@confirm_password | change&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;required:true,equalto:&#x27;password&#x27;&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">data-equalto-message</span>=<span class="string">&quot;两次密码输入不一致&quot;</span></span></span><br><span class="line"><span class="tag">                           &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;email&quot;</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;email&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">type</span>=<span class="string">&quot;email&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex</span>=<span class="string">&quot;@email&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;email:true&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">data-email-message</span>=<span class="string">&quot;请输入一个正确的邮箱&quot;</span></span></span><br><span class="line"><span class="tag">                           &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;agree&quot;</span>&gt;</span>请同意我们的声明<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;agree&quot;</span> <span class="attr">name</span>=<span class="string">&quot;agree&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex-checked</span>=<span class="string">&quot;@agree&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;checked:true&#125;&quot;</span> </span></span><br><span class="line"><span class="tag">                           &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;newsletter&quot;</span>&gt;</span>我乐意接收新信息<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">class</span>=<span class="string">&quot;checkbox&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">id</span>=<span class="string">&quot;newsletter&quot;</span> </span></span><br><span class="line"><span class="tag">                           <span class="attr">name</span>=<span class="string">&quot;newsletter&quot;</span></span></span><br><span class="line"><span class="tag">                           <span class="attr">ms-duplex-checked</span>=<span class="string">&quot;@toggle&quot;</span></span></span><br><span class="line"><span class="tag">                           &gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fieldset</span> <span class="attr">id</span>=<span class="string">&quot;newsletter_topics&quot;</span> <span class="attr">ms-visible</span>=<span class="string">&quot;@toggle&quot;</span> &gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>主题 (至少选择两个) <span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;topic_marketflash&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> </span></span><br><span class="line"><span class="tag">                               <span class="attr">id</span>=<span class="string">&quot;topic_marketflash&quot;</span> </span></span><br><span class="line"><span class="tag">                               <span class="attr">value</span>=<span class="string">&quot;marketflash&quot;</span> </span></span><br><span class="line"><span class="tag">                               <span class="attr">name</span>=<span class="string">&quot;topic[]&quot;</span> </span></span><br><span class="line"><span class="tag">                               <span class="attr">ms-duplex</span>=<span class="string">&quot;@topic&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;selecttwo:true&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               &gt;</span>Marketflash</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;topic_fuzz&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">id</span>=<span class="string">&quot;topic_fuzz&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">value</span>=<span class="string">&quot;fuzz&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">name</span>=<span class="string">&quot;topic[]&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">ms-duplex</span>=<span class="string">&quot;@topic&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;selecttwo:true&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               &gt;</span>Latest fuzz</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;topic_digester&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> </span></span><br><span class="line"><span class="tag">                               <span class="attr">id</span>=<span class="string">&quot;topic_digester&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">value</span>=<span class="string">&quot;digester&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">name</span>=<span class="string">&quot;topic[]&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">ms-duplex</span>=<span class="string">&quot;@topic&quot;</span></span></span><br><span class="line"><span class="tag">                               <span class="attr">ms-rules</span>=<span class="string">&quot;&#123;selecttwo:true&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                               &gt;</span>Mailing list digester</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;topic&quot;</span> <span class="attr">class</span>=<span class="string">&quot;error&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none&quot;</span>&gt;</span>至少选择两个<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><h3 id="格式化过滤器"><a href="#格式化过滤器" class="headerlink" title="格式化过滤器"></a>格式化过滤器</h3><p>用于处理数字或字符串，多用于<code> {{ }} </code>或ms-attr 或ms-class</p>
<blockquote>
<p>注意: avalon的过滤器与ng的过滤器在传参上有点不一样,需要用()括起来</p>
</blockquote>
<h3 id="uppercase"><a href="#uppercase" class="headerlink" title="uppercase"></a>uppercase</h3><p>将字符串全部大写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.aaa = <span class="string">&quot;aaa&quot;</span></span><br><span class="line"></span><br><span class="line">&lt;div&gt;&#123;&#123;@aaa | uppercase&#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="lowercase"><a href="#lowercase" class="headerlink" title="lowercase"></a>lowercase</h3><p>将字符串全部小写</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.aaa = <span class="string">&quot;AAA&quot;</span></span><br><span class="line"></span><br><span class="line">&lt;div&gt;&#123;&#123;@aaa | lowercase&#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="truncate"><a href="#truncate" class="headerlink" title="truncate"></a>truncate</h3><p>对长字符串进行截短，有两个可选参数</p>
<p>number，最后返回的字符串的长度，已经将truncation的长度包含在内，默认为30。 truncation，告知用户它已经被截短的一个结尾标识，默认为”…”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.aaa = <span class="string">&quot;121323234324324&quot;</span></span><br><span class="line"></span><br><span class="line">&lt;div&gt;&#123;&#123;@aaa | truncate(<span class="number">10</span>,<span class="string">&#x27;...&#x27;</span>)&#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="camelize"><a href="#camelize" class="headerlink" title="camelize"></a>camelize</h3><p>驼峰化处理， 如”aaa-bbb”变成”aaaBBB”</p>
<h3 id="escape"><a href="#escape" class="headerlink" title="escape"></a>escape</h3><p>对类似于HTML格式的字符串进行转义，如将&lt;、 &gt;转换为&lt;、 &gt;</p>
<h3 id="sanitize"><a href="#sanitize" class="headerlink" title="sanitize"></a>sanitize</h3><p>对用户输入的字符串进行反XSS处理，去掉onclick, <code>javascript:alert</code>，<code>&lt;script&gt;</code>等危险属性与标签。</p>
<h3 id="number"><a href="#number" class="headerlink" title="number"></a>number</h3><p>对需要处理的数字的整数部分插入千分号（每三个数字插入一个逗号），有一个参数fractionSize，用于保留小数点的后几位。</p>
<p>fractionSize:小数部分的精度，默认为3。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>TODO supply a title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;avalon.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&quot;number&quot;</span>,</span></span><br><span class="line">            aaa: 1234.56789</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;number&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>输入数字:</span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&quot;@aaa&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>不处理：&#123;&#123;@aaa&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>不传参：&#123;&#123;@aaa|number&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>不保留小数：&#123;&#123;@aaa|number(0)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>负数:&#123;&#123;-@aaa|number(4)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="currency"><a href="#currency" class="headerlink" title="currency"></a>currency</h3><p>用于格式化货币，类似于number过滤器（即插入千分号），但前面加了一个货币符号，默认使用人民币符号<code>\uFFE5</code></p>
<p>symbol, 货币符号，默认是<code>\uFFE5</code> fractionSize，小数点后保留多少数，默认是2</p>
<h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><p>对日期进行格式化，date(formats), 目标可能是符合一定格式的字符串，数值，或Date对象。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>TODO supply a title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;avalon.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        avalon.define(&#123;</span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;testtest&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            name: <span class="string">&quot;大跃进右&quot;</span>,</span></span><br><span class="line"><span class="javascript">            d1: <span class="keyword">new</span> <span class="built_in">Date</span>,</span></span><br><span class="line"><span class="javascript">            d2: <span class="string">&quot;2011/07/08&quot;</span>,</span></span><br><span class="line"><span class="javascript">            d3: <span class="string">&quot;2011-07-08&quot;</span>,</span></span><br><span class="line"><span class="javascript">            d4: <span class="string">&quot;01-01-2000&quot;</span>,</span></span><br><span class="line"><span class="javascript">            d5: <span class="string">&quot;03 04,2000&quot;</span>,</span></span><br><span class="line"><span class="javascript">            d6: <span class="string">&quot;3 4,2000&quot;</span>,</span></span><br><span class="line">            d7: 1373021259229,</span><br><span class="line"><span class="javascript">            d8: <span class="string">&quot;1373021259229&quot;</span>,</span></span><br><span class="line"><span class="javascript">            d9: <span class="string">&quot;2014-12-07T22:50:58+08:00&quot;</span>,</span></span><br><span class="line"><span class="javascript">            d10: <span class="string">&quot;\/Date(1373021259229)\/&quot;</span></span></span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;testtest&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d1 | date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d2 | date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d3 | date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d4 | date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d5 | date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d6 | date(&quot;yyyy MM dd&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d7 | date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d8 | date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d9 | date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125; //这是ISO8601的日期格式<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>生成于&#123;&#123; @d10| date(&quot;yyyy MM dd:HH:mm:ss&quot;)&#125;&#125; //这是ASP.NET输出的JSON数据的日期格式<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">标记</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">yyyy</td>
<td align="left">将当前的年份以4位数输出，如果那一年为300，则补足为0300</td>
</tr>
<tr>
<td align="left">yy</td>
<td align="left">将当前的年份截取最后两位数输出，如2014变成14， 1999变成99， 2001变成01</td>
</tr>
<tr>
<td align="left">y</td>
<td align="left">将当前的年份原样输出，如2014变成2014， 399变成399， 1变成1</td>
</tr>
<tr>
<td align="left">MMMM</td>
<td align="left">在中文中，MMMM与MMM是没有区别，都是”1月”，”2月”……英语则为该月份的单词全拼</td>
</tr>
<tr>
<td align="left">MMM</td>
<td align="left">在中文中，MMMM与MMM是没有区别，都是”1月”，”2月”……英语则为该月份的单词缩写(前三个字母)</td>
</tr>
<tr>
<td align="left">MM</td>
<td align="left">将月份以01-12的形式输出(即不到两位数，前面补0)</td>
</tr>
<tr>
<td align="left">M</td>
<td align="left">将月份以1-12的形式输出</td>
</tr>
<tr>
<td align="left">dd</td>
<td align="left">以日期以01-31的形式输出(即不到两位数，前面补0)</td>
</tr>
<tr>
<td align="left">d</td>
<td align="left">以日期以1-31的形式输出</td>
</tr>
<tr>
<td align="left">EEEE</td>
<td align="left">将当前天的星期几以“星期一”，“星期二”，“星期日”的形式输出，英语则Sunday-Saturday</td>
</tr>
<tr>
<td align="left">EEE</td>
<td align="left">将当前天的星期几以“周一”，“周二”，“周日”的形式输出，英语则Sun-Sat</td>
</tr>
<tr>
<td align="left">HH</td>
<td align="left">将当前小时数以00-23的形式输出</td>
</tr>
<tr>
<td align="left">H</td>
<td align="left">将当前小时数以0-23的形式输出</td>
</tr>
<tr>
<td align="left">hh</td>
<td align="left">将当前小时数以01-12的形式输出</td>
</tr>
<tr>
<td align="left">h</td>
<td align="left">将当前小时数以0-12的形式输出</td>
</tr>
<tr>
<td align="left">mm</td>
<td align="left">将当前分钟数以00-59的形式输出</td>
</tr>
<tr>
<td align="left">m</td>
<td align="left">将当前分钟数以0-59的形式输出</td>
</tr>
<tr>
<td align="left">ss</td>
<td align="left">将当前秒数以00-59的形式输出</td>
</tr>
<tr>
<td align="left">s</td>
<td align="left">将当前秒数以0-59的形式输出</td>
</tr>
<tr>
<td align="left">a</td>
<td align="left">将当前时间是以“上午”，“下午”的形式输出</td>
</tr>
<tr>
<td align="left">Z</td>
<td align="left">将当前时间的时区以-1200-+1200的形式输出</td>
</tr>
<tr>
<td align="left">fullDate</td>
<td align="left">相当于y年M月d日EEEE 2014年12月31日星期三</td>
</tr>
<tr>
<td align="left">longDate</td>
<td align="left">相当于y年M月d日EEEE 2014年12月31日</td>
</tr>
<tr>
<td align="left">medium</td>
<td align="left">相当于yyyy-M-d H:mm:ss 2014-12-31 19:02:44</td>
</tr>
<tr>
<td align="left">mediumDate</td>
<td align="left">相当于yyyy-M-d 2014-12-31</td>
</tr>
<tr>
<td align="left">mediumTime</td>
<td align="left">相当于H:mm:ss 19:02:44</td>
</tr>
<tr>
<td align="left">short</td>
<td align="left">相当于yy-M-d ah:mm 14-12-31 下午7:02</td>
</tr>
<tr>
<td align="left">shortDate</td>
<td align="left">相当于yy-M-d 14-12-31</td>
</tr>
<tr>
<td align="left">shortTime</td>
<td align="left">相当于ah:mm 下午7:02</td>
</tr>
</tbody></table>
<hr>
<h3 id="循环过滤器"><a href="#循环过滤器" class="headerlink" title="循环过滤器"></a>循环过滤器</h3><p>用于ms-for指令中</p>
<h3 id="limitBy"><a href="#limitBy" class="headerlink" title="limitBy"></a>limitBy</h3><p>只能用于ms-for循环,对数组与对象都有效, 限制输出到页面的个数, 有两个参数</p>
<ol>
<li>limit: 最大个数,必须是数字或字符, 当个数超出数组长或键值对总数时, 等于后面</li>
<li>begin: 开始循环的个数, 可选,默认0</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    avalon.define(&#123;</span><br><span class="line"><span class="javascript">        $id: <span class="string">&quot;limitBy&quot;</span>,</span></span><br><span class="line">        array: [1, 2, 3, 4, 5, 6],</span><br><span class="line">        object: &#123;a: 1, b: 2, c: 3, d: 4, e: 5&#125;,</span><br><span class="line">        num: 3</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;limitBy&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ms-duplex-number</span>=<span class="string">&#x27;@num&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>4<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>5<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&#x27;el in @array | limitBy(@num)&#x27;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&#x27;el in @object | limitBy(@num)&#x27;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="orderBy"><a href="#orderBy" class="headerlink" title="orderBy"></a>orderBy</h3><p>只能用于ms-for循环,对数组与对象都有效, 用于排序, 有两个参数</p>
<ol>
<li>key: 要排序的属性名</li>
<li>dir: -1或1, 顺序或倒序,可选,默认1</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">avalon.define(&#123;</span><br><span class="line"><span class="javascript">    $id: <span class="string">&quot;orderBy&quot;</span>,</span></span><br><span class="line">    array: [&#123;a: 1, b: 33&#125;,&#123;a: 2, b: 22&#125;, &#123;a: 3, b: 11&#125;],</span><br><span class="line"><span class="javascript">    order: <span class="string">&#x27;a&#x27;</span>,</span></span><br><span class="line">    dir: -1</span><br><span class="line">&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;orderBy&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ms-duplex</span>=<span class="string">&#x27;@order&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>a<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>b<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ms-duplex-number</span>=<span class="string">&#x27;@dir&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">width</span>=<span class="string">&#x27;200&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ms-for</span>=<span class="string">&quot;el in @array | orderBy(@order, @dir)&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">ms-for</span>=<span class="string">&#x27;elem in el&#x27;</span>&gt;</span>&#123;&#123;elem&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="filterBy"><a href="#filterBy" class="headerlink" title="filterBy"></a>filterBy</h3><p>只能用于ms-for循环,对数组与对象都有效, 用于获取它们的某一子集, 有至少一个参数</p>
<p>search，如果为函数时, 通过返回true决定成为子集的一部分; 如果是字符串或数字, 将转换成正则, 如果数组元素或对象键值匹配它,则成为子集的一部分,但如果是空字符串则返回原对象 ;其他情况也返回原对象。 其他参数, 只有当search为函数时有效, 这时其参数依次是数组元素或对象键值(对象的情况下), 索引值或对象键名(对象的情况下), 多余的参数 此过滤多用于自动完成的模糊匹配!</p>
<p><img src="http://www.itprobie.com/jc/avalon/avalon_html/img/filterBy.png" alt="img"></p>
<p>filterBy例子1</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    avalon.define(&#123;</span><br><span class="line"><span class="javascript">        $id: <span class="string">&quot;filterBy&quot;</span>,</span></span><br><span class="line"><span class="javascript">        array: [<span class="string">&#x27;aaaa&#x27;</span>, <span class="string">&#x27;aab&#x27;</span>, <span class="string">&#x27;acb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>, <span class="string">&#x27;dddd&#x27;</span>],</span></span><br><span class="line"><span class="javascript">        object: &#123;<span class="attr">a</span>: <span class="string">&#x27;aaaa&#x27;</span>, <span class="attr">b</span>: <span class="string">&#x27;aab&#x27;</span>, <span class="attr">c</span>: <span class="string">&#x27;acb&#x27;</span>, <span class="attr">d</span>: <span class="string">&#x27;ccc&#x27;</span>, <span class="attr">e</span>: <span class="string">&#x27;dddd&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">        searchs: <span class="string">&quot;a&quot;</span>,</span></span><br><span class="line"><span class="javascript">        searchFn: <span class="function"><span class="keyword">function</span> (<span class="params">el, i</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> i &gt; <span class="number">2</span></span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        searchFn2: <span class="function"><span class="keyword">function</span> (<span class="params">el, i</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> el.length === <span class="number">4</span></span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        searchFn3: <span class="function"><span class="keyword">function</span> (<span class="params">el, i</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> i === <span class="string">&#x27;b&#x27;</span> || i === <span class="number">1</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;filterBy&#x27;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">ms-duplex</span>=<span class="string">&#x27;@search&#x27;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>a<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>b<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>c<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">ms-click</span>=<span class="string">&quot;@search = @searchFn | prevent&quot;</span>&gt;</span>变成过滤函数<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">ms-click</span>=<span class="string">&quot;@search = @searchFn2 | prevent&quot;</span>&gt;</span>变成过滤函数2<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">ms-click</span>=<span class="string">&quot;@search = @searchFn3 | prevent&quot;</span>&gt;</span>变成过滤函数3<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&#x27;el in @array | filterBy(@search)&#x27;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&#x27;el in @object | filterBy(@search)&#x27;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>filterBy例子2</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">            $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">             arr: [&#123;<span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>&#125;,&#123;<span class="attr">color</span>:<span class="string">&#x27;green&#x27;</span>&#125;,&#123;<span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span>&#125;],</span></span><br><span class="line"><span class="javascript">             fn: <span class="function"><span class="keyword">function</span>(<span class="params">el, index, xxx</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                 <span class="built_in">console</span>.log(el, index, xxx)</span></span><br><span class="line"><span class="javascript">                 <span class="keyword">return</span> el.color === <span class="string">&#x27;red&#x27;</span></span></span><br><span class="line">             &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&quot;el in @arr | filterBy(@fn, &#x27;xxx&#x27;)&quot;</span>&gt;</span>&#123;&#123;el.color&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>filterBy例子3</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">        $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        arr: [&#123;<span class="attr">name</span>: <span class="string">&#x27;wanglin&#x27;</span>, <span class="attr">age</span>: <span class="number">11</span>&#125;,</span></span><br><span class="line"><span class="javascript">            &#123;<span class="attr">name</span>: <span class="string">&#x27;lin&#x27;</span>, <span class="attr">age</span>: <span class="number">3</span>&#125;,</span></span><br><span class="line"><span class="javascript">            &#123;<span class="attr">name</span>: <span class="string">&#x27;Hunt&#x27;</span>, <span class="attr">age</span>: <span class="number">22</span>&#125;,</span></span><br><span class="line"><span class="javascript">            &#123;<span class="attr">name</span>: <span class="string">&#x27;Joe&#x27;</span>, <span class="attr">age</span>: <span class="number">33</span>&#125;],</span></span><br><span class="line"><span class="javascript">        fn: <span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;<span class="comment">//过滤数组中 name属性值带lin中的元素</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span>  <span class="regexp">/lin/</span>.test(a.name)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;test&#x27;</span> &gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-for</span>=<span class="string">&quot;(index,el) in @arr as items | filterBy(@fn)&quot;</span> &gt;</span></span><br><span class="line">        &#123;&#123;el.name&#125;&#125; -- &#123;&#123;items.length&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="selectBy"><a href="#selectBy" class="headerlink" title="selectBy"></a>selectBy</h3><p>只能用于ms-for循环,只对对象有效, 用于抽取目标对象的几个值,构成新数组返回.</p>
<ol>
<li>array，要抽取的属性名</li>
<li>defaults，如果目标对象不存在这个属性,那么从这个默认对象中得到默认值,否则为空字符串, 可选 这个多用于表格, 每一列的对象可能存在属性顺序不一致或缺少的情况</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    avalon.define(&#123;</span><br><span class="line"><span class="javascript">        $id: <span class="string">&quot;selectBy&quot;</span>,</span></span><br><span class="line"><span class="javascript">        obj: &#123;<span class="attr">a</span>: <span class="string">&#x27;aaa&#x27;</span>, <span class="attr">b</span>: <span class="string">&#x27;bbb&#x27;</span>, <span class="attr">c</span>: <span class="string">&#x27;ccc&#x27;</span>, <span class="attr">d</span>: <span class="string">&#x27;ddd&#x27;</span>, <span class="attr">e</span>: <span class="string">&#x27;eee&#x27;</span>&#125;,</span></span><br><span class="line">        grid: [&#123;a: 1, b: 2, c: 3&#125;, &#123;c: 11, b: 22, a: 33&#125;, &#123;b: 23, a: 44&#125;],</span><br><span class="line">        defaults: &#123;</span><br><span class="line"><span class="javascript">            a:<span class="string">&#x27;@@@&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            b:<span class="string">&#x27;$$$&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            c:<span class="string">&#x27;###&#x27;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;selectBy&#x27;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">li</span> <span class="attr">ms-for</span>=<span class="string">&#x27;el in @obj | selectBy([&quot;c&quot;,&quot;a&quot;,&quot;b&quot;])&#x27;</span>&gt;</span>&#123;&#123;el&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&#x27;1&#x27;</span> <span class="attr">width</span>=<span class="string">&#x27;200&#x27;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">tr</span> <span class="attr">ms-for</span>=<span class="string">&quot;tr in @grid&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">td</span> <span class="attr">ms-for</span>=<span class="string">&quot;td in tr | selectBy([&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;],@defaults)&quot;</span>&gt;</span>&#123;&#123;td&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="事件过滤器"><a href="#事件过滤器" class="headerlink" title="事件过滤器"></a>事件过滤器</h3><p>事件过滤器只要是对一些常用操作进行简化处理</p>
<p>对按键事件(keyup,keydown,keypress)到底按下了哪些功能键 或方向键进行友好的处理.许多人都记不清回车退格的keyCode是多少. 对阻止默认行为与防止冒泡进行封装</p>
<h3 id="esc"><a href="#esc" class="headerlink" title="esc"></a>esc</h3><p>当用户按下esc键时,执行你的回调</p>
<h3 id="tab"><a href="#tab" class="headerlink" title="tab"></a>tab</h3><p>当用户按下tab键时,执行你的回调</p>
<h3 id="enter"><a href="#enter" class="headerlink" title="enter"></a>enter</h3><p>当用户按下enter键时,执行你的回调</p>
<h3 id="space"><a href="#space" class="headerlink" title="space"></a>space</h3><p>当用户按下space键时,执行你的回调</p>
<h3 id="del"><a href="#del" class="headerlink" title="del"></a>del</h3><p>当用户按下del键时,执行你的回调</p>
<h3 id="up"><a href="#up" class="headerlink" title="up"></a>up</h3><p>当用户按下up键时,执行你的回调</p>
<h3 id="down"><a href="#down" class="headerlink" title="down"></a>down</h3><p>当用户按下down键时,执行你的回调</p>
<h3 id="left"><a href="#left" class="headerlink" title="left"></a>left</h3><p>当用户按下left键时,执行你的回调</p>
<h3 id="right"><a href="#right" class="headerlink" title="right"></a>right</h3><p>当用户按下right键时,执行你的回调</p>
<h3 id="prevent"><a href="#prevent" class="headerlink" title="prevent"></a>prevent</h3><p>阻止默为行为,多用于form的submit事件防止页面跳转,相当于调用了event.preventDefault</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;./api.html&#x27;</span> <span class="attr">ms-click</span>=<span class="string">&#x27;@fn | prevent&#x27;</span>&gt;</span>阻止跳转<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h3><p>阻止事件冒泡,相当于调用了event.stopPropagation</p>
<blockquote>
<p>页面的过滤器只能用于事件绑定</p>
</blockquote>
<h3 id="同步频率过滤器"><a href="#同步频率过滤器" class="headerlink" title="同步频率过滤器"></a>同步频率过滤器</h3><p>这两个过滤器只用于ms-duplex</p>
<h3 id="change"><a href="#change" class="headerlink" title="change"></a>change</h3><p>在文本域或文本区使用ms-duplex时,默认是每输入一个字符就同步一次. 当我们想在失去焦点时才进行同步, 那么可以使用此过滤器</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&#x27;@aaa | change&#x27;</span>&gt;</span>&#123;&#123;@aaa&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h3><p>当我们实现搜索框的自动完成时, 每输入一个字符可能就会向后台请求一次(请求关键字列表), 这样太频繁,后端撑不住,但使用change过滤器,则又太慢了.改为每隔几十毫秒请求一次就最好. 基于此常用需要开发出此过滤器. 拥有一个参数.</p>
<ol>
<li><p>debounceTime: 数字, 不写默认是300,不能少于4,否则做无效处理</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ms-duplex</span>=<span class="string">&#x27;@aaa | debounce(200)&#x27;</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="编写过滤器"><a href="#编写过滤器" class="headerlink" title="编写过滤器"></a>编写过滤器</h3><p>编写一个过滤器是非常简单的. 目前用户可编写的过滤器有两种, 不带参数的及带参数.</p>
<p>比方说uppercase,就是不带参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vm.aaa = <span class="string">&quot;aaa&quot;</span></span><br><span class="line"></span><br><span class="line">&lt;div&gt;&#123;&#123;@aaa | uppercase&#125;&#125;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>AAA<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那它是怎么实现的呢? 源码是这样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">avalon.filters.uppercase = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(str).toUpperCase()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤器总是把它前方的表达式生成的东西作为过滤器的第一个参数,然后返回一个值</p>
<p>同理lowercase的源码也很简单. 之所以用String,因为我们总想返回一个字符串</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">avalon.filters.lowercase = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">String</span>(str).toLowerCase()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么我们自定义一个过滤器,就首先要看一下文档,注意不要与现有的过滤器同名. 比如我们定义一个haha的过滤器</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">   avalon.filters.haha = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">       <span class="keyword">return</span> a +<span class="string">&#x27;haha&#x27;</span></span></span><br><span class="line">   &#125; </span><br><span class="line">   avalon.define(&#123;</span><br><span class="line"><span class="javascript">       $id:<span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">       aaa: <span class="string">&#x27;111&#x27;</span></span></span><br><span class="line">   &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&#x27;tesst&#x27;</span>&gt;</span>&#123;&#123;@aaa | haha&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span>// 111haha</span><br></pre></td></tr></table></figure>

<p>我们再看带参数的,带参数的必须写的括号,把第二个,第三个,放到里面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;@aaa | truncate(10,&#x27;...&#x27;)&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>truncate要传两个参数,那么看一下其源码是这样的:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">avalon.filters.truncate = <span class="function"><span class="keyword">function</span> (<span class="params">str, length, truncation</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//length，新字符串长度，truncation，新字符串的结尾的字段,返回新字符串</span></span><br><span class="line">    length = length || <span class="number">30</span></span><br><span class="line">    truncation = <span class="keyword">typeof</span> truncation === <span class="string">&quot;string&quot;</span> ? truncation : <span class="string">&quot;...&quot;</span></span><br><span class="line">    <span class="keyword">return</span> str.length &gt; length ?</span><br><span class="line">            str.slice(<span class="number">0</span>, length - truncation.length) + truncation :</span><br><span class="line">            <span class="built_in">String</span>(str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>好了,我们看一下如何写一个带参数的过滤器,里面重复利用已有的过滤器</p>
<p>众所周知,ms-attr是返回一个对象. 我们只想对其中的一个字段进行格式化. 比如我们要处理title. 那么就起名为title.</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;../dist/avalon.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">            avalon.filters.title = <span class="function"><span class="keyword">function</span> (<span class="params">obj, a, b</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> title = obj.title</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> newTitle = avalon.filters.truncate(title, a, b)</span></span><br><span class="line">                obj.title = newTitle</span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> obj</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> vm = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">                $id: <span class="string">&#x27;test&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                el: <span class="string">&#x27;123456789qwert&#x27;</span></span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span> <span class="attr">ms-controller</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-attr</span>=<span class="string">&quot;&#123;title:@el&#125; | title(10,&#x27;...&#x27;)&quot;</span>&gt;</span>333<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="watch，-fire-unwatch"><a href="#watch，-fire-unwatch" class="headerlink" title="$watch，$fire, $unwatch"></a>$watch，$fire, $unwatch</h2><p><strong>模块间通信及属性监控 $watch，$fire, $unwatch</strong></p>
<p>avalon内置了一个强大的自定义事件系统，它在绑定在每一个VM上。每一个VM都拥有$watch, $unwatch, $fire这三个方法，及一个$events对象。$events是用于储存各种回调。先从单个VM说起，如果一个VM拥有aaa这个属性，如果我们在VM通过$watch对它监控，那么当aaa改变值时，它对应的回调就会被触发！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vmodel = avalon.define(&#123;</span><br><span class="line">     $id: <span class="string">&quot;test&quot;</span>, </span><br><span class="line">     aaa: <span class="number">111</span></span><br><span class="line"> &#125;)</span><br><span class="line">  vmodel.$watch(<span class="string">&quot;aaa&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">newValue, oldValue</span>)</span>&#123;</span><br><span class="line">       avalon.log(newValue) <span class="comment">//222</span></span><br><span class="line">       avalon.log(oldValue) <span class="comment">//111</span></span><br><span class="line">   &#125;)</span><br><span class="line"> <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     vmodel.aaa = <span class="number">222</span></span><br><span class="line"> &#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>注意，它只能监听当前属性的变动。</strong></p>
<p>我们还可以通过$unwatch方法，移除对应的回调。如果传入两个参数，第一个是属性名，第二个是回调，那么只移除此回调；如果只传入一个属性名，那么此属性关联的所有回调都会被移除掉。</p>
<p>有时，我们还绑定了一些与属性名无关的事件回调，想触发它，那只能使用$fire方法了。$fire方法第一个参数为属性名（自定义事件名），其他参数随意。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vmodel = avalon.define(&#123;</span><br><span class="line">     $id: <span class="string">&quot;test&quot;</span>, </span><br><span class="line">     aaa: <span class="number">111</span></span><br><span class="line"> &#125;)</span><br><span class="line"> vmodel.$watch(<span class="string">&quot;cat&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     avalon.log(avalon.slice(<span class="built_in">arguments</span>)) <span class="comment">//[1,2,3]</span></span><br><span class="line">  &#125;)</span><br><span class="line"> <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     vmodel.$fire(<span class="string">&quot;cat&quot;</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line"> &#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p><strong>更高级的玩法</strong>，有时我们想在任何属性变化时都触发某一个回调，这时我们就需要$watch一个特殊的属性了——“$all”。不同的是，$watch回调的参数多了一个属性名，排在最前面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vmodel = avalon.define(&#123;</span><br><span class="line">     $id: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">     aaa: <span class="number">111</span>,</span><br><span class="line">     bbb: <span class="number">222</span>,</span><br><span class="line">     </span><br><span class="line"> &#125;)</span><br><span class="line"> vmodel.$watch(<span class="string">&quot;$all&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     avalon.log(avalon.slice(<span class="built_in">arguments</span>)) </span><br><span class="line">         <span class="comment">// [&quot;aaa&quot;, 2, 111]</span></span><br><span class="line">         <span class="comment">// [&quot;bbb&quot;, 3, 222]</span></span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     vmodel.aaa = <span class="number">2</span></span><br><span class="line">     vmodel.bbb = <span class="number">3</span></span><br><span class="line"> &#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p>手动触发$fire是位随着高风险的，框架内部是做了处理（只有前后值发生变化才会触发），因此万不得已使用它，但又爆发死循环怎么办？这样就需要暂时中断VM的属性监控机制。使用$unwatch()，它里面什么也不传，就暂时将监控冻结了。恢复它也很简单，使用$watch()，里面也什么也不传！</p>
<p>不过最强大的用法是实现模块间的通信（因为在实际项目中，一个页面可能非常大，有多少人分块制作，每个人自己写自己的VM，这时就需要通过某种机制来进行数据与方法的联动了），这是使用$fire方法达成的。只要在$fire的自定义事件名前添加”up!”, “down!”, “all!”前缀,它就能实现angular相似的$emit,$broadcast功能。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>by 司徒正美<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;avalon.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> vm1 = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">                $id: <span class="string">&quot;ancestor&quot;</span>, </span></span><br><span class="line"><span class="javascript">                aaa : <span class="string">&#x27;1111111111&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                click : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    avalon.log(<span class="string">&quot;向下广播&quot;</span>)</span></span><br><span class="line"><span class="javascript">                    vm1.$fire(<span class="string">&quot;down!aaa&quot;</span>, <span class="string">&quot;capture&quot;</span>)</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            vm1.$watch(<span class="string">&quot;aaa&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span></span><br><span class="line">                    avalon.log(v)</span><br><span class="line"><span class="javascript">                    avalon.log(<span class="string">&quot;ancestor.aaa事件被触发了&quot;</span>)</span></span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> vm2 = avalon.define(&#123;</span></span><br><span class="line"><span class="javascript">                $id: <span class="string">&quot;parent&quot;</span>, </span></span><br><span class="line"><span class="javascript">                text : <span class="string">&quot;222222222&quot;</span></span></span><br><span class="line"><span class="javascript">                aaa : <span class="string">&#x27;3333333333&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                click : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&quot;全局扩播&quot;</span>)</span></span><br><span class="line"><span class="javascript">                    vm2.$fire(<span class="string">&quot;all!aaa&quot;</span>, <span class="string">&quot;broadcast&quot;</span>)</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            vm2.$watch(<span class="string">&quot;aaa&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span></span><br><span class="line">                   avalon.log(v)</span><br><span class="line"><span class="javascript">                   avalon.log(<span class="string">&quot;parent.aaa事件被触发了&quot;</span>)</span></span><br><span class="line">             &#125;)</span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> vm3 = avalon.define(</span></span><br><span class="line"><span class="javascript">                $id: <span class="string">&quot;son&quot;</span>, </span></span><br><span class="line"><span class="javascript">                click : <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&quot;向上冒泡&quot;</span>)</span></span><br><span class="line"><span class="javascript">                    vm3.$fire(<span class="string">&quot;up!aaa&quot;</span>, <span class="string">&quot;bubble&quot;</span>)</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            vm3.$watch(<span class="string">&quot;aaa&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">v</span>) </span>&#123;</span></span><br><span class="line">                    avalon.log(v)</span><br><span class="line"><span class="javascript">                    avalon.log(<span class="string">&quot;son.aaa事件被触发了&quot;</span>)</span></span><br><span class="line">              &#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;ms-controller&quot;</span>   <span class="attr">ms-controller</span>=<span class="string">&quot;ancestor&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>avalon vm.$fire的升级版 <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">ms-click</span>=<span class="string">&quot;click&quot;</span>&gt;</span></span><br><span class="line">            capture</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">ms-click</span>=<span class="string">&quot;click&quot;</span>&gt;</span>broadcast<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">ms-controller</span>=<span class="string">&quot;son&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">ms-click</span>=<span class="string">&quot;click&quot;</span>&gt;</span></span><br><span class="line">                    bubble</span><br><span class="line">                <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="与jQuery共存"><a href="#与jQuery共存" class="headerlink" title="与jQuery共存"></a>与jQuery共存</h2><p>jQuery是世界上最流行的DOM库,它拥有各式各样的插件,在日常开发中我们可能还是离不开它.因此与它一起使用是常态, 下面是一些注意</p>
<h3 id="domReady后如何扫描"><a href="#domReady后如何扫描" class="headerlink" title="domReady后如何扫描"></a>domReady后如何扫描</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> vm = avalon.define(&#123;<span class="comment">/* */</span>&#125;)</span><br><span class="line">   <span class="comment">//如果你将vm定义在jQuery的ready方法内部,那么avalon的扫描就会失效,需要手动扫描</span></span><br><span class="line">   avalon.scan(<span class="built_in">document</span>.body) <span class="comment">//现在只要传入扫描范围的根节点就行</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="如何AJAX提交数据"><a href="#如何AJAX提交数据" class="headerlink" title="如何AJAX提交数据"></a>如何AJAX提交数据</h3><p>提交整个VM</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jQuery.ajax(&#123;</span><br><span class="line">   method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">   url: <span class="string">&#x27;url-adress&#x27;</span>,</span><br><span class="line">   <span class="comment">//这里是取vm的数据模型 ,通过JSON.stringify会去掉其所有方法, 变成JSON字符串</span></span><br><span class="line">   <span class="comment">//再用JSON.parse变回纯JS对象</span></span><br><span class="line">   data: <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(vm.$model))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>提交VM中的某个<code>对象</code>属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">data: <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(vm.data.$model))</span><br><span class="line"><span class="string">``</span></span><br><span class="line"></span><br><span class="line">提交VM中的某个<span class="string">`数组`</span>属性</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`javascript</span></span><br><span class="line"><span class="string">data: JSON.parse(JSON.stringify(vm.data.$model))</span></span><br></pre></td></tr></table></figure>

<h3 id="如何让后台回来的数据更新VM"><a href="#如何让后台回来的数据更新VM" class="headerlink" title="如何让后台回来的数据更新VM"></a>如何让后台回来的数据更新VM</h3><p>后台的数据更新VM,只能是更新VM的某些已经定义属性. 如果后台数据很大,那么我们可以定义一个空对象(假如后台数据是对象类型)或一个空数组(假如后台数据是数组类型)来占位</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> vm = avalon.define(&#123;</span><br><span class="line">    $id: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">    array: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">jQuery.ajax(&#123;</span><br><span class="line">   method: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">   url: <span class="string">&#x27;url-adress&#x27;</span>,</span><br><span class="line">   data: &#123;<span class="comment">/**/&#125;,</span></span><br><span class="line"><span class="comment">   success: function(data)&#123;</span></span><br><span class="line"><span class="comment">     vm.array = data.array</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;)</span></span><br></pre></td></tr></table></figure>

<h3 id="如何同步表单的数据"><a href="#如何同步表单的数据" class="headerlink" title="如何同步表单的数据"></a>如何同步表单的数据</h3><p>假如我的某个表单是用于jQuery的日历插件,那么它数据如何同步到vm</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(datepick_input_css_selector).input(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   vm.aaa = <span class="built_in">this</span>.value</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如何同步复选框 在avalon中,checkbox要对应一个数组 首选是取得所有同名的checkbox,并要求它们在选中状态,然后用map方法收集它们的value值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;checkbox&#x27;</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">var</span> array = $(<span class="string">&#x27;checkbox[name=&quot;&#x27;</span>+<span class="built_in">this</span>.name+<span class="string">&#x27;&quot;]:checked&#x27;</span>).map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> $(<span class="built_in">this</span>).val();</span><br><span class="line">   &#125;)</span><br><span class="line">   vm.checkboxProps = array</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如何同步下拉框</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&#x27;select&#x27;</span>).change(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">   vm.selectProps = $(<span class="built_in">this</span>).val()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/JavaWeb/" rel="tag"># JavaWeb</a>
              <a href="/tags/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/" rel="tag"># 前端框架</a>
              <a href="/tags/avalon/" rel="tag"># avalon</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/07/12/FreeMarker/" rel="prev" title="FreeMarker">
                  <i class="fa fa-angle-left"></i> FreeMarker
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/07/20/SpringBoot2%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E4%B8%AD/" rel="next" title="SpringBoot2核心技术中">
                  SpringBoot2核心技术中 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wotzc</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/wotzc" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  






  





</body>
</html>
