<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="真正的大师永远都怀着一颗学徒的心">
<meta property="og:type" content="website">
<meta property="og:title" content="Cai">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Cai">
<meta property="og:description" content="真正的大师永远都怀着一颗学徒的心">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="wotzc">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Cai</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Cai</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wotzc"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">wotzc</p>
  <div class="site-description" itemprop="description">真正的大师永远都怀着一颗学徒的心</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">62</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/12/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/12/05/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2023-12-05 16:27:06 / 修改时间：21:01:35" itemprop="dateCreated datePublished" datetime="2023-12-05T16:27:06+08:00">2023-12-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="note info no-icon"><p>设计模式（Design pattern）代表了最佳的实践，通常被有经验的面向对象的软件开发人员所采用。设计模式是软件开发人员在软件开发过程中面临的一般问题的解决方案。这些解决方案是众多软件开发人员经过相当长的一段时间的试验和错误总结出来的。<br>设计模式是一套被反复使用的、多数人知晓的、经过分类编目的、代码设计经验的总结。使用设计模式是为了重用代码、让代码更容易被他人理解、保证代码可靠性。 毫无疑问，设计模式于己于他人于系统都是多赢的，设计模式使代码编制真正工程化，设计模式是软件工程的基石，如同大厦的一块块砖石一样。项目中合理地运用设计模式可以完美地解决很多问题，每种模式在现实中都有相应的原理来与之对应，每种模式都描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案，这也是设计模式能被广泛应用的原因。</p>
</div>

<p>共有 23 种设计模式。这些模式可以分为三大类：</p>
<ul>
<li><p><strong>创建型模式（Creational Patterns）- 这些设计模式提供了一种在创建对象的同时隐藏创建逻辑的方式，而不是使用 new 运算符直接实例化对象。这使得程序在判断针对某个给定实例需要创建哪些对象时更加灵活。</strong></p>
<ul>
<li>工厂模式（Factory Pattern）</li>
<li>抽象工厂模式（Abstract Factory Pattern）</li>
<li>单例模式（Singleton Pattern）</li>
<li>建造者模式（Builder Pattern）</li>
<li>原型模式（Prototype Pattern）</li>
</ul>
</li>
<li><p><strong>结构型模式（Structural Patterns）- 这些设计模式关注类和对象的组合。继承的概念被用来组合接口和定义组合对象获得新功能的方式。</strong>    </p>
<ul>
<li>适配器模式（Adapter Pattern）</li>
<li>桥接模式（Bridge Pattern）</li>
<li>组合模式（Composite Pattern）</li>
<li>装饰器模式（Decorator Pattern）</li>
<li>外观模式（Facade Pattern）</li>
<li>享元模式（Flyweight Pattern）</li>
<li>代理模式（Proxy Pattern）</li>
</ul>
</li>
<li><p><strong>行为型模式（Behavioral Patterns）- 这些设计模式特别关注对象之间的通信。</strong></p>
<ul>
<li>责任链模式（Chain of Responsibility Pattern）</li>
<li>命令模式（Command Pattern）</li>
<li>迭代器模式（Iterator Pattern）</li>
<li>中介者模式（Mediator Pattern）</li>
<li>备忘录模式（Memento Pattern）</li>
<li>观察者模式（Observer Pattern）</li>
<li>状态模式（State Pattern）</li>
<li>策略模式（Strategy Pattern）</li>
<li>模板模式（Template Pattern）</li>
<li>访问者模式（Visitor Pattern）</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/25/Optional/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/25/Optional/" class="post-title-link" itemprop="url">Optional</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-25 10:29:54" itemprop="dateCreated datePublished" datetime="2023-09-25T10:29:54+08:00">2023-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-11-29 09:12:18" itemprop="dateModified" datetime="2023-11-29T09:12:18+08:00">2023-11-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java8/" itemprop="url" rel="index"><span itemprop="name">Java8</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><div class="note info no-icon"><p>“Null sucks.” - Doug Lea</p>
</div>

<p>Doug Lea 是一位美国的计算机科学家，他是 Java 平台的并发和集合框架的主要设计者之一。他在 2014 年的一篇文章中说过：“Null sucks.”，意思是 null 很糟糕。他认为 null 是一种不明确的表示，它既可以表示一个值不存在，也可以表示一个值未知，也可以表示一个值无效。这样就会导致很多逻辑错误和空指针异常，给程序员带来很多麻烦。他建议使用 Optional 类来封装可能为空的值，从而提高代码的可读性和健壮性。</p>
<p>null 引用是一种表示一个对象变量没有指向任何对象的方式，它是 Java 语言中的一个特殊值，也是导致空指针异常（NullPointerException）的主要原因。虽然 null 引用可以用来表示一个值不存在或未知，也可以用来节省内存空间。但是它也不符合面向对象的思想，因为它不是一个对象，不能调用任何方法或属性。</p>
<p>可以看到，null 引用并不好，我们应该尽量避免使用 null，那么我们该怎么避免 null 引用引起的逻辑错误和运行时异常嘞？</p>
<p>其实这个问题 Java 的设计者也知道，于是他们在 Java8 之后设计引入了 Optional 类解决这个问题，本文将给大家详细介绍下 Optional 类的设计目的以及使用方法。</p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/optional/java_optional.png"></p>
<hr>
<h1 id="Optional-类是什么？"><a href="#Optional-类是什么？" class="headerlink" title="Optional 类是什么？"></a>Optional 类是什么？</h1><p><code>Optional</code> 类是 java 8 中引入的一个新的类，它的作用是封装一个可能为空的值，从而避免空指针异常（<code>NullPointerException</code>）。<code>Optional</code> 类可以看作是一个容器，它可以包含一个非空的值，也可以为空。<code>Optional</code> 类提供了一些方法，让我们可以更方便地处理可能为空的值，而不需要显式地进行空值检查或者使用 null。</p>
<h1 id="Optional-类的设计"><a href="#Optional-类的设计" class="headerlink" title="Optional 类的设计"></a>Optional 类的设计</h1><p>Optional 类的设计是基于函数式编程的思想，它借鉴了 Scala 和 Haskell 等语言中的 Option 类型。Optional 类实现了 java.util.function 包中的 Supplier、Consumer、Predicate、Function 等接口，这使得它可以和 lambda 表达式或者方法引用一起使用，形成更简洁和优雅的代码。</p>
<p>Optional 类被 final 修饰，因此它是一个不可变的类，它有两个静态方法用于创建 Optional 对象。</p>
<h2 id="Optional-empty"><a href="#Optional-empty" class="headerlink" title="Optional.empty()"></a><code>Optional.empty()</code></h2><p><code>Optional.empty</code> 表示一个空的 <code>Optional</code> 对象，它不包含任何值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个空的 Optional 对象</span></span><br><span class="line">Optional&lt;String&gt; empty = Optional.empty();</span><br></pre></td></tr></table></figure>

<h2 id="Optional-of-T-value"><a href="#Optional-of-T-value" class="headerlink" title="Optional.of(T value)"></a><code>Optional.of(T value)</code></h2><p><code>Optional.of</code> 表示一个非空的 <code>Optional</code> 对象，它包含一个非空的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个非空的 Optional 对象</span></span><br><span class="line">Optional&lt;String&gt; hello = Optional.of(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Optional-ofNullable-T-value"><a href="#Optional-ofNullable-T-value" class="headerlink" title="Optional.ofNullable(T value)"></a><code>Optional.ofNullable(T value)</code></h2><p>注意，如果我们使用 <code>Optional.of</code> 方法传入一个 <code>null</code> 值，会抛出 <code>NullPointerException</code>。如果我们不确定一个值是否为空，可以使用 <code>Optional.ofNullable</code> 方法，它会根据值是否为空，返回一个相应的 <code>Optional</code> 对象。例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个可能为空的 Optional 对象</span></span><br><span class="line">Optional&lt;String&gt; name = Optional.ofNullable(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Optional-对象的使用方法"><a href="#Optional-对象的使用方法" class="headerlink" title="Optional 对象的使用方法"></a>Optional 对象的使用方法</h1><p><code>Optional</code> 对象提供了一些方法，让我们可以更方便地处理可能为空的值，而不需要显式地进行空值检查或者使用 <code>null</code>。以下是一些常用的方法。</p>
<h2 id="isPresent"><a href="#isPresent" class="headerlink" title="isPresent()"></a><code>isPresent()</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Person&gt; personOptional = daoService.selectOne(person1);</span><br><span class="line"><span class="keyword">if</span> (personOptional.isPresent()) &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;查询不为空&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;查询为空&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="get"><a href="#get" class="headerlink" title="get()"></a><code>get()</code></h2><p>如果 <code>Optional</code> 对象包含一个非空的值，返回该值，否则抛出 <code>NoSuchElementException</code> 异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Person&gt; personOptional = daoService.selectOne(person1);</span><br><span class="line"><span class="keyword">if</span> (personOptional.isPresent()) &#123;</span><br><span class="line">  Person person = personOptional.get();</span><br><span class="line">  System.out.println(person);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	System.out.println(<span class="string">&quot;查询为空&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ifPresent-Consumer-lt-super-T-gt-action"><a href="#ifPresent-Consumer-lt-super-T-gt-action" class="headerlink" title="ifPresent(Consumer&lt;? super T&gt; action)"></a><code>ifPresent(Consumer&lt;? super T&gt; action)</code></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Person&gt; personOptional = daoService.selectOne(person1);</span><br><span class="line">personOptional.ifPresent(person -&gt; System.out.println(person.getName()));</span><br></pre></td></tr></table></figure>

<h2 id="orElse-T-other"><a href="#orElse-T-other" class="headerlink" title="orElse(T other)"></a><code>orElse(T other)</code></h2><p>如果 <code>Optional</code> 对象包含一个非空的值，返回该值，否则返回给定的默认值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Optional&lt;Person&gt; personOptional = daoService.selectOne(person1);</span><br><span class="line">Person person = personOptional.orElse(<span class="keyword">new</span> Person());</span><br></pre></td></tr></table></figure>

<h2 id="orElseGet-Supplier-lt-extends-T-gt-supplier"><a href="#orElseGet-Supplier-lt-extends-T-gt-supplier" class="headerlink" title="orElseGet(Supplier&lt;? extends T&gt; supplier)"></a><code>orElseGet(Supplier&lt;? extends T&gt; supplier)</code></h2><p>如果 <code>Optional</code> 对象包含一个非空的值，返回该值，否则返回由给定的供应者操作生成的值。</p>
<p>当<code>orElse</code>的参数是间接计算得来的时候，使用<code>orElse</code>可能导致<code>NullPointerException</code>，当<code>orElse</code>的参数是间接计算得来的时候。虽然这种说法有点牵强（因为并不是<code>orElse</code>导致了空指针异常），但是使用<code>orElseGet</code>确实可以避免这种情况。</p>
<p>两者的明显（也是唯一）区别是前者需要传递的参数是一个值（通常是为空时的默认值），后者传递的是一个函数。我们看一下源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the value if present, otherwise return &#123;<span class="doctag">@code</span> other&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">orElse</span><span class="params">(T other)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="keyword">null</span> ? value : other;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the value if present, otherwise invoke &#123;<span class="doctag">@code</span> other&#125; and return</span></span><br><span class="line"><span class="comment"> * the result of that invocation.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">orElseGet</span><span class="params">(Supplier&lt;? extends T&gt; other)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value != <span class="keyword">null</span> ? value : other.get();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单解释为，我们使用<code>Optional</code>包装的变量如果不为空，返回它本身，否则返回我们传递进去的值。<code>orElseGet</code>参数为<code>Supplier</code>接口，它是一个函数式接口，它的形式是这样的：<code>() -&gt; &#123; return computedResult &#125;</code>，即<em>入参为空，有返回值（任意类型的）</em>。</p>
<p>我们可能考虑的问题是：何时使用<code>orElse</code>和何时使用<code>orElseGet</code>？看起来可以使用<code>orElseGet</code>的时候，使用<code>orElse</code>也可以代替（因为<code>Supplier</code>接口没有入参），而且使用<code>orElseGet</code>还需要将计算过程额外包装成一个 lambda 表达式。</p>
<p>一个关键的点是，使用<code>Supplier</code>能够做到<em>懒计算</em>，即使用<code>orElseGet</code>时。它的好处是，<strong>只有在需要的时候才会计算结果</strong>。具体到我们的场景，使用<code>orElse</code>的时候，每次它都会执行计算结果的过程，而对于<code>orElseGet</code>，只有<code>Optional</code>中的值为空时，它才会计算备选结果。这样做的好处是可以<strong>避免提前计算结果的风险</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Person person1 = <span class="keyword">new</span> Person();</span><br><span class="line">person1.setName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">Person person2 = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">String orElse = Optional.ofNullable(person1.getName()).orElse(person2.getName()); <span class="comment">// 报错，空指针</span></span><br><span class="line"></span><br><span class="line">String orElseGet = Optional.ofNullable(person1.getName()).orElseGet(() -&gt; person2.getName()); <span class="comment">// 不报错</span></span><br><span class="line"></span><br><span class="line">System.out.println(orElseGet);</span><br></pre></td></tr></table></figure>

<h2 id="map-Function-lt-super-T-extends-U-gt-mapper"><a href="#map-Function-lt-super-T-extends-U-gt-mapper" class="headerlink" title="map(Function&lt;? super T,? extends U&gt; mapper)"></a><code>map(Function&lt;? super T,? extends U&gt; mapper)</code></h2><p>如果 <code>Optional</code> 对象包含一个非空的值，对该值应用给定的映射函数，返回一个包含映射结果的 Optional 对象，否则返回一个空的 <code>Optional</code> 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Person person1 = <span class="keyword">new</span> Person();</span><br><span class="line">person1.setName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">Optional&lt;Person&gt; person = Optional.ofNullable(person1);</span><br><span class="line">Optional&lt;String&gt; optionalS = person.map(p -&gt; p.getName().toUpperCase());</span><br><span class="line"><span class="keyword">if</span> (optionalS.isPresent()) &#123;</span><br><span class="line">  String upperName = optionalS.get();</span><br><span class="line">  System.out.println(upperName);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ZHANGSAN</span></span><br></pre></td></tr></table></figure>

<h2 id="flatMap-Function-lt-super-T-Optional-lt-U-gt-gt-mapper"><a href="#flatMap-Function-lt-super-T-Optional-lt-U-gt-gt-mapper" class="headerlink" title="flatMap(Function&lt;? super T,Optional&lt;U&gt;&gt; mapper)"></a><code>flatMap(Function&lt;? super T,Optional&lt;U&gt;&gt; mapper)</code></h2><h3 id="map和flatMap的区别"><a href="#map和flatMap的区别" class="headerlink" title="map和flatMap的区别:"></a>map和flatMap的区别:</h3><p><code>map</code>会将传入的<code>Function</code>函数的结果进行封装，先看源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>&lt;U&gt; Optional&lt;U&gt; <span class="title">map</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, ? extends U&gt; mapper)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(mapper);</span><br><span class="line">    <span class="keyword">if</span> (!isPresent())</span><br><span class="line">        <span class="keyword">return</span> empty();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(mapper.apply(value));<span class="comment">//会使用Optional的ofNullable方法包装Function函数返回的值</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>flatMap</code>会直接返回<code>Function</code>函数执行的结果，看源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>&lt;U&gt; Optional&lt;U&gt; <span class="title">flatMap</span><span class="params">(Function&lt;? <span class="keyword">super</span> T, Optional&lt;U&gt;&gt; mapper)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(mapper);</span><br><span class="line">    <span class="keyword">if</span> (!isPresent())</span><br><span class="line">        <span class="keyword">return</span> empty();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.requireNonNull(mapper.apply(value));<span class="comment">//直接返回Function执行的结果</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以在使用的时候，下面这段代码会报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getStudentName</span><span class="params">(School school)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(school)</span><br><span class="line">                .map(School::getTearch)</span><br><span class="line">                .map(Tearch::getStudent)</span><br><span class="line">                .map(Student::getName)</span><br><span class="line">                .orElse(<span class="string">&quot;false&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>而下面这段代码不会报错。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getStudentName</span><span class="params">(School school)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.ofNullable(school)</span><br><span class="line">                .flatMap(School::getTearch)</span><br><span class="line">                .flatMap(Tearch::getStudent)</span><br><span class="line">                .map(Student::getName).orElse(<span class="string">&quot;false&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="filter-Predicate-lt-super-T-gt-predicate"><a href="#filter-Predicate-lt-super-T-gt-predicate" class="headerlink" title="filter(Predicate&lt;? super T&gt; predicate)"></a><code>filter(Predicate&lt;? super T&gt; predicate)</code></h2><p>如果 <code>Optional</code> 对象包含一个非空的值，并且该值满足给定的谓词条件，返回包含该值的 <code>Optional</code> 对象，否则返回一个空的 <code>Optional</code> 对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Person person1 = <span class="keyword">new</span> Person();</span><br><span class="line">person1.setName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">Optional&lt;Person&gt; optionalPerson = Optional.of(person1);</span><br><span class="line">Optional&lt;Person&gt; optional = optionalPerson.filter(person -&gt; <span class="string">&quot;ZHANGSAN&quot;</span>.equals(person.getName()));)</span><br><span class="line"><span class="keyword">if</span> (optional.isPresent())&#123;</span><br><span class="line">	System.out.println(optional);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	System.out.println(<span class="string">&quot;optional为空&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/08/SpringBoot-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/08/SpringBoot-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" class="post-title-link" itemprop="url">SpringBoot 启动流程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-08 10:18:50" itemprop="dateCreated datePublished" datetime="2023-09-08T10:18:50+08:00">2023-09-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-18 14:52:58" itemprop="dateModified" datetime="2023-09-18T14:52:58+08:00">2023-09-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>每个<quote>SpringBoot</quote>程序都有一个主入口，就是<quote>main()</quote>方法，在<quote>main()</quote>方法中调用<code>SpringApplication.run()</code>来启动整个程序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>SpringApplication.class</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt; primarySource, String... args)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> run(<span class="keyword">new</span> Class[]&#123;primarySource&#125;, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SpringApplication</span><span class="params">(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.resourceLoader = resourceLoader;</span><br><span class="line">  Assert.notNull(primarySources, <span class="string">&quot;PrimarySources must not be null&quot;</span>);</span><br><span class="line">  <span class="keyword">this</span>.primarySources = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));</span><br><span class="line">  <span class="comment">// 根据classpath的类推断并设置webApplicationType</span></span><br><span class="line">  <span class="keyword">this</span>.webApplicationType = WebApplicationType.deduceFromClasspath();</span><br><span class="line">  <span class="keyword">this</span>.bootstrapRegistryInitializers = <span class="keyword">new</span> ArrayList&lt;&gt;(getSpringFactoriesInstances(BootstrapRegistryInitializer.class));</span><br><span class="line">  setInitializers((Collection) getSpringFactoriesInstances(ApplicationContextInitializer.class));</span><br><span class="line">  setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class));</span><br><span class="line">  <span class="keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>调用静态<code>run()</code>方法时，我们首先创建一个<code>SpringApplication</code>的对象实例。在创建实例时，进行了一些基本的初始化操作。大体如下:<ol>
<li>根据<code>classpath</code>的类推断并设置<code>webApplicationType</code>，根据源码可以看到包含三种容器<code>REACTIVE</code>、<code>NONE</code>、<code>SERVLET</code>，默认用的是<code>WebApplicationType.SERVLET</code>容器</li>
<li>从<code>META-INF/spring.factories</code>中获取<code>BootstrapRegistryInitializer</code>并放入集合<code>bootstrapRegistryInitializers</code>中</li>
<li>加载所有的<code>ApplicationContextInitializer</code>并放入集合<code>initializers</code>中</li>
<li>加载所有的<code>ApplicationListener</code>并放入集合<code>listeners</code>中</li>
<li>推断<code>mainApplicationClass</code>并赋值给<code>this.mainApplicationClass</code></li>
</ol>
</li>
</ol>
<p>初始化完成后，执行<code>run()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt; primarySource, String... args)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> run(<span class="keyword">new</span> Class&lt;?&gt;[] &#123; primarySource &#125;, args);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(Class&lt;?&gt;[] primarySources, String[] args)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> SpringApplication(primarySources).run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">long</span> startTime = System.nanoTime();</span><br><span class="line">  DefaultBootstrapContext bootstrapContext = createBootstrapContext();</span><br><span class="line">  ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">  configureHeadlessProperty();</span><br><span class="line">  <span class="comment">// 查找并加载所有的SpringApplicationRunListener</span></span><br><span class="line">  SpringApplicationRunListeners listeners = getRunListeners(args);</span><br><span class="line">  <span class="comment">// 通知所有的listeners程序启动</span></span><br><span class="line">  listeners.starting(bootstrapContext, <span class="keyword">this</span>.mainApplicationClass);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span class="line">    ConfigurableEnvironment environment = prepareEnvironment(listeners, bootstrapContext, applicationArguments);</span><br><span class="line">    Banner printedBanner = printBanner(environment);</span><br><span class="line">    context = createApplicationContext();</span><br><span class="line">    context.setApplicationStartup(<span class="keyword">this</span>.applicationStartup);</span><br><span class="line">    prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">    refreshContext(context);</span><br><span class="line">    afterRefresh(context, applicationArguments);</span><br><span class="line">    Duration timeTakenToStartup = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">      <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup);</span><br><span class="line">    &#125;</span><br><span class="line">    listeners.started(context, timeTakenToStartup);</span><br><span class="line">    callRunners(context, applicationArguments);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> AbandonedRunException) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    handleRunFailure(context, ex, listeners);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (context.isRunning()) &#123;</span><br><span class="line">      Duration timeTakenToReady = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">      listeners.ready(context, timeTakenToReady);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> AbandonedRunException) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    handleRunFailure(context, ex, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(ex);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>run()</code>方法中首先调用方法<code>getRunListeners()</code>查找并加载所有的<code>SpringApplicationRunListener</code>（监听器），放入到<code>SpringApplicationRunListeners</code>这个集合类里面来进行统一管理。然后调用他们的<code>starting()</code>来通知所有的<code>listeners</code>（监听器）程序启动。</li>
</ol>
<p><strong>getRunListeners方法:</strong></p>
<p><code>SpringAppcation.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> SpringApplicationRunListeners <span class="title">getRunListeners</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  ArgumentResolver argumentResolver = ArgumentResolver.of(SpringApplication.class, <span class="keyword">this</span>);</span><br><span class="line">  argumentResolver = argumentResolver.and(String[].class, args);</span><br><span class="line">  List&lt;SpringApplicationRunListener&gt; listeners = getSpringFactoriesInstances(SpringApplicationRunListener.class,</span><br><span class="line">  argumentResolver);</span><br><span class="line">  SpringApplicationHook hook = applicationHook.get();</span><br><span class="line">  SpringApplicationRunListener hookListener = (hook != <span class="keyword">null</span>) ? hook.getRunListener(<span class="keyword">this</span>) : <span class="keyword">null</span>;</span><br><span class="line">  <span class="keyword">if</span> (hookListener != <span class="keyword">null</span>) &#123;</span><br><span class="line">  listeners = <span class="keyword">new</span> ArrayList&lt;&gt;(listeners);</span><br><span class="line">  listeners.add(hookListener);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> SpringApplicationRunListeners(logger, listeners, <span class="keyword">this</span>.applicationStartup);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">getSpringFactoriesInstances</span><span class="params">(Class&lt;T&gt; type, ArgumentResolver argumentResolver)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> SpringFactoriesLoader.forDefaultResourceLocation(getClassLoader()).load(type, argumentResolver);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>SpringFactoriesLoader.class</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SpringFactoriesLoader <span class="title">forDefaultResourceLocation</span><span class="params">(<span class="meta">@Nullable</span> ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> forResourceLocation(<span class="string">&quot;META-INF/spring.factories&quot;</span>, classLoader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>getRunListeners()</code>方法从<code>spring.factories</code>中获取运行监听器。</p>
<p>我们<code>debug</code>跟踪一下。</p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/springboot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/getRunListeners.png"></p>
<p>可以看到，注册为<code>SpringApplicationRunListener</code>的实现类只有一个，就是<code>EventPublishingRunListener</code>。用来在SpringBoot的整个启动流程中的不同时间点发布不同类型的应用事件(<code>SpringApplicationEvent</code>)。<code>EventPublishingRunListener</code> 是 <code>SpringApplicationRunListener</code> 的子类，它会在应用程序启动期间发布多个事件。当应用程序上下文创建时，<code>EventPublishingRunListener</code> 会发布 <code>ApplicationStartingEvent</code> 事件；当应用程序运行时，它会发布 <code>ApplicationStartedEvent</code> 事件。这些事件可以被其他组件监听，例如自定义的事件监听器。通过监听这些事件，您可以在应用程序启动期间执行自定义的逻辑。</p>
<hr>
<p>我们接着回到<code>Run</code>方法中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span class="line">  ConfigurableEnvironment environment = prepareEnvironment(listeners, bootstrapContext, applicationArguments);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span class="title">prepareEnvironment</span><span class="params">(SpringApplicationRunListeners listeners,</span></span></span><br><span class="line"><span class="function"><span class="params">      DefaultBootstrapContext bootstrapContext, ApplicationArguments applicationArguments)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Create and configure the environment</span></span><br><span class="line">   <span class="comment">// 创建并配置environment</span></span><br><span class="line">   ConfigurableEnvironment environment = getOrCreateEnvironment();</span><br><span class="line">   <span class="comment">// 配置 property sources 和 profiles</span></span><br><span class="line">   configureEnvironment(environment, applicationArguments.getSourceArgs());</span><br><span class="line">   <span class="comment">// 将environment.getPropertySources()放在第一个位置</span></span><br><span class="line">   ConfigurationPropertySources.attach(environment);</span><br><span class="line">   <span class="comment">// 运行监听器通知所有监听器环境准备完成</span></span><br><span class="line">   listeners.environmentPrepared(bootstrapContext, environment);</span><br><span class="line">   <span class="comment">// 将&#x27;defaultProperties&#x27; property source移到最后</span></span><br><span class="line">   DefaultPropertiesPropertySource.moveToEnd(environment);</span><br><span class="line">   Assert.state(!environment.containsProperty(<span class="string">&quot;spring.main.environment-prefix&quot;</span>),</span><br><span class="line">         <span class="string">&quot;Environment prefix cannot be set via properties.&quot;</span>);</span><br><span class="line">  	<span class="comment">// 将 environment 绑定到 &#123;@link SpringApplication&#125;</span></span><br><span class="line">   bindToSpringApplication(environment);</span><br><span class="line">  	<span class="comment">// 环境转换成StandardEnvironment</span></span><br><span class="line">   <span class="keyword">if</span> (!<span class="keyword">this</span>.isCustomEnvironment) &#123;</span><br><span class="line">      EnvironmentConverter environmentConverter = <span class="keyword">new</span> EnvironmentConverter(getClassLoader());</span><br><span class="line">      environment = environmentConverter.convertEnvironmentIfNecessary(environment, deduceEnvironmentClass());</span><br><span class="line">   &#125;</span><br><span class="line">   ConfigurationPropertySources.attach(environment);</span><br><span class="line">  <span class="comment">// 返回环境配置对象ConfigurableEnvironment</span></span><br><span class="line">   <span class="keyword">return</span> environment;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span class="title">getOrCreateEnvironment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">this</span>.environment != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.environment;</span><br><span class="line">   &#125;</span><br><span class="line">   ConfigurableEnvironment environment = <span class="keyword">this</span>.applicationContextFactory.createEnvironment(<span class="keyword">this</span>.webApplicationType);</span><br><span class="line">   <span class="keyword">if</span> (environment == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.applicationContextFactory != ApplicationContextFactory.DEFAULT) &#123;</span><br><span class="line">      environment = ApplicationContextFactory.DEFAULT.createEnvironment(<span class="keyword">this</span>.webApplicationType);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> (environment != <span class="keyword">null</span>) ? environment : <span class="keyword">new</span> ApplicationEnvironment();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过<code>prepareEnvironment()</code>方法进行环境的准备（包括配置<code>property</code>和对应的<code>profile</code>信息，将其放入<code>environment</code>变量），然后返回可配置环境<code>environment</code></li>
</ol>
<p>继续查看<code>run()</code>方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  Banner printedBanner = printBanner(environment);</span><br><span class="line">  context = createApplicationContext();</span><br><span class="line">  context.setApplicationStartup(<span class="keyword">this</span>.applicationStartup);</span><br><span class="line">  prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">  refreshContext(context);</span><br><span class="line">  afterRefresh(context, applicationArguments);</span><br><span class="line">  Duration timeTakenToStartup = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">    <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup);</span><br><span class="line">  &#125;</span><br><span class="line">  listeners.started(context, timeTakenToStartup);</span><br><span class="line">  callRunners(context, applicationArguments);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>调用<code>printBanner()</code>方法打印 <quote>banner</quote>信息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Banner <span class="title">printBanner</span><span class="params">(ConfigurableEnvironment environment)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.bannerMode == Mode.OFF) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ResourceLoader resourceLoader = <span class="keyword">this</span>.resourceLoader != <span class="keyword">null</span> ? <span class="keyword">this</span>.resourceLoader : <span class="keyword">new</span> DefaultResourceLoader((ClassLoader)<span class="keyword">null</span>);</span><br><span class="line">    SpringApplicationBannerPrinter bannerPrinter = <span class="keyword">new</span> SpringApplicationBannerPrinter((ResourceLoader)resourceLoader, <span class="keyword">this</span>.banner);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.bannerMode == Mode.LOG ? bannerPrinter.print(environment, <span class="keyword">this</span>.mainApplicationClass, logger) : bannerPrinter.print(environment, <span class="keyword">this</span>.mainApplicationClass, System.out);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> ConfigurableApplicationContext <span class="title">createApplicationContext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>.applicationContextFactory.create(<span class="keyword">this</span>.webApplicationType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/springboot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/springbootbanner.png"></p>
<p>我们可以通过在类路径下添加<code>banner.txt</code>文件自定义<quote>banner</quote>打印信息或将<code>spring.banner.location</code>属性设置为此类文件的位置来更改启动时打印的横幅。如果文件的编码不是 UTF-8，您可以设置<code>spring.banner.charset</code>。</p>
<p>自定义<code>banner</code>示例：</p>
<p><code>banner.txt</code></p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/springboot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/bannertxt.png"></p>
<p>打印效果:</p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/springboot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/bannereffect.png"></p>
<p>继续查看<code>run()</code>方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="comment">// 创建应用程序上下文对象</span></span><br><span class="line">  context = createApplicationContext();</span><br><span class="line">  <span class="comment">// 设置下上下文对象的应用程序启动器</span></span><br><span class="line">  context.setApplicationStartup(<span class="keyword">this</span>.applicationStartup);</span><br><span class="line">  <span class="comment">// 准备上下文，配置容器的基本信息</span></span><br><span class="line">  prepareContext(bootstrapContext, context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">  refreshContext(context);</span><br><span class="line">  afterRefresh(context, applicationArguments);</span><br><span class="line">  Duration timeTakenToStartup = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">    <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup);</span><br><span class="line">  &#125;</span><br><span class="line">  listeners.started(context, timeTakenToStartup);</span><br><span class="line">  callRunners(context, applicationArguments);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">prepareContext</span><span class="params">(DefaultBootstrapContext bootstrapContext, ConfigurableApplicationContext context, ConfigurableEnvironment environment, SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 设置容器的环境变量</span></span><br><span class="line">  context.setEnvironment(environment);</span><br><span class="line">  <span class="comment">// 设置容器的ResourceLoader、ClassLoader、ConversionService</span></span><br><span class="line">  <span class="keyword">this</span>.postProcessApplicationContext(context);</span><br><span class="line">  <span class="comment">// 获取所有初始化器调用initialize()初始化</span></span><br><span class="line">  <span class="keyword">this</span>.applyInitializers(context);</span><br><span class="line">  <span class="comment">// 触发所有 SpringApplicationRunListener监听器的contextPrepared事件方法</span></span><br><span class="line">  listeners.contextPrepared(context);</span><br><span class="line">  bootstrapContext.close(context);</span><br><span class="line">  <span class="comment">// 打印启动日志和启动应用的Profile</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">    <span class="keyword">this</span>.logStartupInfo(context.getParent() == <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">this</span>.logStartupProfileInfo(context);</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">// Add boot specific singleton beans 添加启动特定的单例bean</span></span><br><span class="line">  ConfigurableListableBeanFactory beanFactory = context.getBeanFactory();</span><br><span class="line">  <span class="comment">// 向beanFactory注册单例bean：命令行参数bean</span></span><br><span class="line">  beanFactory.registerSingleton(<span class="string">&quot;springApplicationArguments&quot;</span>, applicationArguments);</span><br><span class="line">  <span class="keyword">if</span> (printedBanner != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="comment">// 向beanFactory注册单例bean：banner bean</span></span><br><span class="line">    beanFactory.registerSingleton(<span class="string">&quot;springBootBanner&quot;</span>, printedBanner);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> AbstractAutowireCapableBeanFactory) &#123;</span><br><span class="line">    ((AbstractAutowireCapableBeanFactory)beanFactory).setAllowCircularReferences(<span class="keyword">this</span>.allowCircularReferences);</span><br><span class="line">    <span class="keyword">if</span> (beanFactory <span class="keyword">instanceof</span> DefaultListableBeanFactory) &#123;</span><br><span class="line">      ((DefaultListableBeanFactory)beanFactory).setAllowBeanDefinitionOverriding(<span class="keyword">this</span>.allowBeanDefinitionOverriding);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.lazyInitialization) &#123;</span><br><span class="line">    context.addBeanFactoryPostProcessor(<span class="keyword">new</span> LazyInitializationBeanFactoryPostProcessor());</span><br><span class="line">  &#125;</span><br><span class="line">  context.addBeanFactoryPostProcessor(<span class="keyword">new</span> PropertySourceOrderingBeanFactoryPostProcessor(context));</span><br><span class="line">  <span class="comment">// Load the sources，加载所有的资源</span></span><br><span class="line">  Set&lt;Object&gt; sources = <span class="keyword">this</span>.getAllSources();</span><br><span class="line">  <span class="comment">// 断言资源必须非空</span></span><br><span class="line">  Assert.notEmpty(sources, <span class="string">&quot;Sources must not be empty&quot;</span>);</span><br><span class="line">  <span class="comment">// 将bean加载到应用上下文中</span></span><br><span class="line">  <span class="keyword">this</span>.load(context, sources.toArray(<span class="keyword">new</span> Object[<span class="number">0</span>]));</span><br><span class="line">  <span class="comment">// 触发所有SpringApplicationRunListener监听器contextLoaded方法</span></span><br><span class="line">  listeners.contextLoaded(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>继续回到<code>run()</code>方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  refreshContext(context);</span><br><span class="line">  afterRefresh(context, applicationArguments);</span><br><span class="line">  Duration timeTakenToStartup = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">    <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup);</span><br><span class="line">  &#125;</span><br><span class="line">  listeners.started(context, timeTakenToStartup);</span><br><span class="line">  callRunners(context, applicationArguments);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>refreshContext</code></p>
<p>配置完容器基本信息后，刷新容器上下文<code>refreshContext</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">refreshContext</span><span class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.registerShutdownHook) &#123;</span><br><span class="line">    shutdownHook.registerApplicationContext(context);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.refresh(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.refresh();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException var3) &#123;</span><br><span class="line">        WebServer webServer = <span class="keyword">this</span>.webServer;</span><br><span class="line">        <span class="keyword">if</span> (webServer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            webServer.stop();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> var3;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">        </span><br><span class="line">  <span class="keyword">synchronized</span>(<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">    StartupStep contextRefresh = <span class="keyword">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.refresh&quot;</span>);</span><br><span class="line">    <span class="comment">// 上下文准备刷新</span></span><br><span class="line">    <span class="keyword">this</span>.prepareRefresh();</span><br><span class="line">    <span class="comment">// 刷新bean工厂，并返回bean工厂</span></span><br><span class="line">    ConfigurableListableBeanFactory beanFactory = <span class="keyword">this</span>.obtainFreshBeanFactory();</span><br><span class="line">    <span class="comment">// 准备bean工厂，以便进行上下文的使用</span></span><br><span class="line">    <span class="keyword">this</span>.prepareBeanFactory(beanFactory);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 允许在上下文子类中对 bean 工厂进行后置处理</span></span><br><span class="line">      <span class="keyword">this</span>.postProcessBeanFactory(beanFactory);</span><br><span class="line">      StartupStep beanPostProcess = <span class="keyword">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.beans.post-process&quot;</span>); </span><br><span class="line">      <span class="comment">// 在bean创建之前调用BeanFactoryPostProcessors后置处理方法</span></span><br><span class="line">      <span class="keyword">this</span>.invokeBeanFactoryPostProcessors(beanFactory); </span><br><span class="line">      <span class="comment">// 注册BeanPostProcessor</span></span><br><span class="line">      <span class="keyword">this</span>.registerBeanPostProcessors(beanFactory);</span><br><span class="line">      beanPostProcess.end();   </span><br><span class="line">      <span class="comment">// 注册DelegatingMessageSource</span></span><br><span class="line">      <span class="keyword">this</span>.initMessageSource();</span><br><span class="line">      <span class="comment">// 注册一个applicationEventMulticaster的广播器</span></span><br><span class="line">      <span class="keyword">this</span>.initApplicationEventMulticaster(); </span><br><span class="line">      <span class="comment">// 在特定上下文子类中初始化其他特殊 bean</span></span><br><span class="line">      <span class="keyword">this</span>.onRefresh();</span><br><span class="line">      <span class="comment">// 注册监听器Listeners</span></span><br><span class="line">      <span class="keyword">this</span>.registerListeners(); </span><br><span class="line">      <span class="comment">// 实例化所有剩余的（非懒加载）单例。</span></span><br><span class="line">      <span class="keyword">this</span>.finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">      <span class="comment">// 发布对应事件</span></span><br><span class="line">      <span class="keyword">this</span>.finishRefresh();  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (BeansException var10) &#123;      </span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isWarnEnabled()) &#123;</span><br><span class="line">        <span class="keyword">this</span>.logger.warn(<span class="string">&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot;</span> + var10);         </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.destroyBeans();</span><br><span class="line">      <span class="keyword">this</span>.cancelRefresh(var10);</span><br><span class="line">      <span class="keyword">throw</span> var10;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.resetCommonCaches();        </span><br><span class="line">      contextRefresh.end();       </span><br><span class="line">    &#125;     </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>刷新容器上下文<code>refreshContext</code>方法之后看到<code>afterRefresh</code>是一个空方法，主要用于开发者拓展使用。</p>
<p><code>run()</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  ......</span><br><span class="line">  refreshContext(context);</span><br><span class="line">  afterRefresh(context, applicationArguments);</span><br><span class="line">  Duration timeTakenToStartup = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) &#123;</span><br><span class="line">    <span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass).logStarted(getApplicationLog(), timeTakenToStartup);</span><br><span class="line">  &#125;</span><br><span class="line">  listeners.started(context, timeTakenToStartup);</span><br><span class="line">  callRunners(context, applicationArguments);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>容器配置都完成之后，这时监听应用上下文启动完成所有的运行监听器调用 <code>started()</code> 方法，发布监听应用的启动事件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">started</span><span class="params">(ConfigurableApplicationContext context, Duration timeTaken)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.doWithListeners(<span class="string">&quot;spring.boot.application.started&quot;</span>, (listener) -&gt; &#123;</span><br><span class="line">    listener.started(context, timeTaken);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>后续继续执行<code>callRunners</code>方法遍历所有<code>runner</code>，调用<code>run</code>方法。</p>
<p>上述都完成之后到了最后一步，执行<code>listener.running</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  Duration timeTakenToReady = Duration.ofNanos(System.nanoTime() - startTime);</span><br><span class="line">  <span class="comment">// 所有的运行监听器调用running()方法,监听应用上下文</span></span><br><span class="line">  listeners.ready(context, timeTakenToReady);</span><br><span class="line">  <span class="keyword">return</span> context;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Throwable var11) &#123;</span><br><span class="line">  <span class="keyword">this</span>.handleRunFailure(context, var11, (SpringApplicationRunListeners)<span class="keyword">null</span>);</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(var11);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行所有运行监听器，该方法执行以后<code>SpringApplication.run()</code>也就算执行完成了，那么<code>SpringBoot</code>的<code>ApplicationContext</code>也就启动完成了。</p>
<p>流程图：</p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/springboot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/springbootrun.svg"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/06/SpringBoot-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/06/SpringBoot-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/" class="post-title-link" itemprop="url">SpringBoot-自动装配</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-06 17:35:52" itemprop="dateCreated datePublished" datetime="2023-09-06T17:35:52+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-07 19:22:09" itemprop="dateModified" datetime="2023-09-07T19:22:09+08:00">2023-09-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <div class="note no-icon default"><p>早期的Spring项目需要添加需要配置繁琐的xml,比如MVC、事务、数据库连接等繁琐的配置。Spring Boot的出现就无需这些繁琐的配置，因为Spring Boot基于<strong>约定大于配置</strong>的理念，在项目启动时候，将约定的配置类自动配置到IOC容器里。这些都因为Spring Boot有自动配置的特性。</p>
</div>

<h1 id="main方法"><a href="#main方法" class="headerlink" title="main方法"></a>main方法</h1><p><code>Spring Boot</code>都需要创建一个<code>main</code>启动类，而启动类都含有<code>@SpringBootApplication</code>注解，使用<code>Spring Boot</code>零配置就可以运行起来，这就是 <code>Spring Boot</code> 自动装配的能力了。</p>
<p>看看<code>Spring Boot</code>入口——<code>main</code>方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="核心注解"><a href="#核心注解" class="headerlink" title="核心注解"></a>核心注解</h1><h2 id="SpringBootApplication-注解"><a href="#SpringBootApplication-注解" class="headerlink" title="@SpringBootApplication 注解"></a>@SpringBootApplication 注解</h2><p><code>Spring Boot</code> 启动类上都有一个 <code>@SpringBootApplication</code>注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;</span><br></pre></td></tr></table></figure>

<p>我们需要关注的有以下几个：</p>
<ul>
<li><code>@ComponentScan</code> 组件扫描指令</li>
<li><code>@SpringBootConfiguration</code></li>
<li><code>@EnableAutoConfiguration</code></li>
</ul>
<p>从源码声明可以看出，<code>@SpringBootApplication</code>相当于<code>@SpringBootConfiguration</code> + <code>@EnableAutoConfiguration</code> + <code>@ComponentScan</code>，因此我们直接拆开来分析。</p>
<h2 id="SpringBootConfiguration"><a href="#SpringBootConfiguration" class="headerlink" title="@SpringBootConfiguration"></a>@SpringBootConfiguration</h2><p><code>@SpringBootConfiguration</code>是继承自<code>Spring</code>的<code>@Configuration</code>注解，<code>@SpringBootConfiguration</code>作用相当于<code>@Configuration</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Indexed</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br><span class="line">    <span class="meta">@AliasFor(</span></span><br><span class="line"><span class="meta">        annotation = Configuration.class</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">proxyBeanMethods</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring 3.0中增加了<code>@Configuration</code>，<code>@Bean</code>。可基<quote>JavaConfig</quote>形式对<quote>Spring</quote>容器中的<code>bean</code>进行更直观的配置。<code>SpringBoot</code>推荐使用基于<code>JavaConfig</code>的配置形式。</p>
<p>基于<quote>xml</quote>配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans  http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">default-lazy-init</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;..myServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>基于<code>JavaConfig</code>配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyService <span class="title">mockService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyServiceImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结，<code>@Configuration</code>相当于一个<quote>spring</quote>的<code>xml</code>文件，配合<quote>@Bean</quote>注解，可以在里面配置需要<quote>Spring</quote>容器管理的<code>bean</code>。</p>
<hr>
<h2 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan"></a>@ComponentScan</h2><p>源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Repeatable(ComponentScans.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ComponentScan &#123;</span><br><span class="line">    <span class="meta">@AliasFor(&quot;basePackages&quot;)</span></span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">    String[] basePackages() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] basePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends BeanNameGenerator&gt; nameGenerator() <span class="keyword">default</span> BeanNameGenerator.class;</span><br><span class="line"></span><br><span class="line">    Class&lt;? extends ScopeMetadataResolver&gt; scopeResolver() <span class="keyword">default</span> AnnotationScopeMetadataResolver.class;</span><br><span class="line"></span><br><span class="line">    <span class="function">ScopedProxyMode <span class="title">scopedProxy</span><span class="params">()</span> <span class="keyword">default</span> ScopedProxyMode.DEFAULT</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">resourcePattern</span><span class="params">()</span> <span class="keyword">default</span> &quot;**/ *.class&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">useDefaultFilters</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line"></span><br><span class="line">    Filter[] includeFilters() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    Filter[] excludeFilters() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">lazyInit</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@Target(&#123;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@interface</span> Filter &#123;</span><br><span class="line">        <span class="function">FilterType <span class="title">type</span><span class="params">()</span> <span class="keyword">default</span> FilterType.ANNOTATION</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@AliasFor(&quot;classes&quot;)</span></span><br><span class="line">        Class&lt;?&gt;[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">        Class&lt;?&gt;[] classes() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        String[] pattern() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相关属性解释:</p>
<ul>
<li><code>basePackages</code>与<code>value</code>: 指定扫描的包或包数组</li>
<li><code>basePackageClasses</code>: 指定具体的要扫描的类</li>
<li><code>nameGenerator</code>: 对应的bean名称的生成器 默认的是<code>BeanNameGenerator</code></li>
<li><code>useDefaultFilters</code>: 是否对带有<code>@Component</code> <code>@Repository</code> <code>@Service</code> <code>@Controller</code>注解的类开启检测，默认是开启的</li>
<li><code>includeFilters</code>: 通过<code>includeFilters</code>加入扫描路径下没有以上注解的类加入spring容器</li>
<li><code>excludeFilters</code>: 通过<code>excludeFilters</code>过滤出不用加入spring容器的类</li>
<li><code>lazyInit</code>: 扫描到的类是都开启懒加载 ，默认是不开启的</li>
</ul>
<p><code>@ComponentScan</code>通常与<code>@Configuration</code>一起配合使用，用来告诉Spring需要扫描哪些包或类。如果不设值的话默认扫描<code>@ComponentScan</code>注解所在类所在的包及其所有子包，所以对于一个Spring Boot项目，一般会把入口类放在顶层目录中，这样就能够保证源码目录下的所有类都能够被扫描到。</p>
<hr>
<h2 id="EnableAutoConfiguration"><a href="#EnableAutoConfiguration" class="headerlink" title="@EnableAutoConfiguration"></a>@EnableAutoConfiguration</h2><p><code>@EnableAutoConfiguration</code>是<quote>SpringBoot</quote>自动配置的核心注解</p>
<p>源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    String ENABLED_OVERRIDE_PROPERTY = <span class="string">&quot;spring.boot.enableautoconfiguration&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中<code>@Import(&#123;AutoConfigurationImportSelector.class&#125;)</code> 就是自动配置的核心入口。</p>
<p><code>@Import(&#123;AutoConfigurationImportSelector.class&#125;)</code>可以自定义导入规则，主要就是<code>AutoConfigurationImportSelector</code>类的<code>selectImports</code>方法来选择需要自动配置的类进行配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.isEnabled(annotationMetadata)) &#123;</span><br><span class="line">      <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      AutoConfigurationEntry autoConfigurationEntry = <span class="keyword">this</span>.getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">      <span class="keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>selectImports</code>方法中主要是<code>getAutoConfigurationEntry</code>这个方法，而<code>getAutoConfigurationEntry</code>方法中最主要是<code>getCandidateConfigurations</code>这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; configurations = <span class="keyword">new</span> ArrayList(SpringFactoriesLoader.loadFactoryNames(<span class="keyword">this</span>.getSpringFactoriesLoaderFactoryClass(),       <span class="keyword">this</span>.getBeanClassLoader()));</span><br><span class="line">    ImportCandidates.load(AutoConfiguration.class,  <span class="keyword">this</span>.getBeanClassLoader()).forEach(configurations::add);</span><br><span class="line">    Assert.notEmpty(configurations, <span class="string">&quot;No auto configuration classes found in META-INF/spring.factories nor in META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports. If you are using a custom packaging, make sure that file is correct.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryType, <span class="meta">@Nullable</span> ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">    ClassLoader classLoaderToUse = classLoader;</span><br><span class="line">    <span class="keyword">if</span> (classLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">    classLoaderToUse = SpringFactoriesLoader.class.getClassLoader();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String factoryTypeName = factoryType.getName();</span><br><span class="line">    <span class="keyword">return</span> (List)loadSpringFactories(classLoaderToUse).getOrDefault(factoryTypeName, Collections.emptyList());	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, List&lt;String&gt;&gt; loadSpringFactories(ClassLoader classLoader) &#123;</span><br><span class="line">        Map&lt;String, List&lt;String&gt;&gt; result = (Map)cache.get(classLoader);</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            Map&lt;String, List&lt;String&gt;&gt; result = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Enumeration&lt;URL&gt; urls = classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>);</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>SpringFactoriesLoader.loadFactoryNames()</code>方法主要作用是读取<code>spring-boot-autoconfigure.jar</code>包下的<code>META-INF/spring.factories</code>中配置可以进行自动配置的类，这些类都是以<code>JavaConfig</code>形式进行导入的，在满足了<code>@Conditional</code>中定义的加载条件后，Spring会将这些类加载到<code>IOC</code>容器中。</p>
<p><code>spring.factories</code>内容如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># Initializers</span><br><span class="line">org.springframework.context.ApplicationContextInitializer&#x3D;\</span><br><span class="line">org.springframework.boot.autoconfigure.SharedMetadataReaderFactoryContextInitializer,\</span><br><span class="line">org.springframework.boot.autoconfigure.logging.ConditionEvaluationReportLoggingListener</span><br><span class="line"></span><br><span class="line"># Application Listeners</span><br><span class="line">org.springframework.context.ApplicationListener&#x3D;\</span><br><span class="line">org.springframework.boot.autoconfigure.BackgroundPreinitializer</span><br><span class="line"></span><br><span class="line"># Auto Configuration Import Listeners</span><br><span class="line">org.springframework.boot.autoconfigure.AutoConfigurationImportListener&#x3D;\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.ConditionEvaluationReportAutoConfigurationImportListener</span><br><span class="line"></span><br><span class="line"># Auto Configuration Import Filters</span><br><span class="line">org.springframework.boot.autoconfigure.AutoConfigurationImportFilter&#x3D;\</span><br><span class="line">org.springframework.boot.autoconfigure.condition.OnClassCondition</span><br><span class="line"></span><br><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\</span><br><span class="line"></span><br><span class="line">.... 省略了很多</span><br></pre></td></tr></table></figure>

<p><code>Spring.factories</code>定义了哪些类可以被自动配置，每个配置类定了在什么条件下可以被自动配置，并将这些类实例化被Spring容器管理。</p>
<p>这里以<code>AopAutoConfiguration</code>为例子，当类路径下存在<code>EnableAspectJAutoProxy.class</code>，<code>Aspect.class</code>，<code>Advice.class</code>等类时才会注入<code>AopAutoConfiguration</code>，并且默认是创建<code>CglibAutoProxyConfiguration</code>配置。</p>
<p>总的来说：</p>
<p>从上面查看的源码，可以知道<code>Spring Boot</code>自动配置主要是<code>@EnableAutoConfiguration</code>实现的，<code>@EnableAutoConfiguration</code>注解导入<code>AutoConfigurationImportSelector</code>类,通过<code>selectImports</code>方法调用<code>SpringFactoriesLoader.loadFactoryNames()</code>扫描所有含有<code>META-INF/spring.factories</code>文件的<code>jar</code>包，将所有<code>jar</code>包里面的<code>spring.factories</code>文件中<code>@EnableAutoConfiguration</code>对应的类注入到<code>IOC</code>容器中。</p>
<p><code>Spring Boot</code>基于<strong>约定大于配置</strong>的理念，配置如果没有额外的配置的话，就给按照默认的配置使用约定的默认值，按照约定配置到<code>IOC</code>容器中，无需开发人员手动添加配置，加快开发效率。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/05/Maven-%E6%9E%84%E5%BB%BA%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/05/Maven-%E6%9E%84%E5%BB%BA%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" class="post-title-link" itemprop="url">Maven 构建生命周期</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-05 19:34:57" itemprop="dateCreated datePublished" datetime="2023-09-05T19:34:57+08:00">2023-09-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 09:16:02" itemprop="dateModified" datetime="2023-09-06T09:16:02+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><p>Maven 基于构建生命周期的中心概念。 这意味着构建和分发特定项的过程是明确定义的。</p>
<p>对于构建项目的人来说，这意味着只需要学习一小部分命令即可构建任何 Maven 项目，POM 将确保他们获得所需的结果。</p>
<p>共有三个内置构建生命周期：<code>default</code>, <code>clean</code> and  <code>site</code>。 <code>default</code>生命周期处理项目部署，<code>clean</code>生命周期处理项目清理，而 <code>site</code>生命周期处理项目网站的创建。</p>
<h1 id="构建生命周期由多个阶段组成"><a href="#构建生命周期由多个阶段组成" class="headerlink" title="构建生命周期由多个阶段组成"></a>构建生命周期由多个阶段组成</h1><p>每个构建生命周期都由不同的构建阶段列表定义，其中一个构建阶段代表生命周期中的一个阶段。</p>
<p>例如，默认生命周期包括以下阶段（有关生命周期阶段的完整列表，请参阅生命周期参考）：</p>
<ul>
<li><code>validate</code>- 验证项目是否正确并且所有必要的信息均可用</li>
<li><code>compile</code>- 编译项目的源代码，编译后的类被放置在 中<code>$&#123;basedir&#125;/target/classes</code></li>
<li><code>test</code>- 使用合适的单元测试框架测试编译后的源代码。这些测试不应要求打包或部署代码</li>
<li><code>package</code>- 将编译后的代码打包为可发布的格式，如 JAR</li>
<li><code>verify</code>- 对集成测试的结果进行检查，确保符合质量标准</li>
<li><code>install</code>- 将软件包（例如JAR包）安装到本地存储库（本地Repository）中，作为本地其他项目的依赖项使用</li>
<li><code>deploy</code>- 将最终包复制到远程存储库以与其他开发人员和项目共享</li>
</ul>
<p>这些生命周期阶段<strong>按顺序执行</strong>以完成默认生命周期。 考虑到上面的生命周期阶段，这意味着当使用默认生命周期时，Maven 将首先验证项目，然后尝试编译源代码，针对测试运行这些源代码，打包二进制文件（例如 jar），针对该项目运行集成测试 包，验证集成测试，将验证的包安装到本地存储库，然后将安装的包部署到远程存储库。</p>
<hr>
<h1 id="命令行调用"><a href="#命令行调用" class="headerlink" title="命令行调用"></a>命令行调用</h1><p>您应该选择与您的结果相匹配的阶段。 如果你想要你的<code>jar</code>，运行<code>package</code>。如果您想运行单元测试，请运行<code>test</code>。</p>
<p>如果您不确定自己想要什么，首选调用的阶段是:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn verify</span><br></pre></td></tr></table></figure>

<p>在执行<code>verify</code>之前，该命令会依次执行每个默认生命周期阶段（<code>validate</code>, <code>compile</code>, <code>package</code>等）。在大多数情况下，效果与打包相同。不过，如果有集成测试，这些测试也会被执行。在验证阶段，还可以进行一些额外的检查，例如，如果代码是按照预定义的检查样式规则编写的。</p>
<p>在构建环境中，使用下面的调用即可将工程干净利落地构建并部署到共享存储库中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean deploy</span><br></pre></td></tr></table></figure>

<p>同一命令可用于多模块场景（即具有一个或多个子项目的项目）。 Maven遍历每个子项目并执行<code>clean</code>，然后执行<code>deploy</code>（包括之前的所有构建阶段步骤）。</p>
<h1 id="构建阶段由插件目标组成"><a href="#构建阶段由插件目标组成" class="headerlink" title="构建阶段由插件目标组成"></a>构建阶段由插件目标组成</h1><p>不过，尽管构建阶段负责构建生命周期中的特定步骤，但其履行职责的方式可能会有所不同。这可以通过声明与这些构建阶段绑定的插件目标来实现。</p>
<p>一个插件目标代表一个特定的任务（比构建阶段更细），有助于项目的构建和管理。它可以与零个或多个构建阶段绑定。未与任何构建阶段绑定的目标可通过直接调用在构建生命周期之外执行。执行顺序取决于目标和构建阶段的调用顺序。</p>
<p>例如，考虑下面的命令。<code>clean</code>和<code>package</code>是构建阶段，而<code>dependency:copy-dependencies</code>是（插件的）目标。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean dependency:copy-dependencies package</span><br></pre></td></tr></table></figure>

<p>如果要执行此操作，则将首先执行<code>clean</code>阶段（这意味着它将运行<code>clean</code>生命周期的所有前置阶段，加上<code>clean</code>阶段本身），然后是<code>dependency:copy-dependencies</code>目标，最后执行<code>package</code>阶段（以及<code>package</code>默认生命周期的所有先前构建阶段）。</p>
<p>此外，如果一个目标与一个或多个构建阶段绑定，那么该目标将在所有这些阶段中被调用。</p>
<h1 id="设置项目以使用构建生命周期"><a href="#设置项目以使用构建生命周期" class="headerlink" title="设置项目以使用构建生命周期"></a>设置项目以使用构建生命周期</h1><p>构建生命周期简单易用，但在为项目构建 Maven 构建时，如何为每个构建阶段分配任务？</p>
<h2 id="Packaging-打包"><a href="#Packaging-打包" class="headerlink" title="Packaging-打包"></a>Packaging-打包</h2><p>第一种，也是最常见的一种方法，是通过POM 元素<code>&lt;packaging></code>为项目设置打包。一些有效的<code>&lt;packaging></code>值包括 <code>jar</code>、<code>war</code>、<code>ear</code>和<code>pom</code>。如果没有指定包装值，则默认为<code>jar</code>。</p>
<p>每个<code>packaging</code>都包含一个目标列表，用于绑定到特定阶段。例如，<code>jar</code> <code>packaging</code>将把以下目标绑定到默认生命周期的构建阶段。</p>
<table>
<thead>
<tr>
<th>阶段</th>
<th>jar  packagin的插件目标</th>
</tr>
</thead>
<tbody><tr>
<td><code>process-resources</code></td>
<td><code>resources:resources</code></td>
</tr>
<tr>
<td><code>compile</code></td>
<td><code>compiler:compile</code></td>
</tr>
<tr>
<td><code>process-test-resources</code></td>
<td><code>resources:testResources</code></td>
</tr>
<tr>
<td><code>test-compile</code></td>
<td><code>compiler:testCompile</code></td>
</tr>
<tr>
<td><code>test</code></td>
<td><code>surefire:test</code></td>
</tr>
<tr>
<td><code>package</code></td>
<td><code>jar:jar</code></td>
</tr>
<tr>
<td><code>install</code></td>
<td><code>install:install</code></td>
</tr>
<tr>
<td><code>deploy</code></td>
<td><code>deploy:deploy</code></td>
</tr>
</tbody></table>
<p>这几乎是一套标准的绑定。</p>
<h2 id="Plugins-插件"><a href="#Plugins-插件" class="headerlink" title="Plugins-插件"></a>Plugins-插件</h2><p>将目标添加到生命周期阶段的第二种方法是在项目中配置插件。插件是为 Maven 提供目标的工程。此外，一个插件可能有一个或多个目标，其中每个目标代表该插件的一种能力。例如，编译器插件有两个目标：<code>compile</code>和<code>testCompile</code>。前者编译你的主代码的源代码，而后者编译你的测试代码的源代码。</p>
<p>在后面的章节中您将看到，插件可以包含指示将目标绑定到哪个生命周期阶段的信息。请注意，仅添加插件本身的信息是不够的，还必须指定要在构建过程中运行的目标。</p>
<p>配置的目标将添加到已绑定到所选包的生命周期的目标中。 如果多个目标绑定到特定阶段，则使用的顺序是首先执行打包中的目标，然后执行 POM 中配置的目标。 请注意，您可以使用<code>&lt;executions></code>元素来更好地控制特定目标的顺序。</p>
<p>为阶段添加目标的第二种方法是在项目中配置插件。插件是向 Maven 提供目标的工件。此外，一个插件可能有一个或多个目标，其中每个目标代表该插件的一种能力。例如，编译器插件有两个目标：<code>compile</code>和<code>testCompile</code>。前者编译主代码的源代码，后者编译测试代码的源代码。</p>
<p>在后面的章节中您将看到，插件可以包含指示将目标绑定到哪个生命周期阶段的信息。请注意，仅添加插件本身的信息是不够的，还必须指定要在构建过程中运行的目标。</p>
<p>配置的目标将添加到已绑定到所选包装生命周期的目标中。如果一个特定阶段绑定了多个目标，则使用的顺序是先执行包装中的目标，然后再执行 POM 中配置的目标。请注意，您可以使用<code>&lt;executions></code>元素对特定目标的顺序进行更多控制。</p>
<p>例如，<code>Modello</code>插件默认将其目标<code>modello:java</code>绑定到<code>generate-sources</code>阶段（注：<code>modello:java</code>目标生成 Java 源代码）。因此，要使用 Modello 插件并让它从模型生成源代码并将其纳入构建，您需要在<code>&lt;build></code>的<code>&lt;plugins></code>部分的 POM 中添加以下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.modello<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>modello-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">models</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">model</span>&gt;</span>src/main/mdo/maven.mdo<span class="tag">&lt;/<span class="name">model</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">models</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">goal</span>&gt;</span>java<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>您可能想知道为什么<code>&lt;executions></code>元素在那里。 这样您就可以根据需要使用不同的配置多次运行相同的目标。还可以根据一个给定 ID单独的执行，以便在继承或应用配置文件期间，您可以控制是否合并目标配置或将其转变为附加执行。</p>
<p>当多个执行与特定阶段相匹配时，它们将按照 POM 中指定的顺序执行，先执行继承的执行。</p>
<p>现在，就<code>modello:java</code>而言，只有在生成源代码阶段才有意义。但有些目标可以在多个阶段中使用，因此可能没有合理的默认值。对于这些目标，你可以自己指定阶段。例如，假设有一个目标<code>display:time</code>，它能在命令行中回声显示当前时间，你希望它在<code>process-test-resources</code>阶段运行，以显示测试何时开始。可以这样配置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mycompany.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>display-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">phase</span>&gt;</span>process-test-resources<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">goal</span>&gt;</span>time<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/25/Maven-POM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/25/Maven-POM/" class="post-title-link" itemprop="url">Maven POM</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-25 15:17:22" itemprop="dateCreated datePublished" datetime="2023-08-25T15:17:22+08:00">2023-08-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-07 11:29:50" itemprop="dateModified" datetime="2023-09-07T11:29:50+08:00">2023-09-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JavaWeb/" itemprop="url" rel="index"><span itemprop="name">JavaWeb</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="What-is-the-POM"><a href="#What-is-the-POM" class="headerlink" title="What is the POM?"></a>What is the POM?</h1><p>POM 代表“项目对象模型”，即”Project Object Model”。它是 Maven 项目的 XML 表示形式，保存在名为<code>pom.xml</code>的文件中。当 Maven 人员在场时，谈论项目是在哲学意义上谈论项目，而不仅仅是包含代码的文件集合。一个项目包含配置文件、相关开发人员及其角色、缺陷、跟踪系统、组织和许可证、项目所在的 URL、项目的依赖关系，以及赋予代码生命的所有其他小部件。它是与项目有关的所有事项的一站式商店。事实上，在 Maven 的世界里，一个项目根本不需要包含任何代码，只需要一个<code>pom.xml</code>。</p>
<h1 id="Quick-Overview"><a href="#Quick-Overview" class="headerlink" title="Quick Overview"></a>Quick Overview</h1><p>这是 <code>POM</code> 的项目元素下的直接元素列表。请注意，<code>modelVersion</code>的版本是<code>4.0.0</code>，这是目前唯一支持的 <code>POM</code> 版本，而且始终是必需的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- The Basics --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>...<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>...<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>...<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>...<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">parent</span>&gt;</span>...<span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">modules</span>&gt;</span>...<span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">properties</span>&gt;</span>...<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- Build Settings --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span>...<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">reporting</span>&gt;</span>...<span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- More Project Information --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">name</span>&gt;</span>...<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">description</span>&gt;</span>...<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">url</span>&gt;</span>...<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">inceptionYear</span>&gt;</span>...<span class="tag">&lt;/<span class="name">inceptionYear</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">licenses</span>&gt;</span>...<span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">organization</span>&gt;</span>...<span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">developers</span>&gt;</span>...<span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">contributors</span>&gt;</span>...<span class="tag">&lt;/<span class="name">contributors</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">&lt;!-- Environment Settings --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">issueManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">issueManagement</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">ciManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">ciManagement</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">mailingLists</span>&gt;</span>...<span class="tag">&lt;/<span class="name">mailingLists</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">scm</span>&gt;</span>...<span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">prerequisites</span>&gt;</span>...<span class="tag">&lt;/<span class="name">prerequisites</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>...<span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span>...<span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">profiles</span>&gt;</span>...<span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="POM文件基础信息"><a href="#POM文件基础信息" class="headerlink" title="POM文件基础信息"></a>POM文件基础信息</h1><p>POM 包含项目的所有必要信息，以及构建过程中要使用的插件配置。它是 “who”, “what”,  “where”的声明式表现，而构建生命周期是 “when” and “how”。这并不是说 POM 不能影响应用生命周期的流程–它可以。例如，通过配置<code>maven-antrun-plugin</code>，就可以在 POM 中嵌入 Apache Ant 任务。然而，这最终只是一个声明。 build.xml 准确地告诉 Ant 在运行时要做什么（过程式），而 POM 则说明其配置（声明式）。如果某种外力导致生命周期跳过 Ant 插件的执行，也不会阻止已执行的插件发挥其魔力。这与 build.xml 文件不同，在 build.xml 文件中，任务几乎总是依赖于在它之前执行的行。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Maven-坐标"><a href="#Maven-坐标" class="headerlink" title="Maven 坐标"></a>Maven 坐标</h1><p>上面定义的 POM 是 Maven 允许的最低限度。<code>groupId:artifactId:version</code>都是必填字段（不过，如果 groupId 和 version 是继承自父版本，则无需明确定义，有关继承的内容稍后详述）。这三个字段的作用很像地址和时间戳。这标记了版本库中的一个特定位置，就像 Maven 项目的坐标系：</p>
<ul>
<li><strong>groupId</strong>：这通常在一个组织或项目中是唯一的。例如，所有核心 Maven 工程都（应该）使用的 <code>groupId</code> 是<code>org.apache.maven</code>。<code>groupId</code>不一定使用点符号，例如 junit 项目。请注意，点标记的 groupId 不必与项目包含的包结构相对应。 但是，这是一个值得遵循的好习惯。当存储在存储库中时，该组的行为与操作系统中的 Java 打包结构非常相似。 这些点被操作系统特定的目录分隔符（例如 Unix 中的“/”）替换，成为基础存储库的相对目录结构。 在给出的示例中，<code>org.codehaus.mojo</code>组位于目录<code>$M2_REPO/org/codehaus/mojo</code>中。</li>
<li><strong>artifactId</strong>：<code>artifactId</code> 通常是项目的名称。虽然 <code>groupId</code> 很重要，但小组内的人在讨论中很少会提到 groupId（他们通常都是同一个 ID，例如 MojoHaus 项目的 groupId：<code>org.codehaus.mojo</code>。它与 <code>groupId</code> 一起创建了一个key，该key将此项目与世界上其他所有项目区分开来（至少应该如此：）。<code>artifactId</code> 配合 <code>groupId</code> ， 完全定义了工程在版本库中的唯一地址。在上述项目中，<code>my-project</code>位于<code>$M2_REPO/org/codehaus/mojo/my-project</code>。</li>
<li><strong>version</strong>: groupId:artifactId 表示的是一个项目，但它们无法确定我们谈论的是该项目的哪个版本。我们想要 2018 年（4.12 版）的 junit:junit，还是 2007 年（3.8.2 版）的 junit:junit？简而言之：代码发生了变化，这些变化就应该进行版本化，而这个元素可以使这些版本保持一致。my-project 1.0 版本的文件存放在<code>$M2_REPO/org/codehaus/mojo/my-project/1.0</code>的目录结构中。</li>
</ul>
<h1 id="Packaging-打包"><a href="#Packaging-打包" class="headerlink" title="Packaging-打包"></a>Packaging-打包</h1><p>现在，我们有了<code>groupId:artifactId:version</code>的地址结构，还需要一个标准标签来提供真正完整的内容：那就是项目的包装。在我们的例子中，上面定义的<code>org.codehaus.mojo:my-project:1.0</code>的 POM 示例将打包为<code>jar</code>。我们可以通过声明不同的打包方式将其变为<code>war</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果没有声明<code>packaging</code>，Maven 默认的<code>packaging</code>为 jar。当前的核心打包方式有：<code>pom</code>、<code>jar</code>、<code>maven-plugin</code>、<code>ejb</code>、<code>war</code>、<code>ear</code>、<code>rar</code>。</p>
<h1 id="POM-Relationships"><a href="#POM-Relationships" class="headerlink" title="POM Relationships"></a>POM Relationships</h1><h2 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h2><p>POM 的基石是其依赖列表。大多数项目都需要依赖其他项目才能正确构建和运行。如果 Maven 为你所做的一切就是管理这个列表，那么你已经收获很多。Maven 下载并链接编译以及需要它们的其他目标的依赖项。作为额外的好处，Maven 引入了这些依赖项的依赖项（传递依赖项），让您的列表只关注项目所需的依赖项。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">type</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>groupId</strong>, <strong>artifactId</strong>, <strong>version</strong>:</p>
<p>您会经常看到这些元素。 这个三位一体用于及时计算特定项目的 Maven 坐标，将其划分为该项目的依赖项。 此计算的目的是选择与所有依赖项声明匹配的版本（由于传递依赖项，同一工程可能有多个依赖项声明）。</p>
</li>
<li><p><strong>type</strong>:</p>
<p>对应于所选的依赖关系类型。 默认为<code>jar</code>。虽然它通常表示依赖项文件名的扩展名，但情况并非总是如此：类型可以映射到不同的扩展名和分类器。<code>type</code>通常与所使用的<code>packaging</code>相对应，但也并非总是如此。</p>
</li>
<li><p><strong>scope</strong>:</p>
<p>该元素指的是当前任务（编译和运行时、测试等）的类路径，以及如何限制依赖关系的传递性。有五种作用域可供选择：</p>
<ul>
<li><code>compile</code>- 这是<code>scope</code>，在未指定任何作用域时使用。编译依赖项在所有类路径中都可用。 此外，这些依赖关系会传播到依赖项目。</li>
<li><code>provided</code>- 这与<code>compile</code>很相似，但表示您希望 JDK 或容器在运行时提供它。它只能在编译和测试的<code>classpath</code> 上使用，而且不具有传递性。</li>
<li><code>runtime</code>- 此作用域表示编译时不需要该依赖关系，但执行时需要。它在运行时和测试类路径中，但不在编译类路径中。</li>
<li><code>test</code>- 此范围表示应用程序的正常使用不需要依赖项，并且仅适用于测试编译和执行阶段。 它不具有传递性。</li>
<li><code>system</code>- 此范围与提供的<code>prvoide</code>类似，只是您必须显式提供包含它的 <code>JAR</code>。 该工件始终可用，无需在资源库中查找。</li>
</ul>
</li>
<li><p><strong>systemPath</strong>:</p>
<p>仅在<code>&lt;scope></code>范围为<code>system</code>时才使用。否则，如果设置了该元素，编译将失败。路径必须是绝对路径，因此建议使用属性指定特定机器的路径，如<code>$&#123;java.home&#125;/lib</code>。它会假定系统依赖作用域具有优先权，因此 Maven 不会检查项目的远程资源库，而是检查系统路径该文件是否存在。如果不存在，Maven 会导致构建失败，并建议您手动下载和安装。</p>
</li>
<li><p><strong>optional</strong>:</p>
<p>当项目本身是依赖项时，标记为<code>optional</code>。例如，假设项目<code>A</code>需要依赖项目<code>B</code>来编译一部分代码，而这部分代码在运行时可能用不到，那么我们的所有项目可能都不需要项目<code>B</code>。因此，如果项目<code>X</code>将项目<code>A</code>作为自己的依赖项，那么 Maven 就根本不需要安装项目<code>B</code>。如果<code>=></code>表示必须依赖，而<code>--></code>表示可选，那么在构建<code>A</code>时会出现<code>A=>B</code>的情况，而构建<code>X</code>时可能会出现<code>X=>A-->B</code>的情况。</p>
<p>简而言之，<code>optional</code>让其他项目知道，当您使用此项目时，不需要此依赖项即可正常工作。</p>
</li>
</ul>
<h2 id="依赖关系版本要求规范"><a href="#依赖关系版本要求规范" class="headerlink" title="依赖关系版本要求规范"></a>依赖关系版本要求规范</h2><p>依赖项的版本元素定义版本要求，用于计算依赖项版本。软性要求可以被依赖关系图中其他地方的同一工程的不同版本所替代。硬性要求规定了特定的一个或多个版本，并覆盖软性要求。如果没有任何依赖项版本可以满足该工程的所有硬要求，则构建会失败。</p>
<p>版本要求的语法如下：</p>
<ul>
<li><code>1.0</code>: 1.0 的软要求。 如果依赖关系树中较早没有出现其他版本，则使用 1.0。</li>
<li><code>[1.0]</code>：1.0 的硬性要求。 使用 1.0 并且仅使用 1.0。</li>
<li><code>(,1.0]</code>: 任何&lt;= 1.0 版本的硬性要求。</li>
<li><code>[1.2,1.3]</code>: 1.2 和 1.3（含）之间任何版本的硬性要求。</li>
<li><code>[1.0,2.0)</code>: 1.0&lt;= x&lt; 2.0；硬性要求在 1.0（含）和 2.0（不含）之间的任何版本。</li>
<li><code>[1.5,)</code>: 任何大于或等于 1.5 版本的硬性要求。</li>
<li><code>(,1.0],[1.2,)</code>: 小于或等于 1.0 或大于或等于 1.2 的任何版本的硬性要求，但不包括 1.1。多个要求之间用逗号分隔。</li>
<li><code>(,1.1),(1.1,)</code>: 除 1.1 之外的任何版本的硬性需求；例如，因为 1.1 存在关键漏洞。<br>Maven 挑选每个项目中满足该项目依赖项所有硬性要求的最高版本。如果没有任何版本满足所有硬性要求，则构建失败。</li>
</ul>
<h2 id="版本顺序规范"><a href="#版本顺序规范" class="headerlink" title="版本顺序规范"></a>版本顺序规范</h2><p>如果版本字符串在语法上是正确的语义版本控制 1.0.0 版本号，则在几乎所有情况下版本比较都遵循该规范中概述的优先规则。 这些版本是常见的字母数字 ASCII 字符串，例如 2.15.2-alpha。 更准确地说，如果要比较的两个版本号都与语义版本控制规范中的 BNF 语法中的“有效 semver”产生式相匹配，则情况成立。 Maven 不考虑该规范隐含的任何语义。</p>
<p>重要：这只适用于语义版本控制1.0.0。 Maven的版本顺序算法与语义版本控制2.0.0不兼容。 特别是，Maven不对加号进行特殊处理，也不考虑构建标识符。</p>
<p>当版本字符串不遵循语义版本控制时，需要一组更复杂的规则。 Maven 坐标被分割为点（“.”）、连字符（“-”）以及数字和字符之间的转换之间的标记。 分隔符被记录并将对顺序产生影响。 数字和字符之间的转换相当于连字符。 空标记将替换为“0”。 这给出了一系列版本号（数字标记）和带有“.”的版本限定符（非数字标记）。 或“-”前缀。</p>
<p>拆分和替换示例：</p>
<div class="note success"><p>1-1.foo-bar1baz-.1 -&gt;1-1.foo-bar-1-baz-0.1</p>
</div>

<p>然后，从版本末尾开始，修剪尾随的“null”值（0、“”、“final”、“ga”）。 从头到尾对每个剩余的连字符重复此过程。</p>
<p>修剪示例：</p>
<ul>
<li><code>1.0.0</code>-&gt;<code>1</code></li>
<li><code>1.g</code>-&gt;<code>1</code></li>
<li><code>1.fina</code>-&gt;<code>1</code></li>
<li><code>1.0</code>-&gt;<code>1</code></li>
<li><code>1.</code>-&gt;<code>1</code></li>
<li><code>1-</code>-&gt;<code>1</code></li>
<li><code>1.0.0-foo.0.0</code>-&gt;<code>1-foo</code></li>
<li><code>1.0.0-0.0.0</code>-&gt;<code>1</code></li>
</ul>
<p>版本顺序是这一前缀标记序列的字典顺序，较短的标记填充有足够的“空”值和匹配的前缀，以与较长的标记具有相同的长度。 填充的“null”值取决于其他版本的前缀：0 表示“.”，“”表示“-”。 前缀令牌顺序为：</p>
<p>如果前缀相同，则比较 token：</p>
<ul>
<li>数字标记具有自然顺序。</li>
<li>非数字标记（“限定符”）按字母顺序排列，但以下标记除外（按此顺序排在第一位）<ul>
<li>“<code>alpha</code>“&lt; “<code>beta</code>“&lt; “<code>milestone</code>“&lt; “<code>rc</code>“ = “<code>cr</code>“&lt; “<code>snapshot</code>“&lt; “” = “<code>final</code>“ = “<code>ga</code>“&lt; “<code>sp</code>“</li>
<li>当直接跟数字时，“alpha”、“beta”和“milestone”限定符可以分别缩写为“a”、“b”和“m”。<br>否则“.qualifier”=“-qualifier”&lt;“-number”&lt;“.number”</li>
<li>alpha = a&lt;&lt;&lt;beta&gt;&gt;= b&lt;&lt;&lt;milestone&gt;&gt;= m&lt;&lt;&lt;rc&gt;&gt;= cr&lt;&lt;&lt;snapshot&gt;&gt;’&lt;&lt;&lt;&gt;&gt;’ = final = ga = release&lt; sp</li>
</ul>
</li>
</ul>
<p>鼓励遵守 semver 规则，不鼓励使用某些限定词：</p>
<ul>
<li>与<code>ea</code>and<code>preview</code>相比，更倾向使用<code>alpha</code>,<code>beta</code>和<code>milestone</code></li>
<li>优先选择<code>1.0.0-RC1</code>，而不是<code>1.0.0.0.RC1</code></li>
<li>不鼓励使用<code>CR</code>修饰符。请使用<code>RC</code></li>
<li>不鼓励使用<code>final</code>、<code>ga</code>和<code>release</code>限定符。请勿使用限定符。</li>
<li>不鼓励使用<code>SP</code>限定符。 而是增加补丁版本。</li>
</ul>
<h2 id="Exclusions-排除项"><a href="#Exclusions-排除项" class="headerlink" title="Exclusions-排除项"></a>Exclusions-排除项</h2><p>限制依赖项的传递依赖关系有时很有用。依赖项可能指定了不正确的作用域，或与项目中的其他依赖项发生冲突。<code>Exclusions</code>会告诉 Maven 不要在类路径中包含指定的<code>artifact</code>，即使该<code>artifact</code>是本项目一个或多个依赖项的依赖项（传递依赖项）。例如，<code>maven-embedder</code>依赖于<code>maven-core</code>。假设您想依赖<code>maven-embedder</code>，但不想在 classpath 中包含<code>maven-core</code>或其依赖项。那么就在声明依赖<code>maven-embedder</code>的元素中添加<code>maven-core</code>作为排除项：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-embedder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这只会从<code>maven-embedder</code>依赖项中删除到<code>maven-core</code>的路径。 如果<code>maven-core</code>在 POM 中的其他位置显示为直接或传递依赖项，它仍然可以添加到类路径中。</p>
<p>通配符排除可以轻松排除依赖项的所有传递依赖项。 在下面的情况下，您可能正在使用 maven-embedder 并且想要管理您使用的依赖项，因此您排除所有传递依赖项：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-embedder<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>*<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>*<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>exclusions</strong>： Exclusions包含一个或多个<code>&lt;exclusion></code>，每个元素都包含表示要排除的依赖关系的<code>groupId</code>和<code>artifactId</code>。与<code>optional</code>不同的是，<code>exclusions</code>会主动将<code>artifacts</code>从依赖关系树中移除，而<code>optional</code>可能会也可能不会被安装和使用。</li>
</ul>
<h2 id="Inheritance-继承"><a href="#Inheritance-继承" class="headerlink" title="Inheritance-继承"></a>Inheritance-继承</h2><p>Maven 为构建管理带来的一个强大功能是项目继承概念。虽然在 Ant 等构建系统中可以模拟继承，但 Maven 在项目对象模型中明确了项目继承。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>父项目和聚合（多模块）项目的<code>packaging</code>类型需要为<code>pom</code>。这些类型定义了与一组生命周期阶段绑定的目标。例如，如果打包类型为<code>jar</code>，那么打包阶段将执行<code>jar:jar</code>目标。现在，我们可以为父 POM 添加值，这些值将由其子 POM 继承。父 POM 中的大多数元素都会被其子 POM 继承，其中包括:</p>
<ul>
<li>groupId</li>
<li>version</li>
<li>description</li>
<li>url</li>
<li>inceptionYear</li>
<li>organization</li>
<li>licenses</li>
<li>developers</li>
<li>contributors</li>
<li>mailingLists</li>
<li>scm</li>
<li>issueManagement</li>
<li>ciManagement</li>
<li>properties</li>
<li>dependencyManagement</li>
<li>dependencies</li>
<li>repositories</li>
<li>pluginRepositories</li>
<li>build<ul>
<li>plugin executions with matching ids</li>
<li>plugin configuration</li>
<li>etc.</li>
</ul>
</li>
<li>reporting</li>
<li>profiles</li>
</ul>
<p><code>不继承的重要元素包括:</code></p>
<ul>
<li>artifactId</li>
<li>name</li>
<li>prerequisites</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../my-parent<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意<code>relativePath</code>元素。它不是必需的，但可以用来指示 Maven 在搜索本地和远程版本库之前，首先搜索该项目父节点的路径。</p>
<p>要查看继承的实际效果，只需查看 ASF 或 Maven 父 POM 即可。</p>
<h2 id="The-Super-POM"><a href="#The-Super-POM" class="headerlink" title="The Super POM"></a>The Super POM</h2><p>与面向对象编程中的对象继承类似，扩展父 POM 的 POM 会从该父 POM 继承某些值。 此外，正如 Java 对象最终继承自<code>java.lang.Object</code>一样，所有项目对象模型都继承自基础 Super POM。 下面的代码片段是 Maven 3.5.4 的 Super POM。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>Central Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>Central Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>never<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/target<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/classes<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;-$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">testOutputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/test-classes<span class="tag">&lt;/<span class="name">testOutputDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scriptSourceDirectory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/scripts<span class="tag">&lt;/<span class="name">scriptSourceDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>$&#123;project.basedir&#125;/src/test/java<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/src/test/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- <span class="doctag">NOTE:</span> These plugins will be removed from future versions of the super POM --&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- They are kept for the moment as they are very unlikely to conflict with lifecycle mappings (MNG-4453) --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2-beta-5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-release-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/site<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- <span class="doctag">NOTE:</span> The release profile will be removed from future versions of the super POM --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>release-profile<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">     <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>performRelease<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">     <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar-no-fork<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-javadocs<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-deploy-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">updateReleaseInfo</span>&gt;</span>true<span class="tag">&lt;/<span class="name">updateReleaseInfo</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>您可以创建一个最小的<code>pom.xml</code>，并在命令行中执行：<code>mvn help:effective-pom</code>来查看超级 POM 如何影响您的项目对象模型。</p>
<h3 id="Dependency-Management-依赖管理"><a href="#Dependency-Management-依赖管理" class="headerlink" title="Dependency Management-依赖管理"></a>Dependency Management-依赖管理</h3><p>除了继承某些顶层元素外，父类还拥有为子 POM 和传递依赖关系配置值的元素。其中一个元素就是依赖关系管理<code>dependencyManagement</code>。</p>
<ul>
<li><p><strong>dependencyManagement</strong>: POM 使用它来帮助管理其所有子项的依赖关系信息。如果<code>my-parent</code>项目使用<code>dependencyManagement</code>定义了对<code>junit:junit:4.12</code>的依赖项，则从该项目继承的 <code>POM</code> 设置其依赖项时，可以仅给出<code>groupId=junit</code>和<code>artifactId=junit</code>即可，Maven 将自动填写父依赖项设置的版本 。这种方法的好处显而易见。依赖关系的详细信息可以在一个中心位置设置，并传播到所有继承的 POM。</p>
<p>需要注意的是，从传递依赖关系中合并进来的<code>artifacts</code>的版本和范围也受依赖关系管理部分中的版本规范控制。这可能会导致意想不到的后果。 考虑这样一种情况，您的项目使用两个依赖项：dep1 和 dep2。 dep2 反过来也使用 dep1，并且需要特定的最低版本才能运行。 如果您随后使用 dependencyManagement 指定旧版本，dep2 将被迫使用旧版本，并失败。 所以，你必须小心检查整个依赖树以避免这个问题； mvn dependency:tree 很有帮助。</p>
</li>
</ul>
<hr>
<h2 id="聚合多个模块"><a href="#聚合多个模块" class="headerlink" title="聚合多个模块"></a>聚合多个模块</h2><p>包含多个模块的项目称为多模块项目或聚合项目。模块是该 POM 列出的项目，并作为一个组执行。pom 打包项目可以通过将一组项目列为模块来聚合一组项目的构建，这些模块是这些项目的目录或 POM 文件的相对路径。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">module</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">module</span>&gt;</span>another-project<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">module</span>&gt;</span>third-project/pom-example.xml<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在列出模块时，您无需考虑模块间的依赖关系，即 POM 给出的模块顺序并不重要。Maven 会对模块进行拓扑排序，使依赖模块总是先于被依赖模块构建。</p>
<h3 id="关于继承与聚合的最后一点说明"><a href="#关于继承与聚合的最后一点说明" class="headerlink" title="关于继承与聚合的最后一点说明"></a>关于继承与聚合的最后一点说明</h3><p>继承和聚合为通过单一的高级 POM 控制构建创造了良好的动态效果。你经常会看到既是父项目又是聚合项目的项目。例如，整个 Maven 核心通过单个基础 POM<code>org.apache.maven:maven</code>运行，因此构建 Maven 项目可以通过单个命令来执行：mvn compile。不过，聚合项目和父项目都是 POM 项目，它们并不相同，不能混为一谈。POM 项目可以从其聚合的任何模块继承，但不一定拥有这些模块。相反，一个 POM 项目可以聚合不从它继承的项目。</p>
<h2 id="Propertie-属性"><a href="#Propertie-属性" class="headerlink" title="Propertie-属性"></a>Propertie-属性</h2><p>属性是理解 POM 基础知识的最后一个必需部分。Maven 属性是值占位符，就像 Ant 中的属性一样。它们的值可以通过使用符号<code>$&#123;X&#125;</code>在 POM 中的任何位置访问，其中<code>X</code>是属性。 或者它们可以被插件用作默认值，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Following project.-properties are reserved for Maven in will become elements in a future POM definition. --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- Don&#x27;t start your own properties properties with project. --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>它们有五种不同的风格：</p>
<ol>
<li><code>env.X</code>：在变量前添加“env”前缀。 将返回 shell 的环境变量。 例如，${env.PATH} 包含 PATH 环境变量。注意：虽然 Windows 环境变量本身不区分大小写，但属性的查找却区分大小写。换句话说，Windows shell 会返回 %PATH% 和 %Path% 的相同值，而 Maven 则会区分 ${env.PATH} 和 ${env.Path}。为可靠起见，环境变量的名称统一为大写。</li>
<li>project.x：POM 中的点 (.) 表示的路径将包含相应元素的值。 例如：<code>&lt;project>&lt;version>1.0&lt;/version>&lt;/project></code>可通过<code>$&#123;project.version&#125;</code>访问。</li>
<li>settings.xml 中的点 (.) 符号路径将包含相应元素的值。例如<code>&lt;settings>&lt;offline>false&lt;/offline>&lt;/settings></code>可通过<code>$&#123;settings.offline&#125;</code>访问。</li>
<li>所有通过<code>java.lang.System.getProperties()</code>访问的属性都可作为 POM 属性使用，如<code>$&#123;java.home&#125;</code>。</li>
<li><code>x</code>: 设置在 POM 中的<code>&lt;properties /></code>元素中。<code>&lt;properties>&lt;someVar>value&lt;/someVar>&lt;/properties></code>的值可用作<code>$&#123;someVar&#125;</code>。</li>
</ol>
<hr>
<h1 id="Build-Settings"><a href="#Build-Settings" class="headerlink" title="Build Settings"></a>Build Settings</h1><p>除了上面给出的 POM 基础知识之外，在声明 POM 的基本能力之前，还必须了解两个要素。它们分别是<code>build</code>元素和<code>reporting</code>元素，前者负责处理诸如声明项目目录结构和管理插件等事务，后者则在很大程度上反映了用于报告目的的构建元素。</p>
<h2 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h2><p>根据 POM 4.0.0 XSD，<code>build</code>元素在概念上分为两部分：有一个<code>BaseBuild</code>类型，其中包含两个构建元素通用的元素集（项目下的顶级构建元素和配置文件下的构建元素） ，如下所述）； 还有<code>Build</code>类型，它包含<code>BaseBuild</code>集以及顶级定义的更多元素。 让我们首先分析两者之间的共同点。</p>
<p>注：这些不同的构建元素可分别称为 “项目构建 “和 “配置文件构建”。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="comment">&lt;!-- &quot;Project Build&quot; contains more elements than just the BaseBuild set --&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span>...<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- &quot;Profile Build&quot; contains a subset of &quot;Project Build&quot;s elements --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">build</span>&gt;</span>...<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="The-BaseBuild-Element-Set"><a href="#The-BaseBuild-Element-Set" class="headerlink" title="The BaseBuild Element Set"></a>The BaseBuild Element Set</h3><p><code>BaseBuild</code>顾名思义：POM 中<code>&lt;build></code>与<code>&lt;/build></code>之间的基本元素集。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">defaultGoal</span>&gt;</span>install<span class="tag">&lt;/<span class="name">defaultGoal</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;basedir&#125;/target<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;artifactId&#125;-$&#123;version&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">filters</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">filter</span>&gt;</span>filters/filter1.properties<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">filters</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>defaultGoal</strong>:  如果没有给出，则执行的默认目标或阶段。如果给出了目标，则应按照命令行中的方式进行定义（例如<code>jar:jar</code>）。 如果定义了阶段（例如<code>install</code>），情况也是如此。</li>
<li><strong>directory</strong>: 这是项目构建后输出文件的目录，或者用 Maven 的话说，就是构建的目标。 它适当地默认为<code>$&#123;basedir&#125;/target</code>。</li>
<li><strong>finalName</strong>: 这是最终构建时项目的名称（不带文件扩展名，例如：<code>my-project-1.0.jar</code>）。 默认为<code>$&#123;artifactId&#125;-$&#123;version&#125;</code>。不过，”finalName “这个术语有点名不副实，因为构建捆绑项目的插件完全有权忽略/修改这个名称（但它们通常不会这样做）。例如，如果<code>maven-jar-plugin</code>被配置为给 jar 提供一个 test 分类器，那么上面定义的实际 jar 将被构建为<code>my-project-1.0-test.jar</code>。</li>
<li><strong>filter</strong>: 定义<code>*.properties</code>文件，其中包含一些列的属性值适用于资源文件列表。 换句话说，过滤器文件中定义的“<code>name=value</code>”对将替换构建时资源中的<code>$&#123;name&#125;</code>字符串。上面的示例定义了<code>filters/</code>目录下的<code>filter1.properties</code>文件。 Maven的默认过滤器目录是<code>$&#123;basedir&#125;/src/main/filters/</code>。</li>
</ul>
<h4 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h4><p>build元素的另一个功能是指定资源文件在项目中存在的位置。资源（通常）不是代码。 它们不会被编译，而是要捆绑在项目中或出于各种其他原因（例如代码生成）而使用的项目。</p>
<p>例如，Plexus 项目需要在 META-INF/plexus 目录中放置一个<code>configuration.xml</code>文件（该文件指定了容器的组件配置）。虽然我们可以很容易地将该文件放在<code>src/main/resources/META-INF/plexus</code>目录中，但我们还是想让 Plexus 拥有自己的<code>src/main/plexus</code>目录。为了让 JAR 插件正确地捆绑资源，您需要指定与下面类似的资源：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>META-INF/plexus<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;basedir&#125;/src/main/plexus<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">include</span>&gt;</span>configuration.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">testResources</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">   <span class="tag">&lt;/<span class="name">testResources</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>resources：</strong>是资源元素的列表，每个元素都描述了与此项目相关的文件的包含内容和位置。</li>
<li><strong>targetPath：</strong>指定用于放置构建资源集的目录结构。目标路径默认为基本目录。对于将打包到 JAR 中的资源，通常指定的目标路径是 META-INF。</li>
<li><strong>filtering</strong>：<code>true</code>或<code>false</code>，表示是否对该资源启用过滤。请注意，不必定义过滤器<code>*.properties</code>文件即可进行过滤，资源还可以使用 POM 中默认定义的属性（例如 ${project.version}）。使用以下命令传递到命令行 “-D”标志（例如“-Dname=value”）或由属性元素显式定义。 过滤器文件已在上面介绍过。</li>
<li><strong>directory：</strong>该元素的值定义在哪里可以找到资源文件。 构建的默认目录是<code>$&#123;basedir&#125;/src/main/resources</code>。</li>
<li><strong>includes</strong>: 包括：一组文件模式，指定要作为指定目录下的资源包含的文件，使用 * 作为通配符。</li>
<li><strong>excludes</strong>: 与<code>includes</code>相同的结构，指定要忽略哪些文件。 在<code>includes</code>和<code>excludes</code>发生冲突时，<code>excludes</code>获胜。</li>
<li><strong>testResources</strong>: 它们的定义与<code>resources</code>类似，但自然是在测试阶段使用。唯一的区别是项目的默认（Super POM 定义的）测试资源目录是<code>$&#123;basedir&#125;/src/test/resources</code>。测试资源不会被部署。</li>
</ul>
<h4 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">extensions</span>&gt;</span>false<span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>test<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">executions</span>&gt;</span>...<span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>除了<code>groupId:artifactId:version</code>的标准坐标外，还有一些元素用于配置插件或构建与插件的交互。</p>
<ul>
<li><strong>extensions:</strong><code>true</code>或<code>false</code>，是否加载该插件的扩展。 默认情况下为<code>false</code>。 本文档稍后将介绍扩展。</li>
<li><strong>inherited</strong>:<code>true</code>或<code>false</code>，表示此插件配置是否应用于继承自此插件的 POM。默认值为<code>true</code>。</li>
<li><strong>configuration</strong>: 这是单个插件的特定属性。无需太深入地了解插件如何工作的机制，只需说明插件 Mojo 可能期望的任何属性（这些是 Java Mojo bean 中的 getter 和 setter）都可以在这里指定。在上面示例中，我们在<code>maven-jar-plugin</code>中将<code>classifier</code>设置为<code>test</code>。值得注意的是，所有配置元素，无论它们位于 POM 中的什么位置，都是为了将值传递到另一个底层系统，例如插件。 换句话说：POM 模式永远不会明确要求配置元素中的值，但插件目标完全有权要求配置值。</li>
</ul>
<p>如果您的 POM 声明了一个parent，它将从父类的<code>build/plugins</code>或<code>pluginManagement</code>部分继承插件配置。</p>
<p><strong>default configuration inheritance:</strong></p>
<p>为了说明这一点，请考虑父 POM 中的以下片段：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>my.group<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">items</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">item</span>&gt;</span>parent-1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">item</span>&gt;</span>parent-2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">items</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">parentKey</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">parentKey</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面是使用该父级作为<code>parent</code>的项目中的插件配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>my.group<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">items</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">item</span>&gt;</span>child-1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">items</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">childKey</span>&gt;</span>child<span class="tag">&lt;/<span class="name">childKey</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>默认行为是根据元素名称合并配置元素的内容。 如果子 POM 具有特定元素，则该值将成为有效值。 如果子 POM 没有元素，但父 POM 有，则父值将成为有效值。 请注意，这纯粹是对 XML 的操作； 不涉及插件本身的代码或配置。 仅涉及元素，而不涉及其值。</p>
<p>将这些规则应用到示例中，Maven 得出：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>my.group<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">items</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">item</span>&gt;</span>child-1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">items</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">childKey</span>&gt;</span>child<span class="tag">&lt;/<span class="name">childKey</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">parentKey</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">parentKey</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>高级配置继承：<code>combine.child</code>和<code>combine.self</code></p>
<p>你可以控制子POM如何从父POM继承配置通过向配置元素的子元素添加属性。这些属性是<code>combine.children</code>和<code>combine.self</code>。在子 POM 中使用这些属性来控制 Maven 如何将父 POM 中的插件配置与子 POM 中的显式配置相结合。</p>
<p>以下是带有这两个属性说明的子配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">items</span> <span class="attr">combine.children</span>=<span class="string">&quot;append&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- combine.children=&quot;merge&quot; is the default --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">item</span>&gt;</span>child-1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">items</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">properties</span> <span class="attr">combine.self</span>=<span class="string">&quot;override&quot;</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- combine.self=&quot;merge&quot; is the default --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">childKey</span>&gt;</span>child<span class="tag">&lt;/<span class="name">childKey</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>现在，有效结果如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">items</span> <span class="attr">combine.children</span>=<span class="string">&quot;append&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">item</span>&gt;</span>parent-1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">item</span>&gt;</span>parent-2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">item</span>&gt;</span>child-1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">items</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">properties</span> <span class="attr">combine.self</span>=<span class="string">&quot;override&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">childKey</span>&gt;</span>child<span class="tag">&lt;/<span class="name">childKey</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>combine.children="append "</code>的结果是按顺序连接父元素和子元素。而<code>combine.self="override"</code>则会完全抑制父元素的配置。您不能在一个<code>element</code>上同时使用<code>combine.self="override"</code>和<code>combine.children="append"</code>； 如果你尝试，<code>override</code>将会获胜。</p>
<p>请注意，这些属性只适用于它们所声明的配置元素，不会传播到嵌套元素。也就是说，如果子 POM 中项目元素的内容是复杂结构而非文本，那么其子元素仍将采用默认的合并策略，除非它们本身也标有属性。</p>
<p><code>merge.*</code>属性从父 POM 继承到子 POM。 将这些属性添加到父 POM 时要小心，因为这可能会影响子 POM 或孙 POM。</p>
<ul>
<li><strong>dependencies:</strong><code>dependencies</code>在 POM 中经常出现，它是所有<code>plugins</code>元素块下的一个元素。<code>dependencies</code>有着与基础构建相同的结构和功能。这种情况下的主要区别在于依赖项不再作为项目的依赖项，而是作为其所在插件的依赖项。其强大之处在于可以更改插件的依赖项列表，可能是通过排除删除未使用的运行时依赖项，或者更改所需依赖项的版本。 有关更多信息，请参阅上面的依赖项。</li>
<li><strong>executions:</strong> 需要注意的是，一个<code>plugin</code>可能有多个<code>goals</code>。每个目标都可能有单独的配置，甚至可能将插件的目标完全绑定到不同的阶段。<code>executions</code>配置了一个插件<code>goals</code>的执行。</li>
</ul>
<p>例如，假设要<code>antrun:run</code>目标绑定到<code>verify</code>阶段。我们希望该任务能呼应构建目录，并通过将<code>inherited</code>设置为<code>false</code>来避免将此配置传递给其子任务（假设它是父任务）。执行结果如下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span>&gt;</span>echodir<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">goal</span>&gt;</span>run<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">phase</span>&gt;</span>verify<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>false<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">tasks</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">echo</span>&gt;</span>Build Dir: /home/jenkins/82467a7c/workspace/aven_maven-box_maven-site_master/target<span class="tag">&lt;/<span class="name">echo</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">tasks</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>id</strong>: 不言自明。它指定了所有其他执行块之间的这个执行块，该运行阶段时，将以下形式显示：<code>[plugin:goal execution: id]</code>。在此示例中：<code>antrun:run execution: echodir</code></li>
<li><strong>goals</strong>: 它包含了一系列元素，在本例中，是该执行块指定的插件目标列表。</li>
<li><strong>phase</strong>: 这是一系列<code>goals</code>列表将执行的阶段。这是一个非常强大的选项，允许将任何目标绑定到构建生命周期中的任何阶段，从而改变 Maven 的默认行为。</li>
<li><strong>inherited</strong>: 与上面的继承元素一样，将其设置为 false 将禁止 Maven 将此执行传递给其子元素。 该元素仅对父 POM 有意义。</li>
<li><strong>configuration</strong>: 与上面相同，但将配置限制到这个特定的目标列表，而不是插件下的所有目标。</li>
</ul>
<h4 id="Plugin-Management"><a href="#Plugin-Management" class="headerlink" title="Plugin Management"></a>Plugin Management</h4><p><code>pluginManagement</code>是一个与<code>plugins</code>一起出现的元素。插件管理以大致相同的方式包含插件元素，不同之处在于它不是为特定项目构建配置插件信息，而是用于配置继承自此项目构建的项目。不过，这只能配置子项目或当前 POM 中插件元素实际引用的插件。子项目完全有权覆盖<code>pluginManagement</code>定义。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">id</span>&gt;</span>pre-process-classes<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>pre-process<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果我们将这些规范添加到<code>plugins</code>元素中，它们将仅适用于单个POM。但是，如果我们在<code>pluginManagement</code>元素下应用它们，那么这个 POM 和所有在构建过程中继承 了<code>maven-jar-plugin</code>的POM也将获得预处理类的执行。因此，与其在每个子<code>pom.xml</code>中包含上述乱七八糟的内容，不如只需要以下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="The-Build-Element-Set"><a href="#The-Build-Element-Set" class="headerlink" title="The Build Element Set"></a>The Build Element Set</h3><p>XSD 中的 “构建 “类型表示那些只适用于 “项目构建 “的元素。尽管额外元素的数量很多（6 个），但项目构建所包含的元素中只有两组是配置文件构建所缺少的：<code>directories</code>and<code>extensions</code>。</p>
<h4 id="Directories"><a href="#Directories" class="headerlink" title="Directories"></a>Directories</h4><p>目录元素集存在于父构建元素中，为整个 POM 设置了各种目录结构。由于它们不存在于配置文件构建中，因此不能被配置文件更改。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>$&#123;basedir&#125;/src/main/java<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">scriptSourceDirectory</span>&gt;</span>$&#123;basedir&#125;/src/main/scripts<span class="tag">&lt;/<span class="name">scriptSourceDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>$&#123;basedir&#125;/src/test/java<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;basedir&#125;/target/classes<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">testOutputDirectory</span>&gt;</span>$&#123;basedir&#125;/target/test-classes<span class="tag">&lt;/<span class="name">testOutputDirectory</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果上述<code>*Directory</code>元素的值被设置为绝对路径（在展开其属性时），则使用该目录。否则，它将相对于基本构建目录：<code>$&#123;basedir&#125;</code>。请注意，脚本源目录<code>scriptSourceDirectory</code>在 Maven 中已不再使用，并已过时。</p>
<h4 id="Extensions"><a href="#Extensions" class="headerlink" title="Extensions"></a>Extensions</h4><p>扩展是用于工程构建的一系列artifacts列表。它们将被包含在正在运行的构建的类路径中。他们可以扩展构建过程（例如为 Wagon 传输机制添加 ftp provider），以及激活插件以更改构建生命周期。简而言之，扩展是在构建期间激活的artifacts。扩展不需要做任何实际工作，也不包含 Mojo。因此，扩展非常适合指定一个通用插件接口的多个实现中的一个。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">extensions</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">extension</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.wagon<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>wagon-ftp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-alpha-3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">extension</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Reporting"><a href="#Reporting" class="headerlink" title="Reporting"></a>Reporting</h2><p>报告包含专门对应网站生成阶段的元素。定义和配置在<code>reporting</code>元素下相当多的Maven 插件可以生成报告。例如：生成 Javadoc 报告。 与构建元素配置插件的能力非常相似，与构建元素配置插件的功能一样，报告元素也具有同样的功能。明显的区别在于，明显的区别在于，报告不是在执行块中对插件目标进行精细控制，而是在 reportSet 元素中配置目标。更微妙的区别在于，报告元素下的插件配置可作为构建插件配置使用，尽管相反情况并非如此（构建插件配置不会影响报告插件）。</p>
<p>对于了解构建元素的人来说，报告元素下唯一不熟悉的项目可能是可能就是布尔排除默认值元素<code>Boolean excludeDefaults element</code>。该元素向站点生成器表示排除通常默认生成的报告。当通过站点构建周期生成站点时，项目信息部分会放置在左侧菜单中，其中充满了报告，例如项目团队报告或依赖项列表报告。这些报告目标由 maven-project-info-reports-plugin 生成。作为一个和其他插件一样的插件，它也可以通过以下更冗长的方式被抑制，从而有效地关闭项目信息报告。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;basedir&#125;/target/site<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-project-info-reports-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">reportSets</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">reportSet</span>&gt;</span><span class="tag">&lt;/<span class="name">reportSet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">reportSets</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>另一个区别是<code>plugin</code>下的<code>outputDirectory</code>元素。 在报告的情况下，输出目录默认为<code>$&#123;basedir&#125;/target/site</code>。</p>
<h3 id="Report-Sets"><a href="#Report-Sets" class="headerlink" title="Report Sets"></a>Report Sets</h3><p>重要的是要记住，单个插件可能有多个目标。 每个目标可能有单独的配置。报告集配置报告插件目标的执行。 这听起来是不是很熟悉——似曾相识？关于构建的执行元素也说了同样的事情，但有一个区别：您不能将报告绑定到另一个阶段。 对不起。例如，假设您想将 javadoc:javadoc 目标配置为链接到 “<a target="_blank" rel="noopener" href="http://java.sun.com/j2se/1.5.0/docs/api/&quot;%EF%BC%8C%E4%BD%86%E4%BB%85%E9%99%90%E4%BA%8E">http://java.sun.com/j2se/1.5.0/docs/api/&quot;，但仅限于</a> javadoc 目标（而不是目标 maven-javadoc-plugin:jar）。我们还希望将此配置传递给其子级，并将inherited设置为 true。 reportSet类似于以下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">reporting</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">       <span class="tag">&lt;<span class="name">reportSets</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">reportSet</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">id</span>&gt;</span>sunlink<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">reports</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">report</span>&gt;</span>javadoc<span class="tag">&lt;/<span class="name">report</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">reports</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">inherited</span>&gt;</span>true<span class="tag">&lt;/<span class="name">inherited</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">links</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">link</span>&gt;</span>http://java.sun.com/j2se/1.5.0/docs/api/<span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">links</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">reportSet</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">reportSets</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在build<code>executions</code>和reporting<code>reportSets</code>之间，现在应该清楚它们存在的原因了。最简单的意义上讲，它们是对配置的深入研究。它们赋予了 POM 在控制其构建命运方面的最终粒度。</p>
<hr>
<h1 id="More-Project-Information"><a href="#More-Project-Information" class="headerlink" title="More Project Information"></a>More Project Information</h1><p>有几个元素并不影响构建，而是为了方便开发人员而记录项目。在生成项目网站时，这些元素中有许多都用于填写项目细节。不过，与所有 POM 声明一样，插件也可以将它们用于任何用途。以下是最简单的元素：</p>
<ul>
<li><strong>name</strong>: 项目往往都有一个会话式的名称，而不只是<code>artifactId</code>。Sun 公司的工程师们并没有把他们的项目称为 “java-1.5”，而是称之为 “Tiger”。这里是设置该值的位置。</li>
<li><strong>description</strong>:  简短、可读的项目描述。尽管这不应取代正式文档，但对 POM 的任何读者进行快速评语总是有帮助的。</li>
<li><strong>url</strong>: 项目主页。</li>
<li><strong>inceptionYear</strong>: 项目首次创建的年份。</li>
</ul>
<h2 id="Licenses-许可证"><a href="#Licenses-许可证" class="headerlink" title="Licenses-许可证"></a>Licenses-许可证</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">licenses</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">license</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>Apache-2.0<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://www.apache.org/licenses/LICENSE-2.0.txt<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">distribution</span>&gt;</span>repo<span class="tag">&lt;/<span class="name">distribution</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">comments</span>&gt;</span>A business-friendly OSS license<span class="tag">&lt;/<span class="name">comments</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">license</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">licenses</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Licenses 是法律文件定义如何以及何时使用项目，项目应列出直接适用于本项目的许可证，而不应列出适用于本项目依赖关系的许可证。</p>
<ul>
<li><strong>name</strong>, <strong>url</strong> and <strong>comments</strong>: 不言自明，以前在其他情况下也遇到过。建议使用 SPDX 标识符作为许可证名称。第四个许可证元素是</li>
<li><strong>distribution</strong>: 这描述了如何合法地分发项目。 两种指定的方法是repo（它们可以从Maven存储库下载）或manual（它们必须手动安装）。</li>
</ul>
<h2 id="Organization-组织"><a href="#Organization-组织" class="headerlink" title="Organization-组织"></a>Organization-组织</h2><p>大多数项目都是由某种组织（企业、私人团体等）运作的。这里设置了最基本的信息。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">organization</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>Codehaus Mojo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://mojo.codehaus.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Developers-开发者"><a href="#Developers-开发者" class="headerlink" title="Developers-开发者"></a>Developers-开发者</h2><p>所有项目都由某个人在某个时间创建的文件组成。 与围绕项目的其他系统一样，参与项目的人员也与项目息息相关。开发人员可能是项目的核心开发成员。需要注意的是，尽管一个组织可能有很多开发人员（程序员），但把他们都列为开发人员并不是好的做法，而只能是那些直接负责代码的人。一个好的经验法则是，如果不应该就项目与此人联系，就不需要在此列出。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>jdoe<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>John Doe<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">email</span>&gt;</span>jdoe@example.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.example.com/jdoe<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">organization</span>&gt;</span>ACME<span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">organizationUrl</span>&gt;</span>http://www.example.com<span class="tag">&lt;/<span class="name">organizationUrl</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">roles</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">role</span>&gt;</span>architect<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">role</span>&gt;</span>developer<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">roles</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>America/New_York<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">picUrl</span>&gt;</span>http://www.example.com/jdoe/pic<span class="tag">&lt;/<span class="name">picUrl</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>id</strong>, <strong>name</strong>, <strong>email</strong>:  这些信息对应于开发者的 ID（可能是整个组织的唯一 ID）、开发者的姓名和电子邮件地址。</li>
<li><strong>organization</strong>, <strong>organizationUrl</strong>: 你可能猜到了，这分别是开发者的组织名称和 URL。</li>
<li><strong>roles</strong>: 角色应明确规定该人负责的标准行动。就像一个人可以身兼数职一样，一个人可以扮演多个角色。</li>
<li><strong>timezone</strong>: timezone：有效的时区 ID，例如 America/New_York 或 Europe/Berlin，或者是开发人员居住地与 UTC 的小时数（和分数）偏移量，例如 -5 或 +1。 时区 ID 是高度首选，因为它们不受 DST 和时区转换的影响。 有关官方时区数据库和维基百科中的列表，请参阅 IANA。</li>
<li><strong>properties</strong>: 该元素用于放置有关个人的其他属性。例如，指向个人图像或即时消息句柄的链接。不同的插件可能会使用这些属性，也可能只是给阅读 POM 的其他开发人员使用。</li>
</ul>
<h2 id="Contributors-贡献者"><a href="#Contributors-贡献者" class="headerlink" title="Contributors-贡献者"></a>Contributors-贡献者</h2><p>贡献者就像开发人员一样，但在项目的生命周期中扮演辅助角色。 也许贡献者发送了错误修复，或者添加了一些重要的文档。 一个健康的开源项目可能会有比开发人员更多的贡献者。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">contributors</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">contributor</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>Noelle<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">email</span>&gt;</span>some.name@gmail.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://noellemarie.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">organization</span>&gt;</span>Noelle Marie<span class="tag">&lt;/<span class="name">organization</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">organizationUrl</span>&gt;</span>http://noellemarie.com<span class="tag">&lt;/<span class="name">organizationUrl</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">roles</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">role</span>&gt;</span>tester<span class="tag">&lt;/<span class="name">role</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">roles</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">timezone</span>&gt;</span>America/Vancouver<span class="tag">&lt;/<span class="name">timezone</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">gtalk</span>&gt;</span>some.name@gmail.com<span class="tag">&lt;/<span class="name">gtalk</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">contributor</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">contributors</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Environment-Settings"><a href="#Environment-Settings" class="headerlink" title="Environment Settings"></a>Environment Settings</h1><h2 id="Issue-Management-问题管理"><a href="#Issue-Management-问题管理" class="headerlink" title="Issue Management-问题管理"></a>Issue Management-问题管理</h2><p>这定义了所使用的bug跟踪系统（Bugzilla、TestTrack、ClearQuest 等）。尽管没有什么可以阻止插件使用此信息进行某些操作，但它主要用于生成项目文档。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">issueManagement</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">system</span>&gt;</span>Bugzilla<span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://127.0.0.1/bugzilla/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">issueManagement</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Continuous-Integration-Management-持续集成管理"><a href="#Continuous-Integration-Management-持续集成管理" class="headerlink" title="Continuous Integration Management-持续集成管理"></a>Continuous Integration Management-持续集成管理</h2><p>在过去几年中，基于触发器或定时（如每小时或每天）的持续集成构建系统比手动构建系统更受欢迎。随着构建系统越来越标准化，运行触发这些构建的系统也越来越标准化。虽然大部分配置取决于所使用的特定程序（Continuum、Cruise Control 等），但也有一些配置可能会在 POM 中进行。Maven 在通知器元素集中捕捉到了一些经常出现的重复设置。通知器是通知人们某些构建状态的方式。在以下示例中，此 POM 设置邮件类型的通知程序（即电子邮件），并配置要在指定触发器<code>sendOnError</code>、<code>sendOnFailure</code>上使用的电子邮件地址，而不是<code>sendOnSuccess</code>或<code>sendOnWarning</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">ciManagement</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">system</span>&gt;</span>continuum<span class="tag">&lt;/<span class="name">system</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://127.0.0.1:8080/continuum<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">notifiers</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">notifier</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">type</span>&gt;</span>mail<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">sendOnError</span>&gt;</span>true<span class="tag">&lt;/<span class="name">sendOnError</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">sendOnFailure</span>&gt;</span>true<span class="tag">&lt;/<span class="name">sendOnFailure</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">sendOnSuccess</span>&gt;</span>false<span class="tag">&lt;/<span class="name">sendOnSuccess</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">sendOnWarning</span>&gt;</span>false<span class="tag">&lt;/<span class="name">sendOnWarning</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">configuration</span>&gt;</span><span class="tag">&lt;<span class="name">address</span>&gt;</span>continuum@127.0.0.1<span class="tag">&lt;/<span class="name">address</span>&gt;</span><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">notifier</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">notifiers</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">ciManagement</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Mailing-Lists-邮件列表"><a href="#Mailing-Lists-邮件列表" class="headerlink" title="Mailing Lists-邮件列表"></a>Mailing Lists-邮件列表</h2><p>邮件列表是与项目相关人员保持联系的绝佳工具。大多数邮件列表都面向开发人员和用户。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">mailingLists</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">mailingList</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>User List<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">subscribe</span>&gt;</span>user-subscribe@127.0.0.1<span class="tag">&lt;/<span class="name">subscribe</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">unsubscribe</span>&gt;</span>user-unsubscribe@127.0.0.1<span class="tag">&lt;/<span class="name">unsubscribe</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">post</span>&gt;</span>user@127.0.0.1<span class="tag">&lt;/<span class="name">post</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">archive</span>&gt;</span>http://127.0.0.1/user/<span class="tag">&lt;/<span class="name">archive</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">otherArchives</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">otherArchive</span>&gt;</span>http://base.google.com/base/1/127.0.0.1<span class="tag">&lt;/<span class="name">otherArchive</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">otherArchives</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">mailingList</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">mailingLists</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>subscribe</strong>, <strong>unsubscribe</strong>: 些元素指定用于执行相关操作的电子邮件地址。要订阅上面的用户列表，用户将向 <a href="mailto:&#x75;&#115;&#x65;&#x72;&#x2d;&#115;&#x75;&#98;&#115;&#99;&#114;&#x69;&#x62;&#x65;&#64;&#49;&#x32;&#55;&#x2e;&#48;&#46;&#48;&#46;&#49;">&#x75;&#115;&#x65;&#x72;&#x2d;&#115;&#x75;&#98;&#115;&#99;&#114;&#x69;&#x62;&#x65;&#64;&#49;&#x32;&#55;&#x2e;&#48;&#46;&#48;&#46;&#49;</a> 发送电子邮件。</li>
<li><strong>archive</strong>: 此元素指定旧邮件列表电子邮件的存档的 URL（如果存在）。 如果有镜像存档，可以在otherArchives下指定。</li>
<li><strong>post</strong>: 用于发布到邮件列表的电子邮件地址。 请注意，并非所有邮件列表都能够发帖（例如构建失败列表）。</li>
</ul>
<h2 id="SCM-版本控制"><a href="#SCM-版本控制" class="headerlink" title="SCM-版本控制"></a>SCM-版本控制</h2><p>SCM（软件配置管理，也称为源代码/控制管理，或者简单地说，版本控制）是任何健康项目不可或缺的一部分。 如果您的 Maven 项目使用 SCM 系统（确实如此，不是吗？），那么您可以在此处将该信息放入 POM 中。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">connection</span>&gt;</span>scm:svn:http://127.0.0.1/svn/my-project<span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>scm:svn:https://127.0.0.1/svn/my-project<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://127.0.0.1/websvn/my-project<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>connection</strong>, <strong>developerConnection</strong>: 这两个连接元素传达了如何通过 Maven 连接到版本控制系统。连接需要 Maven 的读取访问权限才能找到源代码（例如更新），而developerConnection 则需要提供写入访问权限的连接。Maven 项目衍生了另一个名为 Maven SCM 的项目，该项目为任何希望实现它的 SCM 创建了一个通用 API。 最流行的是 CVS 和 Subversion，但是，其他受支持的 SCM 的列表也在不断增加。 所有 SCM 连接都是通过通用 URL 结构建立的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scm:[provider]:[provider_specific]</span><br></pre></td></tr></table></figure>
</li>
<li><p>其中provider是SCM系统的类型。 例如，连接到 CVS 存储库可能如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scm:cvs:pserver:127.0.0.1:&#x2F;cvs&#x2F;root:my-project</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>tag</strong>: 指定该项目所在的标签。 HEAD（即 SCM root）是默认值。</p>
</li>
<li><p><strong>url</strong>: 可公开浏览的存储库。 例如，通过 ViewCVS。</p>
</li>
</ul>
<h2 id="Prerequisites-先决条件"><a href="#Prerequisites-先决条件" class="headerlink" title="Prerequisites-先决条件"></a>Prerequisites-先决条件</h2><p>POM 可能需要某些先决条件才能正确执行。在 POM 4.0.0 中，唯一作为先决条件存在的元素是<code>maven</code>元素，它需要一个最低版本号。</p>
<p>使用 Maven Enforcer Plugin 的<code>requireMavenVersion</code>规则或其他规则作为构建时的先决条件。对于打包的<code>maven-plugin</code>，运行时仍会使用该规则，以确保满足插件的最低 Maven 版本要求（但仅限于引用插件的 pom.xml）。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">prerequisites</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">maven</span>&gt;</span>2.0.6<span class="tag">&lt;/<span class="name">maven</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">prerequisites</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Repositories-存储库"><a href="#Repositories-存储库" class="headerlink" title="Repositories-存储库"></a>Repositories-存储库</h2><p>存储库是遵循 Maven 存储库目录布局的工程集合。要成为 Maven 资源库工程，POM 文件必须位于<code>$BASE_REPO/groupId/artifactId/version/artifactId-version.pom</code>结构中。<code>$BASE_REPO</code>可以是本地的（文件结构），也可以是远程的（基本 URL）；其余布局将保持不变。资源库是收集和存储<code>artifacts</code>的地方。每当项目依赖于某个artifact时，Maven 将首先尝试使用指定工件的本地副本。 如果本地存储库中不存在该工件，它将尝试从远程存储库下载。POM 中的版本库元素指定了要搜索的备用版本库。</p>
<p>存储库是 Maven 社区最强大的功能之一。 默认情况下，Maven 搜索 <a target="_blank" rel="noopener" href="https://repo.maven.apache.org/maven2/">https://repo.maven.apache.org/maven2/</a> 的中央存储库。 可以在 pom.xml <code>repositories</code> 元素中配置其他存储库。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">releases</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>always<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>warn<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>true<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>never<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>fail<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus Snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>snapshots-repo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://oss.sonatype.org/content/repositories/snapshots<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>releases</strong>, <strong>snapshots</strong>: 这些是针对每种类型的工件（<code>Release</code>或者<code>snapshot</code>）的策略。有了这两套策略，POM 就能在单个版本库中改变每种类型的策略，而不受另一种策略的影响。例如，可能出于开发目的，有人会决定只启用快照下载。</li>
<li><strong>enabled</strong>:<code>true</code>或<code>false</code>，表示该版本库是否为相应类型（<code>Release</code>或者<code>snapshot</code>）启用。</li>
<li><strong>updatePolicy</strong>: 该元素指定了尝试更新的频率。Maven 将比较本地 POM 的时间戳（存储在版本库的 maven-metadata 文件中）和远程 POM 的时间戳。可选项有：<code>always</code>、<code>daily</code>（默认）、<code>interval:X</code>（X 是以分钟为单位的整数）或<code>never</code>（仅在本地版本库中不存在时下载）。</li>
<li><strong>checksumPolicy</strong>: 当Maven将文件部署到存储库时，它也会部署相应的校验和文件。当校验和缺失或者不正确您的可选项是<code>ignore</code>,<code>fail</code>, or<code>warn</code></li>
<li><strong>layout</strong>: 在上文对资源库的描述中，提到它们都遵循一个共同的布局。这基本上是正确的。Maven 2 引入的布局是 Maven 2 和 3 使用的版本库默认布局。不过，Maven 1.x 有不同的布局。使用此元素指定它是默认的还是旧的。</li>
</ul>
<h2 id="Plugin-Repositories-插件存储库"><a href="#Plugin-Repositories-插件存储库" class="headerlink" title="Plugin Repositories-插件存储库"></a>Plugin Repositories-插件存储库</h2><p>存储库是两种主要类型artifacts的所在地。第一种类型是用作其他工程的依赖项，另一种类型的工程是插件。Maven 插件本身就是一种特殊类型的工程。因此，插件存储库可能与其他存储库分开（尽管，我还没有听到这样做的令人信服的论据）。 无论如何，pluginRepositories 元素块的结构与 repositories 元素类似。 每个pluginRepository 元素都指定Maven 可以找到新插件的远程位置。</p>
<h2 id="Distribution-Management-分发管理"><a href="#Distribution-Management-分发管理" class="headerlink" title="Distribution Management-分发管理"></a>Distribution Management-分发管理</h2><p>分发管理的作用正如其听起来一样：它管理整个构建过程中生成的工件和支持文件的分发。 首先从最后一个元素开始：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">downloadUrl</span>&gt;</span>http://mojo.codehaus.org/my-project<span class="tag">&lt;/<span class="name">downloadUrl</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">status</span>&gt;</span>deployed<span class="tag">&lt;/<span class="name">status</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>downloadUrl</strong>: 是另一个 POM 可以指向的存储库的 URL，以便获取此 POM 的工件。 用最简单的话来说，我们告诉 POM 如何上传它（通过<code>repository/url</code>），但是公众可以从哪里下载它呢？ 这个元素回答了这个问题。</li>
<li><strong>status</strong>: 警告！就像巢中的雏鸟一样，status永远不应该被人类的手触碰！这样做的原因是，当项目被传输到存储库时，Maven 会自动设置项目的状态。 其有效类型如下。<ul>
<li><strong>none</strong>: 没有特殊的状态。 这是 POM 的默认设置。</li>
<li><strong>converted</strong>: 存储库的管理员将此 POM 从早期版本转换为 Maven 2。</li>
<li><strong>partner</strong>: 该artifact已与合作伙伴资源库同步。</li>
<li><strong>deployed</strong>: ：迄今为止最常见的状态，这意味着该工件是从 Maven 2 或 3 实例部署的。 这是使用命令行<code>deploy</code>手动部署时得到的结果。</li>
<li><strong>verified</strong>: 该项目已经过验证，应视为已完成。</li>
</ul>
</li>
</ul>
<h3 id="Repository-存储库"><a href="#Repository-存储库" class="headerlink" title="Repository-存储库"></a>Repository-存储库</h3><p>repositories 元素在 POM 中指定了 Maven 下载远程工件供当前项目使用的位置和方式，而 distributionManagement 则指定了该项目在部署时从哪里（以及如何）进入远程版本库。如果未定义快照存储库（snapshotRepository），存储库元素将用于快照分发。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">uniqueVersion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">uniqueVersion</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>corp1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>Corporate Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>scp://repo/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">uniqueVersion</span>&gt;</span>true<span class="tag">&lt;/<span class="name">uniqueVersion</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>propSnap<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>Propellors Snapshots<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>sftp://propellers.net/maven<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">layout</span>&gt;</span>legacy<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>id</strong>, <strong>name</strong>:<code>id</code>用于在众多资源库中唯一标识该资源库，<code>name</code>是人类可读的形式。</li>
<li><strong>uniqueVersion</strong>: 唯一版本，取值为<code>true</code>或<code>false</code>，表示部署到该版本库的工件是应该获得唯一生成的版本号，还是使用定义为地址一部分的版本号。</li>
<li><strong>url</strong>: 这是版本库元素的核心。它指定了用于将构建的工件（以及 POM 文件和校验和数据）传输到版本库的位置和传输协议。</li>
<li><strong>layout</strong>: 这些与存储库元素中定义的布局元素具有相同的类型和用途。 </li>
</ul>
<h3 id="Site-Distribution-站点发布"><a href="#Site-Distribution-站点发布" class="headerlink" title="Site Distribution-站点发布"></a>Site Distribution-站点发布</h3><p>分发管理<code>distributionManagement</code>不仅负责向资源库分发，还负责定义如何部署项目网站和文档。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">site</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>mojo.website<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>Mojo Website<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>scp://beaver.codehaus.org/home/projects/mojo/public_html/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">site</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>id</strong>, <strong>name</strong>, <strong>url</strong>: 这些元素与上面的 distributionManagement 资源库元素中的对应元素类似。</li>
</ul>
<h3 id="Relocation-搬迁"><a href="#Relocation-搬迁" class="headerlink" title="Relocation-搬迁"></a>Relocation-搬迁</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span><span class="attr">1</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">   <span class="tag">&lt;<span class="name">relocation</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>my-project<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">message</span>&gt;</span>We have moved the Project under Apache<span class="tag">&lt;/<span class="name">message</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">relocation</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"> <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>项目不是一成不变的；它们是有生命的东西（或垂死的东西，视情况而定）。随着项目的发展壮大，一个常见的情况是项目被迫迁往更合适的地方。例如，当你的下一个大获成功的开源项目转移到 Apache 旗下时，最好能给用户提个醒，告诉他们项目将更名为<code>org.apache:my-project:1.0</code>。除了指明新地址外，提供一条解释原因的信息也是很好的形式。</p>
<h2 id="Profiles"><a href="#Profiles" class="headerlink" title="Profiles"></a>Profiles</h2><p>POM 4.0 的一个新功能是项目可以根据构建环境改变设置。一个<code>profile</code>元素既包含可选激活（配置文件触发器），也包含激活该配置文件后对 POM 所做的一系列更改。例如，为测试环境构建的项目可能与最终部署环境有着不同的数据库。或者，根据所使用的 JDK 版本不同，依赖关系也可能来自不同的资源库。The elements of profiles are as follows:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">activation</span>&gt;</span>...<span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">build</span>&gt;</span>...<span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">modules</span>&gt;</span>...<span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">repositories</span>&gt;</span>...<span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span>...<span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">reporting</span>&gt;</span>...<span class="tag">&lt;/<span class="name">reporting</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span>...<span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Activation"><a href="#Activation" class="headerlink" title="Activation"></a>Activation</h3><p><code>Activations</code>是<code>Profiles</code>的关键。只有在特定情况下，配置文件才能修改基本 POM。这些情况通过激活一个activation元素来指定。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"> <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.5<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">os</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>Windows XP<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">family</span>&gt;</span>Windows<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">arch</span>&gt;</span>x86<span class="tag">&lt;/<span class="name">arch</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.2600<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">os</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">name</span>&gt;</span>sparrow-type<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">value</span>&gt;</span>African<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">file</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">exists</span>&gt;</span>$&#123;basedir&#125;/file2.properties<span class="tag">&lt;/<span class="name">exists</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">missing</span>&gt;</span>$&#123;basedir&#125;/file1.properties<span class="tag">&lt;/<span class="name">missing</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">      ...</span><br><span class="line">   <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>自 Maven 3.2.2 以来，当满足所有指定条件时才会激活。</p>
<ul>
<li><p><strong>jdk</strong>:<code>activation</code>在 jdk 元素中具有内置的、以 Java 为中心的检查。 该值为以下三种类型之一:</p>
<ul>
<li>根据 maven-enforcer-plugin 定义的版本范围，<code>[</code>或<code>（,</code></li>
<li>如果值以<code>!</code>开头，则为否定前缀</li>
<li>一个（无负数）前缀，用于所有其他情况</li>
</ul>
</li>
<li><p>如果运行 Maven 所用的 JDK 版本以给定的前缀开始/不以给定的前缀开始（不包括潜在的前导 !），则前缀（否定）值匹配。如果运行 Maven 所用的 JDK 版本介于下限和上限之间（包含或排除），则值范围匹配。</p>
</li>
<li><p><strong>os</strong>: os 元素可以定义一些特定于操作系统的属性，如上图所示。有关操作系统值的更多详情，请参阅 maven-enforcer-plugins RequireOS Rule。</p>
</li>
<li><p><strong>property</strong>: 如果 Maven 检测到相应<code>name=value</code>对的系统属性或 CLI 用户属性（可以在 POM 中通过 ${name} 解除引用）与给定值（如果给定）匹配，则<code>profile</code>将激活。</p>
</li>
<li><p><strong>file</strong>: 最后，给定的文件名可以通过文件存在或丢失来激活配置文件。 注意：此元素的插值仅限于 ${basedir}、系统属性和请求属性。</p>
</li>
</ul>
<hr>
<h1 id="Maven依赖的优先原则"><a href="#Maven依赖的优先原则" class="headerlink" title="Maven依赖的优先原则"></a>Maven依赖的优先原则</h1><p>使用<code>Maven</code>的程序员都会遇到一个问题，那就是<code>Maven</code>依赖冲突的问题，这会导致<code>ClassNotFound</code>或者<code>MethodNotFound</code>这样的异常。其实只要明白<code>Maven</code>依赖的根本性的原则就不怕这样的问题了。</p>
<h2 id="依赖路径最短优先"><a href="#依赖路径最短优先" class="headerlink" title="依赖路径最短优先"></a>依赖路径最短优先</h2><p>一个Demo项目依赖了两个<code>jar</code>包，其中<code>A-B-C-X(1.0)</code>，<code>A-D-X(2.0)</code>。由于<code>X(2.0)</code>路径最短，所以项目使用的是<code>X(2.0)</code>。</p>
<h2 id="申明顺序优先"><a href="#申明顺序优先" class="headerlink" title="申明顺序优先"></a>申明顺序优先</h2><p>如果<code>A-B-X(1.0)</code>，<code>A-C-X(2.0)</code> 这样的路径长度一样怎么办呢？这样的情况下，<code>maven</code>会根据<code>pom</code>文件声明的顺序加载，如果先声明了<code>B</code>，后声明了<code>C</code>，那就最后的依赖就会是<code>X(1.0)</code>。</p>
<div class="note no-icon success"><p>所以maven依赖原则总结起来就两条：<code>路径最短，申明顺序其次。</code></p>
</div>

<hr>
<h1 id="Final"><a href="#Final" class="headerlink" title="Final"></a>Final</h1><p>Maven POM 体积庞大。不过，它的大小也证明了它的多功能性。</p>
<p>至少可以说，将项目的所有方面抽象为单个工件的能力是强大的。 每个项目都有数十个不同的构建脚本和分散的文档的日子已经一去不复返了。</p>
<p>与 Maven 一起组成 Maven 星系的其他明星—定义明确的构建生命周期、易于编写和维护的插件、集中式存储库、系统范围和基于用户的配置，以及越来越多的工具来完成开发人员的工作 更容易维护复杂的项目 - POM 是大而明亮的中心。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/21/Pandas%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/21/Pandas%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">Pandas教程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-21 11:00:04" itemprop="dateCreated datePublished" datetime="2023-08-21T11:00:04+08:00">2023-08-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-05 16:57:12" itemprop="dateModified" datetime="2023-09-05T16:57:12+08:00">2023-09-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>pandas 是一个 Python 包，它提供快速、灵活且富有表现力的数据结构，旨在使“关系”或“标记”数据的处理变得简单直观。 它的目标是成为用 Python 进行实际、真实世界数据分析的基本高级构建块。 此外，它还有更广泛的目标，即成为任何语言中最强大、最灵活的开源数据分析/操作工具。 它已经在朝着这个目标前进。</p>
<p>pandas 非常适合下列这些类型的数据：</p>
<ul>
<li>具有异构类型列的表格数据，如 SQL 表或 Excel 电子表格</li>
<li>有序和无序（不一定是固定频率）时间序列数据</li>
<li>带有行和列标签的任意矩阵数据（同质类型或异构）</li>
<li>任何其他形式的观察/统计数据集。数据根本不需要被标记就可以放入 pandas 数据结构中</li>
</ul>
<h1 id="主要特点"><a href="#主要特点" class="headerlink" title="主要特点"></a>主要特点</h1><p>pandas 的两种主要数据结构<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.html#pandas.Series"><code>Series</code></a>（一维）和<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame"><code>DataFrame</code></a>（二维）处理金融、统计、社会科学和许多工程领域的绝大多数典型用例。对于 R 用户，<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame"><code>DataFrame</code></a>提供 R <code>data.frame</code>提供的一切以及更多。<a target="_blank" rel="noopener" href="https://numpy.org/">pandas 构建在NumPy</a>之上，旨在与许多其他第三方库在科学计算环境中良好集成。</p>
<p>以下是 <code>pandas</code> 擅长的一些事情：</p>
<ul>
<li>轻松处理浮点和非浮点数据中的缺失数据（表示为 <code>NaN</code>、<code>NA</code>或<code>NaT</code>）</li>
<li>大小可变性：可以从 <code>DataFrame</code> 和更高维对象中插入和删除列</li>
<li>自动和精确的数据对齐：对象可以准确地与一组数据对齐，或者用户可以简单地忽略数据并让<code>Series</code>、<code>DataFrame</code>等在计算中自动为您对齐数据</li>
<li>强大、灵活的分组功能，可对数据集执行拆分-应用-组合操作，以聚合和转换数据</li>
<li>可以轻松地将其他 <code>Python</code> 和 <code>NumPy</code> 数据结构中的不规则、不同索引的数据转换为 <code>DataFrame</code> 对象</li>
<li>基于智能标签的切片、高级索引和大数据集的子集</li>
<li>直观的合并和连接数据集</li>
<li>灵活的重塑和翻转数据集</li>
<li>坐标轴的分层标签（每个刻度可能有多个标签）</li>
<li>强大的<code>IO</code>工具，用于从平面文件<code>(CSV and delimited</code>)、<code>Excel</code>文件、数据集以及从超快<code>HDF5</code>格式保存或加载的数据</li>
</ul>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>pandas 可以通过<a target="_blank" rel="noopener" href="https://pypi.org/project/pandas">PyPI</a>中的 pip 安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pandas</span><br></pre></td></tr></table></figure>

<h1 id="pandas-处理什么样的数据？"><a href="#pandas-处理什么样的数据？" class="headerlink" title="pandas 处理什么样的数据？"></a>pandas 处理什么样的数据？</h1><h2 id="导包"><a href="#导包" class="headerlink" title="导包"></a>导包</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>

<h2 id="pandas-数据表表示"><a href="#pandas-数据表表示" class="headerlink" title="pandas 数据表表示"></a>pandas 数据表表示</h2><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/table_dataframe.png" style="zoom: 50%;" />

<p>示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.DataFrame(</span><br><span class="line">    &#123;<span class="string">&quot;Name&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">            <span class="string">&quot;李四&quot;</span>,</span><br><span class="line">            <span class="string">&quot;王五&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;Age&quot;</span>: [<span class="number">22</span>, <span class="number">24</span>, <span class="number">26</span>],</span><br><span class="line">        <span class="string">&quot;Sex&quot;</span>: [<span class="string">&quot;男&quot;</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;女&quot;</span>],</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    print(df)</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/dataframe_print.png" style="zoom:50%;" />

<p>在电子表格软件中，我们数据的表格表示看起来非常相似：</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/df_excel.png" style="zoom:50%;" />

<h2 id="DataFrame中每一列都是一个-Series"><a href="#DataFrame中每一列都是一个-Series" class="headerlink" title="DataFrame中每一列都是一个 Series"></a>DataFrame中每一列都是一个 Series</h2><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/01_table_series.png" style="zoom:50%;" />

<p>如果只对<code>Name</code>这一列的数据感兴趣：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pring(df[<span class="string">&quot;Age&quot;</span>])</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0    22</span><br><span class="line">1    24</span><br><span class="line">2    26</span><br><span class="line">Name: Age, dtype: int64</span><br></pre></td></tr></table></figure>

<p>当选择<code>DataFrame</code>中的单列时，结果是 <code>Series</code>。要选择列，请使用方括号之间的列标签<code>[]</code>。</p>
<p>创建<code>Series</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ages = pd.Series([<span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>], name=<span class="string">&quot;Age&quot;</span>)</span><br><span class="line">print(ages)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0    20</span><br><span class="line">1    30</span><br><span class="line">2    40</span><br><span class="line">Name: Age, dtype: int64</span><br></pre></td></tr></table></figure>

<h2 id="使用-DataFrame-或-Series-做一些事情"><a href="#使用-DataFrame-或-Series-做一些事情" class="headerlink" title="使用 DataFrame 或 Series 做一些事情"></a>使用 DataFrame 或 Series 做一些事情</h2><p>我想知道谁的年龄最大？</p>
<p><code>DataFrame</code>我们可以通过选择<code>Age</code>列并应用<code>max()</code>函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ages = pd.Series([<span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>], name=<span class="string">&quot;Age&quot;</span>)</span><br><span class="line">print(ages.<span class="built_in">max</span>())</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">40</span><br></pre></td></tr></table></figure>

<p><code>DataFrame</code>和<code>Series</code>还有许多其他函数供我们使用，可以通过下面链接进行查看。</p>
<p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/docs/reference/series.html">Series</a></p>
<p><a target="_blank" rel="noopener" href="https://pandas.pydata.org/docs/reference/frame.html">DataFrame</a></p>
<p>假如我们只对数据表的数值数据的一些基本统计感兴趣：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(df.describe())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">        Age</span><br><span class="line">count   3.0</span><br><span class="line">mean   24.0</span><br><span class="line">std     2.0</span><br><span class="line">min    22.0</span><br><span class="line">25%    23.0</span><br><span class="line">50%    24.0</span><br><span class="line">75%    25.0</span><br><span class="line">max    26.0</span><br></pre></td></tr></table></figure>

<p><code>describe()</code> 方法可快速浏览 <code>DataFrame</code> 中的数字数据。由于<code>Name</code>和<code>Sex</code>列是文本数据，因此 <code>describe()</code> 方法默认不考虑这两列。</p>
<hr>
<h1 id="如何读写表格数据？"><a href="#如何读写表格数据？" class="headerlink" title="如何读写表格数据？"></a>如何读写表格数据？</h1><p>数据集：</p>
<p>本教程使用<a target="_blank" rel="noopener" href="https://www.kaggle.com/datasets/uciml/adult-census-income?resource=download">成人人口普查收入</a>数据集，存储为 <code>csv 文件</code>。如下所示:</p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/dataframe_dataset.png"></p>
<p><code>Pandas</code>提供了<code>read_csv()</code>函数将Excel文件读取为<code>DataFrame</code>对象。</p>
<p><code>pandas</code> 支持许多不同的文件格式或开箱即用的数据源（<code>csv</code>、<code>excel</code>、<code>sql</code>、<code>json</code>、<code>parquet</code>…），读取每个文件格式或数据源都使用带有前缀<code>read_*</code>的函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adult = pd.read_csv(<span class="string">&quot;data/adult.csv&quot;</span>)</span><br><span class="line">print(adult)</span><br></pre></td></tr></table></figure>

<p>Out：</p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/read_excel.png"></p>
<p>请确保读完数据之后总是有一个数据检查。显示 <code>DataFrame</code> 时，默认显示前 5 行和后 5 行。</p>
<p>要查看 DataFrame 的前 N 行，请使用该 <code>head()</code> 方法并以所需的行数作为参数。</p>
<p>我想查看 <code>pandas</code> <code>DataFrame</code> 的前 8 行。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult.head(<span class="number">8</span>))</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   age  workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">0   90          ?   77053  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">1   82    Private  132870  ...             18   United-States  &lt;&#x3D;50K</span><br><span class="line">2   66          ?  186061  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">3   54    Private  140359  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">4   41    Private  264663  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">5   34    Private  216864  ...             45   United-States  &lt;&#x3D;50K</span><br><span class="line">6   38    Private  150601  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">7   74  State-gov   88638  ...             20   United-States   &gt;50K</span><br></pre></td></tr></table></figure>

<p>对最后 N 行感兴趣吗？pandas也提供了一种  <code>tail() </code>方法。例如，<code>adult.tail(10)</code>将返回 <code>DataFrame</code> 的最后 10 行。</p>
<p>可以通过请求 <code>pandas</code>  <code>dtypes</code> 属性来检查 <code>pandas</code> 如何解释每个列数据类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult.dtypes)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">age                int64</span><br><span class="line">workclass         object</span><br><span class="line">fnlwgt             int64</span><br><span class="line">education         object</span><br><span class="line">education.num      int64</span><br><span class="line">marital.status    object</span><br><span class="line">occupation        object</span><br><span class="line">relationship      object</span><br><span class="line">race              object</span><br><span class="line">sex               object</span><br><span class="line">capital.gain       int64</span><br><span class="line">capital.loss       int64</span><br><span class="line">hours.per.week     int64</span><br><span class="line">native.country    object</span><br><span class="line">income            object</span><br><span class="line">dtype: object</span><br></pre></td></tr></table></figure>

<p>对于每一列，都会列出所使用的数据类型。其中的数据类型<code>DataFrame</code>为整数 ( <code>int64</code>)和字符串 ( <code>object</code>)。</p>
<p>将<code>DataFrame</code>保存为Excel文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adult.to_excel(&quot;adult.xlsx&quot;, sheet_name&#x3D;&quot;person&quot;, index&#x3D;False)</span><br></pre></td></tr></table></figure>

<p><code> read_*</code>函数常用于读取函数到<code>Pandas</code>中，而<code>to_*</code>函数常用于存储数据。</p>
<p>该<code>to_excel()</code>方法将数据存储为 <code>Excel</code> 文件。在此示例中，<code>sheet_name</code>名为<em>“person”</em>而不是默认的<em>“Sheet1”</em>。通过设置 <code>index=False</code>行索引标签不会保存在电子表格中。</p>
<p>读取函数<code>read_excel()</code>会将数据重新加载到 <code>DataFrame</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adult = pd.read_excel(<span class="string">&quot;adult.xlsx&quot;</span>)</span><br><span class="line">print(adult)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">       age workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">0       90         ?   77053  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">1       82   Private  132870  ...             18   United-States  &lt;&#x3D;50K</span><br><span class="line">2       66         ?  186061  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">3       54   Private  140359  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">4       41   Private  264663  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">...    ...       ...     ...  ...            ...             ...    ...</span><br><span class="line">32556   22   Private  310152  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">32557   27   Private  257302  ...             38   United-States  &lt;&#x3D;50K</span><br><span class="line">32558   40   Private  154374  ...             40   United-States   &gt;50K</span><br><span class="line">32559   58   Private  151910  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">32560   22   Private  201490  ...             20   United-States  &lt;&#x3D;50K</span><br></pre></td></tr></table></figure>

<p>我对 <code>DataFrame</code> 的技术摘要感兴趣</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult.info())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span><br><span class="line">RangeIndex: 32561 entries, 0 to 32560</span><br><span class="line">Data columns (total 15 columns):</span><br><span class="line"> #   Column          Non-Null Count  Dtype </span><br><span class="line">---  ------          --------------  ----- </span><br><span class="line"> 0   age             32561 non-null  int64 </span><br><span class="line"> 1   workclass       32561 non-null  object</span><br><span class="line"> 2   fnlwgt          32561 non-null  int64 </span><br><span class="line"> 3   education       32561 non-null  object</span><br><span class="line"> 4   education.num   32561 non-null  int64 </span><br><span class="line"> 5   marital.status  32561 non-null  object</span><br><span class="line"> 6   occupation      32561 non-null  object</span><br><span class="line"> 7   relationship    32561 non-null  object</span><br><span class="line"> 8   race            32561 non-null  object</span><br><span class="line"> 9   sex             32561 non-null  object</span><br><span class="line"> 10  capital.gain    32561 non-null  int64 </span><br><span class="line"> 11  capital.loss    32561 non-null  int64 </span><br><span class="line"> 12  hours.per.week  32561 non-null  int64 </span><br><span class="line"> 13  native.country  32561 non-null  object</span><br><span class="line"> 14  income          32561 non-null  object</span><br><span class="line">dtypes: int64(6), object(9)</span><br><span class="line">memory usage: 3.7+ MB</span><br></pre></td></tr></table></figure>

<p><code>info()</code>方法提供了有关 <code>DataFrame</code> 的技术信息 ，因此让我们对输出作出更详细地解释：</p>
<ul>
<li>它确实是一个<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html#pandas.DataFrame"><code>DataFrame</code></a></li>
<li>有 32561 个<code>entries</code>，即 32561 行</li>
<li>每行都有一个行标签（也称为<code>index</code>），其值范围为 0 到 32560</li>
<li>该表有 15列。大多数列的每一行都有一个值（所有 32561 个值都是<code>non-null</code>）</li>
<li><code>workclass</code> <code>education</code> <code>marital.status</code> <code>occupation</code> <code>relationship</code>  <code>race</code> <code>sex</code> <code>native.country</code> <code>income</code>列都是由文本数据组成（String 又称 Object）</li>
<li>其他列是数值数据，其中一些是整数（又名<code>integer</code>）</li>
<li>不同列中的数据类型（字符、整数……）通过<code>dtypes</code>列出</li>
<li>还提供了用于保存 DataFrame 的大致 RAM </li>
</ul>
<hr>
<h1 id="选择DataFrame的子集"><a href="#选择DataFrame的子集" class="headerlink" title="选择DataFrame的子集"></a>选择DataFrame的子集</h1><h2 id="如何选择DataFrame的特定列？"><a href="#如何选择DataFrame的特定列？" class="headerlink" title="如何选择DataFrame的特定列？"></a>如何选择DataFrame的特定列？</h2><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/03_subset_columns.png" style="zoom:50%;" />

<p>假如我们只对<code>Age</code>感兴趣:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adult = pd.read_excel(<span class="string">&quot;adult.xlsx&quot;</span>)</span><br><span class="line">adult_subset = adult.head()</span><br><span class="line">print(adult_subset[<span class="string">&quot;age&quot;</span>])</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0    90</span><br><span class="line">1    82</span><br><span class="line">2    66</span><br><span class="line">3    54</span><br><span class="line">4    41</span><br><span class="line">Name: age, dtype: int64</span><br></pre></td></tr></table></figure>

<p><code>DataFrame</code> 中的每一列都是一个<code>Series</code>。当选择单个列时，返回的对象是 <code>pandas Series</code>。我们可以通过检查输出的类型来验证这一点：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="built_in">type</span>(adult[<span class="string">&quot;age&quot;</span>]))</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#39;pandas.core.series.Series&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>看看<code>shape</code>输出：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult[<span class="string">&quot;age&quot;</span>].shape)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(5,)</span><br></pre></td></tr></table></figure>

<p><code>DataFrame.shape</code>是 <code>Series</code>、<code>DataFram</code> 的一个属性。<code>DataFrame</code>包含行数和列数：(nrows, ncolumns)。pandas <code>Series</code> 是一维的，仅返回行数。</p>
<p>假如对年龄和性别感兴趣：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">age_sex = adult[[<span class="string">&quot;age&quot;</span>, <span class="string">&quot;sex&quot;</span>]]</span><br><span class="line">print(age_sex)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   age     sex</span><br><span class="line">0   90  Female</span><br><span class="line">1   82  Female</span><br><span class="line">2   66  Female</span><br><span class="line">3   54  Female</span><br><span class="line">4   41  Female</span><br></pre></td></tr></table></figure>

<div class="note success no-icon"><p>要选择多个列，请在选择括号内使用列名称列表<code>[]</code>。</p>
</div>



<p>返回的数据类型是 <code>pandas DataFrame</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="built_in">type</span>(age_sex))</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>In:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(age_sex.shape)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(5, 2)</span><br></pre></td></tr></table></figure>

<p>返回的<code>DataFrame</code>具有5 行 2 列。</p>
<hr>
<h2 id="如何选择DataFrame的特定行？"><a href="#如何选择DataFrame的特定行？" class="headerlink" title="如何选择DataFrame的特定行？"></a>如何选择DataFrame的特定行？</h2><p>假如对 60岁以上的客户感兴趣。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult[adult[<span class="string">&quot;age&quot;</span>] &gt; <span class="number">60</span>])</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">   age workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">0   90         ?   77053  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">1   82   Private  132870  ...             18   United-States  &lt;&#x3D;50K</span><br><span class="line">2   66         ?  186061  ...             40   United-States  &lt;&#x3D;50K</span><br></pre></td></tr></table></figure>

<p>括号内的条件 <code>adult[&quot;age&quot;] &gt; 60</code> 检查哪些行 <code>Age</code> 列的值大于 60：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult[<span class="string">&quot;age&quot;</span>] &gt; <span class="number">60</span>)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0     True</span><br><span class="line">1     True</span><br><span class="line">2     True</span><br><span class="line">3    False</span><br><span class="line">4    False</span><br><span class="line">Name: age, dtype: bool</span><br></pre></td></tr></table></figure>

<p>条件表达式（也可以是 <code>==</code>, <code>!=</code>, <code>&lt;</code>, <code>&lt;=</code>,… ）的输出实际上是一组<code>pandas Series</code>的布尔值（<code>True</code>或<code>False</code>），</p>
<p>其行数与原始 <code>DataFrame</code> 相同 。这样的一系列布尔值可用于将其放在选择括号 [] 之间来过滤 DataFrame， 仅选择值为 <code>True</code> 的行。</p>
<p>假如我们只对<code>native.country</code>是<code>China</code>和<code>India</code>的用户感兴趣。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">country = adult[adult[<span class="string">&quot;native.country&quot;</span>].isin([<span class="string">&quot;China&quot;</span>, <span class="string">&quot;India&quot;</span>])]</span><br><span class="line">print(country.head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">     age         workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">63    51  Self-emp-not-inc  160724  ...             40           China   &gt;50K</span><br><span class="line">90    39           Private  198654  ...             67           India   &gt;50K</span><br><span class="line">214   42      Self-emp-inc   23510  ...             60           India   &gt;50K</span><br><span class="line">244   64           Private  149044  ...             60           China  &lt;&#x3D;50K</span><br><span class="line">377   30           Private  315640  ...             40           China   &gt;50K</span><br></pre></td></tr></table></figure>

<p>与条件表达式类似，<code>isin()</code> 条件函数为匹配条件列表中的每一行返回 <code>True</code>。要根据此类函数过滤行，请使用括号内的条件函数，括号内的条件函数检查<code>native.country</code>是<code>China</code>或<code>India</code>的行。</p>
<p>与下列等价:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">country = adult[(adult[<span class="string">&quot;native.country&quot;</span>] == <span class="string">&quot;China&quot;</span>) | (adult[<span class="string">&quot;native.country&quot;</span>] == <span class="string">&quot;India&quot;</span>)]</span><br><span class="line">print(country.head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">     age         workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">63    51  Self-emp-not-inc  160724  ...             40           China   &gt;50K</span><br><span class="line">90    39           Private  198654  ...             67           India   &gt;50K</span><br><span class="line">214   42      Self-emp-inc   23510  ...             60           India   &gt;50K</span><br><span class="line">244   64           Private  149044  ...             60           China  &lt;&#x3D;50K</span><br><span class="line">377   30           Private  315640  ...             40           China   &gt;50K</span><br></pre></td></tr></table></figure>

<div class="note success no-icon"><p>组合多个条件语句时，每个条件必须用括号 <code style="color:red;font-family:bold">()</code> 括起来。 而且，不能使用<code style="color:red;font-family:bold"> or </code>或<code style="color:red;font-family:bold"> and </code>，而需要使用或运算符<code style="color:red;font-family:bold">  | </code>以及与运算符<code style="color:red;font-family:bold">  & </code>。</p>
</div>

<p>假如我们只对年龄已知的用户感兴趣。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adult &#x3D; pd.read_excel(&quot;adult.xlsx&quot;)</span><br><span class="line">age_not_no &#x3D; adult[adult[&quot;age&quot;].notna()]</span><br><span class="line">print(age_not_no.head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   age workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">0   90         ?   77053  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">1   82   Private  132870  ...             18   United-States  &lt;&#x3D;50K</span><br><span class="line">2   66         ?  186061  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">3   54   Private  140359  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">4   41   Private  264663  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line"></span><br><span class="line">[5 rows x 15 columns]</span><br></pre></td></tr></table></figure>

<p><code style="color:red; font-weight: bold">notna() </code>条件函数对于值不是 <code>Null</code> 值的每一行返回 <code>True</code>。 因此，可以结合选择括号<code>[]</code>来过滤数据表。</p>
<h2 id="如何选择DataFrame的特定行和列？"><a href="#如何选择DataFrame的特定行和列？" class="headerlink" title="如何选择DataFrame的特定行和列？"></a>如何选择DataFrame的特定行和列？</h2><p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/03_subset_columns_rows.png"></p>
<p>假如对35 岁以上人员的性别感兴趣。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adult_names = adult.loc[adult[<span class="string">&quot;age&quot;</span>] &gt; <span class="number">35</span>, <span class="string">&quot;sex&quot;</span>]</span><br><span class="line">print(adult_names.head())</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在这种情况下，行和列的子集是一次性生成的，仅使用括号选择<code style="color:red;font-weight:bold"> [] </code>已经不够了。 选择括号<code style="color:red;font-weight:bold"> [] </code>前面需要<code style="color:red;font-weight:bold"> loc/iloc </code>运算符。 使用<code style="color:red;font-weight:bold"> loc/iloc </code>时，逗号之前的部分是您想要选择的行，逗号之后的部分是您想要选择的列。</p>
</blockquote>
<p>使用列名、行标签或条件表达式时，请在选择括号 [] 前面使用 loc 运算符。 对于逗号之前和之后的部分，您可以使用单个标签、标签列表、标签切片、条件表达式或冒号。 使用冒号指定您要选择所有行或列。</p>
<p>假如对第 10 行到第 25 行和第 3 到第 5 列感兴趣。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult.iloc[9:25, 2:5])</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    fnlwgt     education  education.num</span><br><span class="line">9    70037  Some-college             10</span><br><span class="line">10  172274     Doctorate             16</span><br><span class="line">11  164526   Prof-school             15</span><br><span class="line">12  129177     Bachelors             13</span><br><span class="line">13  136204       Masters             14</span><br><span class="line">14  172175     Doctorate             16</span><br><span class="line">15   45363   Prof-school             15</span><br><span class="line">16  172822          11th              7</span><br><span class="line">17  317847       Masters             14</span><br><span class="line">18  119592    Assoc-acdm             12</span><br><span class="line">19  203034     Bachelors             13</span><br><span class="line">20  188774     Bachelors             13</span><br><span class="line">21   77009          11th              7</span><br><span class="line">22   29059       HS-grad              9</span><br><span class="line">23  153870  Some-college             10</span><br><span class="line">24  135285       HS-grad              9</span><br></pre></td></tr></table></figure>

<p>同样，行和列的子集是一次性生成的，仅使用选择括号<code style="color:red;font-weight:bold"> [] </code>已经不够了。 当根据表中的位置对某些行和/或列特别感兴趣时，请在选择括号<code style="color:red;font-weight:bold"> [] </code>前面使用<code style="color:red;font-weight:bold"> iloc </code>运算符。</p>
<p>当使用 loc 或 iloc 选择特定行和/或列时，我们对我们所选的特定行和/或列赋值。 </p>
<p>例如，要将前三行人员的年龄统一改成20：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adult.iloc[<span class="number">0</span>:<span class="number">3</span>, <span class="number">0</span>] = <span class="number">20</span></span><br><span class="line">print(adult.head(<span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   age workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">0   20         ?   77053  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">1   20   Private  132870  ...             18   United-States  &lt;&#x3D;50K</span><br><span class="line">2   20         ?  186061  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">3   54   Private  140359  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">4   41   Private  264663  ...             40   United-States  &lt;&#x3D;50K</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code style="color:red;font-weight:bold">Remember</code>:</p>
<ul>
<li><code style="color:green;font-weight:bold">要选择数据子集时，使用方括号[]。</code></li>
<li><code style="color:green;font-weight:bold">在括号内，您可以使用单个列/行标签、列/行标签列表、标签切片、条件表达式或冒号。</code></li>
<li><code style="color:green;font-weight:bold">通过 loc 使用行名和列名选择特定的行和列。</code></li>
<li><code style="color:green;font-weight:bold">通过 iloc 使用坐标轴位置选择特定的行和列。</code></li>
<li><code style="color:green;font-weight:bold">你可以为 loc 或 iloc 选择的行或列赋新值。</code></li>
</ul>
</blockquote>
<hr>
<h1 id="如何在-pandas-中创建绘图？"><a href="#如何在-pandas-中创建绘图？" class="headerlink" title="如何在 pandas 中创建绘图？"></a>如何在 pandas 中创建绘图？</h1><p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/04_plot_overview.png"></p>
<p>导入相关类库：</p>
<p>本教程使用的数据：<a target="_blank" rel="noopener" href="https://github.com/pandas-dev/pandas/blob/main/doc/data/air_quality_no2.csv">空气质量数据</a></p>
<p>在本教程中，使用了有关的空气质量数据，这些数据由 <code>OpenAQ</code> 提供并使用 py-openaq 包。 <code>air_quality_no2.csv</code> 数据集提供了分别位于巴黎、安特卫普和伦敦的测量站 FR04014、BETR801 和伦敦威斯敏斯特的值。</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/air_quilty_data.png" style="zoom:50%;" />

<p>读取数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">air_quality = pd.read_csv(<span class="string">&quot;data/air_quality_no2.csv&quot;</span>, index_col=<span class="number">0</span>, parse_dates=<span class="literal">True</span>)</span><br><span class="line">print(air_quality.head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                     station_antwerp  station_paris  station_london</span><br><span class="line">datetime                                                           </span><br><span class="line">2019-05-07 02:00:00              NaN            NaN            23.0</span><br><span class="line">2019-05-07 03:00:00             50.5           25.0            19.0</span><br><span class="line">2019-05-07 04:00:00             45.0           27.7            19.0</span><br><span class="line">2019-05-07 05:00:00              NaN           50.4            16.0</span><br><span class="line">2019-05-07 06:00:00              NaN           61.9             NaN</span><br></pre></td></tr></table></figure>

<p><code>read_csv</code> 函数的 <code>index_col</code>参数表示将第一（第 0）列定义为结果 <code>DataFrame</code> 的索引。</p>
<p><code>read_csv</code> 函数的 <code>parse_dates</code>参数表示将列中的日期转换为 <code>Timestamp</code> 对象。</p>
<p>通过视图快速的检查数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">air_quality = pd.read_csv(<span class="string">&quot;data/air_quality_no2.csv&quot;</span>, index_col=<span class="number">0</span>, parse_dates=<span class="literal">True</span>)</span><br><span class="line">air_quality.plot()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/matplot_air.png"></p>
<p><code>pandas</code> 默认为<code>DataFrame</code>包含数字的每一列数创建一个线图。</p>
<p>我只想用巴黎的数据列绘制图形。</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/station_pairs_draw.png" style="zoom:50%;" />

<p>我想直观地比较NO2在伦敦和巴黎测量的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">air_quality.plot.scatter(x=<span class="string">&quot;station_london&quot;</span>, y=<span class="string">&quot;station_paris&quot;</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/matlab_scatter_plot.png" style="zoom:50%;" />

<p>除了使用绘图功能时的默认线图之外，还可以使用许多其他图形来绘制数据。</p>
<p>绘图方法允许使用除默认线图之外的多种绘图样式，可以通过<code>plot()</code>方法的<code>kind</code>参数进行设置:</p>
<ul>
<li><code style="color:red;font-weight:bold">"bar" </code>或<code style="color:red;font-weight:bold"> "barh" </code>绘制柱状图</li>
<li><code style="color:red;font-weight:bold">"hist" </code>绘制直方图</li>
<li><code style="color:red;font-weight:bold"> "box" </code>绘制箱形图</li>
<li><code style="color:red;font-weight:bold"> "kde" </code>或<code style="color:red;font-weight:bold"> "density" </code>绘制密度图</li>
<li><code style="color:red;font-weight:bold"> "area" </code>绘制面积图</li>
<li><code style="color:red;font-weight:bold"> "scatter" </code>绘制散点图</li>
<li><code style="color:red;font-weight:bold"> "hexbin" </code>绘制六边形箱图</li>
<li> <code style="color:red;font-weight:bold"> "pie" </code>绘制饼状图</li>
</ul>
<p>例如，可以通过以下方式创建箱线图：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">air_quality.plot.box()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/air_quality_plot_box.png" style="zoom:50%;" />

<p>我希望每一列都在一个单独的子图中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">axs = air_quality.plot.area(figsize=(<span class="number">12</span>, <span class="number">4</span>), subplots=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/air_quality_subplots.png" style="zoom:50%;" />

<p>我想进一步定制、扩展或保存结果图。</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/plt_subplots.png" style="zoom:50%;" />

<p><code>pandas</code> 创建的每个绘图对象都是 <a target="_blank" rel="noopener" href="https://matplotlib.org/">Matplotlib</a>对象。由于 <code>Matplotlib</code> 提供了大量的选项来自定义绘图，因此使 <code>pandas</code> 和 <code>Matplotlib</code> 之间的关联显式化，从而可以将 Matplotlib 的所有功能发挥到绘图上。</p>
<hr>
<h1 id="如何从现有列创建新列"><a href="#如何从现有列创建新列" class="headerlink" title="如何从现有列创建新列"></a>如何从现有列创建新列</h1><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/05_newcolumn_1.png" style="zoom:50%;" />

<p>教程数据如下：</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/market_sales_excel.png" style="zoom:50%;" />

<p>假设我们想在表格中新增一列表示所有商场第一季度的收入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">market_sales[<span class="string">&quot;first_season_sales&quot;</span>] = market_sales.iloc[:, <span class="number">0</span>:<span class="number">4</span>].<span class="built_in">sum</span>(axis=<span class="number">1</span>)</span><br><span class="line">print(market_sales)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        sales_01  sales_02  sales_03  sales_04  first_season_sales</span><br><span class="line">market                                                            </span><br><span class="line">沃尔玛        10000     30000     80000     60000              180000</span><br><span class="line">家乐福        20000     20000     20000     20000               80000</span><br><span class="line">好又多        30000     50000     10000     10000              100000</span><br><span class="line">大润发        40000     60000     50000     30000              180000</span><br><span class="line">华润万家       50000     40000     60000     20000              170000</span><br><span class="line">永辉         60000     10000     20000     10000              100000</span><br></pre></td></tr></table></figure>

<p>其他数学运算符（+、-、*、/、…）或逻辑运算符（&lt;、&gt;、==、…）也按此逻辑工作。</p>
<p>如果您需要更高级的逻辑，您可以通过<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html#pandas.DataFrame.apply"><code>apply()</code></a>.</p>
<p>如果你想对某些列名进行重命名操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">renamed_market_sales = market_sales.rename(</span><br><span class="line">        columns=&#123;</span><br><span class="line">          </span><br><span class="line">            <span class="string">&quot;sales_01&quot;</span>: <span class="string">&quot;SALES_FIRST_MONTH&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sales_02&quot;</span>: <span class="string">&quot;SALES_SECOND_MONTH&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sales_03&quot;</span>: <span class="string">&quot;SALES_THIRD_MONTH&quot;</span>,</span><br><span class="line">            <span class="string">&quot;sales_04&quot;</span>: <span class="string">&quot;SALES_FOURTH_MONTH&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    )</span><br><span class="line">print(renamed_market_sales)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        SALES_FIRST_MONTH  ...  SALES_FOURTH_MONTH</span><br><span class="line">market                     ...                    </span><br><span class="line">沃尔玛                 10000  ...               60000</span><br><span class="line">家乐福                 20000  ...               20000</span><br><span class="line">好又多                 30000  ...               10000</span><br><span class="line">大润发                 40000  ...               30000</span><br><span class="line">华润万家                50000  ...               20000</span><br><span class="line">永辉                  60000  ...               10000</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>rename()</code> 函数可用于行和列。 你需要提供一个字典，其中包含当前名称的键和新名称的值，以更新相应的名称。</p>
</blockquote>
<p>映射不应仅限于固定名称，也可以是映射函数。 例如，也可以使用函数将列名转换为小写字母：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">renamed_market_sales = renamed_market_sales.rename(columns=<span class="built_in">str</span>.lower)</span><br><span class="line">print(renamed_market_sales)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">        sales_first_month  ...  sales_fourth_month</span><br><span class="line">market                     ...                    </span><br><span class="line">沃尔玛                 10000  ...               60000</span><br><span class="line">家乐福                 20000  ...               20000</span><br><span class="line">好又多                 30000  ...               10000</span><br><span class="line">大润发                 40000  ...               30000</span><br><span class="line">华润万家                50000  ...               20000</span><br><span class="line">永辉                  60000  ...               10000</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="如何计算汇总统计数据"><a href="#如何计算汇总统计数据" class="headerlink" title="如何计算汇总统计数据"></a>如何计算汇总统计数据</h1><p>数据集：本教程使用<a target="_blank" rel="noopener" href="https://www.kaggle.com/datasets/uciml/adult-census-income?resource=download">成人人口普查收入</a>数据集。</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/06_aggregate.png" style="zoom:50%;" />

<h2 id="汇总统计数据"><a href="#汇总统计数据" class="headerlink" title="汇总统计数据"></a>汇总统计数据</h2><p>所有人员的平均年龄是多少？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adult = pd.read_excel(<span class="string">&quot;data/adult.xlsx&quot;</span>)</span><br><span class="line">print(adult[<span class="string">&quot;age&quot;</span>].mean())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">38.58164675532078</span><br></pre></td></tr></table></figure>

<p>可以使用不同的统计数据，并将其应用于具有数值数据的列。 一般情况下，操作会排除缺失数据并默认跨行(按列)操作。</p>
<p>我们可以使用<code>median</code>函数来计算一系列数值的中位数。这个函数可以用于计算 <code>Series</code> 或 <code>DataFrame</code> 对象中的中位数。：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adult = pd.read_excel(<span class="string">&quot;data/adult.xlsx&quot;</span>)</span><br><span class="line">print(adult[[<span class="string">&quot;age&quot;</span>, <span class="string">&quot;hours.per.week&quot;</span>]].median())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">age               37.0</span><br><span class="line">hours.per.week    40.0</span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<p>可以使用 <code>DataFrame.agg()</code> 方法定义给定列的聚合统计信息的特定组合，而不是预定义的统计信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">              age  hours.per.week</span><br><span class="line"><span class="built_in">min</span>     <span class="number">17.000000</span>        <span class="number">1.000000</span></span><br><span class="line"><span class="built_in">max</span>     <span class="number">90.000000</span>       <span class="number">99.000000</span></span><br><span class="line">median  <span class="number">37.000000</span>       <span class="number">40.000000</span></span><br><span class="line">skew     <span class="number">0.558743</span>        <span class="number">0.227643</span></span><br></pre></td></tr></table></figure>

<h2 id="聚合统计数据并按类别分组"><a href="#聚合统计数据并按类别分组" class="headerlink" title="聚合统计数据并按类别分组"></a>聚合统计数据并按类别分组</h2><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/06_groupby.png" style="zoom:50%;" />

<p>统计所有男性和女性的平均年龄是多少？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult[[<span class="string">&quot;age&quot;</span>, <span class="string">&quot;sex&quot;</span>]].groupby(<span class="string">&quot;sex&quot;</span>).mean())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">              age</span><br><span class="line">sex              </span><br><span class="line">Female  36.858230</span><br><span class="line">Male    39.433547</span><br></pre></td></tr></table></figure>

<p>由于我们感兴趣的是每个性别的平均年龄，因此首先对这两列进行子选择：<code>titanic[[&quot;Sex&quot;, &quot;Age&quot;]]</code>。 接下来，对 “Sex” 列应用 <code>groupby()</code> 方法，为每个类别创建一个组。 计算并返回每个性别组的平均年龄。</p>
<p>如果我们只对每个性别的平均年龄感兴趣，则分组数据也支持列的选择（像往常一样的矩形括号 []）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult.groupby(<span class="string">&quot;sex&quot;</span>)[<span class="string">&quot;age&quot;</span>].mean())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sex</span><br><span class="line">Female    36.858230</span><br><span class="line">Male      39.433547</span><br><span class="line">Name: age, dtype: float64</span><br></pre></td></tr></table></figure>

<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/06_groupby_select_detail.png" style="zoom:50%;" />

<h2 id="按类别统计记录数"><a href="#按类别统计记录数" class="headerlink" title="按类别统计记录数"></a>按类别统计记录数</h2><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/06_valuecounts.png" style="zoom:50%;" />

<p>统计每个性别的人数是多少：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult[<span class="string">&quot;sex&quot;</span>].value_counts())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sex</span><br><span class="line">Female    10771</span><br><span class="line">Male      21790</span><br><span class="line">Name: count, dtype: int64</span><br></pre></td></tr></table></figure>

<p>该函数是一个快捷方式，因为它实际上是一个 groupby 操作，并结合了每组内记录数的计数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(adult.groupby(<span class="string">&quot;sex&quot;</span>)[<span class="string">&quot;sex&quot;</span>].count())</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>size</code>和两者都<code>count</code>可以与 结合使用 <code>groupby</code>。而<code>size</code>包含<code>NaN</code>值并仅提供行数（表的大小），<code>count</code>排除缺失值。在该<code>value_counts</code>方法中，使用<code>dropna</code>参数来包含或排除<code>NaN</code>值。</p>
</blockquote>
<hr>
<h1 id="如何重塑表格布局"><a href="#如何重塑表格布局" class="headerlink" title="如何重塑表格布局"></a>如何重塑表格布局</h1><p>让我们使用<a target="_blank" rel="noopener" href="https://github.com/pandas-dev/pandas/blob/main/doc/data/air_quality_long.csv">空气质量数据集</a>的一小部分。我们专注于 <code>NO2</code>数据并仅使用每个位置的前两个测量值。数据子集将被称为<code>no2_subset</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">air_quality = pd.read_csv(</span><br><span class="line">	<span class="string">&quot;data/air_quality_long.csv&quot;</span>, index_col=<span class="string">&quot;date.utc&quot;</span>, parse_dates=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line">print(air_quality.head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                                city country location parameter  value   unit</span><br><span class="line">date.utc                                                                     </span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-18</span> <span class="number">06</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>  Antwerpen      BE  BETR801      pm25   <span class="number">18.0</span>  µg/m³</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-17</span> <span class="number">08</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>  Antwerpen      BE  BETR801      pm25    <span class="number">6.5</span>  µg/m³</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-17</span> <span class="number">07</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>  Antwerpen      BE  BETR801      pm25   <span class="number">18.5</span>  µg/m³</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-17</span> <span class="number">06</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>  Antwerpen      BE  BETR801      pm25   <span class="number">16.0</span>  µg/m³</span><br><span class="line"><span class="number">2019</span><span class="number">-06</span><span class="number">-17</span> <span class="number">05</span>:<span class="number">00</span>:<span class="number">00</span>+<span class="number">00</span>:<span class="number">00</span>  Antwerpen      BE  BETR801      pm25    <span class="number">7.5</span>  µg/m³</span><br></pre></td></tr></table></figure>

<p>空气质量数据集包含以下列：</p>
<ul>
<li>city：使用传感器的城市，巴黎、安特卫普或伦敦</li>
<li>国家：使用传感器的国家，FR、BE 或 GB</li>
<li>location：传感器的 ID，<em>FR04014</em>、<em>BETR801</em>或 <em>伦敦威斯敏斯特</em></li>
<li>参数：传感器测量的参数，或者NO2 或颗粒物</li>
<li>value：测量值</li>
<li>单位：测量参数的单位，在本例中为“μg/m³”</li>
</ul>
<p><code>DataFrame</code>的索引是<code>datetime</code>测量的日期时间。</p>
<h2 id="对表行进行排序"><a href="#对表行进行排序" class="headerlink" title="对表行进行排序"></a>对表行进行排序</h2><p>根据年龄对表格数据进行排序</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adult = pd.read_excel(<span class="string">&quot;adult.xlsx&quot;</span>)</span><br><span class="line">print(adult.sort_values(<span class="string">&quot;age&quot;</span>).head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">       age workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">4159    17   Private  130125  ...             20   United-States  &lt;&#x3D;50K</span><br><span class="line">18810   17   Private  187308  ...             15   United-States  &lt;&#x3D;50K</span><br><span class="line">25709   17   Private  153021  ...             20   United-States  &lt;&#x3D;50K</span><br><span class="line">6046    17         ?  103810  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">8682    17         ?  127003  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line"></span><br><span class="line">[5 rows x 15 columns]</span><br></pre></td></tr></table></figure>

<p>根据年龄和受教育等级对所有人员进行排序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adult_sorted = adult.sort_values(by=[<span class="string">&quot;age&quot;</span>, <span class="string">&quot;education.num&quot;</span>], ascending=<span class="literal">False</span>).head()</span><br><span class="line">print(adult_sorted)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">       age  workclass  fnlwgt  ... hours.per.week  native.country income</span><br><span class="line">1742    90    Private   87372  ...             72   United-States   &gt;50K</span><br><span class="line">1739    90  Local-gov  227796  ...             60   United-States   &gt;50K</span><br><span class="line">8914    90    Private   51744  ...             50   United-States   &gt;50K</span><br><span class="line">20621   90    Private  115306  ...             40   United-States  &lt;&#x3D;50K</span><br><span class="line">22166   90    Private  206667  ...             40   United-States   &gt;50K</span><br><span class="line"></span><br><span class="line">[5 rows x 15 columns]</span><br></pre></td></tr></table></figure>

<p>使用 <code>DataFrame.sort_values()</code>，表中的行根据定义的列进行排序。 索引将遵循行顺序。</p>
<h2 id="从长到宽的表格格式"><a href="#从长到宽的表格格式" class="headerlink" title="从长到宽的表格格式"></a>从长到宽的表格格式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">air_quality = pd.read_csv(</span><br><span class="line">	<span class="string">&quot;data/air_quality_long.csv&quot;</span>, index_col=<span class="string">&quot;date.utc&quot;</span>, parse_dates=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"><span class="comment"># filter for no2 data only</span></span><br><span class="line">no2 = air_quality[air_quality[<span class="string">&quot;parameter&quot;</span>] == <span class="string">&quot;no2&quot;</span>]</span><br><span class="line"><span class="comment"># use 2 measurements (head) for each location (groupby)</span></span><br><span class="line">no2_subset = no2.sort_index().groupby([<span class="string">&quot;location&quot;</span>]).head(<span class="number">2</span>)</span><br><span class="line">print(no2_subset)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">                                city country  ... value   unit</span><br><span class="line">date.utc                                      ...             </span><br><span class="line">2019-04-09 01:00:00+00:00  Antwerpen      BE  ...  22.5  µg&#x2F;m³</span><br><span class="line">2019-04-09 01:00:00+00:00      Paris      FR  ...  24.4  µg&#x2F;m³</span><br><span class="line">2019-04-09 02:00:00+00:00     London      GB  ...  67.0  µg&#x2F;m³</span><br><span class="line">2019-04-09 02:00:00+00:00  Antwerpen      BE  ...  53.5  µg&#x2F;m³</span><br><span class="line">2019-04-09 02:00:00+00:00      Paris      FR  ...  27.4  µg&#x2F;m³</span><br><span class="line"></span><br><span class="line">[5 rows x 6 columns]</span><br></pre></td></tr></table></figure>

<p>我希望三个站点的值作为彼此相邻的单独列。（即将某些行转换成列）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(no2_subset.pivot(columns=<span class="string">&quot;location&quot;</span>, values=<span class="string">&quot;value&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location                   BETR801  FR04014  London Westminster</span><br><span class="line">date.utc                                                       </span><br><span class="line">2019-04-09 01:00:00+00:00     22.5     24.4                 NaN</span><br><span class="line">2019-04-09 02:00:00+00:00     53.5     27.4                67.0</span><br><span class="line">2019-04-09 03:00:00+00:00      NaN      NaN                67.0</span><br></pre></td></tr></table></figure>

<h3 id="数据透视表"><a href="#数据透视表" class="headerlink" title="数据透视表"></a>数据透视表</h3><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/07_pivot_table.png" style="zoom:50%;" />

<p>我想要以表格形式获取每个站<code>NO2</code>和<code>PM2.5</code>的平均浓度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">air_quality_mean = air_quality.pivot_table(</span><br><span class="line">	values=<span class="string">&quot;value&quot;</span>, index=<span class="string">&quot;location&quot;</span>, columns=<span class="string">&quot;parameter&quot;</span>, aggfunc=<span class="string">&quot;mean&quot;</span></span><br><span class="line">)</span><br><span class="line">print(air_quality_mean)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">parameter                 no2       pm25</span><br><span class="line">location                                </span><br><span class="line">BETR801             26.950920  23.169492</span><br><span class="line">FR04014             29.374284        NaN</span><br><span class="line">London Westminster  29.740050  13.443568</span><br></pre></td></tr></table></figure>

<p>数据透视表是电子表格软件中众所周知的概念。当对每个变量的行/列边距（小计）感兴趣时，请将参数<code>margins</code>设置为<code>True</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">air_quality_mean = air_quality.pivot_table(</span><br><span class="line">      values=<span class="string">&quot;value&quot;</span>,</span><br><span class="line">      index=<span class="string">&quot;location&quot;</span>,</span><br><span class="line">      columns=<span class="string">&quot;parameter&quot;</span>,</span><br><span class="line">      aggfunc=<span class="string">&quot;mean&quot;</span>,</span><br><span class="line">      margins=<span class="literal">True</span></span><br><span class="line">  )</span><br><span class="line">  print(air_quality_mean)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">parameter                 no2       pm25        All</span><br><span class="line">location                                           </span><br><span class="line">BETR801             26.950920  23.169492  24.982353</span><br><span class="line">FR04014             29.374284        NaN  29.374284</span><br><span class="line">London Westminster  29.740050  13.443568  21.491708</span><br><span class="line">All                 29.430316  14.386849  24.222743</span><br></pre></td></tr></table></figure>

<h2 id="从宽到长的表格格式"><a href="#从宽到长的表格格式" class="headerlink" title="从宽到长的表格格式"></a>从宽到长的表格格式</h2><p>我们向<code>DataFrame</code> 加一个新索引<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.reset_index.html#pandas.DataFrame.reset_index"><code>reset_index()</code></a>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no2_pivoted = no2.pivot(columns=<span class="string">&quot;location&quot;</span>, values=<span class="string">&quot;value&quot;</span>).reset_index()</span><br><span class="line">print(no2_pivoted.head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location                  date.utc  BETR801  FR04014  London Westminster</span><br><span class="line">0        2019-04-09 01:00:00+00:00     22.5     24.4                 NaN</span><br><span class="line">1        2019-04-09 02:00:00+00:00     53.5     27.4                67.0</span><br><span class="line">2        2019-04-09 03:00:00+00:00     54.5     34.2                67.0</span><br><span class="line">3        2019-04-09 04:00:00+00:00     34.5     48.5                41.0</span><br><span class="line">4        2019-04-09 05:00:00+00:00     46.5     59.5                41.0</span><br></pre></td></tr></table></figure>

<p>我想在单列（长格式）中收集所有空气质量二氧化氮测量值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no_2 = no2_pivoted.melt(id_vars=<span class="string">&quot;date.utc&quot;</span>)</span><br><span class="line">print(no_2)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">                      date.utc            location  value</span><br><span class="line">0    2019-04-09 01:00:00+00:00             BETR801   22.5</span><br><span class="line">1    2019-04-09 02:00:00+00:00             BETR801   53.5</span><br><span class="line">2    2019-04-09 03:00:00+00:00             BETR801   54.5</span><br><span class="line">3    2019-04-09 04:00:00+00:00             BETR801   34.5</span><br><span class="line">4    2019-04-09 05:00:00+00:00             BETR801   46.5</span><br><span class="line">...                        ...                 ...    ...</span><br><span class="line">5110 2019-06-20 20:00:00+00:00  London Westminster    NaN</span><br><span class="line">5111 2019-06-20 21:00:00+00:00  London Westminster    NaN</span><br><span class="line">5112 2019-06-20 22:00:00+00:00  London Westminster    NaN</span><br><span class="line">5113 2019-06-20 23:00:00+00:00  London Westminster    NaN</span><br><span class="line">5114 2019-06-21 00:00:00+00:00  London Westminster    NaN</span><br><span class="line"></span><br><span class="line">[5115 rows x 3 columns]</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>DataFrame</code> 上的 <code>pandas.melt()</code> 方法将数据表从宽格式转换为长格式。 列标题成为新创建的列中的变量名称。</p>
<p>换句话说，也就是将多列合并成一列。</p>
</blockquote>
<p><code>pandas.melt()</code>可以更详细地定义传递给的参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">no_2 = no2_pivoted.melt(</span><br><span class="line">    id_vars=<span class="string">&quot;date.utc&quot;</span>,</span><br><span class="line">    value_vars=[<span class="string">&quot;BETR801&quot;</span>, <span class="string">&quot;FR04014&quot;</span>, <span class="string">&quot;London Westminster&quot;</span>],</span><br><span class="line">    value_name=<span class="string">&quot;NO_2&quot;</span>,</span><br><span class="line">    var_name=<span class="string">&quot;id_location&quot;</span>,</span><br><span class="line">)</span><br><span class="line">print(no_2)</span><br></pre></td></tr></table></figure>

<p>上述参数的解释：</p>
<ul>
<li><code>value_vars</code>定义将哪些列<em>融合</em>在一起</li>
<li><code>value_name</code>为列值提供自定义列名，而不是默认列名<code>value</code></li>
<li><code>var_name</code>为融合的列提供自定义列名称。否则它采用索引名称或默认值<code>variable</code></li>
<li><code>id_vars</code>中声明的列将不会被融合</li>
<li><code>id_vars</code>声明的列不会被融合</li>
</ul>
<p>因此，参数 <code>value_name</code> 和 <code>var_name</code> 只是两个生成列的用户定义名称。 要融合的列由 <code>id_vars</code> 和 <code>value_vars</code> 定义。</p>
<hr>
<h1 id="如何合并多个表的数据"><a href="#如何合并多个表的数据" class="headerlink" title="如何合并多个表的数据"></a>如何合并多个表的数据</h1><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/08_concat_row.png" style="zoom:50%;" />

<p>现有两个班的学生数据 <code>class_01_students.xlsx</code> <code>class_02_students.xlsx</code> 如下:</p>
<p> <code>class_01_students.xlsx</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class_01_students = pd.read_excel(<span class="string">&quot;data/class_01_students.xlsx&quot;</span>)</span><br><span class="line">print(class_01_students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   name   age  sex   height blood</span><br><span class="line">0   张三   20   男     175     O</span><br><span class="line">1   李四   21   女     160     A</span><br><span class="line">2   王五   50   男     170     B</span><br><span class="line">3   赵六   30   男     173    AB</span><br><span class="line">4   田七   40   男     180     A</span><br></pre></td></tr></table></figure>

<p><code>class_02_students.xlsx</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class_02_students = pd.read_excel(<span class="string">&quot;data/class_02_students.xlsx&quot;</span>)</span><br><span class="line">print(class_02_students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   name   age sex  height blood</span><br><span class="line">0   小明   18   男     181     O</span><br><span class="line">1   小黄   24   男     177     A</span><br><span class="line">2   小红   17   女     170     B</span><br><span class="line">3   小李   32   男     157    AB</span><br><span class="line">4   小花   29   女     168     A</span><br></pre></td></tr></table></figure>

<p>将两个具有相似结构的表合并成一个表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class_01_students = pd.read_excel(<span class="string">&quot;data/class_01_students.xlsx&quot;</span>)</span><br><span class="line">class_02_students = pd.read_excel(<span class="string">&quot;data/class_02_students.xlsx&quot;</span>)</span><br><span class="line">students = pd.concat([class_01_students, class_02_students], axis=<span class="number">0</span>)</span><br><span class="line">print(students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    name  age sex  height blood</span><br><span class="line">0   张三   20   男     175     O</span><br><span class="line">1   李四   21   女     160     A</span><br><span class="line">2   王五   50   男     170     B</span><br><span class="line">3   赵六   30   男     173    AB</span><br><span class="line">4   田七   40   男     180     A</span><br><span class="line">0   小明   18   男     181     O</span><br><span class="line">1   小黄   24   男     177     A</span><br><span class="line">2   小红   17   女     170     B</span><br><span class="line">3   小李   32   男     157    AB</span><br><span class="line">4   小花   29   女     168     A</span><br></pre></td></tr></table></figure>

<blockquote>
<p>concat() 函数沿其中一个轴（按行或按列）执行多个表的串联操作。</p>
</blockquote>
<p>默认情况下，串联是沿着轴 0 进行的，因此生成的表组合了输入表的行。 让我们检查原始表和串联表的形状来验证操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&quot;shape of class_01_students:&quot;</span>, class_01_students.shape)</span><br><span class="line"><span class="comment"># shape of class_01_students: (5, 5)</span></span><br><span class="line">print(<span class="string">&quot;shape of class_02_students:&quot;</span>, class_02_students.shape)</span><br><span class="line"><span class="comment"># shape of class_02_students: (5, 5)</span></span><br><span class="line">print(<span class="string">&quot;shape of students:&quot;</span>, students.shape)</span><br><span class="line"><span class="comment"># shape of students: (10, 5)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>axis 参数出现在许多可沿轴应用的 pandas 方法中。 DataFrame 有两个相应的轴：第一个轴垂直向下跨行（轴 0），第二个轴水平跨列（轴 1）。 默认情况下，大多数操作（如串联或汇总统计）是跨行（轴 0）的，但也可以跨列应用。</p>
</blockquote>
<p>根据年龄对表进行排序（正序）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sorted_students = students.sort_values(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">print(sorted_students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    name  age sex  height blood</span><br><span class="line">2   小红   17   女     170     B</span><br><span class="line">0   小明   18   男     181     O</span><br><span class="line">0   张三   20   男     175     O</span><br><span class="line">1   李四   21   女     160     A</span><br><span class="line">1   小黄   24   男     177     A</span><br><span class="line">4   小花   29   女     168     A</span><br><span class="line">3   赵六   30   男     173    AB</span><br><span class="line">3   小李   32   男     157    AB</span><br><span class="line">4   田七   40   男     180     A</span><br><span class="line">2   王五   50   男     170     B</span><br></pre></td></tr></table></figure>

<p>倒序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sorted_students = students.sort_values(<span class="string">&quot;age&quot;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line">print(sorted_students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    name  age sex  height blood</span><br><span class="line">2   王五   50   男     170     B</span><br><span class="line">4   田七   40   男     180     A</span><br><span class="line">3   小李   32   男     157    AB</span><br><span class="line">3   赵六   30   男     173    AB</span><br><span class="line">4   小花   29   女     168     A</span><br><span class="line">1   小黄   24   男     177     A</span><br><span class="line">1   李四   21   女     160     A</span><br><span class="line">0   张三   20   男     175     O</span><br><span class="line">0   小明   18   男     181     O</span><br><span class="line">2   小红   17   女     170     B</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这些教程中没有提到同时存在多个行/列索引。 分层索引或 MultiIndex 是一种先进且强大的 pandas 功能，用于分析更高维度的数据。</p>
<p>多重索引超出了 pandas 介绍的范围。 目前，请记住函数reset_index可用于将任何级别的索引转换为列。</p>
</blockquote>
<h2 id="使用通用标识符连接表"><a href="#使用通用标识符连接表" class="headerlink" title="使用通用标识符连接表"></a>使用通用标识符连接表</h2><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/08_merge_left.png" style="zoom:50%;" />

<p>现有学生基本信息表 <code>class_01_students.xlsx</code> 和学生成绩表 <code>student_score.xlsx</code> 如下:</p>
<p>基本信息表 <code>class_01_students.xlsx</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class_01_students = pd.read_excel(<span class="string">&quot;data/class_01_students.xlsx&quot;</span>)</span><br><span class="line">print(class_01_students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  	name  age sex  height blood  student_id</span><br><span class="line">0   张三   20   男     175     O           1</span><br><span class="line">1   李四   21   女     160     A           2</span><br><span class="line">2   王五   50   男     170     B           3</span><br><span class="line">3   赵六   30   男     173    AB           4</span><br><span class="line">4   田七   40   男     180     A           5</span><br></pre></td></tr></table></figure>

<p>学生成绩表 <code>student_score.xlsx</code> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">student_score = pd.read_excel(<span class="string">&quot;data/student_score.xlsx&quot;</span>)</span><br><span class="line">print(student_score)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   student_id  chinese  math  english  physics</span><br><span class="line">0           1       89    76       88       90</span><br><span class="line">1           2       76    67       50       89</span><br><span class="line">2           3       57    82       91       88</span><br><span class="line">3           4       23    43       54       76</span><br></pre></td></tr></table></figure>

<p>根据<code>student_id</code>合并两个表格：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class_01_students = pd.read_excel(<span class="string">&quot;data/class_01_students.xlsx&quot;</span>)</span><br><span class="line">student_score = pd.read_excel(<span class="string">&quot;data/student_score.xlsx&quot;</span>)</span><br><span class="line">merged_table = pd.merge(class_01_students, student_score, how=<span class="string">&quot;left&quot;</span>, on=<span class="string">&quot;student_id&quot;</span>)</span><br><span class="line">print(merged_table)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    name  age sex  height blood  student_id  chinese  math  english  physics</span><br><span class="line">0   张三   20   男     175     O           1     89.0  76.0     88.0     90.0</span><br><span class="line">1   李四   21   女     160     A           2     76.0  67.0     50.0     89.0</span><br><span class="line">2   王五   50   男     170     B           3     57.0  82.0     91.0     88.0</span><br><span class="line">3   赵六   30   男     173    AB           4     23.0  43.0     54.0     76.0</span><br><span class="line">4   田七   40   男     180     A           5      NaN   NaN      NaN      NaN</span><br></pre></td></tr></table></figure>

<p><code>mege</code>操作类似于数据库的<code>join</code>操作</p>
<p>现学生成绩表 <code>student_score.xlsx</code> 和学生基本信息表 <code>class_01_students.xlsx</code> 没有相同的key。</p>
<p>学生基本信息表 <code>class_01_students.xlsx</code> 的数据如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    name  age sex  student_id</span><br><span class="line">0   张三   20   男           1</span><br><span class="line">1   李四   21   女           2</span><br><span class="line">2   王五   50   男           3</span><br><span class="line">3   赵六   30   男           4</span><br><span class="line">4   田七   40   男           5</span><br></pre></td></tr></table></figure>

<p>学生成绩表 <code>student_score.xlsx</code> 的数据如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   stuid  chinese  math  english  physics</span><br><span class="line">0      1       89    76       88       90</span><br><span class="line">1      2       76    67       50       89</span><br><span class="line">2      3       57    82       91       88</span><br><span class="line">3      4       23    43       54       76</span><br></pre></td></tr></table></figure>

<p>连接两个表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class_01_students = pd.read_excel(<span class="string">&quot;data/class_01_students.xlsx&quot;</span>)</span><br><span class="line">student_score = pd.read_excel(<span class="string">&quot;data/student_score.xlsx&quot;</span>)</span><br><span class="line">merged_table = pd.merge(class_01_students, student_score, how=<span class="string">&quot;left&quot;</span>, left_on=<span class="string">&quot;student_id&quot;</span>,      right_on=<span class="string">&quot;stuid&quot;</span>)</span><br><span class="line">print(merged_table)</span><br></pre></td></tr></table></figure>

<p>与前面的示例相比，没有公共列名。然而，表  <code>class_01_students.xlsx</code> 中的<code>student_id</code>列和表<code>student_score.xlsx</code> 中的<code>stuid</code>字段以通用格式提供了学生Id信息，此处使用参数<code>left_on</code> 和参数<code>right_on</code> （而不仅仅是<code>on</code>）来建立两个表之间的链接。</p>
<hr>
<h1 id="如何轻松处理时间序列数据"><a href="#如何轻松处理时间序列数据" class="headerlink" title="如何轻松处理时间序列数据"></a>如何轻松处理时间序列数据</h1><p>本教程使用的数据：<a target="_blank" rel="noopener" href="https://github.com/pandas-dev/pandas/blob/main/doc/data/air_quality_no2_long.csv">空气质量数据</a></p>
<h2 id="使用-pandas-日期时间属性"><a href="#使用-pandas-日期时间属性" class="headerlink" title="使用 pandas 日期时间属性"></a>使用 pandas 日期时间属性</h2><p>将纯文本转换成日期时间对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">air_quality = pd.read_csv(<span class="string">&quot;data/air_quality_no2_long.csv&quot;</span>)</span><br><span class="line">air_quality[<span class="string">&quot;date.utc&quot;</span>] = pd.to_datetime(air_quality[<span class="string">&quot;date.utc&quot;</span>])</span><br><span class="line">print(air_quality[<span class="string">&quot;date.utc&quot;</span>].head())</span><br></pre></td></tr></table></figure>

<p>最初，日期时间中的值是字符串，不提供任何日期时间操作（例如提取年份、星期几等）。 通过应用 <code>to_datetime</code> 函数，<code>pandas</code> 解释字符串并将其转换为日期时间（即 <code>datetime64[ns, UTC]</code>）对象。 在 <code>pandas</code> 中，我们将这些类似于标准库中的 <code>datetime.datetime</code> 的日期时间对象称为 <code>pandas.Timestamp</code>。</p>
<p>由于许多数据集的其中一列中确实包含日期时间信息，因此 <code>pandas.read_csv()</code> 和 <code>pandas.read_json()</code> 等 <code>pandas</code> 输入函数可以在使用 <code>parse_dates</code> 参数在读取数据时将一些列日期列转换成时间戳对象。</p>
<p>为什么这些<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Timestamp.html#pandas.Timestamp"><code>pandas.Timestamp</code></a>对象有用？让我们通过一些示例来说明附加值。</p>
<p>我们正在使用的时间序列数据集的开始日期和结束日期是哪天？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(air_quality[<span class="string">&quot;date.utc&quot;</span>].<span class="built_in">min</span>())</span><br><span class="line">print(air_quality[<span class="string">&quot;date.utc&quot;</span>].<span class="built_in">max</span>())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2019-05-07 01:00:00+00:00</span><br><span class="line">2019-06-21 00:00:00+00:00</span><br></pre></td></tr></table></figure>

<p>使用 <code>pandas.Timestamp</code> 作为日期时间使我们能够使用日期信息进行计算并使它们具有可比性。 因此，我们可以用它来获取时间序列的长度：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(air_quality[<span class="string">&quot;date.utc&quot;</span>].<span class="built_in">max</span>() - air_quality[<span class="string">&quot;date.utc&quot;</span>].<span class="built_in">min</span>())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">44 days 23:00:00</span><br></pre></td></tr></table></figure>

<p>结果是一个 <code>pandas.Timedelta</code> 对象，类似于标准 <code>Python</code> 库中的 <code>datetime.timedelta</code> 并定义持续时间。</p>
<p>我想向 DataFrame 添加一个新列，仅包含月份</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">air_quality[<span class="string">&quot;month&quot;</span>] = air_quality[<span class="string">&quot;date.utc&quot;</span>].dt.month</span><br><span class="line">print(air_quality.head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">    city country                  date.utc  ... value   unit  month</span><br><span class="line">0  Paris      FR 2019-06-21 00:00:00+00:00  ...  20.0  µg&#x2F;m³      6</span><br><span class="line">1  Paris      FR 2019-06-20 23:00:00+00:00  ...  21.8  µg&#x2F;m³      6</span><br><span class="line">2  Paris      FR 2019-06-20 22:00:00+00:00  ...  26.5  µg&#x2F;m³      6</span><br><span class="line">3  Paris      FR 2019-06-20 21:00:00+00:00  ...  24.9  µg&#x2F;m³      6</span><br><span class="line">4  Paris      FR 2019-06-20 20:00:00+00:00  ...  21.4  µg&#x2F;m³      6</span><br><span class="line"></span><br><span class="line">[5 rows x 8 columns]</span><br></pre></td></tr></table></figure>

<p>通过使用 <code>Timestamp</code> 对象来表示日期，<code>pandas</code> 提供了许多与时间相关的属性。 例如月份<code>month</code>，还有年份<code>year</code>、季度<code>quarter</code>……所有这些属性都可以通过<code style="color:red;font-weight:bold"> dt </code>访问器访问。</p>
<p>每个测量位置一周中每一天的平均二氧化氮浓度是多少？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(air_quality.groupby(</span><br><span class="line">        [air_quality[<span class="string">&quot;date.utc&quot;</span>].dt.weekday, <span class="string">&quot;location&quot;</span>])[<span class="string">&quot;value&quot;</span>].mean())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">date.utc  location          </span><br><span class="line">0         BETR801               27.875000</span><br><span class="line">          FR04014               24.856250</span><br><span class="line">          London Westminster    23.969697</span><br><span class="line">1         BETR801               22.214286</span><br><span class="line">          FR04014               30.999359</span><br><span class="line">          London Westminster    24.885714</span><br><span class="line">2         BETR801               21.125000</span><br><span class="line">          FR04014               29.165753</span><br><span class="line">          London Westminster    23.460432</span><br><span class="line">3         BETR801               27.500000</span><br><span class="line">          FR04014               28.600690</span><br><span class="line">          London Westminster    24.780142</span><br><span class="line">4         BETR801               28.400000</span><br><span class="line">          FR04014               31.617986</span><br><span class="line">          London Westminster    26.446809</span><br><span class="line">5         BETR801               33.500000</span><br><span class="line">          FR04014               25.266154</span><br><span class="line">          London Westminster    24.977612</span><br><span class="line">6         BETR801               21.896552</span><br><span class="line">          FR04014               23.274306</span><br><span class="line">          London Westminster    24.859155</span><br><span class="line">Name: value, dtype: float64</span><br></pre></td></tr></table></figure>

<p>还记得统计计算教程中 <code>groupby</code> 提供的分割-应用-组合模式吗？在这里，我们想要计算给定的统计数据（例如每周每个测量地的二氧化碳的平均浓度)。为了按工作日进行分组，我们使用 <code>pandas Timestamp</code> 的 <code>datetime</code> 属性 <code>weekday</code>（星期一 = 0 和星期日 = 6），也可以通过 <code>dt</code> 访问器访问。 可以对地点和工作日进行分组，以拆分每个组合的平均值计算。</p>
<p>将所有站点的时间序列中一天中典型的 NO2 模式绘制在一起。 换句话说，一天中每个小时的平均值是多少？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fig, axs = plt.subplots(figsize=(<span class="number">12</span>, <span class="number">4</span>))</span><br><span class="line">air_quality.groupby(air_quality[<span class="string">&quot;date.utc&quot;</span>].dt.hour)[<span class="string">&quot;value&quot;</span>].mean().plot(</span><br><span class="line">    kind=<span class="string">&#x27;bar&#x27;</span>, rot=<span class="number">0</span>, ax=axs</span><br><span class="line">)</span><br><span class="line">plt.xlabel(<span class="string">&quot;Hour of the day&quot;</span>)  <span class="comment"># custom x label using Matplotlib</span></span><br><span class="line">plt.ylabel(<span class="string">&quot;$NO_2 (µg/m^3)$&quot;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/hour_of_the_day.png" style="zoom:50%;" />

<h2 id="日期时间作为索引"><a href="#日期时间作为索引" class="headerlink" title="日期时间作为索引"></a>日期时间作为索引</h2><p>在重塑教程中， <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.pivot.html#pandas.pivot"><code>pivot()</code></a>介绍了如何重塑数据表，将每个测量位置作为单独的列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">no_2 = air_quality.pivot(index=<span class="string">&quot;date.utc&quot;</span>, columns=<span class="string">&quot;location&quot;</span>, values=<span class="string">&quot;value&quot;</span>)</span><br><span class="line">print(no_2.head())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location                   BETR801  FR04014  London Westminster</span><br><span class="line">date.utc                                                       </span><br><span class="line">2019-05-07 01:00:00+00:00     50.5     25.0                23.0</span><br><span class="line">2019-05-07 02:00:00+00:00     45.0     27.7                19.0</span><br><span class="line">2019-05-07 03:00:00+00:00      NaN     50.4                19.0</span><br><span class="line">2019-05-07 04:00:00+00:00      NaN     61.9                16.0</span><br><span class="line">2019-05-07 05:00:00+00:00      NaN     72.4                 NaN</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过旋转数据，日期时间信息成为表的索引。一般来说，将某列设置为索引可以通过该<code>set_index</code>函数来实现。</p>
</blockquote>
<p>使用日期时间索引（即<code>DatetimeIndex</code>）提供了强大的功能。例如，我们不需要<code>dt</code>访问器来获取时间序列属性，而是直接在索引上使用这些属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(no_2.index.year)</span><br><span class="line">print(no_2.index.month)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Index([2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019,</span><br><span class="line">       ...</span><br><span class="line">       2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019, 2019],</span><br><span class="line">      dtype&#x3D;&#39;int32&#39;, name&#x3D;&#39;date.utc&#39;, length&#x3D;1033)</span><br><span class="line">Index([5, 5, 5, 5, 5, 5, 5, 5, 5, 5,</span><br><span class="line">       ...</span><br><span class="line">       6, 6, 6, 6, 6, 6, 6, 6, 6, 6],</span><br><span class="line">      dtype&#x3D;&#39;int32&#39;, name&#x3D;&#39;date.utc&#39;, length&#x3D;1033)</span><br></pre></td></tr></table></figure>

<p>绘制5 月 20 日至 5 月 21 月底不同站点的 NO2 值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">no_2 = air_quality.pivot(index=<span class="string">&quot;date.utc&quot;</span>, columns=<span class="string">&quot;location&quot;</span>, values=<span class="string">&quot;value&quot;</span>)</span><br><span class="line">no_2[<span class="string">&quot;2019-05-20&quot;</span>:<span class="string">&quot;2019-05-21&quot;</span>].plot()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/pandas/09_time_section.png" style="zoom:50%;" />

<hr>
<h1 id="如何操作文本数据"><a href="#如何操作文本数据" class="headerlink" title="如何操作文本数据"></a>如何操作文本数据</h1><p>本教程数据<code>class_01_students.xlsx</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class_01_students = pd.read_excel(<span class="string">&quot;data/class_01_students.xlsx&quot;</span>)</span><br><span class="line">print(class_01_students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        name  age  sex  student_id</span><br><span class="line">0  San Zhang   20   男           1</span><br><span class="line">1      Si Li   21   女           2</span><br><span class="line">2    Wu Wang   50   男           3</span><br><span class="line">3   Liu Zhao   30   男           4</span><br><span class="line">4    Qi Tian   40   男           5</span><br></pre></td></tr></table></figure>

<p>将<code>name</code>设为小写。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class_01_students = pd.read_excel(<span class="string">&quot;data/class_01_students.xlsx&quot;</span>)</span><br><span class="line">print(class_01_students[<span class="string">&quot;name&quot;</span>].<span class="built_in">str</span>.lower())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0    san zhang</span><br><span class="line">1        si li</span><br><span class="line">2      wu wang</span><br><span class="line">3     liu zhao</span><br><span class="line">4      qi tian</span><br><span class="line">Name: name, dtype: object</span><br></pre></td></tr></table></figure>

<p>与时间序列教程中具有 <code>dt</code> 访问器的日期时间对象类似，使用 <code>str</code> 访问器时可以使用许多专用字符串方法。 这些方法通常具有与单个元素的等效内置字符串方法匹配的名称，但按元素应用到列的每个值。</p>
<p>通过提取逗号之前的部分来创建一个新列“姓氏”，其中包含乘客的姓氏。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class_01_students[<span class="string">&quot;surname&quot;</span>] = class_01_students[<span class="string">&quot;name&quot;</span>].<span class="built_in">str</span>.split(<span class="string">&quot; &quot;</span>).<span class="built_in">str</span>.get(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">print(class_01_students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        name  age sex  student_id surname</span><br><span class="line">0  San Zhang   20   男           1   Zhang</span><br><span class="line">1      Si Li   21   女           2      Li</span><br><span class="line">2    Wu Wang   50   男           3    Wang</span><br><span class="line">3   Liu Zhao   30   男           4    Zhao</span><br><span class="line">4    Qi Tian   40   男           5    Tian</span><br></pre></td></tr></table></figure>

<p>使用该<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.split.html#pandas.Series.str.split"><code>Series.str.split()</code></a>方法，每个值都作为 2 个元素的列表返回。第一个元素是空格之前的部分，第二个元素是空格之后的部分。</p>
<p>假如我们只对姓名中带有”Tian”字的用户感兴趣：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(class_01_students[<span class="string">&quot;name&quot;</span>].<span class="built_in">str</span>.contains(<span class="string">&quot;Tian&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0    False</span><br><span class="line">1    False</span><br><span class="line">2    False</span><br><span class="line">3    False</span><br><span class="line">4     True</span><br><span class="line">Name: name, dtype: bool</span><br></pre></td></tr></table></figure>

<p>方法<code>Series.str.contains()</code>检查列中的每个值（<code>Name</code>如果字符串包含单词<code>Tian</code>，并返回每个值<code>True</code>（<code>Tian</code>是<code>name</code>的一部分）或 <code>False</code>（<code>Tian</code>不是<code>name</code>的一部分）。</p>
<blockquote>
<p>支持更强大的字符串提取，因为 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.contains.html#pandas.Series.str.contains"><code>Series.str.contains()</code></a>和<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.extract.html#pandas.Series.str.extract"><code>Series.str.extract()</code></a>方法接受<a target="_blank" rel="noopener" href="https://docs.python.org/3/library/re.html">正则表达式</a>，但超出了本教程的范围。</p>
</blockquote>
<p>哪位用户的名字最长？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(class_01_students[<span class="string">&quot;name&quot;</span>].<span class="built_in">str</span>.<span class="built_in">len</span>().idxmax())</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0</span><br></pre></td></tr></table></figure>

<p>为了获得最长的名称，我们首先必须获得列中每个名称的长度<code>Name</code>。通过使用 <code>pandas</code> 字符串方法，该 <a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.len.html#pandas.Series.str.len"><code>Series.str.len()</code></a>函数将单独应用于每个名称（按元素）。</p>
<p>接下来，我们需要获取表中名称长度最大的对应位置，最好是索引标签。 <code>idxmax()</code> 方法正是这样做的。 它不是字符串方法，适用于整数，因此不使用 <code>str</code>。</p>
<p>根据行 ( <code>0</code>) 和列 ( <code>name</code>) 的索引名称，我们可以使用运算符进行选择<code>loc</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(class_01_students.loc[class_01_students[<span class="string">&quot;name&quot;</span>].<span class="built_in">str</span>.<span class="built_in">len</span>().idxmax(), <span class="string">&quot;name&quot;</span>])</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">San Zhang</span><br></pre></td></tr></table></figure>

<p>在“sex”列中，将“男”的值替换为“M”，将“女”的值替换为“F”。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">class_01_students[<span class="string">&quot;sex&quot;</span>] = class_01_students[<span class="string">&quot;sex&quot;</span>].replace(&#123;<span class="string">&quot;男&quot;</span>:<span class="string">&quot;M&quot;</span>, <span class="string">&quot;女&quot;</span>:<span class="string">&quot;F&quot;</span>&#125;)</span><br><span class="line">print(class_01_students)</span><br></pre></td></tr></table></figure>

<p>Out:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">        name  age sex  student_id</span><br><span class="line">0  San Zhang   20   M           1</span><br><span class="line">1      Si Li   21   F           2</span><br><span class="line">2    Wu Wang   50   M           3</span><br><span class="line">3   Liu Zhao   30   M           4</span><br><span class="line">4    Qi Tian   40   M           5</span><br></pre></td></tr></table></figure>

<p>虽然<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.replace.html#pandas.Series.replace"><code>replace()</code></a>它不是字符串方法，但它提供了一种使用映射或词汇表来转换某些值的便捷方法。它需要<code>dictionary</code>来定义映射。<code>&#123;from : to&#125;</code></p>
<hr>
<p>关于Pandas的更多教程请访问：<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/tutorials.html%E3%80%82">https://pandas.pydata.org/pandas-docs/stable/getting_started/tutorials.html。</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/19/Java%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9FLogback-SLf4J/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/08/19/Java%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9FLogback-SLf4J/" class="post-title-link" itemprop="url">Java日志系统Logback+SLf4J</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-19 09:54:54" itemprop="dateCreated datePublished" datetime="2023-08-19T09:54:54+08:00">2023-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-05 16:53:01" itemprop="dateModified" datetime="2023-09-05T16:53:01+08:00">2023-09-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/SpringBoot/" itemprop="url" rel="index"><span itemprop="name">SpringBoot</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Java中常用日志框架"><a href="#Java中常用日志框架" class="headerlink" title="Java中常用日志框架"></a>Java中常用日志框架</h1><h2 id="日志框架的演化"><a href="#日志框架的演化" class="headerlink" title="日志框架的演化"></a>日志框架的演化</h2><blockquote>
<ul>
<li>1996 年初，欧洲安全电子市场 (EU SEMPER) 项目组决定编写它自己的程序跟踪 API(Tracing API)。经过不断的完善，这个 API 终于成为一个十分受欢迎的 Java 日志软件包，即 Log4j。后来 Log4j 成为 Apache 基金会项目中的一员。</li>
<li>Log4j 发布后近乎成了 Java 社区的日志标准。据说 Apache 基金会还曾经建议 sun 引入 Log4j 到 java 的标准库中，但 Sun 拒绝了。</li>
<li>2002年 Java1.4 发布，Sun 推出了自己的日志库 JUL(Java Util Logging),其实现基本模仿了 Log4j 的实现。在 JUL 出来以前，log4j 就已经成为一项成熟的技术，使得 log4j 在选择上占据了一定的优势。</li>
<li>2005年，Apache 推出了 JCL(Jakarta Commons Logging)，JCL只是定义了一套日志接口(其内部也提供一个Simple Log的简单实现)，支持运行时动态加载日志组件的实现，也就是说，在你应用代码里，只需调用 Commons Logging 的接口，底层实现可以是log4j，也可以是Java Util Logging。</li>
<li>2006年，Ceki Gülcü (Log4j最初由他编写) 开发了 SLF4J(The Simple Logging Facade for Java) 作为 JCL(Jakarta Commons Logging) 的更可靠替代方案。之后又开发了 Logback 框架 (Slf4j 的实现)，并回瑞典创建了 QOS 公司，QOS 官网上是这样描述 Logback 的：The Generic，Reliable Fast&amp;Flexible Logging Framework(一个通用，可靠，快速且灵活的日志框架)。</li>
<li>之后，Java 日志领域被划分为两大阵营：Commons Logging 阵营和 SLF4J 阵营。 Commons Logging 在 Apache 大树的笼罩下，有很大的用户基数。但有证据表明，形式正在发生变化。2013 年底有人分析了 GitHub 上30000个项目，统计出了最流行的100个 Libraries，可以看出 slf4j 的发展趋势更好</li>
<li>2012-07 Apache 重写了 log4j 1.x，成立了新的项目 Log4j2。Log4j2 具有 Logback 的所有特性。</li>
</ul>
</blockquote>
<p>现在，SLF4J + Logback 是 Spring Boot 的默认日志框架。</p>
<h2 id="日志框架的分类"><a href="#日志框架的分类" class="headerlink" title="日志框架的分类"></a>日志框架的分类</h2><p>日志框架分为<strong>日志门面框架</strong>和<strong>日志实现框架</strong>，那什么是<strong>日志门面框架</strong>和<strong>日志实现框架</strong>呢</p>
<ul>
<li><strong>日志门面框架</strong>指的是：无具体实现的抽象门面框架，如：Commons Logging、SLF4J</li>
<li><strong>日志实现框架</strong>：具体实现的框架，如：Log4j，Log4j2，Logback，Jul(java.util.logging)</li>
</ul>
<h3 id="日志门面框架"><a href="#日志门面框架" class="headerlink" title="日志门面框架"></a>日志门面框架</h3><p>日志门面:是门面模式的一个典型的应用,门面模式，也称外观模式。日志门面框架就使一套提供了日志相关功能的接口而无具体实现的框架，其调用具体的实现框架来进行日志记录。也就是说日志门面天然的兼容日志实现框架。</p>
<p>在java 生态中国日志门面框架主要有两个 Commons Logging 和 SLF4J</p>
<h4 id="Commons-Logging"><a href="#Commons-Logging" class="headerlink" title="Commons Logging"></a><strong>Commons Logging</strong></h4><p>common-logging 是 apache 提供的一个通用的日志接口， 在 common-logging 中，有一个 Simple logger 的简单实现，但是它功能很弱，所以使用 common-logging，通常都是配合着 log4j 来使用。</p>
<h4 id="SLF4J"><a href="#SLF4J" class="headerlink" title="SLF4J"></a>SLF4J</h4><p>SLF4J(Simple Logging Facade for Java），是一套包装 Logging 框架的界面程式，以外观模式实现。可以在软件部署的时候决定要使用的 Logging 框架，目前主要支援的有Java Logging API、Log4j及logback等框架。以MIT 授权方式发布。SLF4J 的作者就是 Log4j和Logback 的作者 Ceki Gülcü。</p>
<h3 id="日志实现框架"><a href="#日志实现框架" class="headerlink" title="日志实现框架"></a>日志实现框架</h3><h4 id="Log4j"><a href="#Log4j" class="headerlink" title="Log4j"></a>Log4j</h4><p>最早的日志实现框架，早期由 Ceki Gülcü 开发，现在则是Apache软件基金会的一个项目。</p>
<h4 id="JUL-Java-Util-Logging"><a href="#JUL-Java-Util-Logging" class="headerlink" title="JUL(Java Util Logging)"></a>JUL(Java Util Logging)</h4><p>Java 1.4 以来的官方日志实现,主要参考自 Log4j</p>
<h4 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h4><p>Log4j 的早期作者 Ceki Gülcü 开发的新一代日志框架</p>
<h4 id="Log4j2"><a href="#Log4j2" class="headerlink" title="Log4j2"></a>Log4j2</h4><p>Apache Log4j2 是 Apache Log4j 的升级产品,并且不兼容 Log4j，主要参考自 Logback</p>
<h2 id="框架选择"><a href="#框架选择" class="headerlink" title="框架选择"></a>框架选择</h2><ul>
<li><strong>成本考虑</strong>：Logback 的所有文档是全面免费提供，Apache Log4J 只提供部分免费文档,其余部分需要付费购买。</li>
<li><strong>资源开销</strong>：Commons Logging 相比较与 SLF4J 开销更高.</li>
<li><strong>性能</strong>：Logback 相比 Log4j、Log4j2 拥有更好的性能。Logback声称：某些关键操作，比如判定是否记录一条日志语句的操作，其性能得到了显著的提高。这个操作在Logback中需要3纳秒，而在Log4J中则需要30纳秒。LogBack创建记录器（logger）的速度也更快：13毫秒，而在Log4J中需要23毫秒。更重要的是，它获取已存在的记录器只需94纳秒，而Log4J需要2234纳秒，时间减少到了1/23。跟JUL相比的性能提高也是显著的。</li>
</ul>
<p>SLF4J + Logback 成为了实际开发中的最佳选择。</p>
<hr>
<h1 id="SpringBoot项目中配置SLF4J-Logback"><a href="#SpringBoot项目中配置SLF4J-Logback" class="headerlink" title="SpringBoot项目中配置SLF4J+Logback"></a>SpringBoot项目中配置SLF4J+Logback</h1><h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><p>要开始使用 <code>Logback</code>，首先需要将<code>logback-classic</code>依赖项添加到类路径中。让我们用 <code>Maven</code> 来做到这一点：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>引入这个单一依赖项就足够了，因为它将间接引入<code>logback-core</code>和<code>slf4j-api</code>这两个依赖项。</p>
<p><strong>如果没有定义自定义配置，Logback 会自行提供简单的自动配置。</strong>默认情况下，这可确保日志语句以 <code>DEBUG</code> 级别打印到控制台。</p>
<p>因此，您现在可以获得*<code>Logger</code>*实例并开始使用默认的基本配置写入日志消息。</p>
<p>首先，您可以使用<code>slf4j LoggerFactory</code>类创建<code>Logger</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger LOGGER = LoggerFactory.getLogger(LogbackTestApplication.class);</span><br></pre></td></tr></table></figure>

<p>接下来，您可以简单地使用你想要的日志级别并打印日志：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOGGER.info(<span class="string">&quot;LogbackTestApplication running...&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Logback配置文件"><a href="#Logback配置文件" class="headerlink" title="Logback配置文件"></a>Logback配置文件</h2><p><strong>要为 Logback 创建配置，您可以使用 XML 以及 Groovy</strong>。只要您遵守命名约定，系统就会自动选择并使用配置。</p>
<p>您可以选择三个有效的标准文件名：</p>
<ul>
<li><em>logback-test.xml</em></li>
<li><em>logback.groovy</em></li>
<li><em>logback.xml</em></li>
</ul>
<p>这里值得注意的是，<code>Logback</code> 将按照这个确切的顺序搜索这些文件。</p>
<p>展望未来，本教程中的示例将依赖于基于 <code>XML</code> 的 <code>logback.xml</code>文件。</p>
<p>让我们看看默认配置的基本配置是什么样的：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>此配置定义了一个<code>ConsoleAppender</code>。控制台上的日志消息将使用<code>&lt;pattern&gt;</code>中配置的样式显示在打印控制台。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2023-08-19 15:57:13.086  INFO 72780 --- [           main] c.g.logbacktest.LogbackTestApplication   : LogbackTestApplication running...</span><br></pre></td></tr></table></figure>

<h2 id="Logback-配置文件结构"><a href="#Logback-配置文件结构" class="headerlink" title="Logback 配置文件结构"></a>Logback 配置文件结构</h2><p>Logback 配置文件的基本结构如下:</p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/logback/23144709_brxi.webp"></p>
<p>如上，根节点为<code>&lt;configuration></code>元素，包含零个或多个<code>&lt;appender></code>元素，然后是零个或多个<code>&lt;logger></code>元素，然后是<strong>最多一个</strong><code>&lt;root></code><strong>元素</strong>。</p>
<p><code>logger</code>、<code>root</code> 作为日志的记录器，把它关联到应用的对应的 <code>context</code> 上后，主要用于存放日志对象，也可以定义日志类型、级别。</p>
<p><code>appender</code> 主要用于指定日志输出的目的地，目的地可以是控制台、文件、远程套接字服务器、 <code>MySQL</code>、<code>PostreSQL</code>、 <code>Oracle</code> 和其他数据库、 <code>JMS</code> 和远程 <code>UNIX Syslog</code> 守护进程等。</p>
<h3 id="根节点-lt-configuration-gt"><a href="#根节点-lt-configuration-gt" class="headerlink" title="根节点&lt;configuration&gt;"></a>根节点&lt;configuration&gt;</h3><p>根节点 <code>&lt;configuration></code> 常用的属性包含<code>scan</code>、<code>scanPeriod</code>、<code>debug</code>三个属性。</p>
<ol>
<li><strong>scan</strong>：当此属性设置为 <code>true</code> 时，如果配置文件发生改变，会自动重新加载配置文件，默认值为 <code>true</code>.</li>
<li><strong>scanPeriod</strong>：设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒。当 scan 为 true 时，此属性生效。默认的时间间隔为 1 分钟.</li>
<li><strong>debug</strong>：当此属性设置为 <code>true</code> 时，将打印出 logback 内部日志信息，实时查看 logback 运行状态。默认值为 false.</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;60 second&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span>  </span><br><span class="line">      <span class="comment">&lt;!-- 其他配置省略--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意 <code>scanPeriod</code> 值的写法，<code>数值英文空格时间单位</code> 。 如果未指定时间单位，则默认时间单位为毫秒</p>
<h3 id="变量-lt-property-gt"><a href="#变量-lt-property-gt" class="headerlink" title="变量 &lt;property&gt;"></a>变量 &lt;property&gt;</h3><h4 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h4><p>在<code>&lt;configuration> </code>中，可以通过<code>&lt;property> </code> 来定义一个变量，属性 <strong>name</strong> 是变量的名称，属性 <strong>value</strong> 是变量的值。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%date %level [%thread] %logger&#123;10&#125; [%file : %line] %msg%n&quot;</span> /&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用自定义变量"><a href="#使用自定义变量" class="headerlink" title="使用自定义变量"></a>使用自定义变量</h4><p>通过 <code>$&#123;变量名&#125;</code> 来引用变量</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%date %level [%thread] %logger&#123;10&#125; [%file : %line] %msg%n&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用配置文件中的属性"><a href="#使用配置文件中的属性" class="headerlink" title="使用配置文件中的属性"></a>使用配置文件中的属性</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 读取spring.application.name中的属性来生成日志文件名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;logName&quot;</span> <span class="attr">source</span>=<span class="string">&quot;spring.application.name&quot;</span> <span class="attr">defaultValue</span>=<span class="string">&quot;localhost.log&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;springProperty> </code>标签允许我们从<code>Spring</code>中显示属性，<code>Environment</code> 以便在<code>Logback</code>中使用。如果你想将读取<code>application.properties</code>文件中的值，这将非常有用。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 读取spring.application.name中的属性来生成日志文件名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;logName&quot;</span> <span class="attr">source</span>=<span class="string">&quot;spring.application.name&quot;</span> <span class="attr">defaultValue</span>=<span class="string">&quot;localhost.log&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="日志输出器-lt-appender-gt"><a href="#日志输出器-lt-appender-gt" class="headerlink" title="日志输出器 &lt;appender&gt;"></a>日志输出器 &lt;appender&gt;</h3><p><code>&lt;appender></code> (日志输出器)，用于将日志按照<strong>一定的格式</strong>输出到控制台、文件、数据库等地方，<strong>logger(日志记录器)</strong> 需要使用 <strong>appender(日志输出器)</strong> 将记录器中的日志输出。</p>
<p><strong>appender</strong> 有两个<strong>必填属性</strong></p>
<ul>
<li><strong>name</strong> ：<code>appender</code> 的名称，任意填写，不要重名就行</li>
<li><strong>calss</strong>：某个具体的 <code>appender</code> 的完全类名，它是 <code>appender</code> 的具体实现，<code>Logback</code> 自带常用的几个 <code>appender</code>。<ul>
<li>ch.qos.logback.core.ConsoleAppender ：将日志输出到控制台的 <code>appender</code></li>
<li>ch.qos.logback.core.rolling.RollingFileAppender ：将日志输出到文件，并按照条件切换输出到新建文件(滚动输出，自动切割)</li>
</ul>
</li>
</ul>
<p><code>&lt;encoder></code> 负责将事件(日志)转换为字节数组，并将该字节数组写出为 <code>OutputStream</code>。</p>
<p><code>&lt;encoder></code> 是<code>&lt;appender></code> 的子节点，在 <code>&lt;encoder></code> 节点中，最重要的是配置 <code>&lt;pattern></code>，它是用来定义日志输出格式。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span><span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">charset</span>&gt;</span><span class="tag">&lt;/<span class="name">charset</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="lt-pattern-gt"><a href="#lt-pattern-gt" class="headerlink" title="&lt;pattern&gt;"></a>&lt;pattern&gt;</h4><p> <code>&lt;pattern></code>用于定义日志的输出格式，通过 <code>Logback</code> 中的转换说明符(Conversion specifier)（其实就是一些预定义变量），可以方便的组合出我们想要的日志格式</p>
<p>在这里我只列举出常用的转换说明符(Conversion specifier)，更多请参考<a href="https://link.juejin.cn/?target=http://logback.qos.ch/manual/layouts.html">官方文档</a></p>
<h5 id="日期、时间"><a href="#日期、时间" class="headerlink" title="日期、时间"></a>日期、时间</h5><p>假设系统时间是 2006-10-20 14:06:49,812</p>
<table>
<thead>
<tr>
<th>Conversion Pattern</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>%d</td>
<td>2006-10-20 14:06:49,812</td>
</tr>
<tr>
<td>%date</td>
<td>2006-10-20 14:06:49,812</td>
</tr>
<tr>
<td>%date{ISO8601}</td>
<td>2006-10-20 14:06:49,812</td>
</tr>
<tr>
<td>%date{HH:mm:ss.SSS}</td>
<td>14:06:49.812</td>
</tr>
<tr>
<td>%date{yyyy-MM-dd HH:mm:ss.SSS, Asia/Shanghai}</td>
<td>2006-10-20 14:06:49,812</td>
</tr>
</tbody></table>
<h5 id="日志记录器"><a href="#日志记录器" class="headerlink" title="日志记录器"></a>日志记录器</h5><p>输出日志记录事件源处的记录器名称，下表提供了缩写算法的实际应用示例。</p>
<table>
<thead>
<tr>
<th>转换说明符</th>
<th>记录器名称</th>
<th>输出结果</th>
</tr>
</thead>
<tbody><tr>
<td>%logger</td>
<td>mainPackage.sub.sample.Bar</td>
<td>mainPackage.sub.sample.Bar</td>
</tr>
<tr>
<td>%logger{0}</td>
<td>mainPackage.sub.sample.Bar</td>
<td>Bar</td>
</tr>
<tr>
<td>%logger{5}</td>
<td>mainPackage.sub.sample.Bar</td>
<td>m.s.s.Bar</td>
</tr>
<tr>
<td>%logger{10}</td>
<td>mainPackage.sub.sample.Bar</td>
<td>m.s.s.Bar</td>
</tr>
<tr>
<td>%logger{15}</td>
<td>mainPackage.sub.sample.Bar</td>
<td>m.s.sample.Bar</td>
</tr>
<tr>
<td>%logger{16}</td>
<td>mainPackage.sub.sample.Bar</td>
<td>m.sub.sample.Bar</td>
</tr>
<tr>
<td>%logger{26}</td>
<td>mainPackage.sub.sample.Bar</td>
<td>mainPackage.sub.sample.Bar</td>
</tr>
</tbody></table>
<h5 id="类名、方法名、行号"><a href="#类名、方法名、行号" class="headerlink" title="类名、方法名、行号"></a>类名、方法名、行号</h5><table>
<thead>
<tr>
<th>Conversion Pattern</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>%C、%class</td>
<td>输出log的类的完整类名,获取类名的效率一般,只建议在需要时使用</td>
</tr>
<tr>
<td>%M 、%method</td>
<td>输出log的方法</td>
</tr>
<tr>
<td>%L 、%line</td>
<td>输出log的行号。获取行号的效率一般，只建议在需要时使用</td>
</tr>
</tbody></table>
<h5 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h5><table>
<thead>
<tr>
<th>Conversion Pattern</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>%t 、%thread</td>
<td>输出日志的线程</td>
</tr>
</tbody></table>
<h5 id="消息请求级别"><a href="#消息请求级别" class="headerlink" title="消息请求级别"></a>消息请求级别</h5><table>
<thead>
<tr>
<th>Conversion Pattern</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>%p、%le、 %level</td>
<td>消息请求级别</td>
</tr>
</tbody></table>
<h5 id="日志信息"><a href="#日志信息" class="headerlink" title="日志信息"></a>日志信息</h5><table>
<thead>
<tr>
<th>Conversion Pattern</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>%m 、%msg 、%message</td>
<td>日志信息</td>
</tr>
</tbody></table>
<h5 id="换行"><a href="#换行" class="headerlink" title="换行"></a>换行</h5><table>
<thead>
<tr>
<th>Conversion Pattern</th>
<th>Result</th>
</tr>
</thead>
<tbody><tr>
<td>%n</td>
<td>换行</td>
</tr>
</tbody></table>
<p>组合示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date&#123;yyyy-MM-dd HH:mm:ss.SSS, Asia/Shanghai&#125; %red(%-5level) --- [%thread] %cyan(%class.%method/%line) : %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="颜色"><a href="#颜色" class="headerlink" title="颜色"></a>颜色</h5><p>对于控制台的输出，Logback 支持填充颜色，支持的颜色如下</p>
<ul>
<li>%black()</li>
<li>%red()</li>
<li>%green()</li>
<li>%yellow()</li>
<li>%blue()</li>
<li>%magenta()</li>
<li>%cyan()</li>
<li>%white()</li>
<li>%gray()</li>
<li>%boldRed()</li>
<li>%boldGreen()</li>
<li>%boldYellow()</li>
<li>%boldBlue()</li>
<li>%boldMagenta()</li>
<li>%boldCyan()</li>
<li>%boldWhite()</li>
<li>%highlight()</li>
</ul>
<p>使用方法是用颜色的代码把消息包起来，比如想将日志级别设置成红色 <code>%red(%-5level)</code></p>
<h4 id="设置字符集-lt-charset-gt"><a href="#设置字符集-lt-charset-gt" class="headerlink" title="设置字符集 &lt;charset&gt;"></a>设置字符集 &lt;charset&gt;</h4><p><code>&lt;charset></code> 是 <code>&lt;encoder></code> 的子节点，用于设置输出字符集</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date&#123;yyyy-MM-dd HH:mm:ss.SSS, Asia/Shanghai&#125; %red(%-5level) --- [%thread] %cyan(%class.%method/%line) : %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ConsoleAppender"><a href="#ConsoleAppender" class="headerlink" title="ConsoleAppender"></a>ConsoleAppender</h4><p><code>ch.qos.logback.core.ConsoleAppender</code> 是 <code>Logback</code> 自带的 <code>appender</code>，用于将日志输出到控制台。</p>
<p>对应控制台，只需要重点配置 <code>&lt;encoder></code>节点</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;60 seconds&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date %red(%-5level) --- [%thread] %cyan(%class.%method/%line) : %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="RollingFileAppender"><a href="#RollingFileAppender" class="headerlink" title="RollingFileAppender"></a>RollingFileAppender</h4><p><code>ch.qos.logback.core.rolling.RollingFileAppender</code> 是 <code>Logback</code> 自带的 <code>Appender</code>，用于将日志输出到文件，并按照条件切换输出到新建文件(滚动输出，自动切割)</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>file</td>
<td>String</td>
<td>文件名，如果文件不存在，则创建。注意文件路径</td>
</tr>
<tr>
<td>append</td>
<td>boolean</td>
<td>true 在文件末尾追加，false 覆盖，默认 true</td>
</tr>
<tr>
<td>encoder</td>
<td>Encoder</td>
<td>编码器，设置日志输出格式和编码</td>
</tr>
<tr>
<td>rollingPolicy</td>
<td>RollingPolicy</td>
<td>滚动策略，描述该如何滚动</td>
</tr>
<tr>
<td>triggeringPolicy</td>
<td>TriggeringPolicy</td>
<td>触发策略，什么条件下触发滚动</td>
</tr>
</tbody></table>
<p>要使用 <code>RollingFileAppender RollingPolicy</code> (滚动策略)和 <code>TriggeringPolicy</code>(触发策略)必不可少。但是，如果 <code>RollingPolicy</code> 实现了 <code>TriggeringPolicy</code> 接口，则仅需要指定 <code>RollingPolicy</code>。</p>
<p><code>rollingPolicy</code>(滚动策略) 里面有一个属性叫 <code>fileNamePattern</code>，它和 <code>file</code> 属性一样都表示日志文件名。</p>
<h4 id="滚动策略-——-RollingPolicy"><a href="#滚动策略-——-RollingPolicy" class="headerlink" title="滚动策略 —— RollingPolicy"></a>滚动策略 —— RollingPolicy</h4><p><code>RollingPolicy</code> 负责日志文件的移动和重命名的过程。<br> <code>Logback</code> 提供了多种 <code>RollingPolicy</code> 的实现</p>
<ul>
<li><code>TimeBasedRollingPolicy</code> ：按时间滚动，比如按天或按月</li>
<li><code>SizeAndTimeBasedRollingPolicy</code> ：按时间和大小滚动，比如说在按天滚动的基础上设置大小，防止某天的日志文件过大！</li>
</ul>
<h4 id="TimeBasedRollingPolicy"><a href="#TimeBasedRollingPolicy" class="headerlink" title="TimeBasedRollingPolicy"></a>TimeBasedRollingPolicy</h4><p><code>TimeBasedRollingPolicy</code>可能是最受欢迎的滚动政策。它定义了基于时间的展期策略，例如按天或按月。 </p>
<p><code>ch.qos.logback.core.rolling.TimeBasedRollingPolicy</code> 滚动策略同时也实现了 <code>TriggeringPolicy</code>(触发策略)</p>
<p>因此配置好 <code>TimeBasedRollingPolicy</code> 后，就不需要配置 <code>TriggeringPolicy</code>。</p>
<p><code>TimeBasedRollingPolicy</code>的配置包含一个必选的<code>fileNamePattern</code>属性和几个可选属性。</p>
<table>
<thead>
<tr>
<th>属性名</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>fileNamePattern</td>
<td>String</td>
<td>fileNamePattern 是最为复杂也最为重要的属性，同时也是必填项，将在下文中详细介绍</td>
</tr>
<tr>
<td>maxHistory</td>
<td>Int</td>
<td>可选的 maxHistory 属性控制要保留的归档文件的最大数量，异步删除旧文件。 例如，如果您指定每月滚动，并将 maxHistory 设置为 6，则将保留近 6 个月的存档文件，并删除超过 6 个月的文件。 请注意，当旧的存档日志文件被删除时，为日志文件存档而创建的任何文件夹都将根据需要删除。<br/><br/>将 maxHistory 设置为0会禁用存档删除。 默认情况下，maxHistory 设置为0，即默认情况下不删除存档。</td>
</tr>
<tr>
<td>totalSizeCap</td>
<td>Int</td>
<td>可选的totalSizeCap属性控制所有归档文件的总大小，在 maxHistory 限制的基础上，进一步限制 所有存档文件的总大小。当超过总大小上限时，最旧的存档将被异步删除。totalSizeCap 依赖于 maxHistory ，如果没有 maxHistory ，单独设置 totalSizeCap 是不生效的。<br/><br/>TotalSizeCap 属性可以通过在数值后分别添加 KB、MB 和 GB 来指定为字节、千字节、兆字节或千兆字节的单位。 例如，5000000、5000KB、5MB 和 2GB 都是有效值，前三个是等效的。 没有后缀的数值以字节为单位。<br/><br/>默认情况下，totalSizeCap 设置为零，这意味着没有总大小上限。</td>
</tr>
<tr>
<td>cleanHistoryOnStart</td>
<td>boolean</td>
<td>如果设置为 true，则存档文件将在appender启动时删除。 默认情况下，此属性设置为 false。<br/><br/>存档删除通常在滚动期间执行。 但是，某些应用程序的生存时间可能不够长，无法触发滚动。 因此，对于此类短暂的应用程序，存档删除可能永远没有机会执行。 通过将 cleanHistoryOnStart 设置为 true，存档删除将在appender启动时执行。</td>
</tr>
</tbody></table>
<h4 id="fileNamePattern-属性"><a href="#fileNamePattern-属性" class="headerlink" title="fileNamePattern 属性"></a>fileNamePattern 属性</h4><p><code>fileNamePattern</code> 的值包含文件名以及支持绝对和相对路径和日期转换符——<code>%d</code>。</p>
<p><code>% d</code>转换符可以包含由 <code>java.text.SimpleDateFormat</code>类指定的日期和时间模式。如果省略日期和时间模式，则 采用默认模式<code>yyyy-MM-dd</code> 。滚动周期是根据<code>fileNamePattern</code>的值推断出来的。</p>
<p><code>%d</code> 表示系统当前的时间，默认格式为 %d{yyyy-MM-dd}，通过 <code>%d</code>{日期格式} 来自定义。</p>
<p><code>fileNamePattern</code> 属性内或日期和时间模式内任意位置的 正斜杠“/”或反斜杠“\”字符将被解释为目录分隔符。</p>
<p><strong>时区</strong></p>
<p>%d 默认采用主机时区，也可以自定义%d{yyyy-MM-dd,UTC+8}</p>
<p><strong>多个%d</strong></p>
<p>可以指定多个 <code>%d</code> 转换符，但只有其中一个可以是主要的，即用于推断滚动周期。</p>
<p>多个 <code>%d</code>转换符允许您以不同于滚动周期的文件夹结构来组织存档文件。 例如，下面显示的文件名模式按年和月组织日志文件夹，但每天午夜滚动更新日志文件。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/log/%d&#123;yyyy/MM, aux&#125;/myapplication.%d&#123;yyyy-MM-dd&#125;.log</span><br></pre></td></tr></table></figure>

<p><strong>自动文件压缩</strong><br><code>TimeBasedRollingPolicy</code>支持自动文件压缩。如果<code>fileNamePattern</code>选项的值 以<code style="color: green; font-weight: bold">.gz</code>或.<code style="color: green; font-weight: bold">zip</code>结尾，则启用此功能。</p>
<table>
<thead>
<tr>
<th>fileNamePattern</th>
<th><strong>Rollover schedule</strong></th>
<th><strong>Example</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>/wombat/foo.%d.gz</code></td>
<td>每日滚动（午夜），自动对存档文件进行 <code>GZIP</code> 压缩。</td>
<td>如果没有设置<code><file></code>，2009 年 11 月 23 日期间，日志将输出到文件 <code>/wombat/foo.2009-11-23</code>。但是，在午夜该文件将被压缩为 <code>/wombat/foo.2009-11-23.gz</code>。11 月 24 日，日志记录输出将定向到 <code>/wombat/folder/foo.2009-11-24</code>，以此类推。<br> 如果设置<code><file></code>为<code>/wombat/foo.txt</code>，2009 年 11 月 23 日期间，日志输出将转到文件<code>/wombat/foo.txt</code>。午夜该文件将被压缩并重命名为 <code>/wombat/foo.2009-11-23.gz</code>。并将创建一个新的 <code>/wombat/foo.tx</code>t文件，并将11月24日期间的日志记录到该文件。在11月24日午夜，<code>/wombat/foo.txt</code>将被压缩并重命名为<code>/wombat/foo.2009-11-24.gz</code>。</td>
</tr>
</tbody></table>
<p><code>fileNamePattern</code>有双重用途。首先，logback通过研究模式 计算请求的滚动周期。其次，它计算每个存档文件的名称。请注意，两种不同的模式可以指定相同的周期。模式yyyy-MM和 yyyy@MM都指定每月滚动，尽管生成的存档文件将带有不同的名称。</p>
<p>通过设置<code>&lt;file></code>属性，您可以分离活动日志文件的位置和归档日志文件的位置。日志输出将定位到文件属性指定的文件中 。由此可见，活动日志文件的名称不会随时间而改变。但是，如果您选择忽略file属性，则将根据fileNamePattern的值在每个周期重新计算活动文件名称。通过保留<code>&lt;file></code>属性未设置，您可以避免在滚动期间存在引用日志文件的外部文件句柄时发生的 文件重命名错误。</p>
<p>由于各种技术原因，滚动不是时钟驱动的，而是取决于日志记录事件的到达。例如，在 2002 年 3 月 8 日，假设 fileNamePattern设置为yyyy-MM-dd （每日滚动），则午夜后第一个事件的到达将触发滚动。如果在午夜后 23 分 47 秒期间没有记录事件，则滚动实际上将发生在 3 月 9 日上午 00:23’47，而不是上午 0:00。因此，根据事件的到达率，可能会以一定的延迟触发滚动。然而，无论延迟如何，滚动算法都已知是正确的，从某种意义上说，在特定时间段内生成的所有日志记录事件都将输出到界定该时间段的正确文件中。</p>
<h4 id="SizeAndTimeBasedRollingPolicy"><a href="#SizeAndTimeBasedRollingPolicy" class="headerlink" title="SizeAndTimeBasedRollingPolicy"></a>SizeAndTimeBasedRollingPolicy</h4><p>有时您可能希望基本上按日期归档文件，但同时限制每个日志文件的大小，特别是日志文件处理工具对大小有着明确的限制。为了满足这一要求，<code>logback</code> 附带了 <code>SizeAndTimeBasedRollingPolicy</code>.</p>
<p>请注意，<code>TimeBasedRollingPolicy</code>已经允许限制归档日志文件的组合大小。如果您只想限制日志归档的组合大小，那么 <code>TimeBasedRollingPolicy</code>上面描述的和设置<code>totalSizeCap</code>属性应该足够了。</p>
<p><code>maxFileSize</code> 属性表示单个归档日志文件的大小，单位有 <code>KB</code>、<code>MB</code>、<code>GB</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;SizeAndTimeFile&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>logs/app1/app1.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>logs/app1/backup/app1_%d_%i.zip<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--单个日志文件最大10MB--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>10MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--删除n个滚动周期之前的日志文件(最多保留前n个滚动周期的历史记录)件--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>60<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--在 maxHistory 限制的基础上，进一步限制所有存档文件的总大小--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>1GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date %-5level --- [%thread] %class.%method/%line : %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;SizeAndTimeFile&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>%i</code> 是一个滚动周期内的归档序列号，从0开始</p>
<p>注意：<code>maxHistory</code> 是表了 <code>n</code> 个滚动周期的日志文件，而不是 <code>n</code> 个的日志文件，在设置了 maxFileSize 后，一个滚动周期内可能有多个日志文件。</p>
<hr>
<h3 id="日志记录器-lt-logger-gt"><a href="#日志记录器-lt-logger-gt" class="headerlink" title="日志记录器 &lt;logger&gt;"></a>日志记录器 &lt;logger&gt;</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;&quot;</span> <span class="attr">level</span>=<span class="string">&quot;&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;&quot;</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>&lt;logger></code> 有三个属性</p>
<ul>
<li><strong>name</strong> : 包名或类名。即，将该记录器作用于哪个类或包下。必填</li>
<li><strong>level</strong> : 该记录器的级别，低于该级别的日志消息不记录。可选级别从小到大为 <strong>TRACE、DEBUG、INFO、WARN、ERROR、ALL、OFF</strong>(不区分大小写)。选填，不填则默认从父记录器继承<strong>level</strong></li>
<li><strong>additivity</strong> : 是否追加父 Logger 的输出源(appender),默认为true，选填。如果只想输出到自己的输出源(appender)，需要设置为 false</li>
</ul>
<p><code>logger</code> 还可以包含 0 或多个 <code>&lt;appender-ref&gt;</code> 元素, 将记录的日志使用 <code>appender</code> 进行输出</p>
<h4 id="level-的继承"><a href="#level-的继承" class="headerlink" title="level 的继承"></a>level 的继承</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;30 seconds&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date %level [%thread] %logger&#123;10&#125; [%file : %line] %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.wqlm.boot.user.controller.UserController&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.wqlm.boot.user.controller&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上，<code>&quot;com.wqlm.boot.user.controller.UserController&quot;</code>的 <code>logger</code> 没有定义 <code>level</code>，因此它会继承父 logger 的 level。</p>
<p>那它的父 logger 是谁呢？ 其实就是下面的 <code>&quot;com.wqlm.boot.user.controller&quot;</code>的 <code>logger</code>!</p>
<div class="note success no-icon"><p>Logback 是根据包或类的层次结构来确定 logger 的父子关系的</p>
</div>

<p><code>&quot;com.wqlm.boot.user.controller&quot;</code>的 <code>logger</code> 也没有定义 <code>level</code>，因此它也会继承它的父 <code>logger</code> 的 <code>level</code>。但是，在该 xml 中，已经没有比它层次还“浅”的 <code>logger</code> 了，因此，它的父 <code>logger</code> 为 <strong>root</strong>。也就是说它会继承 <strong>root</strong> <code>logger</code> 的 <code>level</code>，也就是 <code>info</code>。</p>
<h4 id="additivity-的追加策略"><a href="#additivity-的追加策略" class="headerlink" title="additivity 的追加策略"></a>additivity 的追加策略</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;30 seconds&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%date %level [%thread] %logger&#123;10&#125; [%file : %line] %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.wqlm.boot.user.controller.UserController&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.wqlm.boot.user.controller&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如上，<code>&quot;com.wqlm.boot.user.controller.UserController&quot;</code>的 <code>logger</code> 没有设置 <code>additivity</code>，因此 <code>additivity</code> 采用默认值 <code>true</code>，即，追加它父 <code>logger</code> 中的 <strong>appender</strong> 到自己的 <code>logger</code> 中。</p>
<p>在看它的父 <code>logger</code> —— <code>&quot;com.wqlm.boot.user.controller&quot;</code> <code>logger</code>， <code>additivity</code> 也采用默认值，因此，它也会追加它父 <code>logger</code> 中的 <strong>appender</strong> 到自己的 <code>logger</code> 中。<br> 在该 <code>xml</code> 中 <code>&quot;com.wqlm.boot.user.controller&quot;</code> <code>logger</code> 的父 <code>logger</code> 为 <code>root logger</code>！，因此，它会追加 名为 STDOUT 的 <code>appender</code> 到自己的 <code>logger</code> 中</p>
<p>刚才是从上层往下层走，直到找到显示标注 <code>appender=&quot;false&quot;</code> 的 <code>logger</code> 或 <code>root logger</code> 才停止追加。<br> 现在要从下层往上层走，把层层追加的 <code>appender</code> 往上传，直到遇到显示标注  <code>appender=&quot;false&quot;</code> 的 <code>logger</code> 才停止</p>
<p>因此，<code>&quot;com.wqlm.boot.user.controller.UserController&quot;</code>的 <code>logger</code> 中，也有一个名为 STDOUT 的 <code>appender</code>，这个 <code>appender</code> 是从它的父 <code>logger</code> 中来的</p>
<p>所以，一般情况下，只需要给 <code>root logger</code> 添加 <code>appender</code> 即可！！！其他 <code>logger</code> 都会直接或间接获取到 <code>root logger</code> 的 <code>appender</code>。</p>
<h3 id="根记录器-lt-root-gt"><a href="#根记录器-lt-root-gt" class="headerlink" title="根记录器 &lt;root&gt;"></a>根记录器 &lt;root&gt;</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该<code>&lt;root></code>元素配置根记录器。它支持单一属性，即<code>level</code>属性。它不允许任何其他属性，因为可加性标志不适用于根记录器。此外，由于根记录器已被命名为“ROOT”，因此它也不允许使用名称属性。<code>level</code> 属性的值可以是不区分大小写的字符串 <code>TRACE</code>、<code>DEBUG</code>、<code>INFO</code>、<code>WARN</code>、<code>ERROR</code>、<code>ALL</code> 或 <code>OFF</code> 之一。请注意，根记录器的级别不能设置为 <code>INHERITED</code> 或 <code>NULL</code>。</p>
<p>与元素<code>&lt;logger></code>类似，<code>&lt;root></code>元素可以包含零个或多个 <code>&lt;appender-ref></code>元素；这样引用的每个日志记录器都会添加到根记录器中。请注意，与 <code>log4j</code> 不同，<code>logback-classic</code>在配置根记录器时 不会关闭或删除任何先前引用的日志记录器。</p>
<hr>
<h4 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h4><p><code>Filter</code>：过滤器，过滤满足条件或者不满足条件的日志<br>允许组合使用，可配置多个过滤器有很多，只介绍两种常用的<code>LevelFilter</code>、<code>ThresholdFilter</code></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>值说明</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>LevelFilter</td>
<td>级别过滤器</td>
<td>精确匹配指定的日志级别</td>
<td></td>
</tr>
<tr>
<td>ThresholdFilter</td>
<td>阈值过滤</td>
<td>匹配等于或高于指定级别</td>
<td></td>
</tr>
</tbody></table>
<p>使用示例如下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 级别 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 匹配时的操作：接收（记录） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 不匹配时的操作：拒绝（不记录） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- deny all events with a level below INFO, that is TRACE and DEBUG --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 拒绝所有级别低于 INFO 的, 也就是 TRACE 和 DEBUG --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>LevelFilter属性如下:</p>
<p><code>onMatch</code>、<code>onMismatch</code>的取值类型有三种:</p>
<ul>
<li><code>DENY</code>：拒绝，不再执行后续的过滤器</li>
<li><code>NEUTRAL</code>：中性，继续执行后面的过滤器</li>
<li><code>ACCEPT</code>：接受，记录日志，不再执行后续过滤器</li>
</ul>
<hr>
<h3 id="日志有效级别"><a href="#日志有效级别" class="headerlink" title="日志有效级别"></a>日志有效级别</h3><p>记录器可以被分配级别。在类中定义 <code>ch.qos.logback.classic.Level</code>了可能的级别集（<strong>TRACE</strong>、<strong>DEBUG</strong>、<strong>INFO</strong>、<strong>WARN</strong> 和 <strong>ERROR</strong>）。</p>
<p>如果给定的记录器没有分配级别，那么它会从其最接近的祖先那里继承一个已分配级别的级别。</p>
<p>为了确保所有记录器最终都能继承级别，根记录器始终具有指定的级别。默认情况下，该级别为 <strong>DEBUG</strong>。</p>
<p>根据定义，打印方法决定日志记录请求的级别。例如，如果<code>L</code>是一个记录器实例，则该语句<code>L.info(&quot;..&quot;)</code>是 <strong>INFO</strong> 级别的日志记录语句。</p>
<p>如果日志请求的级别高于或等于其记录器的有效级别，则称该日志请求已<em>启用。</em>否则，该请求被称为被<em>禁用</em>。</p>
<div class="note success no-icon"><p><em>基本选择规则：</em></p>
<p><em>如果<code>p &gt;= q</code>，则启用 向有效级别q的记录器发出级别p的日志打印请求。</em></p>
</div>



<p>这条规则是 <code>logback</code> 的核心。它假设级别按如下顺序排序： <code>TRACE &lt; DEBUG &lt; INFO &lt;  WARN &lt; ERROR</code>。</p>
<p>以更形象的方式，以下是选择规则的工作原理。在下表中，垂直标头显示日志记录请求的级别，由<code>p</code>指定，而水平标头显示记录器的有效级别，由<code>q</code>指定。行（级别请求）和列（有效级别）的交集是由基本选择规则产生的布尔值。</p>
<p><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2023/logback/effectivelevel.png"></p>
<p>例子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ch.qos.logback.classic.Level;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line">....</span><br><span class="line"></span><br><span class="line"><span class="comment">// get a logger instance named &quot;com.foo&quot;. Let us further assume that the</span></span><br><span class="line"><span class="comment">// logger is of type  ch.qos.logback.classic.Logger so that we can</span></span><br><span class="line"><span class="comment">// set its level</span></span><br><span class="line">ch.qos.logback.classic.Logger logger = </span><br><span class="line">        (ch.qos.logback.classic.Logger) LoggerFactory.getLogger(<span class="string">&quot;com.foo&quot;</span>);</span><br><span class="line"><span class="comment">//set its Level to INFO. The setLevel() method requires a logback logger</span></span><br><span class="line">logger.setLevel(Level. INFO);</span><br><span class="line"></span><br><span class="line">Logger barlogger = LoggerFactory.getLogger(<span class="string">&quot;com.foo.Bar&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This request is enabled, because WARN &gt;= INFO</span></span><br><span class="line">logger.warn(<span class="string">&quot;Low fuel level.&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This request is disabled, because DEBUG &lt; INFO. </span></span><br><span class="line">logger.debug(<span class="string">&quot;Starting search for nearest gas station.&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// The logger instance barlogger, named &quot;com.foo.Bar&quot;, </span></span><br><span class="line"><span class="comment">// will inherit its level from the logger named </span></span><br><span class="line"><span class="comment">// &quot;com.foo&quot; Thus, the following request is enabled </span></span><br><span class="line"><span class="comment">// because INFO &gt;= INFO. </span></span><br><span class="line">barlogger.info(<span class="string">&quot;Located nearest gas station.&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// This request is disabled, because DEBUG &lt; INFO. </span></span><br><span class="line">barlogger.debug(<span class="string">&quot;Exiting gas station search&quot;</span>);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/13/Python%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/13/Python%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">Python语言基础教程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-13 19:06:31" itemprop="dateCreated datePublished" datetime="2022-03-13T19:06:31+08:00">2022-03-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-05 16:57:34" itemprop="dateModified" datetime="2023-09-05T16:57:34+08:00">2023-09-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><ol>
<li><p>单行注释 - 以#和空格开头的部分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># print(&#x27;hello,world&#x27;)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>多行注释 - 三个引号开头，三个引号结尾</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">print(&#x27;hello,world&#x27;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="变量和类型"><a href="#变量和类型" class="headerlink" title="变量和类型"></a>变量和类型</h1><h2 id="变量命名"><a href="#变量命名" class="headerlink" title="变量命名"></a>变量命名</h2><p>在Python中，变量命名需要遵循以下这些必须遵守硬性规则和强烈建议遵守的非硬性规则。</p>
<ul>
<li>硬性规则：<ul>
<li>变量名由字母（广义的Unicode字符，不包括特殊字符）、数字和下划线构成，数字不能开头。</li>
<li>大小写敏感（大写的<code>a</code>和小写的<code>A</code>是两个不同的变量）。</li>
<li>不要跟关键字（有特殊含义的单词，后面会讲到）和系统保留字（如函数、模块等的名字）冲突。</li>
</ul>
</li>
<li>PEP 8要求：<ul>
<li>用小写字母拼写，多个单词用下划线连接。</li>
<li>受保护的实例属性用单个下划线开头（后面会讲到）。</li>
<li>私有的实例属性用两个下划线开头（后面会讲到）。</li>
</ul>
</li>
</ul>
<h2 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h2><p>计算机中的变量是实际存在的数据或者说是存储器中存储数据的一块内存空间，变量的值可以被读取和修改，这是所有计算和控制的基础。计算机能处理的数据有很多种类型，除了数值之外还可以处理文本、图形、音频、视频等各种各样的数据，那么不同的数据就需要定义不同的存储类型。Python中的数据类型很多，而且也允许我们自定义新的数据类型（这一点在后面会讲到），我们先介绍几种常用的数据类型。</p>
<ul>
<li><code>整型</code>：Python中可以处理任意大小的整数（Python 2.x中有<code>int</code>和<code>long</code>两种类型的整数，但这种区分对Python来说意义不大，因此在Python 3.x中整数只有int这一种了），而且支持二进制（如<code>0b100</code>，换算成十进制是4）、八进制（如<code>0o100</code>，换算成十进制是64）、十进制（<code>100</code>）和十六进制（<code>0x100</code>，换算成十进制是256）的表示法。</li>
<li><code>浮点型</code>：浮点数也就是小数，之所以称为浮点数，是因为按照科学记数法表示时，一个浮点数的小数点位置是可变的，浮点数除了数学写法（如<code>123.456</code>）之外还支持科学计数法（如<code>1.23456e2</code>）。</li>
<li><code>字符串型</code>：字符串是以单引号或双引号括起来的任意文本，比如<code>&#39;hello&#39;</code>和<code>&quot;hello&quot;</code>,字符串还有原始字符串表示法、字节字符串表示法、Unicode字符串表示法，而且可以书写成多行的形式（用三个单引号或三个双引号开头，三个单引号或三个双引号结尾）。</li>
<li><code>布尔型</code>：布尔值只有<code>True</code>、<code>False</code>两种值，要么是<code>True</code>，要么是<code>False</code>，在Python中，可以直接用<code>True</code>、<code>False</code>表示布尔值（请注意大小写），也可以通过布尔运算计算出来（例如<code>3 &lt; 5</code>会产生布尔值<code>True</code>，而<code>2 == 1</code>会产生布尔值<code>False</code>）。</li>
<li><code>复数型</code>：形如<code>3+5j</code>，跟数学上的复数表示一样，唯一不同的是虚部的<code>i</code>换成了<code>j</code>。实际上，这个类型并不常用，大家了解一下就可以了。</li>
</ul>
<p>在Python中可以使用<code>type</code>函数对变量的类型进行检查。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">100</span></span><br><span class="line">b = <span class="number">12.345</span></span><br><span class="line">c = <span class="number">1</span> + <span class="number">5j</span></span><br><span class="line">d = <span class="string">&#x27;hello, world&#x27;</span></span><br><span class="line">e = <span class="literal">True</span></span><br><span class="line">print(<span class="built_in">type</span>(a))    <span class="comment"># &lt;class &#x27;int&#x27;&gt;</span></span><br><span class="line">print(<span class="built_in">type</span>(b))    <span class="comment"># &lt;class &#x27;float&#x27;&gt;</span></span><br><span class="line">print(<span class="built_in">type</span>(c))    <span class="comment"># &lt;class &#x27;complex&#x27;&gt;</span></span><br><span class="line">print(<span class="built_in">type</span>(d))    <span class="comment"># &lt;class &#x27;str&#x27;&gt;</span></span><br><span class="line">print(<span class="built_in">type</span>(e))    <span class="comment"># &lt;class &#x27;bool&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h2><p>可以使用Python中内置的函数对变量类型进行转换。</p>
<ul>
<li><code>int()</code>：将一个数值或字符串转换成整数，可以指定进制。</li>
<li><code>float()</code>：将一个字符串转换成浮点数。</li>
<li><code>str()</code>：将指定的对象转换成字符串形式，可以指定编码。</li>
<li><code>chr()</code>：将整数转换成该编码对应的字符串（一个字符）。</li>
<li><code>ord()</code>：将字符串（一个字符）转换成对应的编码（整数）。</li>
</ul>
<h2 id="格式化输出"><a href="#格式化输出" class="headerlink" title="格式化输出"></a>格式化输出</h2><p>下面的代码通过键盘输入两个整数来实现对两个整数的算术运算。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;a = &#x27;</span>))</span><br><span class="line">b = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;b = &#x27;</span>))</span><br><span class="line">print(<span class="string">&#x27;%d + %d = %d&#x27;</span> % (a, b, a + b))</span><br><span class="line">print(<span class="string">&#x27;%d - %d = %d&#x27;</span> % (a, b, a - b))</span><br><span class="line">print(<span class="string">&#x27;%d * %d = %d&#x27;</span> % (a, b, a * b))</span><br><span class="line">print(<span class="string">&#x27;%d / %d = %f&#x27;</span> % (a, b, a / b))</span><br><span class="line">print(<span class="string">&#x27;%d // %d = %d&#x27;</span> % (a, b, a // b))</span><br><span class="line">print(<span class="string">&#x27;%d %% %d = %d&#x27;</span> % (a, b, a % b))</span><br><span class="line">print(<span class="string">&#x27;%d ** %d = %d&#x27;</span> % (a, b, a ** b))</span><br></pre></td></tr></table></figure>

<div class="note info"><p><strong>说明</strong>：上面的print函数中输出的字符串使用了占位符语法，其中<code>%d</code>是整数的占位符，<code>%f</code>是小数的占位符，<code>%%</code>表示百分号（因为百分号代表了占位符，所以带占位符的字符串中要表示百分号必须写成<code>%%</code>），字符串之后的<code>%</code>后面跟的变量值会替换掉占位符然后输出到终端中，运行上面的程序，看看程序执行结果就明白啦。</p>
</div>

<p>除了这种格式化字符串的方式外，还可以用下面的方式来格式化字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a1 = <span class="built_in">float</span>(<span class="built_in">input</span>(<span class="string">&#x27;a1 = &#x27;</span>))</span><br><span class="line">b1 = <span class="built_in">float</span>(<span class="built_in">input</span>(<span class="string">&#x27;a1 = &#x27;</span>))</span><br><span class="line">print(<span class="string">f&#x27;<span class="subst">&#123;a1&#125;</span> + <span class="subst">&#123;b1&#125;</span> = <span class="subst">&#123;a1 + b1&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h1><h2 id="if语句的使用"><a href="#if语句的使用" class="headerlink" title="if语句的使用"></a>if语句的使用</h2><p>虽然都是用 <code>if</code> 关键词定义判断，但与<strong>C，Java</strong>等语言不同，<strong>Python</strong>不使用 <code>&#123;&#125;</code>将<code>if</code> 语句控制的区域包含起来。<strong>Python</strong>使用的是缩进方法。同时，也不需要用 <code>()</code>将判断条件括起来。</p>
<p>一个完整的 <code>if</code>结构通常如下所示（注意：条件后的 <code>:</code>是必须要的，缩进值需要一样）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if &lt;condition 1&gt;:</span><br><span class="line">    &lt;statement 1&gt;</span><br><span class="line">    &lt;statement 2&gt;</span><br><span class="line">elif &lt;condition 2&gt;: </span><br><span class="line">    &lt;statements&gt;</span><br><span class="line">else:</span><br><span class="line">    &lt;statements&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> x &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;x is positive&quot;</span></span><br><span class="line"><span class="keyword">elif</span> x == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;x is zero&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;x is negative&quot;</span></span><br><span class="line">x <span class="keyword">is</span> zero</span><br></pre></td></tr></table></figure>

<p><code>elif</code>的个数没有限制，可以是1个或者多个，也可以没有。</p>
<p><code>else</code> 最多只有1个，也可以没有。</p>
<p>可以使用 <code>and</code> ，<code>or</code>, <code>not</code>等关键词结合多个判断条件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">10</span></span><br><span class="line">y = <span class="number">-5</span></span><br><span class="line">x &gt; <span class="number">0</span> <span class="keyword">and</span> y &lt; <span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">not</span> x &gt; <span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">False</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x &lt; <span class="number">0</span> <span class="keyword">or</span> y &lt; <span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<p>这里使用这个简单的例子，假如想判断一个年份是不是闰年，按照闰年的定义，这里只需要判断这个年份是不是能被4整除，但是不能被100整除，或者正好被400整除：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">year = <span class="number">1900</span></span><br><span class="line"><span class="keyword">if</span> year % <span class="number">400</span> == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;This is a leap year!&quot;</span></span><br><span class="line"><span class="comment"># 两个条件都满足才执行</span></span><br><span class="line"><span class="keyword">elif</span> year % <span class="number">4</span> == <span class="number">0</span> <span class="keyword">and</span> year % <span class="number">100</span> != <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;This is a leap year!&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;This is not a leap year.&quot;</span></span><br><span class="line">This <span class="keyword">is</span> <span class="keyword">not</span> a leap year.</span><br></pre></td></tr></table></figure>

<h1 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h1><p>循环结构就是程序中控制某条或某些指令重复执行的结构。在Python中构造循环结构有两种做法，一种是<code>for-in</code>循环，一种是<code>while</code>循环。</p>
<h2 id="for-in循环"><a href="#for-in循环" class="headerlink" title="for-in循环"></a>for-in循环</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &lt;variable&gt; <span class="keyword">in</span> &lt;sequence&gt;:</span><br><span class="line">    &lt;indented block of code&gt;</span><br></pre></td></tr></table></figure>

<p>如果明确的知道循环执行的次数或者要对一个容器进行迭代（后面会讲到），那么我们推荐使用<code>for-in</code>循环，例如下面代码中计算1~100求和的结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>):</span><br><span class="line">    <span class="built_in">sum</span> += x</span><br><span class="line">print(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure>

<p>需要说明的是上面代码中的<code>range(1, 101)</code>可以用来构造一个从1到100的范围，当我们把这样一个范围放到<code>for-in</code>循环中，就可以通过前面的循环变量<code>x</code>依次取出从1到100的整数。当然，<code>range</code>的用法非常灵活，下面给出了一个例子：</p>
<ul>
<li><code>range(101)</code>：可以用来产生0到100范围的整数，需要注意的是取不到101。</li>
<li><code>range(1, 101)</code>：可以用来产生1到100范围的整数，相当于前面是闭区间后面是开区间。</li>
<li><code>range(1, 101, 2)</code>：可以用来产生1到100的奇数，其中2是步长，即每次数值递增的值。</li>
<li><code>range(100, 0, -2)</code>：可以用来产生100到1的偶数，其中-2是步长，即每次数字递减的值。</li>
</ul>
<p>知道了这一点，我们可以用下面的代码来实现1~100之间的偶数求和。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">101</span>, <span class="number">2</span>):</span><br><span class="line">    <span class="built_in">sum</span> += x</span><br><span class="line">print(<span class="built_in">sum</span>)</span><br></pre></td></tr></table></figure>

<h2 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h2><p>while 循环</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> &lt;condition&gt;:</span><br><span class="line">    &lt;statesments&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Python</strong>会循环执行<code>&lt;statesments&gt;</code>，直到<code>&lt;condition&gt;</code>不满足为止。</p>
<p>例如，计算数字<code>0</code>到<code>1000000</code>的和：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i &lt; <span class="number">1000000</span>:</span><br><span class="line">    total += i</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span> total</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">499999500000</span><br></pre></td></tr></table></figure>

<h2 id="continue-语句"><a href="#continue-语句" class="headerlink" title="continue 语句"></a>continue 语句</h2><p>遇到 <code>continue</code> 的时候，程序会返回到循环的最开始重新执行。</p>
<p>例如在循环中忽略一些特定的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">values = [<span class="number">7</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> values:</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="comment"># 忽略奇数</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span> i/<span class="number">2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<h2 id="break-语句"><a href="#break-语句" class="headerlink" title="break 语句"></a>break 语句</h2><p>遇到 <code>break</code> 的时候，程序会跳出循环，不管循环条件是不是满足</p>
<h2 id="else语句"><a href="#else语句" class="headerlink" title="else语句"></a>else语句</h2><p>与 <code>if</code>  一样， <code>while</code>  和 <code>for</code>  循环后面也可以跟着 <code>else</code>  语句，不过要和<code>break</code> 一起连用。</p>
<ul>
<li>当循环正常结束时，循环条件不满足， <code>else</code>  被执行；</li>
<li>当循环被 <code>break</code>  结束时，循环条件仍然满足， <code>else</code>  不执行。</li>
</ul>
<p>不执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">values = [<span class="number">7</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> values:</span><br><span class="line">    <span class="keyword">if</span> x &lt;= <span class="number">10</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Found:&#x27;</span>, x</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;All values greater than 10&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Found: 7</span><br></pre></td></tr></table></figure>

<p>执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">values = [<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">100</span>]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> values:</span><br><span class="line">    <span class="keyword">if</span> x &lt;= <span class="number">10</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;Found:&#x27;</span>, x</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;All values greater than 10&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">All values greater than 10</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="容器型数据类型"><a href="#容器型数据类型" class="headerlink" title="容器型数据类型"></a>容器型数据类型</h1><p>容器型数据类型包括：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td><code>列表(list)</code></td>
<td><code>[1, 1.2, &#39;hello&#39;]</code></td>
</tr>
<tr>
<td><code>元组(Tuple)</code></td>
<td><code>(10, 11, 12, 13, 14)</code></td>
</tr>
<tr>
<td><code>集合(set)</code></td>
<td><code>&#123;1, 2, 3, 1&#125;</code></td>
</tr>
<tr>
<td><code>字典(dict)</code></td>
<td><code>&#123;&#39;dogs&#39;: 5, &#39;pigs&#39;: 3&#125;</code></td>
</tr>
<tr>
<td><code>Numpy数组</code></td>
<td><code>array([1, 2, 3])</code></td>
</tr>
</tbody></table>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>在<strong>Python</strong>中，列表是一个有序的序列。</p>
<p>列表用一对 <code>[]</code> 生成，中间的元素用 <code>,</code>隔开，其中的元素不需要是同一类型，同时列表的长度也不固定。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>, <span class="number">2.0</span>, <span class="string">&#x27;hello&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span> l</span><br><span class="line">[<span class="number">1</span>, <span class="number">2.0</span>, <span class="string">&#x27;hello&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>空列表可以用 <code>[]</code> 或者 <code>list()</code> 生成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">empty_list = []</span><br><span class="line">empty_list</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">empty_list = <span class="built_in">list</span>()</span><br><span class="line">empty_list</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>

<p>列表操作</p>
<p>与字符串类似，列表也支持以下的操作：</p>
<h3 id="长度"><a href="#长度" class="headerlink" title="长度"></a>长度</h3><p>用 <code>len</code> 查看列表长度：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(l)</span><br></pre></td></tr></table></figure>

<p>加法和乘法</p>
<p>列表加法，相当于将两个列表按顺序连接：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = [<span class="number">3.2</span>, <span class="string">&#x27;hello&#x27;</span>]</span><br><span class="line">a + b</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 2, 3, 3.2, &#39;hello&#39;]</span><br></pre></td></tr></table></figure>

<p>列表与整数相乘，相当于将列表重复相加：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">l * <span class="number">2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 2.0, &#39;hello&#39;, 1, 2.0, &#39;hello&#39;]</span><br></pre></td></tr></table></figure>

<h3 id="索引和分片"><a href="#索引和分片" class="headerlink" title="索引和分片"></a>索引和分片</h3><p>列表和字符串一样可以通过索引和分片来查看它的元素。</p>
<p>索引：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]</span><br><span class="line">a[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure>

<p>反向索引：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">14</span><br></pre></td></tr></table></figure>

<p>分片：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="number">2</span>:<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[12, 13]</span><br></pre></td></tr></table></figure>

<p>与字符串不同的是，列表可以通过索引和分片来修改。</p>
<p>对于字符串，如果我们通过索引或者分片来修改，<strong>Python</strong>会报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"><span class="comment"># 把开头的 h 改成大写</span></span><br><span class="line">s[0] = <span class="string">&#x27;H&#x27;</span></span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-10-844622ced67a&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">      1 s = <span class="string">&quot;hello world&quot;</span></span><br><span class="line">      2 <span class="comment"># 把开头的 h 改成大写</span></span><br><span class="line">----&gt; 3 s[0] = <span class="string">&#x27;H&#x27;</span></span><br><span class="line"></span><br><span class="line">TypeError: <span class="string">&#x27;str&#x27;</span> object does not support item assignment</span><br></pre></td></tr></table></figure>

<p>而这种操作对于列表来说是可以的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]</span><br><span class="line">a[<span class="number">0</span>] = <span class="number">100</span></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[100, 11, 12, 13, 14]</span><br></pre></td></tr></table></figure>

<p>这种赋值也适用于分片，例如，将列表的第2，3两个元素换掉：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="number">1</span>:<span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[100, 1, 2, 13, 14]</span><br></pre></td></tr></table></figure>

<p>事实上，对于连续的分片（即步长为 <code>1</code> ），<strong>Python</strong>采用的是整段替换的方法，两者的元素个数并不需要相同，例如，将 <code>[11,12]</code> 替换为 <code>[1,2,3,4]</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]</span><br><span class="line">a[<span class="number">1</span>:<span class="number">3</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line"><span class="built_in">print</span> a</span><br><span class="line">[<span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">14</span>]</span><br></pre></td></tr></table></figure>

<p>这意味着，可以用这种方法来删除列表中一个连续的分片：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br><span class="line"><span class="built_in">print</span> a[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line">a[<span class="number">1</span>:<span class="number">3</span>] = []</span><br><span class="line"><span class="built_in">print</span> a</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">[<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br></pre></td></tr></table></figure>

<p>对于不连续（间隔step不为1）的片段进行修改时，两者的元素数目必须一致：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]</span><br><span class="line">a[::<span class="number">2</span>] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 11, 2, 13, 3]</span><br></pre></td></tr></table></figure>

<p>否则会报错：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a[::2] = []</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">ValueError                                Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-16-7b6c4e43a9fa&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 a[::2] = []</span><br><span class="line"></span><br><span class="line">ValueError: attempt to assign sequence of size 0 to extended slice of size 3</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="添加或删除元素"><a href="#添加或删除元素" class="headerlink" title="添加或删除元素"></a>添加或删除元素</h3><h4 id="向列表添加单个元素"><a href="#向列表添加单个元素" class="headerlink" title="向列表添加单个元素"></a>向列表添加单个元素</h4><p><code>l.append(ob)</code> 将元素 <code>ob</code> 添加到列表 <code>l</code> 的最后。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]</span><br><span class="line">a.append(<span class="number">11</span>)</span><br><span class="line">print(a)</span><br><span class="line">[<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">11</span>]</span><br></pre></td></tr></table></figure>

<p>append每次只添加一个元素，并不会因为这个元素是序列而将其展开：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.append([<span class="number">11</span>, <span class="number">12</span>])</span><br><span class="line">print(a)</span><br><span class="line">[<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">11</span>, [<span class="number">11</span>, <span class="number">12</span>]]</span><br></pre></td></tr></table></figure>

<h4 id="向列表添加序列"><a href="#向列表添加序列" class="headerlink" title="向列表添加序列"></a>向列表添加序列</h4><p><code>l.extend(lst)</code> 将序列 <code>lst</code> 的元素依次添加到列表 <code>l</code> 的最后，作用相当于 <code>l += lst</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">11</span>]</span><br><span class="line">a.extend([<span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[10, 11, 12, 11, 1, 2]</span><br></pre></td></tr></table></figure>

<h4 id="插入元素"><a href="#插入元素" class="headerlink" title="插入元素"></a>插入元素</h4><p><code>l.insert(idx, ob)</code> 在索引 <code>idx</code> 处插入<code>ob</code> ，之后的元素依次后移。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">11</span>]</span><br><span class="line"><span class="comment"># 在索引 3 插入 &#x27;a&#x27;</span></span><br><span class="line">a.insert(<span class="number">3</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[10, 11, 12, &#39;a&#39;, 13, 11]</span><br></pre></td></tr></table></figure>

<h4 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h4><p><strong>Python</strong>提供了删除列表中元素的方法<code>del</code>。</p>
<p>删除列表中的第一个元素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1002</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> a[<span class="number">0</span>]</span><br><span class="line">print(a)</span><br><span class="line">[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>删除第2到最后一个元素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1002</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> a[<span class="number">1</span>:]</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1002]</span><br></pre></td></tr></table></figure>

<p>删除间隔的元素：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">del</span> a[::<span class="number">2</span>]</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1, 2]</span><br></pre></td></tr></table></figure>

<h4 id="移除元素"><a href="#移除元素" class="headerlink" title="移除元素"></a>移除元素</h4><p><code>l.remove(ob)</code> 会将列表中第一个出现的 <code>ob</code> 删除，如果 <code>ob</code> 不在 <code>l</code> 中会报错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">11</span>]</span><br><span class="line"><span class="comment"># 移除了第一个 11</span></span><br><span class="line">a.remove(<span class="number">11</span>)</span><br><span class="line"><span class="built_in">print</span> a</span><br><span class="line">[<span class="number">10</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">11</span>]</span><br></pre></td></tr></table></figure>

<h4 id="弹出元素"><a href="#弹出元素" class="headerlink" title="弹出元素"></a>弹出元素</h4><p><code>l.pop(idx)</code> 会将索引 <code>idx</code> 处的元素删除，并返回这个元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">11</span>]</span><br><span class="line">a.pop(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12</span><br></pre></td></tr></table></figure>

<h3 id="列表遍历"><a href="#列表遍历" class="headerlink" title="列表遍历"></a>列表遍历</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">list1 = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</span><br><span class="line"><span class="comment"># 通过循环用下标遍历列表元素</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(list1)):</span><br><span class="line">    print(list1[index])</span><br><span class="line"><span class="comment"># 通过for循环遍历列表元素</span></span><br><span class="line"><span class="keyword">for</span> elem <span class="keyword">in</span> list1:</span><br><span class="line">    print(elem)</span><br><span class="line"><span class="comment"># 通过enumerate函数处理列表之后再遍历可以同时获得元素索引和值</span></span><br><span class="line"><span class="keyword">for</span> index, elem <span class="keyword">in</span> <span class="built_in">enumerate</span>(list1):</span><br><span class="line">    print(index, elem)</span><br></pre></td></tr></table></figure>

<h3 id="列表方法"><a href="#列表方法" class="headerlink" title="列表方法"></a>列表方法</h3><h4 id="测试从属关系"><a href="#测试从属关系" class="headerlink" title="测试从属关系"></a>测试从属关系</h4><p>用 <code>in</code> 来看某个元素是否在某个序列（不仅仅是列表）中，用<code>not in</code>来判断是否不在某个序列中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]</span><br><span class="line">print(<span class="number">10</span> <span class="keyword">in</span> a)</span><br><span class="line">print(<span class="number">10</span> <span class="keyword">not</span> <span class="keyword">in</span> a)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>也可以作用于字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line">print(<span class="string">&#x27;he&#x27;</span> <span class="keyword">in</span> s)</span><br><span class="line">print(<span class="string">&#x27;world&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> s)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>列表中可以包含各种对象，甚至可以包含列表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="string">&#x27;eleven&#x27;</span>, [<span class="number">12</span>, <span class="number">13</span>]]</span><br><span class="line">a[<span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[12, 13]</span><br></pre></td></tr></table></figure>

<p>a[2]是列表，可以对它再进行索引：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="number">2</span>][<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13</span><br></pre></td></tr></table></figure>

<h4 id="列表中某个元素个数count"><a href="#列表中某个元素个数count" class="headerlink" title="列表中某个元素个数count"></a>列表中某个元素个数count</h4><p><code>l.count(ob)</code> 返回列表中元素 <code>ob</code> 出现的次数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">11</span>]</span><br><span class="line">a.count(<span class="number">11</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure>

<h4 id="列表中某个元素位置index"><a href="#列表中某个元素位置index" class="headerlink" title="列表中某个元素位置index"></a>列表中某个元素位置index</h4><p><code>l.index(ob)</code> 返回列表中元素 <code>ob</code> 第一次出现的索引位置，如果 <code>ob</code> 不在 <code>l</code> 中会报错。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.index(12)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure>

<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><p><code>l.sort()</code> 会将列表中的元素按照一定的规则排序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">2</span>]</span><br><span class="line">a.sort()</span><br><span class="line">print(a)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">13</span>]</span><br></pre></td></tr></table></figure>

<p>如果不想改变原来列表中的值，可以使用 <code>sorted</code> 函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">2</span>]</span><br><span class="line">b = <span class="built_in">sorted</span>(a)</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">[<span class="number">10</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">2</span>]</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">13</span>]</span><br></pre></td></tr></table></figure>

<h3 id="列表反向"><a href="#列表反向" class="headerlink" title="列表反向"></a>列表反向</h3><p> <code>l.reverse()</code> 会将列表中的元素从后向前排列。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">a.reverse()</span><br><span class="line">print(a)</span><br><span class="line">[<span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>如果不想改变原来列表中的值，可以使用这样的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">b = a[::<span class="number">-1</span>]</span><br><span class="line">print(a)</span><br><span class="line">print(b)</span><br><span class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</span><br><span class="line">[<span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h2><p>与列表相似，元组<code>Tuple</code>也是个有序序列，但是元组是不可变的，用<code>()</code>生成。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t = (<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>)</span><br><span class="line">t</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(10, 11, 12, 13, 14)</span><br></pre></td></tr></table></figure>

<p>可以索引，切片：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t[<span class="number">1</span>:<span class="number">3</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(11, 12)</span><br></pre></td></tr></table></figure>

<p>但是元组是不可变的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 会报错</span></span><br><span class="line">t[<span class="number">0</span>] = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-4-da6c1cabf0b0&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">      1 <span class="comment"># 会报错</span></span><br><span class="line">----&gt; 2 t[0] = 1</span><br><span class="line"></span><br><span class="line">TypeError: <span class="string">&#x27;tuple&#x27;</span> object does not support item assignment</span><br></pre></td></tr></table></figure>

<h3 id="单个元素的元组生成"><a href="#单个元素的元组生成" class="headerlink" title="单个元素的元组生成"></a>单个元素的元组生成</h3><p>由于<code>()</code>在表达式中被应用，只含有单个元素的元组容易和表达式混淆，所以采用下列方式定义只有一个元素的元组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = (<span class="number">10</span>,)</span><br><span class="line">print(a)</span><br><span class="line">print(<span class="built_in">type</span>(a))</span><br><span class="line">(<span class="number">10</span>,)</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;tuple&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = (<span class="number">10</span>)</span><br><span class="line">print(<span class="built_in">type</span>(a))</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;int&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>将列表转换为元组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>]</span><br><span class="line"><span class="built_in">tuple</span>(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(10, 11, 12, 13, 14)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 获取元组中的元素</span><br><span class="line">print(a[0])</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure>

<h3 id="元组方法"><a href="#元组方法" class="headerlink" title="元组方法"></a>元组方法</h3><p>由于元组是不可变的，所以只能有一些不可变的方法，例如计算元素个数 <code>count</code> 和元素位置 <code>index</code> ，用法与列表一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.count(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.index(<span class="number">12</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p><strong>Python</strong>中可以使用一对单引号’’或者双引号””生成字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;hello, world&quot;</span></span><br><span class="line"><span class="built_in">print</span> s</span><br><span class="line">hello, world</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"><span class="built_in">print</span> s</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hello,</span><br><span class="line">world!</span><br><span class="line">hello,</span><br><span class="line">python!</span><br></pre></td></tr></table></figure>

<p>Python 用一对 <code>"""</code> 或者 <code>'''</code> 来生成多行字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">strs = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">hello,</span></span><br><span class="line"><span class="string">world!</span></span><br><span class="line"><span class="string">hello,</span></span><br><span class="line"><span class="string">python!</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">print(strs)</span><br></pre></td></tr></table></figure>

<p>可以在字符串中使用（反斜杠）来表示转义，也就是说<code>\</code>后面的字符不再是它原来的意义，例如：<code>\n</code>不是代表反斜杠和字符n，而是表示换行；而<code>\t</code>也不是代表反斜杠和字符t，而是表示制表符。所以如果想在字符串中表示<code>&#39;</code>要写成<code>\&#39;</code>，同理想表示<code>\</code>要写成<code>\\</code>。可以运行下面的代码看看会输出什么。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">&#x27;\&#x27;hello, world!\&#x27;&#x27;</span></span><br><span class="line">s2 = <span class="string">&#x27;\n\\hello, world!\\\n&#x27;</span></span><br><span class="line">print(s1, s2, end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#39;hello, world!&#39; </span><br><span class="line">\hello, world!\</span><br></pre></td></tr></table></figure>

<p>我们可以通过在字符串的最前面加上字母<code>r</code>来表示原始字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">r&#x27;\&#x27;hello, world!\&#x27;&#x27;</span></span><br><span class="line">s2 = <span class="string">r&#x27;\n\\hello, world!\\\n&#x27;</span></span><br><span class="line">print(s1, s2, end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\&#39;hello, world!\&#39; \n\\hello, world!\\\n</span><br></pre></td></tr></table></figure>

<p>格式化字符串还有更为简洁的书写方式，就是在字符串前加上字母<code>f</code>，我们可以使用下面的语法糖来简化上面的代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a, b = <span class="number">5</span>, <span class="number">10</span></span><br><span class="line">print(<span class="string">f&#x27;<span class="subst">&#123;a&#125;</span> * <span class="subst">&#123;b&#125;</span> = <span class="subst">&#123;a * b&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5 * 10 &#x3D; 50</span><br></pre></td></tr></table></figure>

<h3 id="简单操作"><a href="#简单操作" class="headerlink" title="简单操作"></a>简单操作</h3><p>加法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello &#x27;</span> + <span class="string">&#x27;world&#x27;</span></span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;hello world&#39;</span><br></pre></td></tr></table></figure>

<p>字符串与数字相乘：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;echo&quot;</span> * <span class="number">3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;echoechoecho&#39;</span><br></pre></td></tr></table></figure>

<p>字符串长度：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">len</span>(s)</span><br></pre></td></tr></table></figure>

<p>使用<code>in</code>和<code>not in</code>来判断一个字符串是否包含另外一个字符串（成员运算）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello,world&#x27;</span></span><br><span class="line">print(<span class="string">&#x27;hello&#x27;</span> <span class="keyword">in</span> s) //<span class="literal">True</span></span><br><span class="line">print(<span class="string">&#x27;good&#x27;</span> <span class="keyword">in</span> s) //<span class="literal">False</span></span><br></pre></td></tr></table></figure>

<h3 id="索引和切片"><a href="#索引和切片" class="headerlink" title="索引和切片"></a>索引和切片</h3><p>我们也可以用<code>[]</code>和<code>[:]</code>运算符从字符串取出某个字符或某些字符（切片运算）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello,world&#x27;</span></span><br><span class="line"><span class="comment"># 从字符串中取出指定位置的字符(下标运算)</span></span><br><span class="line">print(s[<span class="number">2</span>]) <span class="comment"># l</span></span><br><span class="line"><span class="comment"># 字符串切片(从指定的开始索引到指定的结束索引)</span></span><br><span class="line">print(s[<span class="number">2</span>:<span class="number">5</span>]) <span class="comment"># llo</span></span><br><span class="line">print(s[<span class="number">2</span>:]) <span class="comment"># llo,world</span></span><br><span class="line">print(s[<span class="number">2</span>::<span class="number">2</span>]) <span class="comment"># lowrd</span></span><br><span class="line">print(s[::<span class="number">2</span>]) <span class="comment"># hlowrd</span></span><br><span class="line">print(s[::<span class="number">-1</span>]) <span class="comment"># dlrow,olleh</span></span><br><span class="line">print(s[<span class="number">-3</span>:<span class="number">-1</span>]) <span class="comment"># rl</span></span><br></pre></td></tr></table></figure>

<h3 id="字符串的遍历"><a href="#字符串的遍历" class="headerlink" title="字符串的遍历"></a>字符串的遍历</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 第一种方式，<span class="keyword">for</span> <span class="keyword">in</span></span><br><span class="line">strs = <span class="string">&#x27;hello,world&#x27;</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strs:</span><br><span class="line">    print(s)</span><br><span class="line">    </span><br><span class="line">// 第二种方式，内置函数<span class="built_in">range</span>()或xrange（）</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(strs)):</span><br><span class="line">    print(strs[i])</span><br><span class="line"></span><br><span class="line">// 第三种方式，内置函数<span class="built_in">enumerate</span>()</span><br><span class="line"><span class="keyword">for</span> index, <span class="built_in">str</span> <span class="keyword">in</span> <span class="built_in">enumerate</span>(strs):</span><br><span class="line">    print(index,<span class="built_in">str</span>)</span><br><span class="line">    </span><br><span class="line">// 第四种方式，内置函数<span class="built_in">iter</span>()</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">str</span> <span class="keyword">in</span> <span class="built_in">iter</span>(strs):</span><br><span class="line">    print(<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure>

<h3 id="字符串方法"><a href="#字符串方法" class="headerlink" title="字符串方法"></a>字符串方法</h3><h4 id="大小写转换"><a href="#大小写转换" class="headerlink" title="大小写转换"></a>大小写转换</h4><p><code>s.upper()</code>方法返回一个将s中的字母全部大写的新字符串。</p>
<p><code>s.lower()</code>方法返回一个将s中的字母全部小写的新字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;hello world&quot;</span>.upper()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;HELLO WORLD&#39;</span><br></pre></td></tr></table></figure>

<p>这两种方法也不会改变原来s的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;HELLO WORLD&quot;</span></span><br><span class="line">print(s.lower())</span><br><span class="line">print(s)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello world</span><br><span class="line">HELLO WORLD</span><br></pre></td></tr></table></figure>

<h4 id="首字母大写"><a href="#首字母大写" class="headerlink" title="首字母大写"></a>首字母大写</h4><p><code>s.capitalize()</code>方法返回一个将s中首字母大写的新字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello,world&#x27;</span></span><br><span class="line">print(s.capitalize()) //Hello,world</span><br></pre></td></tr></table></figure>

<p><code>s.title()</code>方法返回一个将s中每个首字母大写的新字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(s.title())</span><br><span class="line">Hello,World</span><br></pre></td></tr></table></figure>

<div class="note danger"><p>str类型是不可变类型</p>
</div>

<h4 id="查找子串"><a href="#查找子串" class="headerlink" title="查找子串"></a>查找子串</h4><p><code>s.index()</code>从左到右查找子串，可以指定起始查找位置，默认是0</p>
<p><code>s.rindex()</code> 则是从右向左查找</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;hello,world&#x27;</span></span><br><span class="line">print(s.index(<span class="string">&#x27;l&#x27;</span>))</span><br><span class="line">print(s.index(<span class="string">&#x27;l&#x27;</span>,<span class="number">3</span>))</span><br><span class="line">print(s.rindex(<span class="string">&#x27;l&#x27;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">3</span><br><span class="line">9</span><br></pre></td></tr></table></figure>

<p>如果查找不到则会程序报错</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(s.index(<span class="string">&#x27;re&#x27;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;&#x2F;Users&#x2F;mac7&#x2F;PycharmProjects&#x2F;pythonBasic&#x2F;helloworld.py&quot;, line 114, in &lt;module&gt;</span><br><span class="line">    print(s.index(&#39;re&#39;))</span><br><span class="line">ValueError: substring not found</span><br></pre></td></tr></table></figure>

<p><code>s.find()</code> 查找不到则会返回-1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(s.find(<span class="string">&#x27;l&#x27;</span>))</span><br><span class="line">print(s.find(<span class="string">&#x27;oo&#x27;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">-1</span><br></pre></td></tr></table></figure>

<h4 id="格式化输出-1"><a href="#格式化输出-1" class="headerlink" title="格式化输出"></a>格式化输出</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将字符串以指定的宽度居中并在两侧填充指定的字符</span></span><br><span class="line">print(s.center(<span class="number">50</span>, <span class="string">&#x27;*&#x27;</span>))</span><br><span class="line"><span class="comment"># 将字符串以指定的宽度靠右放置左侧填充指定的字符</span></span><br><span class="line">print(s.rjust(<span class="number">50</span>, <span class="string">&#x27;-&#x27;</span>))</span><br><span class="line"><span class="comment"># 将字符串以指定的宽度靠左放置右侧填充指定的字符</span></span><br><span class="line">print(s.ljust(<span class="number">50</span>, <span class="string">&#x27;-&#x27;</span>))</span><br><span class="line"><span class="comment"># 0填充,使得字符串的长度达到指定的长度</span></span><br><span class="line">n = <span class="string">&#x27;12345&#x27;</span></span><br><span class="line">print(n.zfill(<span class="number">10</span>))</span><br><span class="line"><span class="comment"># The original string is returned if width is less than or equal to len(s).</span></span><br><span class="line"><span class="comment"># 如果指定的长度小于等于原始的长度，则返回原始的字符串</span></span><br><span class="line">n = <span class="string">&#x27;12345&#x27;</span></span><br><span class="line">print(n.zfill(<span class="number">5</span>)) // <span class="number">12345</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*******************hello,world********************</span><br><span class="line">---------------------------------------hello,world</span><br><span class="line">hello,world---------------------------------------</span><br><span class="line">0000012345</span><br></pre></td></tr></table></figure>

<h4 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h4><p><strong>Python</strong>用字符串的<code>format()</code>方法来格式化字符串。</p>
<p>具体用法如下，字符串中花括号 <code>&#123;&#125;</code> 的部分会被format传入的参数替代，传入的值可以是字符串，也可以是数字或者别的对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a, b = <span class="number">5</span>, <span class="number">10</span></span><br><span class="line">print(<span class="string">&#x27;&#123;&#125; * &#123;&#125; = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(a, b, a * b))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5 * 10 &#x3D; 50</span><br></pre></td></tr></table></figure>

<p>可以用数字指定传入参数的相对位置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#123;2&#125; &#123;1&#125; &#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;c b a&#39;</span><br></pre></td></tr></table></figure>

<p>还可以指定传入参数的名称：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#123;color&#125; &#123;n&#125; &#123;x&#125;&#x27;</span>.<span class="built_in">format</span>(n=<span class="number">10</span>, x=<span class="number">1.5</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>可以在一起混用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#123;color&#125; &#123;0&#125; &#123;x&#125; &#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="number">10</span>, <span class="string">&#x27;foo&#x27;</span>, x = <span class="number">1.5</span>, color=<span class="string">&#x27;blue&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;blue 10 1.5 foo&#39;</span><br></pre></td></tr></table></figure>

<p>Python 3.6以后，格式化字符串还有更为简洁的书写方式，就是在字符串前加上字母<code>f</code>，我们可以使用下面的语法糖来简化上面的代码。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a, b = <span class="number">5</span>, <span class="number">10</span></span><br><span class="line">print(<span class="string">f&#x27;<span class="subst">&#123;a&#125;</span> * <span class="subst">&#123;b&#125;</span> = <span class="subst">&#123;a * b&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h4 id="去除多余空格"><a href="#去除多余空格" class="headerlink" title="去除多余空格"></a>去除多余空格</h4><p><code>s.strip()</code>返回一个将s两端的多余空格除去的新字符串。</p>
<p><code>s.lstrip()</code>返回一个将s开头的多余空格除去的新字符串。</p>
<p><code>s.rstrip()</code>返回一个将s结尾的多余空格除去的新字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;  hello world   &quot;</span></span><br><span class="line">s.strip()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;hello world&#39;</span><br></pre></td></tr></table></figure>

<p>s的值依然不会变化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(s)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;  hello world   &#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.lstrip()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;hello world   &#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.rstrip()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;  hello world&#39;</span><br></pre></td></tr></table></figure>

<h4 id="分割与连接"><a href="#分割与连接" class="headerlink" title="分割与连接"></a>分割与连接</h4><p><code>s.split()</code>将s按照空格（包括多个空格，制表符<code>\t</code>，换行符<code>\n</code>等）分割，并返回所有分割得到的字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">line = <span class="string">&quot;1 2 3 4  5&quot;</span></span><br><span class="line">numbers = line.split()</span><br><span class="line"><span class="built_in">print</span> numbers</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>s.split(sep)</code>以给定的sep为分隔符对s进行分割。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">line = <span class="string">&quot;1,2,3,4,5&quot;</span></span><br><span class="line">numbers = line.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span> numbers</span><br><span class="line">[<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>源码定义如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split</span>(<span class="params">self, *args, **kwargs</span>):</span> <span class="comment"># real signature unknown</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Return a list of the words in the string, using sep as the delimiter string.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">      sep  参数一：指定的分割字符</span></span><br><span class="line"><span class="string">        The delimiter according which to split the string.</span></span><br><span class="line"><span class="string">        None (the default value) means split according to any whitespace,</span></span><br><span class="line"><span class="string">        and discard empty strings from the result.</span></span><br><span class="line"><span class="string">      maxsplit  参数二：最大允许分割数量，不指定则默认-1</span></span><br><span class="line"><span class="string">        Maximum number of splits to do.</span></span><br><span class="line"><span class="string">        -1 (the default value) means no limit. </span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">line = <span class="string">&quot;1,2,3,4,5,6&quot;</span></span><br><span class="line">numbers = line.split(<span class="string">&quot;,&quot;</span>,maxsplit=<span class="number">3</span>)</span><br><span class="line">print(numbers)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4,5,6&#39;]</span><br></pre></td></tr></table></figure>

<p><code>s.rsplit()</code>则是从右向左拆分</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;i love you&quot;</span></span><br><span class="line">print(s.rsplit(<span class="string">&quot; &quot;</span>, <span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#39;i love&#39;, &#39;you&#39;]</span><br></pre></td></tr></table></figure>

<p>与分割相反，<code>s.join(str_sequence)</code>的作用是以s为连接符将字符串序列str_sequence中的元素连接起来，并返回连接后得到的新字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">strList = [<span class="string">&quot;i&quot;</span>,<span class="string">&quot;love&quot;</span>,<span class="string">&quot;you&quot;</span>]</span><br><span class="line">s = <span class="string">&#x27; &#x27;</span></span><br><span class="line">joinStr = s.join(strList)</span><br><span class="line">print(joinStr)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i love you</span><br></pre></td></tr></table></figure>

<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><p>之前看到的列表和字符串都是一种有序序列，而集合 <code>set</code> 是一种无序的序列。</p>
<p>因为集合是无序的，所以当集合中存在两个同样的元素的时候，Python只会保存其中的一个（唯一性）；同时为了确保其中不包含同样的元素，集合中放入的元素只能是不可变的对象（确定性）。</p>
<h3 id="定义集合"><a href="#定义集合" class="headerlink" title="定义集合"></a>定义集合</h3><p>可以用<code>set()</code>函数来显示的生成空集合：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">set</span>()</span><br><span class="line"><span class="built_in">type</span>(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set</span><br></pre></td></tr></table></figure>

<p>也可以使用一个列表来初始化一个集合：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">set</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>])</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 3&#125;</span><br></pre></td></tr></table></figure>

<p>集合会自动去除重复元素 <code>1</code>。</p>
<p>可以看到，集合中的元素是用大括号<code>&#123;&#125;</code>包含起来的，这意味着可以用<code>&#123;&#125;</code>的形式来创建集合：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>&#125;</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 3&#125;</span><br></pre></td></tr></table></figure>

<p>但是创建空集合的时候只能用<code>set</code>来创建，因为在Python中<code>&#123;&#125;</code>创建的是一个空的字典：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = &#123;&#125;</span><br><span class="line"><span class="built_in">type</span>(s)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict</span><br></pre></td></tr></table></figure>

<h3 id="成员运算"><a href="#成员运算" class="headerlink" title="成员运算"></a>成员运算</h3><p>集合的成员变量在效率上是远远高于列表运算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;</span><br><span class="line">print(<span class="number">1</span> <span class="keyword">in</span> <span class="built_in">set</span>)</span><br><span class="line">print(<span class="number">7</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">set</span>)</span><br></pre></td></tr></table></figure>

<h3 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h3><img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2022/python%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/python-set.png" style="zoom:67%;" />

<p>假设有这样两个集合：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">b = &#123;<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="并"><a href="#并" class="headerlink" title="并"></a>并</h4><p>两个集合的并，返回包含两个集合所有元素的集合（去除重复）。</p>
<p>可以用方法 <code>a.union(b)</code> 或者操作 <code>a | b</code> 实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.union(b)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 3, 4, 5, 6&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b.union(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 3, 4, 5, 6&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a | b</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 3, 4, 5, 6&#125;</span><br></pre></td></tr></table></figure>

<h4 id="交"><a href="#交" class="headerlink" title="交"></a>交</h4><p>两个集合的交，返回包含两个集合共有元素的集合。</p>
<p>可以用方法 <code>a.intersection(b)</code> 或者操作 <code>a & b</code> 实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.intersection(b)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;3, 4&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b.intersection(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;3, 4&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &amp; b</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;3, 4&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(a &amp; b)</span><br><span class="line">set([3, 4])</span><br></pre></td></tr></table></figure>

<p>注意：一般使用print打印set的结果与表示方法并不一致。</p>
<h4 id="差"><a href="#差" class="headerlink" title="差"></a>差</h4><p><code>a</code> 和 <code>b</code> 的差集，返回只在 <code>a</code> 不在 <code>b</code> 的元素组成的集合。</p>
<p>可以用方法 <code>a.difference(b)</code> 或者操作 <code>a - b</code> 实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.difference(b)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a - b</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2&#125;</span><br></pre></td></tr></table></figure>

<p>注意，<code>a - b</code> 与 <code>b - a</code>并不一样，<code>b - a</code> 返回的是返回 b 不在 a 的元素组成的集合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b.difference(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;5, 6&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b - a </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;5, 6&#125;</span><br></pre></td></tr></table></figure>

<h4 id="对称差"><a href="#对称差" class="headerlink" title="对称差"></a>对称差</h4><p><code>a</code> 和<code>b</code> 的对称差集，返回在 <code>a</code> 或在 <code>b</code> 中，但是不同时在 <code>a</code> 和 <code>b</code> 中的元素组成的集合。</p>
<p>可以用方法 <code>a.symmetric_difference(b)</code> 或者操作 <code>a ^ b</code> 实现（异或操作符）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.symmetric_difference(b)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 5, 6&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b.symmetric_difference(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 5, 6&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a ^ b</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 5, 6&#125;</span><br></pre></td></tr></table></figure>

<h3 id="包含关系"><a href="#包含关系" class="headerlink" title="包含关系"></a>包含关系</h3><p>假设现在有这样两个集合：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">b = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>

<p>要判断 <code>b</code> 是不是 <code>a</code> 的子集，可以用 <code>b.issubset(a)</code>  方法，或者更简单的用操作 <code>b <= a</code>  ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b.issubset(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b &lt;= a</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<p>与之对应，也可以用 <code>a.issuperset(b)</code> 或者 <code>a >= b</code> 来判断：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.issuperset(b)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &gt;= b</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<p>方法只能用来测试子集，但是操作符可以用来判断真子集：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &lt;= a</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<p>自己不是自己的真子集：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &lt; a</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">False</span><br></pre></td></tr></table></figure>

<h4 id="集合方法"><a href="#集合方法" class="headerlink" title="集合方法"></a>集合方法</h4><h5 id="add-方法向集合添加单个元素"><a href="#add-方法向集合添加单个元素" class="headerlink" title="add 方法向集合添加单个元素"></a><code>add</code> 方法向集合添加单个元素</h5><p>跟列表的 <code>append</code> 方法类似，用来向集合添加单个元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.add(a)</span><br></pre></td></tr></table></figure>

<p>将元素 <code>a</code> 加入集合 <code>s</code> 中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">t.add(<span class="number">5</span>)</span><br><span class="line">print(t)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 3, 5&#125;</span><br></pre></td></tr></table></figure>

<p>如果添加的是已有元素，集合不改变：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t.add(<span class="number">3</span>)</span><br><span class="line">print(t)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 3, 5&#125;</span><br></pre></td></tr></table></figure>

<h5 id="update-方法向集合添加多个元素"><a href="#update-方法向集合添加多个元素" class="headerlink" title="update 方法向集合添加多个元素"></a><code>update</code> 方法向集合添加多个元素</h5><p>跟列表的<code>extend</code>方法类似，用来向集合添加多个元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.update(seq)</span><br></pre></td></tr></table></figure>

<p>将<code>seq</code>中的元素添加到<code>s</code>中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t.update([<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>])</span><br><span class="line">print(t)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1, 2, 3, 5, 6, 7&#125;</span><br></pre></td></tr></table></figure>

<h5 id="remove-方法移除单个元素"><a href="#remove-方法移除单个元素" class="headerlink" title="remove 方法移除单个元素"></a><code>remove</code> 方法移除单个元素</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.remove(ob)</span><br></pre></td></tr></table></figure>

<p>从集合<code>s</code>中移除元素<code>ob</code>，如果不存在会报错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t.remove(<span class="number">1</span>)</span><br><span class="line">print(t)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;2, 3, 5, 6, 7&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">t.remove(10)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">KeyError                                  Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-31-3bc25c5e1ff4&gt; in &lt;module&gt;()</span><br><span class="line">----&gt; 1 t.remove(10)</span><br><span class="line"></span><br><span class="line">KeyError: 10</span><br></pre></td></tr></table></figure>

<h5 id="pop方法弹出元素"><a href="#pop方法弹出元素" class="headerlink" title="pop方法弹出元素"></a>pop方法弹出元素</h5><p>由于集合没有顺序，不能像列表一样按照位置弹出元素，所以<code>pop</code> 方法删除并返回集合中任意一个元素，如果集合中没有元素会报错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.pop()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;3, 5, 6, 7&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(t)</span><br><span class="line"><span class="built_in">set</span>([<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s &#x3D; set()</span><br><span class="line"># 报错</span><br><span class="line">s.pop()</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">KeyError                                  Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-34-9f9e06c962e6&gt; in &lt;module&gt;()</span><br><span class="line">      1 s &#x3D; set()</span><br><span class="line">      2 # 报错</span><br><span class="line">----&gt; 3 s.pop()</span><br><span class="line"></span><br><span class="line">KeyError: &#39;pop from an empty set&#39;</span><br></pre></td></tr></table></figure>

<h5 id="discard-方法"><a href="#discard-方法" class="headerlink" title="discard 方法"></a>discard 方法</h5><p>作用与 <code>remove</code> 一样，但是当元素在集合中不存在的时候不会报错。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t.discard(<span class="number">3</span>)</span><br><span class="line">print(t)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;5, 6, 7&#125;</span><br></pre></td></tr></table></figure>

<p>不存在的元素不会报错：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t.discard(<span class="number">20</span>)</span><br><span class="line">print(t)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;5, 6, 7&#125;</span><br></pre></td></tr></table></figure>

<h5 id="difference-update方法"><a href="#difference-update方法" class="headerlink" title="difference_update方法"></a>difference_update方法</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.difference_update(b)</span><br></pre></td></tr></table></figure>

<p>从a中去除所有属于b的元素：</p>
<h5 id="清空集合"><a href="#清空集合" class="headerlink" title="清空集合"></a>清空集合</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.clear()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>字典 <code>dictionary</code>  ，在一些编程语言中也称为 <code>hash</code>  ， <code>map</code>  ，是一种由键值对组成的数据结构。</p>
<p>顾名思义，我们把键想象成字典中的单词，值想象成词对应的定义，那么——</p>
<p>一个词可以对应一个或者多个定义，但是这些定义只能通过这个词来进行查询。</p>
<h3 id="初始化字典"><a href="#初始化字典" class="headerlink" title="初始化字典"></a>初始化字典</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建字典的字面量语法</span></span><br><span class="line">b = &#123;<span class="string">&#x27;one&#x27;</span>: <span class="string">&#x27;this is number 1&#x27;</span>, <span class="string">&#x27;two&#x27;</span>: <span class="string">&#x27;this is number 2&#x27;</span>&#125;</span><br><span class="line"><span class="comment"># 创建字典的构造器语法</span></span><br><span class="line">items1 = <span class="built_in">dict</span>(one=<span class="number">1</span>, two=<span class="number">2</span>, three=<span class="number">3</span>, four=<span class="number">4</span>)</span><br><span class="line"><span class="comment"># 创建字典的推导式语法</span></span><br><span class="line">items3 = &#123;num: num ** <span class="number">2</span> <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>)&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Python</strong> 使用 <code>&#123;&#125;</code> 或者 <code>dict()</code> 来创建一个空的字典：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;&#125;</span><br><span class="line"><span class="built_in">type</span>(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">dict</span>()</span><br><span class="line"><span class="built_in">type</span>(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict</span><br></pre></td></tr></table></figure>

<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><p>有了dict之后，可以用索引键值的方法向其中添加元素，也可以通过索引来查看元素的值：</p>
<h4 id="插入键值"><a href="#插入键值" class="headerlink" title="插入键值"></a>插入键值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="string">&quot;one&quot;</span>] = <span class="string">&quot;this is number 1&quot;</span></span><br><span class="line">a[<span class="string">&quot;two&quot;</span>] = <span class="string">&quot;this is number 2&quot;</span></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;one&#39;: &#39;this is number 1&#39;, &#39;two&#39;: &#39;this is number 2&#39;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="查看键值"><a href="#查看键值" class="headerlink" title="查看键值"></a>查看键值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="string">&#x27;one&#x27;</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;this is number 1&#39;</span><br></pre></td></tr></table></figure>

<h4 id="更新键值"><a href="#更新键值" class="headerlink" title="更新键值"></a>更新键值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a[<span class="string">&quot;one&quot;</span>] = <span class="string">&quot;this is number 1, too&quot;</span></span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;one&#39;: &#39;this is number 1, too&#39;, &#39;two&#39;: &#39;this is number 2&#39;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对字典中所有键值对进行遍历</span></span><br><span class="line">dic = <span class="built_in">dict</span>(one=<span class="number">1</span>, two=<span class="number">2</span>, three=<span class="number">3</span>, four=<span class="number">4</span>)</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> dic:</span><br><span class="line">    print(<span class="string">f&#x27;<span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;dic[key]&#125;</span>&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 遍历字典中所以的值</span></span><br><span class="line"><span class="keyword">for</span> value <span class="keyword">in</span> dic.values():</span><br><span class="line">    print(value)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 遍历键值对    </span></span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> dic.items():</span><br><span class="line">    print(key, value)</span><br></pre></td></tr></table></figure>

<h3 id="字典没有顺序"><a href="#字典没有顺序" class="headerlink" title="字典没有顺序"></a>字典没有顺序</h3><p>当我们 <code>print</code> 一个字典时，<strong>Python</strong>并不一定按照插入键值的先后顺序进行显示,因为字典中的键本身不一定是有序的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> a</span><br><span class="line">&#123;<span class="string">&#x27;two&#x27;</span>: <span class="string">&#x27;this is number 2&#x27;</span>, <span class="string">&#x27;one&#x27;</span>: <span class="string">&#x27;this is number 1, too&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> b</span><br><span class="line">&#123;<span class="string">&#x27;two&#x27;</span>: <span class="string">&#x27;this is number 2&#x27;</span>, <span class="string">&#x27;one&#x27;</span>: <span class="string">&#x27;this is number 1&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>因此，<strong>Python</strong>中不能用支持用数字索引按顺序查看字典中的值，而且数字本身也有可能成为键值，这样会引起混淆：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 会报错</span><br><span class="line">a[0]</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">KeyError                                  Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-9-cc39af2a359c&gt; in &lt;module&gt;()</span><br><span class="line">      1 # 会报错</span><br><span class="line">----&gt; 2 a[0]</span><br><span class="line"></span><br><span class="line">KeyError: 0</span><br></pre></td></tr></table></figure>

<h3 id="使用-dict-初始化字典"><a href="#使用-dict-初始化字典" class="headerlink" title="使用 dict 初始化字典"></a>使用 dict 初始化字典</h3><p>除了通常的定义方式，还可以通过 <code>dict()</code> 转化来生成字典：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">inventory = <span class="built_in">dict</span>(</span><br><span class="line">    [(<span class="string">&#x27;foozelator&#x27;</span>, <span class="number">123</span>),</span><br><span class="line">     (<span class="string">&#x27;frombicator&#x27;</span>, <span class="number">18</span>), </span><br><span class="line">     (<span class="string">&#x27;spatzleblock&#x27;</span>, <span class="number">34</span>), </span><br><span class="line">     (<span class="string">&#x27;snitzelhogen&#x27;</span>, <span class="number">23</span>)</span><br><span class="line">    ])</span><br><span class="line">inventory</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;foozelator&#39;: 123, &#39;frombicator&#39;: 18, &#39;snitzelhogen&#39;: 23, &#39;spatzleblock&#39;: 34&#125;</span><br></pre></td></tr></table></figure>

<p>利用索引直接更新键值对：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inventory[<span class="string">&#x27;frombicator&#x27;</span>] += <span class="number">1</span></span><br><span class="line">inventory</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;foozelator&#39;: 123, &#39;frombicator&#39;: 19, &#39;snitzelhogen&#39;: 23, &#39;spatzleblock&#39;: 34&#125;</span><br></pre></td></tr></table></figure>

<h2 id="适合做键的类型"><a href="#适合做键的类型" class="headerlink" title="适合做键的类型"></a>适合做键的类型</h2><p>在不可变类型中，<code>整数</code>和<code>字符串</code>是字典中最常用的类型；而<code>浮点数</code>通常不推荐用来做键，原因如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;&#125;</span><br><span class="line">data[<span class="number">1.1</span> + <span class="number">2.2</span>] = <span class="number">6.6</span></span><br><span class="line"><span class="comment"># 会报错</span></span><br><span class="line">data[<span class="number">3.3</span>]</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">KeyError                                  Traceback (most recent call last)</span><br><span class="line">&lt;ipython-<span class="built_in">input</span><span class="number">-16</span>-a48e87d01daa&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">      <span class="number">2</span> data[<span class="number">1.1</span> + <span class="number">2.2</span>] = <span class="number">6.6</span></span><br><span class="line">      <span class="number">3</span> <span class="comment"># 会报错</span></span><br><span class="line">----&gt; 4 data[3.3]</span><br><span class="line"></span><br><span class="line">KeyError: <span class="number">3.3</span></span><br></pre></td></tr></table></figure>

<p>事实上，观察<code>data</code>的值就会发现，这个错误是由浮点数的精度问题所引起的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;3.3000000000000003: 6.6&#125;</span><br></pre></td></tr></table></figure>

<p>有时候，也可以使用元组作为键值，例如，可以用元组做键来表示从第一个城市飞往第二个城市航班数的多少：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">connections = &#123;&#125;</span><br><span class="line">connections[(<span class="string">&#x27;New York&#x27;</span>, <span class="string">&#x27;Seattle&#x27;</span>)] = <span class="number">100</span></span><br><span class="line">connections[(<span class="string">&#x27;Austin&#x27;</span>, <span class="string">&#x27;New York&#x27;</span>)] = <span class="number">200</span></span><br><span class="line">connections[(<span class="string">&#x27;New York&#x27;</span>, <span class="string">&#x27;Austin&#x27;</span>)] = <span class="number">400</span></span><br></pre></td></tr></table></figure>

<p>元组是有序的，因此 <code>('New York', 'Austin')</code> 和 <code>('Austin', 'New York')</code> 是两个不同的键：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> connections[(<span class="string">&#x27;Austin&#x27;</span>, <span class="string">&#x27;New York&#x27;</span>)]</span><br><span class="line"><span class="built_in">print</span> connections[(<span class="string">&#x27;New York&#x27;</span>, <span class="string">&#x27;Austin&#x27;</span>)]</span><br><span class="line"><span class="number">200</span></span><br><span class="line"><span class="number">400</span></span><br></pre></td></tr></table></figure>

<h2 id="字典方法"><a href="#字典方法" class="headerlink" title="字典方法"></a>字典方法</h2><h3 id="get-方法"><a href="#get-方法" class="headerlink" title="get 方法"></a><code>get</code> 方法</h3><p>之前已经见过，用索引可以找到一个键对应的值，但是当字典中没有这个键的时候，Python会报错，这时候可以使用字典的  <code>get</code> 方法来处理这种情况，其用法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d.get(key, default = <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>返回字典中键 <code>key</code> 对应的值，如果没有这个键，返回 <code>default</code>  指定的值（默认是 <code>None</code>  ）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;&#125;</span><br><span class="line">a[<span class="string">&quot;one&quot;</span>] = <span class="string">&quot;this is number 1&quot;</span></span><br><span class="line">a[<span class="string">&quot;two&quot;</span>] = <span class="string">&quot;this is number 2&quot;</span></span><br></pre></td></tr></table></figure>

<p>索引不存在的键值会报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a[&quot;three&quot;]</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">KeyError                                  Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-22-8a5f2913f00e&gt; in &lt;module&gt;()</span><br><span class="line">----&gt; 1 a[&quot;three&quot;]</span><br><span class="line"></span><br><span class="line">KeyError: &#39;three&#39;</span><br></pre></td></tr></table></figure>

<p>改用get方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> a.get(<span class="string">&quot;three&quot;</span>)</span><br><span class="line"><span class="literal">None</span></span><br></pre></td></tr></table></figure>

<p>指定默认值参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.get(<span class="string">&quot;three&quot;</span>, <span class="string">&quot;undefined&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;undefined&#39;</span><br></pre></td></tr></table></figure>

<h3 id="pop-方法删除元素"><a href="#pop-方法删除元素" class="headerlink" title="pop 方法删除元素"></a><code>pop</code> 方法删除元素</h3><p><code>pop()</code> 方法可以用来弹出字典中某个键对应的值，同时也可以指定默认参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d.pop(key, default = <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>删除并返回字典中键 <code>key</code>  对应的值，如果没有这个键，返回 <code>default</code>  指定的值（默认是 <code>None</code>  ）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;one&#39;: &#39;this is number 1&#39;, &#39;two&#39;: &#39;this is number 2&#39;&#125;</span><br></pre></td></tr></table></figure>

<p>弹出并返回值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(a.pop(<span class="string">&quot;two&quot;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;this is number 2&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;one&#39;: &#39;this is number 1&#39;&#125;</span><br></pre></td></tr></table></figure>

<p>弹出不存在的键值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.pop(<span class="string">&quot;two&quot;</span>, <span class="string">&#x27;not exist&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;not exist&#39;</span><br></pre></td></tr></table></figure>

<p>与列表一样，<code>del</code> 函数可以用来删除字典中特定的键值对，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> a[<span class="string">&quot;one&quot;</span>]</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>可以用<code>popItem()</code> 方法删除最后一个元素</p>
<h3 id="update方法更新字典"><a href="#update方法更新字典" class="headerlink" title="update方法更新字典"></a><code>update</code>方法更新字典</h3><p>之前已经知道，可以通过索引来插入、修改单个键值对，但是如果想对多个键值对进行操作，这种方法就显得比较麻烦，好在有 <code>update</code> 方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d.update(newd)</span><br></pre></td></tr></table></figure>

<p>将字典<code>newd</code>中的内容更新到<code>d</code>中去。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">person = &#123;&#125;</span><br><span class="line">person[<span class="string">&#x27;first&#x27;</span>] = <span class="string">&quot;Jmes&quot;</span></span><br><span class="line">person[<span class="string">&#x27;last&#x27;</span>] = <span class="string">&quot;Maxwell&quot;</span></span><br><span class="line">person[<span class="string">&#x27;born&#x27;</span>] = <span class="number">1831</span></span><br><span class="line"><span class="built_in">print</span> person</span><br><span class="line">&#123;<span class="string">&#x27;born&#x27;</span>: <span class="number">1831</span>, <span class="string">&#x27;last&#x27;</span>: <span class="string">&#x27;Maxwell&#x27;</span>, <span class="string">&#x27;first&#x27;</span>: <span class="string">&#x27;Jmes&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>把’first’改成’James’，同时插入’middle’的值’Clerk’：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">person_modifications = &#123;<span class="string">&#x27;first&#x27;</span>: <span class="string">&#x27;James&#x27;</span>, <span class="string">&#x27;middle&#x27;</span>: <span class="string">&#x27;Clerk&#x27;</span>&#125;</span><br><span class="line">person.update(person_modifications)</span><br><span class="line"><span class="built_in">print</span> person</span><br><span class="line">&#123;<span class="string">&#x27;middle&#x27;</span>: <span class="string">&#x27;Clerk&#x27;</span>, <span class="string">&#x27;born&#x27;</span>: <span class="number">1831</span>, <span class="string">&#x27;last&#x27;</span>: <span class="string">&#x27;Maxwell&#x27;</span>, <span class="string">&#x27;first&#x27;</span>: <span class="string">&#x27;James&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>类似的方法还有<code>a.setdefault()</code></p>
<p><code>If key is in the dictionary, return its value.</code><br><code>If not, insert key with a value of default and return default. default defaults to None.</code></p>
<h3 id="in查询字典中是否有该键"><a href="#in查询字典中是否有该键" class="headerlink" title="in查询字典中是否有该键"></a><code>in</code>查询字典中是否有该键</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">barn = &#123;<span class="string">&#x27;cows&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;dogs&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;cats&#x27;</span>: <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>

<p><code>in</code> 可以用来判断字典中是否有某个特定的键：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;chickens&#x27;</span> <span class="keyword">in</span> barn</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">False</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;cows&#x27;</span> <span class="keyword">in</span> barn</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">True</span><br></pre></td></tr></table></figure>

<h3 id="字典键值互换"><a href="#字典键值互换" class="headerlink" title="字典键值互换"></a>字典键值互换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="string">&#x27;one&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;two&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;three&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line">b = <span class="built_in">dict</span>(<span class="built_in">zip</span>(a.values(),a.keys()))</span><br><span class="line">print(b)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;1: &#39;one&#39;, 2: &#39;two&#39;, 3: &#39;three&#39;&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h2><p>函数<code>function</code> ，通常接受输入参数，并有返回值。</p>
<p>它负责完成某项特定任务，而且相较于其他代码，具备相对的独立性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">    a = x + y</span><br><span class="line">    <span class="keyword">return</span> a</span><br></pre></td></tr></table></figure>

<p>函数通常有一下几个特征：</p>
<ul>
<li>使用 <code>def</code> 关键词来定义一个函数。</li>
<li><code>def</code> 后面是函数的名称，括号中是函数的参数，不同的参数用 <code>,</code> 隔开， <code>def foo():</code> 的形式是必须要有的，参数可以为空；</li>
<li>使用缩进来划分函数的内容；</li>
<li><code>docstring</code> 用 <code>"""</code> 包含的字符串，用来解释函数的用途，可省略；</li>
<li><code>return</code> 返回特定的值，如果省略，返回 <code>None</code> 。</li>
</ul>
<p>函数的文档注释：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Add two numbers</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param x: 需要求和的参数一</span></span><br><span class="line"><span class="string">    :param y: 需要求和的参数二</span></span><br><span class="line"><span class="string">    :return: 求和的结果</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    a = x + y</span><br><span class="line">    <span class="keyword">return</span> a</span><br></pre></td></tr></table></figure>

<p>效果如下:</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2022/python%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/pythonDocumentComments.png" style="zoom:70%;" />

<h2 id="使用函数"><a href="#使用函数" class="headerlink" title="使用函数"></a>使用函数</h2><p>使用函数时，只需要将参数换成特定的值传给函数。</p>
<p><strong>Python</strong>并没有限定参数的类型，因此可以使用不同的参数类型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> add(<span class="number">2</span>, <span class="number">3</span>) <span class="comment"># 5</span></span><br><span class="line"><span class="built_in">print</span> add(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>) <span class="comment"># foobar</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，如果传入的两个参数不可以相加，那么<strong>Python</strong>会将报错：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> add(<span class="number">2</span>, <span class="string">&quot;foo&quot;</span>)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-<span class="built_in">input</span><span class="number">-3</span><span class="number">-6</span>f8dcf7eb280&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 print add(2, &quot;foo&quot;)</span><br><span class="line"></span><br><span class="line">&lt;ipython-<span class="built_in">input</span><span class="number">-1</span>-e831943cfaf2&gt; <span class="keyword">in</span> add(x, y)</span><br><span class="line">      <span class="number">1</span> <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">      <span class="number">2</span>     <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">----&gt; 3     a = x + y</span><br><span class="line">      <span class="number">4</span>     <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">TypeError: unsupported operand <span class="built_in">type</span>(s) <span class="keyword">for</span> +: <span class="string">&#x27;int&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;str&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如果传入的参数数目与实际不符合，也会报错：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-<span class="built_in">input</span><span class="number">-4</span>-ed7bae31fc7d&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 print add(1, 2, 3)</span><br><span class="line"></span><br><span class="line">TypeError: add() takes exactly <span class="number">2</span> arguments (<span class="number">3</span> given)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> add(<span class="number">1</span>)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-<span class="built_in">input</span><span class="number">-5</span>-a954233d3b0d&gt; <span class="keyword">in</span> &lt;module&gt;()</span><br><span class="line">----&gt; 1 print add(1)</span><br><span class="line"></span><br><span class="line">TypeError: add() takes exactly <span class="number">2</span> arguments (<span class="number">1</span> given)</span><br></pre></td></tr></table></figure>

<p>传入参数时，Python提供了两种选项，第一种是上面使用的按照位置传入参数，另一种则是使用关键词模式，显式地指定参数的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> add(x=<span class="number">2</span>, y=<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span> add(y=<span class="string">&quot;foo&quot;</span>, x=<span class="string">&quot;bar&quot;</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line">barfoo</span><br></pre></td></tr></table></figure>

<p>可以混合这两种模式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> add(<span class="number">2</span>, y=<span class="number">3</span>)</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

<h2 id="设定参数默认值"><a href="#设定参数默认值" class="headerlink" title="设定参数默认值"></a>设定参数默认值</h2><p>可以在函数定义的时候给参数设定默认值，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quad</span>(<span class="params">x, a=<span class="number">1</span>, b=<span class="number">0</span>, c=<span class="number">0</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> a*x**<span class="number">2</span> + b*x + c</span><br></pre></td></tr></table></figure>

<p>可以省略有默认值的参数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print quad(2.0)</span><br><span class="line">4.0</span><br></pre></td></tr></table></figure>

<p>可以修改参数的默认值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> quad(<span class="number">2.0</span>, b=<span class="number">3</span>)</span><br><span class="line"><span class="number">10.0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> quad(<span class="number">2.0</span>, <span class="number">2</span>, c=<span class="number">4</span>)</span><br><span class="line"><span class="number">12.0</span></span><br></pre></td></tr></table></figure>

<p>这里混合了位置和指定两种参数传入方式，第二个2是传给 <code>a</code> 的。</p>
<p>注意，在使用混合语法时，要注意不能给同一个值赋值多次，否则会报错，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">print quad(2.0, 2, a&#x3D;2)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">TypeError                                 Traceback (most recent call last)</span><br><span class="line">&lt;ipython-input-12-101d0c090bbb&gt; in &lt;module&gt;()</span><br><span class="line">----&gt; 1 print quad(2.0, 2, a&#x3D;2)</span><br><span class="line"></span><br><span class="line">TypeError: quad() got multiple values for keyword argument &#39;a&#39;</span><br></pre></td></tr></table></figure>

<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><div class="note info"><p>A scope is a textual region of a Python program where a namespace is directly accessible. “Directly accessible” here means that an unqualified reference to a name attempts to find the name in the namespace.</p>
</div>

<p>在一个 python 程序中，直接访问一个变量，会从内到外依次访问所有的作用域直到找到，否则会报未定义的错误。</p>
<p>变量的作用域决定了在哪一部分程序可以访问哪个特定的变量名称。Python 的作用域一共有4种，分别是：</p>
<p>有四种作用域：</p>
<ul>
<li><strong>L（Local）</strong>：最内层，包含局部变量，比如一个函数/方法内部。</li>
<li><strong>E（Enclosing）</strong>：包含了非局部(non-local)也非全局(non-global)的变量。比如两个嵌套函数，一个函数（或类） A 里面又包含了一个函数 B ，那么对于 B 中的名称来说 A 中的作用域就为 nonlocal。</li>
<li><strong>G（Global）</strong>：当前脚本的最外层，比如当前模块的全局变量。</li>
<li><strong>B（Built-in）</strong>： 包含了内建的变量/关键字等，最后被搜索。</li>
</ul>
<p>规则顺序： <strong>L –&gt; E –&gt; G –&gt; B</strong>。</p>
<p>在局部找不到，便会去局部外的局部找（例如闭包），再找不到就会去全局找，再者去内置中找。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">g_count = <span class="number">0</span>  <span class="comment"># 全局作用域</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    o_count = <span class="number">1</span>  <span class="comment"># 闭包函数外的函数中</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        i_count = <span class="number">2</span>  <span class="comment"># 局部作用域</span></span><br></pre></td></tr></table></figure>

<p>内置作用域是通过一个名为 builtin 的标准模块来实现的，但是这个变量名自身并没有放入内置作用域内，所以必须导入这个文件才能够使用它。在Python3.0中，可以使用以下的代码来查看到底预定义了哪些变量:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import builtins</span><br><span class="line">&gt;&gt;&gt; dir(builtins)</span><br></pre></td></tr></table></figure>

<p>Python 中只有模块（module），类（class）以及函数（def、lambda）才会引入新的作用域，其它的代码块（如 if/elif/else/、try/except、for/while等）是不会引入新的作用域的，也就是说这些语句内定义的变量，外部也可以访问，如下代码：</p>
<h3 id="global-和-nonlocal关键字"><a href="#global-和-nonlocal关键字" class="headerlink" title="global 和 nonlocal关键字"></a>global 和 nonlocal关键字</h3><p>当内部作用域想修改外部作用域的变量时，就要用到 global 和 nonlocal 关键字了。</p>
<p><strong>global声明使用全局变量或者将一个局部变量放到全局变量中</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun1</span>():</span></span><br><span class="line">    <span class="keyword">global</span> num  <span class="comment"># 需要使用 global 关键字声明</span></span><br><span class="line">    print(num)</span><br><span class="line">    num = <span class="number">123</span></span><br><span class="line">    print(num)</span><br><span class="line">fun1()</span><br><span class="line">print(num)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">123</span><br><span class="line">123</span><br></pre></td></tr></table></figure>

<p><strong>nonlocal声明使用嵌套作用域变量（不使用局部变量）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outer</span>():</span></span><br><span class="line">    num = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>():</span></span><br><span class="line">        <span class="keyword">nonlocal</span> num   <span class="comment"># nonlocal关键字声明</span></span><br><span class="line">        num = <span class="number">100</span></span><br><span class="line">        print(num)</span><br><span class="line">    inner()</span><br><span class="line">    print(num)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">100</span><br><span class="line">100</span><br></pre></td></tr></table></figure>

<h2 id="用模块管理函数"><a href="#用模块管理函数" class="headerlink" title="用模块管理函数"></a>用模块管理函数</h2><p>对于任何一种编程语言来说，给变量、函数这样的标识符起名字都是一个让人头疼的问题，因为我们会遇到命名冲突这种尴尬的情况。最简单的场景就是在同一个.py文件中定义了两个同名函数，由于Python没有函数重载的概念，那么后面的定义会覆盖之前的定义，也就意味着两个函数同名函数实际上只有一个是存在的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;hello, world!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;goodbye, world!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面的代码会输出什么呢？</span></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>当然上面的这种情况我们很容易就能避免，但是如果项目是由多人协作进行团队开发的时候，团队中可能有多个程序员都定义了名为<code>foo</code>的函数，那么怎么解决这种命名冲突呢？答案其实很简单，Python中每个文件就代表了一个模块（module），我们在不同的模块中可以有同名的函数，在使用函数的时候我们通过<code>import</code>关键字导入指定的模块就可以区分到底要使用的是哪个模块中的<code>foo</code>函数，代码如下所示。</p>
<p><code>module1.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;hello, world!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>module2.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    print(<span class="string">&#x27;goodbye, world!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><code>test.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> module1 <span class="keyword">import</span> foo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出hello, world!</span></span><br><span class="line"></span><br><span class="line">foo()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> module2 <span class="keyword">import</span> foo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出goodbye, world!</span></span><br><span class="line"></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>也可以按照如下所示的方式来区分到底要使用哪一个<code>foo</code>函数。</p>
<p><code>test.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> module1 <span class="keyword">as</span> m1</span><br><span class="line"><span class="keyword">import</span> module2 <span class="keyword">as</span> m2</span><br><span class="line"></span><br><span class="line">m1.foo()</span><br><span class="line">m2.foo()</span><br></pre></td></tr></table></figure>

<p>但是如果将代码写成了下面的样子，那么程序中调用的是最后导入的那个<code>foo</code>，因为后导入的foo覆盖了之前导入的<code>foo</code>。</p>
<p><code>test.py</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from module1 import foo</span><br><span class="line">from module2 import foo</span><br><span class="line"></span><br><span class="line"># 输出goodbye, world!</span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p><code>test.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> module2 <span class="keyword">import</span> foo</span><br><span class="line"><span class="keyword">from</span> module1 <span class="keyword">import</span> foo</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出hello, world!</span></span><br><span class="line"></span><br><span class="line">foo()</span><br></pre></td></tr></table></figure>

<p>需要说明的是，如果我们导入的模块除了定义函数之外还有可以执行代码，那么Python解释器在导入这个模块时就会执行这些代码，事实上我们可能并不希望如此，因此如果我们在模块中编写了执行代码，最好是将这些执行代码放入如下所示的条件中，这样的话除非直接运行该模块，if条件下的这些代码是不会执行的，因为只有直接执行的模块的名字才是”<strong>main</strong>“。</p>
<p><code>module3.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bar</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># __name__是Python中一个隐含的变量它代表了模块的名字</span></span><br><span class="line"><span class="comment"># 只有被Python解释器直接执行的模块的名字才是__main__</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    print(<span class="string">&#x27;call foo()&#x27;</span>)</span><br><span class="line">    foo()</span><br><span class="line">    print(<span class="string">&#x27;call bar()&#x27;</span>)</span><br><span class="line">    bar()</span><br></pre></td></tr></table></figure>

<p><code>test.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> module3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导入module3时 不会执行模块中if条件成立时的代码 因为模块的名字是module3而不是__main</span></span><br></pre></td></tr></table></figure>

<h2 id="接收不定参数"><a href="#接收不定参数" class="headerlink" title="接收不定参数"></a>接收不定参数</h2><p>使用如下方法，可以使函数接受不定数目的参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, *args</span>):</span></span><br><span class="line">    total = x</span><br><span class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> args:</span><br><span class="line">        total += arg</span><br><span class="line">    <span class="keyword">return</span> total</span><br></pre></td></tr></table></figure>

<p>这里，<code>*args</code> 表示参数数目不定，可以看成一个元组，把第一个参数后面的参数当作元组中的元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(add(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">print(add(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="number">10</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure>

<h2 id="关键字参数"><a href="#关键字参数" class="headerlink" title="关键字参数"></a>关键字参数</h2><p>这样定义的函数不能使用关键词传入参数，要使用关键词，可以这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, **kwargs</span>):</span></span><br><span class="line">    total = x</span><br><span class="line">    <span class="keyword">for</span> arg, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">        print(<span class="string">&quot;adding &quot;</span>, arg)</span><br><span class="line">        total += value</span><br><span class="line">    <span class="keyword">return</span> total</span><br></pre></td></tr></table></figure>

<p>这里， <code>**kwargs</code> 表示参数数目不定，相当于一个字典，关键词和值对应于键值对。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(add(<span class="number">10</span>, y=<span class="number">11</span>, z=<span class="number">12</span>, w=<span class="number">13</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adding  y</span><br><span class="line">adding  z</span><br><span class="line">adding  w</span><br><span class="line">46</span><br></pre></td></tr></table></figure>

<p>再看这个例子，可以接收任意数目的位置参数和键值对参数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">foo</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">    print(args, kwargs)</span><br><span class="line"></span><br><span class="line">foo(<span class="number">2</span>, <span class="number">3</span>, x=<span class="string">&#x27;bar&#x27;</span>, z=<span class="number">10</span>)</span><br><span class="line">(<span class="number">2</span>, <span class="number">3</span>) &#123;<span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">10</span>&#125;</span><br></pre></td></tr></table></figure>

<p>不过要按顺序传入参数，先传入位置参数 <code>args</code> ，在传入关键词参数 <code>kwargs</code> 。</p>
<h2 id="命名关键字参数"><a href="#命名关键字参数" class="headerlink" title="命名关键字参数"></a>命名关键字参数</h2><p>如果要限制关键字参数的名字，就可以用命名关键字参数，例如，只接收city和job作为关键字参数。<br>这种方式定义的函数如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">person</span>(<span class="params">name, age, *, city, job</span>)</span></span><br><span class="line"><span class="function">    <span class="title">print</span>(<span class="params">name, age, city, job</span>)</span></span><br><span class="line"><span class="function"># 调用</span></span><br><span class="line"><span class="function"><span class="title">person</span>(<span class="params"><span class="string">&#x27;city&#x27;</span>, <span class="number">22</span>, city=<span class="string">&#x27;Beijing&#x27;</span>, job=<span class="string">&#x27;IT&#x27;</span></span>)</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">yjc</span> <span class="number">22</span> Beijing IT</span><br></pre></td></tr></table></figure>

<p>和关键字参数<code>**kw</code>不同，命名关键字参数需要一个特殊的分隔符<code>*</code>，<code>*</code>后面的参数被视为<code>命名关键字参数</code>。<br>命名关键字参数必须传入参数名，这和位置参数不同。如果没有传入参数名，调用将报错。</p>
<h2 id="返回多个值"><a href="#返回多个值" class="headerlink" title="返回多个值"></a>返回多个值</h2><p>函数可以返回多个值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> atan2</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_polar</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    r = (x**<span class="number">2</span> + y**<span class="number">2</span>) ** <span class="number">0.5</span></span><br><span class="line">    theta = atan2(y, x)</span><br><span class="line">    <span class="keyword">return</span> r, theta</span><br><span class="line"></span><br><span class="line">r, theta = to_polar(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">print(r, theta)</span><br><span class="line"><span class="number">5.0</span> <span class="number">0.927295218002</span></span><br></pre></td></tr></table></figure>

<p>事实上，<strong>Python</strong>将返回的两个值变成了元组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(to_polar(<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">(<span class="number">5.0</span>, <span class="number">0.9272952180016122</span>)</span><br></pre></td></tr></table></figure>

<p>因为这个元组中有两个值，所以可以使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r, theta &#x3D; to_polar(3, 4)</span><br></pre></td></tr></table></figure>

<p>给两个值赋值。</p>
<p>列表也有相似的功能：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a, b, c = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">print(a, b, c) <span class="comment">#1 2 3</span></span><br></pre></td></tr></table></figure>

<p>事实上，不仅仅返回值可以用元组表示，也可以将参数用元组以这种方式传入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">    a = x + y</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">    </span><br><span class="line">z = (<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span> add(*z) <span class="comment">#5</span></span><br></pre></td></tr></table></figure>

<p>这里的<code>*</code>必不可少。</p>
<p>事实上，还可以通过字典传入参数来执行函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">    a = x + y</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">w = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;y&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="built_in">print</span> add(**w) <span class="comment"># 5</span></span><br></pre></td></tr></table></figure>

<h2 id="map-方法生成序列"><a href="#map-方法生成序列" class="headerlink" title="map 方法生成序列"></a>map 方法生成序列</h2><p>可以通过 <code>map</code> 的方式利用函数来生成序列：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sqr</span>(<span class="params">x</span>):</span> </span><br><span class="line">    <span class="keyword">return</span> x ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line">a = [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">map</span>(sqr, a)</span><br></pre></td></tr></table></figure>

<p><code>map</code>方法返回一个迭代器:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[4, 9, 16]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="built_in">list</span>(<span class="built_in">map</span>(sqr, a))) <span class="comment"># [4, 9, 16]</span></span><br></pre></td></tr></table></figure>

<p>其用法为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">map</span>(aFun, aSeq)</span><br></pre></td></tr></table></figure>

<p>将函数 <code>aFun</code> 应用到序列 <code>aSeq</code> 上的每一个元素上，返回一个迭代器，不管这个序列原来是什么类型。</p>
<p>事实上，根据函数参数的多少，<code>map</code> 可以接受多组序列，将其对应的元素作为参数传入函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = (<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">b = [<span class="number">10</span>,<span class="number">5</span>,<span class="number">3</span>]</span><br><span class="line">print(<span class="built_in">list</span>(<span class="built_in">map</span>(add, a, b))) <span class="comment"># [12, 8, 7]</span></span><br></pre></td></tr></table></figure>

<h2 id="一等函数"><a href="#一等函数" class="headerlink" title="一等函数"></a>一等函数</h2><p>Python中的函数是一等函数</p>
<ul>
<li>函数可以作为函数的参数</li>
<li>函数可以作为函数的返回值</li>
<li>函数可以赋值给变量</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate</span>(<span class="params">init_value, fn, *args, **kwargs</span>):</span></span><br><span class="line">    total = init_value</span><br><span class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> args:</span><br><span class="line">        total = fn(total, arg)</span><br><span class="line">    <span class="keyword">for</span> kwarg <span class="keyword">in</span> kwargs.values():</span><br><span class="line">        total = fn(total, kwarg)</span><br><span class="line">    <span class="keyword">return</span> total</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 乘</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multipication</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(calculate(<span class="number">0</span>, add, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">print(calculate(<span class="number">1</span>, multipication, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">24</span><br></pre></td></tr></table></figure>

<h2 id="Lambda函数"><a href="#Lambda函数" class="headerlink" title="Lambda函数"></a>Lambda函数</h2><p>关键字<code>lambda</code>表示匿名函数，冒号前面的表示函数参数。</p>
<p>匿名函数有个限制，就是只能有一个表达式，不用写<code>return</code>，返回值就是该表达式的结果。</p>
<p>用匿名函数有个好处，因为函数没有名字，不必担心函数名冲突。此外，匿名函数也是一个函数对象，也可以把匿名函数赋值给一个变量，再利用变量来调用该函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(calculate(<span class="number">0</span>, <span class="keyword">lambda</span> a, b: a + b, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line">print(calculate(<span class="number">1</span>, <span class="keyword">lambda</span> a, b: a * b, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10</span><br><span class="line">24</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="模块和包"><a href="#模块和包" class="headerlink" title="模块和包"></a>模块和包</h1><h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p>Python会将所有 <code>.py</code> 结尾的文件认定为Python代码文件，<strong>在 Python 中，一个 .py 文件就称之为一个模块（Module）。</strong>考虑下面的脚本 <code>ex1.py</code> ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">%%writefile ex1.py</span><br><span class="line"></span><br><span class="line">PI = <span class="number">3.1416</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">lst</span>):</span></span><br><span class="line">    tot = lst[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> lst[<span class="number">1</span>:]:</span><br><span class="line">        tot = tot + value</span><br><span class="line">    <span class="keyword">return</span> tot</span><br><span class="line">    </span><br><span class="line">w = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">print(<span class="built_in">sum</span>(w), PI)</span><br></pre></td></tr></table></figure>

<p>可以执行它：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%run ex1.py</span><br><span class="line"><span class="number">6</span> <span class="number">3.1416</span></span><br></pre></td></tr></table></figure>

<p>这个脚本可以当作一个模块，可以使用<code>import</code> 关键词加载并执行它（这里要求<code>ex1.py</code>在当前工作目录）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ex1</span><br><span class="line"><span class="number">6</span> <span class="number">3.1416</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ex1)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;module &#39;ex1&#39; from &#39;ex1.py&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>在导入时，<strong>Python</strong>会执行一遍模块中的所有内容。</p>
<p><code>ex1.py</code> 中所有的变量都被载入了当前环境中，不过要使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ex1.变量名</span><br></pre></td></tr></table></figure>

<p>的方法来查看或者修改这些变量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(ex1.PI) <span class="comment"># 3.1416</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ex1.PI = <span class="number">3.141592653</span></span><br><span class="line">print(ex1.PI)</span><br><span class="line"><span class="number">3.141592653</span></span><br></pre></td></tr></table></figure>

<p>还可以用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ex1.函数名</span><br></pre></td></tr></table></figure>

<p>调用模块里面的函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(ex1.<span class="built_in">sum</span>([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]))</span><br><span class="line"><span class="number">9</span></span><br></pre></td></tr></table></figure>

<p>为了提高效率，<strong>Python</strong>只会载入模块一次，已经载入的模块再次载入时，Python并不会真正执行载入操作，哪怕模块的内容已经改变。</p>
<p>例如，这里重新导入 <code>ex1</code> 时，并不会执行 <code>ex1.py</code> 中的 <code>print</code> 语句：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ex1</span><br></pre></td></tr></table></figure>

<p>需要重新导入模块时，可以使用<code>reload</code>强制重新载入它，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reload(ex1)</span><br><span class="line"><span class="number">6</span> <span class="number">3.1416</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;module &#39;ex1&#39; from &#39;ex1.pyc&#39;&gt;</span><br></pre></td></tr></table></figure>

<p>删除之前生成的文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.remove(<span class="string">&#x27;ex1.py&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="name-属性"><a href="#name-属性" class="headerlink" title="__name__ 属性"></a><code>__name__</code> 属性</h2><p>有时候我们想将一个 <code>.py</code> 文件既当作脚本，又能当作模块用，这个时候可以使用 <code>__name__</code> 这个属性。</p>
<p>只有当文件被当作脚本执行的时候，<code>__name__</code>的值才会是 <code>__main__</code>，所以我们可以：</p>
<p><code>ex2.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PI = <span class="number">3.1416</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">lst</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Sum the values in a list</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    tot = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> lst:</span><br><span class="line">        tot = tot + value</span><br><span class="line">    <span class="keyword">return</span> tot</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="string">&quot; Add two values.&quot;</span></span><br><span class="line">    a = x + y</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    w = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">sum</span>(w) == <span class="number">6</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;test passed.&#x27;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    test()</span><br><span class="line">Writing ex2.py</span><br></pre></td></tr></table></figure>

<p>运行文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%run ex2.py</span><br><span class="line">test passed.</span><br></pre></td></tr></table></figure>

<p>当作模块导入， <code>test()</code> 不会执行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ex2</span><br></pre></td></tr></table></figure>

<p>但是可以使用其中的变量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ex2.PI</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3.1416</span><br></pre></td></tr></table></figure>

<p>使用别名：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ex2 <span class="keyword">as</span> e2</span><br><span class="line">e2.PI</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3.1416</span><br></pre></td></tr></table></figure>

<h2 id="其他导入方法"><a href="#其他导入方法" class="headerlink" title="其他导入方法"></a>其他导入方法</h2><p>可以从模块中导入变量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ex2 <span class="keyword">import</span> add, PI</span><br></pre></td></tr></table></figure>

<p>使用 <code>from</code> 后，可以直接使用<code>add</code> ， <code>PI</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(add(<span class="number">2</span>, <span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure>

<p>或者使用 <code>*</code> 导入所有变量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ex2 <span class="keyword">import</span> *</span><br><span class="line">add(<span class="number">3</span>, <span class="number">4.5</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7.5</span><br></pre></td></tr></table></figure>

<p>这种导入方法不是很提倡，因为如果你不确定导入的都有哪些，可能覆盖一些已有的函数。</p>
<p>删除文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.remove(<span class="string">&#x27;ex2.py&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><p>假设我们有这样的一个文件夹：</p>
<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2022/python%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/pythonPackage.png" style="zoom:67%;" />

<p>foo/</p>
<ul>
<li><code>__init__.py</code></li>
<li><code>bar.py</code> (defines func)</li>
<li><code>baz.py</code> (defines zap)</li>
</ul>
<p>这意味着 foo 是一个包，我们可以这样导入其中的内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> foo.bar <span class="keyword">import</span> func</span><br><span class="line"><span class="keyword">from</span> foo.baz <span class="keyword">import</span> zap</span><br></pre></td></tr></table></figure>

<p><code>bar</code> 和 <code>baz</code> 都是 <code>foo</code> 文件夹下的 <code>.py</code> 文件。</p>
<p>导入包要求：</p>
<ul>
<li>文件夹 <code>foo</code> 在<strong>Python</strong>的搜索路径中</li>
<li><code>__init__.py</code> 表示 <code>foo</code> 是一个包，它可以是个空文件。</li>
</ul>
<h3 id="解决命名冲突"><a href="#解决命名冲突" class="headerlink" title="解决命名冲突"></a>解决命名冲突</h3><p><strong>方式一：导入函数的时候，对函数进行别名</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> foo.person <span class="keyword">import</span> eat <span class="keyword">as</span> person_eat</span><br><span class="line"><span class="keyword">from</span> foo.animal <span class="keyword">import</span> eat <span class="keyword">as</span> animal_eat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">person_eat()</span><br><span class="line">animal_eat()</span><br></pre></td></tr></table></figure>

<p><strong>方式二：使用完全限定名（qualified name）–&gt;[包名.]模块名.函数名</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> foo.person</span><br><span class="line"><span class="keyword">import</span> foo.animal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">foo.person.eat()</span><br><span class="line">foo.animal.eat()</span><br></pre></td></tr></table></figure>

<h2 id="常用的标准库"><a href="#常用的标准库" class="headerlink" title="常用的标准库"></a>常用的标准库</h2><ul>
<li>re 正则表达式</li>
<li>copy 复制</li>
<li>math, cmath 数学</li>
<li>decimal, fraction</li>
<li>sqlite3 数据库</li>
<li>os, os.path 文件系统</li>
<li>gzip, bz2, zipfile, tarfile 压缩文件</li>
<li>csv, netrc 各种文件格式</li>
<li>xml</li>
<li>htmllib</li>
<li>ftplib, socket</li>
<li>cmd 命令行</li>
<li>pdb</li>
<li>profile, cProfile, timeit</li>
<li>collections, heapq, bisect 数据结构</li>
<li>mmap</li>
<li>threading, Queue 并行</li>
<li>multiprocessing</li>
<li>subprocess</li>
<li>pickle, cPickle</li>
<li>struct</li>
</ul>
<h2 id="PYTHONPATH设置"><a href="#PYTHONPATH设置" class="headerlink" title="PYTHONPATH设置"></a>PYTHONPATH设置</h2><p>Python的搜索路径可以通过环境变量PYTHONPATH设置，环境变量的设置方法依操作系统的不同而不同，具体方法可以网上搜索。</p>
<hr>
<h1 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h1><p>Python 就是一门面向对象的语言,</p>
<p>如果你学过 Java ，就知道 Java 的编程思想就是：万事万物皆对象。Python 也不例外，在解决实际问题的过程中，可以把构成问题事务分解成各个对象。</p>
<p>面向对象都有两个基本的概念，分别是类和对象。</p>
<ul>
<li><strong>类</strong></li>
</ul>
<p>用来描述具有相同的属性和方法的对象的集合。它定义了该集合中每个对象所共有的属性和方法。对象是类的实例。</p>
<ul>
<li><strong>对象</strong></li>
</ul>
<p>通过类定义的数据结构实例</p>
<h2 id="面向对象的三大特性"><a href="#面向对象的三大特性" class="headerlink" title="面向对象的三大特性"></a>面向对象的三大特性</h2><p>面向对象的编程语言，也有三大特性，继承，多态和封装性。</p>
<ul>
<li><strong>继承</strong></li>
</ul>
<p>即一个派生类（derived class）继承基类（base class）的字段和方法。继承也允许把一个派生类的对象作为一个基类对象对待。</p>
<p>例如：一个 Dog 类型的对象派生自 Animal 类，这是模拟”是一个（is-a）”关系（例图，Dog 是一个 Animal ）。</p>
<ul>
<li><strong>多态</strong></li>
</ul>
<p>它是指对不同类型的变量进行相同的操作，它会根据对象（或类）类型的不同而表现出不同的行为。</p>
<ul>
<li><strong>封装性</strong></li>
</ul>
<p>“封装”就是将抽象得到的数据和行为（或功能）相结合，形成一个有机的整体（即类）；封装的目的是增强安全性和简化编程，使用者不必了解具体的实现细节，而只是要通过外部接口，一特定的访问权限来使用类的成员。</p>
<h2 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h2><p>在Python中可以使用<code>class</code>关键字定义类，<strong>类的命名采用驼峰命名法</strong>，然后在类中通过之前学习过的函数来定义方法，这样就可以将对象的动态特征描述出来，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># __init__是一个特殊方法用于在创建对象时进行初始化操作</span></span><br><span class="line">    <span class="comment"># 通过这个方法我们可以为学生对象绑定name和age两个属性</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">		</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>正在吃饭.&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">study</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>正在学习.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># PEP 8要求标识符的名字用全小写多个单词用下划线连接</span></span><br><span class="line">    <span class="comment"># 但是部分程序员和公司更倾向于使用驼峰命名法(驼峰标识)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">watch_movie</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.age &lt; <span class="number">18</span>:</span><br><span class="line">            print(<span class="string">&#x27;%s只能观看《熊出没》.&#x27;</span> % self.name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">&#x27;%s正在观看岛国爱情大电影.&#x27;</span> % self.name)</span><br></pre></td></tr></table></figure>

<h3 id="创建和使用对象"><a href="#创建和使用对象" class="headerlink" title="创建和使用对象"></a>创建和使用对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = Student(<span class="string">&#x27;张三&#x27;</span>, <span class="number">18</span>)</span><br><span class="line">s.eat()</span><br><span class="line">s.study()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">张三正在吃饭.</span><br><span class="line">张三正在学习.</span><br></pre></td></tr></table></figure>

<h3 id="静态方法和类方法"><a href="#静态方法和类方法" class="headerlink" title="静态方法和类方法"></a>静态方法和类方法</h3><p>Python 的类方法和静态方法很相似，它们都推荐使用类来调用（其实也可使用对象来调用）。</p>
<p>类方法和静态方法的区别在于，Python会自动绑定类方法的第一个参数，类方法的第一个参数（通常建议参数名为 <code>cls</code>）会自动绑定到类本身；但对于静态方法则不会自动绑定。</p>
<p>使用 <code>＠classmethod</code> 修饰的方法就是类方法；使用 <code>＠staticmethod</code> 修饰的方法就是静态方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span>:</span></span><br><span class="line">    <span class="comment"># classmethod修饰的方法是类方法</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fly</span> (<span class="params">cls</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;类方法fly: &#x27;</span>, cls)</span><br><span class="line">    <span class="comment"># staticmethod修饰的方法是静态方法</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">info</span> (<span class="params">p</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;静态方法info: &#x27;</span>, p)</span><br></pre></td></tr></table></figure>

<p>调用类方法，Bird类会自动绑定到第一个参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bird.fly()  </span><br><span class="line"><span class="comment"># 类方法fly:  &lt;class &#x27;__main__.Bird&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>调用静态方法，不会自动绑定，因此程序必须手动绑定第一个参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Bird.info(<span class="string">&#x27;crazyit&#x27;</span>)</span><br><span class="line"><span class="comment"># 静态方法info:  crazyit</span></span><br></pre></td></tr></table></figure>

<p>创建Bird对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b = Bird()</span><br><span class="line"><span class="comment"># 类方法fly:  &lt;class &#x27;__main__.Bird&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用对象调用fly()类方法，其实依然还是使用类调用， 因此第一个参数依然被自动绑定到Bird类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b.fly()</span><br><span class="line"><span class="comment"># 静态方法info:  fkit</span></span><br></pre></td></tr></table></figure>

<p>使用对象调用info()静态方法，其实依然还是使用类调用，因此程序必须为第一个参数执行绑定</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b.info(<span class="string">&#x27;fkit&#x27;</span>)</span><br><span class="line"><span class="comment"># 静态方法info:  fkit</span></span><br></pre></td></tr></table></figure>

<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>首先我们来看下类的继承的基本语法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span>(<span class="params">BaseClassName</span>):</span></span><br><span class="line">    &lt;statement<span class="number">-1</span>&gt;</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    &lt;statement-N&gt;</span><br></pre></td></tr></table></figure>

<p>在定义类的时候，可以在括号里写继承的类，如果不用继承类的时候，也要写继承 object 类，因为在 Python 中 object 类是一切类的父类。</p>
<p>当然上面的是单继承，Python 也是支持多继承的，具体的语法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassName</span>(<span class="params">Base1,Base2,Base3</span>):</span></span><br><span class="line">    &lt;statement<span class="number">-1</span>&gt;</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    .</span><br><span class="line">    &lt;statement-N&gt;</span><br></pre></td></tr></table></figure>

<p>多继承有一点需要注意的：若是父类中有相同的方法名，而在子类使用时未指定，python 在圆括号中父类的顺序，从左至右搜索 ， 即方法在子类中未找到时，从左到右查找父类中是否包含方法。</p>
<p>继承的子类的好处：</p>
<ul>
<li>会继承父类的属性和方法</li>
<li>可以自己定义，覆盖父类的属性和方法</li>
</ul>
<p>定义父类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">eat</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>正在吃饭&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">play</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>正在玩&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>继承父类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, grade</span>):</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(name, gender)</span><br><span class="line">        self.grade = grade</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">study</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">f&#x27;<span class="subst">&#123;self.name&#125;</span>正在学习&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">&quot;张三&quot;</span>, <span class="literal">True</span>, <span class="number">80</span>)</span><br><span class="line">s.eat()</span><br><span class="line">s.play()</span><br><span class="line">s.study()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">张三正在吃饭</span><br><span class="line">张三正在玩</span><br><span class="line">张三正在学习</span><br></pre></td></tr></table></figure>

<h3 id="子类的类型判断"><a href="#子类的类型判断" class="headerlink" title="子类的类型判断"></a>子类的类型判断</h3><p>对于 class 的继承关系来说，有些时候我们需要判断 class 的类型，该怎么办呢？</p>
<p>可以使用 <code>isinstance()</code> 函数,</p>
<p>一个例子就能看懂 <code>isinstance()</code> 函数的用法了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User1</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User2</span>(<span class="params">User1</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User3</span>(<span class="params">User2</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    user1 = User1()</span><br><span class="line">    user2 = User2()</span><br><span class="line">    user3 = User3()</span><br><span class="line">    <span class="comment"># isinstance()就可以告诉我们，一个对象是否是某种类型</span></span><br><span class="line">    print(<span class="built_in">isinstance</span>(user3, User2))</span><br><span class="line">    print(<span class="built_in">isinstance</span>(user3, User1))</span><br><span class="line">    print(<span class="built_in">isinstance</span>(user3, User3))</span><br><span class="line">    <span class="comment"># 基本类型也可以用isinstance()判断</span></span><br><span class="line">    print(<span class="built_in">isinstance</span>(<span class="string">&#x27;两点水&#x27;</span>, <span class="built_in">str</span>))</span><br><span class="line">    print(<span class="built_in">isinstance</span>(<span class="number">347073565</span>, <span class="built_in">int</span>))</span><br><span class="line">    print(<span class="built_in">isinstance</span>(<span class="number">347073565</span>, <span class="built_in">str</span>))</span><br></pre></td></tr></table></figure>

<p>输出的结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">True</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line">True</span><br><span class="line">False</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="文件和异常"><a href="#文件和异常" class="headerlink" title="文件和异常"></a>文件和异常</h1><p>在Python中实现文件的读写操作其实非常简单，通过Python内置的<code>open</code>函数，我们可以指定文件名、操作模式、编码信息等来获得操作文件的对象，接下来就可以对文件进行读写操作了。这里所说的操作模式是指要打开什么样的文件（字符文件还是二进制文件）以及做什么样的操作（读、写还是追加），具体的如下表所示。</p>
<h2 id="读写文本文件"><a href="#读写文本文件" class="headerlink" title="读写文本文件"></a>读写文本文件</h2><p>读取文本文件时，需要在使用<code>open</code>函数时指定好带路径的文件名（可以使用相对路径或绝对路径）并将文件模式设置为<code>'r'</code>（如果不指定，默认值也是<code>'r'</code>），然后通过<code>encoding</code>参数指定编码（如果不指定，默认值是None，那么在读取文件时使用的是操作系统默认的编码），如果不能保证保存文件时使用的编码方式与encoding参数指定的编码方式是一致的，那么就可能因无法解码字符而导致读取失败。下面的例子演示了如何读取一个纯文本文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&#x27;未选择的路.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    print(f.read())</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>请注意上面的代码，如果<code>open</code>函数指定的文件并不存在或者无法打开，那么将引发异常状况导致程序崩溃。为了让代码有一定的健壮性和容错性，我们可以使用Python的异常机制对可能在运行时发生状况的代码进行适当的处理，如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    f = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        f = <span class="built_in">open</span>(<span class="string">&#x27;未选择的路.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        print(f.read())</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        print(<span class="string">&#x27;无法打开指定的文件!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> LookupError:</span><br><span class="line">        print(<span class="string">&#x27;指定了未知的编码!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">        print(<span class="string">&#x27;读取文件时解码错误!&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> f:</span><br><span class="line">            f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>在Python中，我们可以将那些在运行时可能会出现状况的代码放在<code>try</code>代码块中，在<code>try</code>代码块的后面可以跟上一个或多个<code>except</code>来捕获可能出现的异常状况。例如在上面读取文件的过程中，文件找不到会引发<code>FileNotFoundError</code>，指定了未知的编码会引发<code>LookupError</code>，而如果读取文件时无法按指定方式解码会引发<code>UnicodeDecodeError</code>，我们在<code>try</code>后面跟上了三个<code>except</code>分别处理这三种不同的异常状况。最后我们使用<code>finally</code>代码块来关闭打开的文件，释放掉程序中获取的外部资源，由于<code>finally</code>块的代码不论程序正常还是异常都会执行到（甚至是调用了<code>sys</code>模块的<code>exit</code>函数退出Python环境，<code>finally</code>块都会被执行，因为<code>exit</code>函数实质上是引发了<code>SystemExit</code>异常），因此我们通常把<code>finally</code>块称为“总是执行代码块”，它最适合用来做释放外部资源的操作。如果不愿意在<code>finally</code>代码块中关闭文件对象释放资源，也可以使用上下文语法，通过<code>with</code>关键字指定文件对象的上下文环境并在离开上下文环境时自动释放文件资源，代码如下所示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;未选择的路.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            print(f.read())</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError:</span><br><span class="line">        print(<span class="string">&#x27;无法打开指定的文件!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> LookupError:</span><br><span class="line">        print(<span class="string">&#x27;指定了未知的编码!&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">        print(<span class="string">&#x27;读取文件时解码错误!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h2 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h2><p>使用 <code>w</code> 模式时，如果文件不存在会被创建，如果文件已经存在， <code>w</code> 模式会覆盖之前写的所有内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&#x27;venv/resource/望江南·超然台作.txt&#x27;</span>, mode=<span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file.write(<span class="string">&#x27;春未老\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;风细柳斜斜\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;试上超然台上望\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;半壕春水一城花\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;烟雨暗千家\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;寒食后\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;酒醒却咨嗟\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;休对故人思故国\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;且将新火试新茶\r\n&#x27;</span>)</span><br><span class="line">        file.write(<span class="string">&#x27;诗酒趁年华\r\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2022/python%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/sushiyyds.png" style="zoom:67%;" />

<p>除了写入模式，还有追加模式  <code>a</code> ，追加模式不会覆盖之前已经写入的内容，而是在之后继续写入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&#x27;venv/resource/望江南·超然台作.txt&#x27;</span>, mode=<span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file.write(<span class="string">&#x27;end\r\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<img src="https://myblob-pics.oss-cn-hangzhou.aliyuncs.com/2022/python%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/fileappend.png" style="zoom:67%;" />



<h2 id="二进制文件"><a href="#二进制文件" class="headerlink" title="二进制文件"></a>二进制文件</h2><h3 id="读写二进制文件"><a href="#读写二进制文件" class="headerlink" title="读写二进制文件"></a>读写二进制文件</h3><p>知道了如何读写文本文件要读写二进制文件也就很简单了，下面的代码实现了复制图片文件的功能。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;guido.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fs1:</span><br><span class="line">            data = fs1.read()</span><br><span class="line">            print(<span class="built_in">type</span>(data))  <span class="comment"># &lt;class &#x27;bytes&#x27;&gt;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;吉多.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fs2:</span><br><span class="line">            fs2.write(data)</span><br><span class="line">    <span class="keyword">except</span> FileNotFoundError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">&#x27;指定的文件无法打开.&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">&#x27;读写文件时出现错误.&#x27;</span>)</span><br><span class="line">    print(<span class="string">&#x27;程序执行结束.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/03/10/%E5%BF%AB%E9%80%9F%E6%8E%8C%E6%8F%A1%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/03/10/%E5%BF%AB%E9%80%9F%E6%8E%8C%E6%8F%A1%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="post-title-link" itemprop="url">快速掌握正则表达式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-10 14:56:28" itemprop="dateCreated datePublished" datetime="2022-03-10T14:56:28+08:00">2022-03-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-05 16:48:01" itemprop="dateModified" datetime="2023-09-05T16:48:01+08:00">2023-09-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">正则表达式</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="什么是正则表达式？"><a href="#什么是正则表达式？" class="headerlink" title="什么是正则表达式？"></a>什么是正则表达式？</h1><p>在编写处理字符串的程序或网页时，经常会有查找符合某些复杂规则的字符串的需要。<strong>正则表达式</strong>就是用于描述这些规则的工具。换句话说，正则表达式就是记录文本规则的代码。</p>
<p>很可能你使用过Windows/Dos下用于文件查找的通配符(wildcard)，也就是<code>*</code>和<code>?</code>。如果你想查找某个目录下的所有的Word文档的话，你会搜索*.doc。在这里，<em>会被解释成任意的字符串。和通配符类似，正则表达式也是用来进行文本匹配的工具，只不过比起通配符，它能更精确地描述你的需求——当然，代价就是更复杂——比如你可以编写一个正则表达式，用来查找所有以0开头，后面跟着2-3个数字，然后是一个连字号“-”，最后是7或8位数字的字符串(像</em>010-12345678<em>或</em>0376-7654321)。</p>
<h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><p>学习正则表达式的最好方法是从例子开始，理解例子之后再自己对例子进行修改，实验。下面给出了不少简单的例子，并对它们作了详细的说明。</p>
<p>假设你在一篇英文小说里查找hi，你可以使用正则表达式<code>hi</code>。</p>
<p>这几乎是最简单的正则表达式了，它可以精确匹配这样的字符串：由两个字符组成，前一个字符是<code>h</code>,后一个是<code>i</code>。通常，处理正则表达式的工具会提供一个<code>忽略大小写</code>的选项，如果选中了这个选项，它可以匹配<em>hi</em>,<em>HI</em>,<em>Hi</em>,<em>hI</em>这四种情况中的任意一种。</p>
<p>不幸的是，很多单词里包含<em>hi</em>这两个连续的字符，比如<em>him</em>,<em>history</em>,<em>high</em>等等。用<span style="color:red">hi</span>来查找的话，这里边的<em>hi</em>也会被找出来。如果要精确地查找hi这个单词的话，我们应该使用<span style="color:red">\bhi\b</span>。</p>
<p><code>\b</code>是正则表达式规定的一个特殊代码（好吧，某些人叫它<strong>元字符，metacharacter</strong>），代表着单词的开头或结尾，也就是单词的分界处。虽然通常英文的单词是由空格，标点符号或者换行来分隔的，但是<code>\b</code>并不匹配这些单词分隔字符中的任何一个，它<strong>只匹配一个位置</strong>。</p>
<p>假如你要找的是hi后面不远处跟着一个Lucy，你应该用<code>\bhi\b.*\bLucy\b</code>。</p>
<p>这里，<code>.</code>是另一个元字符，匹配除了换行符以外的任意字符。<code>*</code>同样是元字符，不过它代表的不是字符，也不是位置，而是数量——它指定<em>前边的内容可以连续重复使用任意次以使整个表达式得到匹配。因此，<code>.\</em></code>连在一起就意味着<code>任意数量的不包含换行的字符</code>。现在\bhi\b.*\bLucy\b的意思就很明显了：先是一个单词hi,然后是任意个任意字符(但不能是换行)，最后是Lucy这个单词。</p>
<p>换行符就是<code>'\n'</code>,ASCII编码为10(十六进制0x0A)的字符。</p>
<p>如果同时使用其它元字符，我们就能构造出功能更强大的正则表达式。比如下面这个例子：</p>
<p><code>0\d\d-\d\d\d\d\d\d\d\d</code>匹配这样的字符串：以0开头，然后是两个数字，然后是一个连字号“-”，最后是8个数字(也就是中国的电话号码。当然，这个例子只能匹配区号为3位的情形)。</p>
<p>这里的<code>\d</code>是个新的元字符，<code>匹配一位数字(0，或1，或2，或……)</code>。<code>-</code>不是元字符，只匹配它本身——连字符(或者减号，或者中横线，或者随你怎么称呼它)。</p>
<p>为了避免那么多烦人的重复，我们也可以这样写这个表达式：<code>0\d&#123;2&#125;-\d&#123;8&#125;</code>。这里\d后面的{2}({8})的意思是前面\d必须连续重复匹配2次(8次)。</p>
<div class="note success"><p><strong>注解：</strong></p>
<ol>
<li>如果需要更精确的说法，<code>\b</code>匹配这样的位置：它的前一个字符和后一个字符不全是(一个是,一个不是或不存在)<code>\w</code>。</li>
<li>换行符就是<code>'\n'</code>，ASCII编码为10(十六进制0x0A)的字符。</li>
</ol>
</div>

<h1 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h1><p>现在你已经知道几个很有用的元字符了，如<code>\b</code>,<code>.</code>,<code>*</code>，还有<code>\d.</code>正则表达式里还有更多的元字符，比如<code>\s</code>匹配任意的空白符，包括空格，制表符(Tab)，换行符，中文全角空格等。<code>\w</code>匹配字母或数字或下划线或汉字等。</p>
<p>对中文/汉字的特殊处理是由.Net提供的正则表达式引擎支持的，其它环境下的具体情况请查看相关文档。</p>
<p>下面来看看更多的例子：</p>
<p><code>\ba\w*\b</code>匹配以字母a开头的单词——先是某个单词开始处(<code>\b</code>)，然后是字母a，然后是任意数量的字母或数字(<code>\w</code>)，最后是单词结束处(<code>\b</code>)。</p>
<p><code>\d+</code>匹配1个或更多连续的数字。这里的<code>+</code>是和<code>*</code>类似的元字符，不同的是<code>*</code>匹配重复任意次(可能是0次)，而<code>+</code>则匹配重复1次或更多次。</p>
<p><code>\b\w&#123;6&#125;\b</code> 匹配刚好6个字符的单词。</p>
<table>
<thead>
<tr>
<th align="center">代码</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>.</code></td>
<td align="center">匹配除换行符以外的任意字符</td>
</tr>
<tr>
<td align="center"><code>\w</code></td>
<td align="center">匹配字母或数字或下划线</td>
</tr>
<tr>
<td align="center"><code>\s</code></td>
<td align="center">匹配任意的空白符</td>
</tr>
<tr>
<td align="center"><code>\d</code></td>
<td align="center">匹配数字</td>
</tr>
<tr>
<td align="center"><code>\b</code></td>
<td align="center">匹配单词的开始或结束</td>
</tr>
<tr>
<td align="center"><code>^</code></td>
<td align="center">匹配字符串的开始</td>
</tr>
<tr>
<td align="center"><code>$</code></td>
<td align="center">匹配字符串的结束</td>
</tr>
</tbody></table>
<p>元字符<code>^</code>（和数字6在同一个键位上的符号）和<code>$</code>都匹配一个位置，这和<code>\b</code>有点类似。<code>^</code>匹配你要用来查找的字符串的开头，<code>$</code>匹配结尾。这两个代码在验证输入的内容时非常有用，比如一个网站如果要求你填写的QQ号必须为5位到12位数字时，可以使用：<code>^\d&#123;5,12&#125;$</code>。</p>
<p>这里的<code>&#123;5,12&#125;</code>和前面介绍过的<code>&#123;2&#125;</code>是类似的，只不过<code>&#123;2&#125;</code>匹配只能不多不少重复2次，<code>&#123;5,12&#125;</code>则是重复的次数不能少于5次，不能多于12次，否则都不匹配。</p>
<p>因为使用了<code>^</code>和<code>$</code>，所以输入的整个字符串都要用来和<code>\d&#123;5,12&#125;</code>来匹配，也就是说整个输入必须是5到12个数字，因此如果输入的QQ号能匹配这个正则表达式的话，那就符合要求了。</p>
<p>和忽略大小写的选项类似，有些正则表达式处理工具还有一个处理多行的选项。如果选中了这个选项，<code>^</code>和<code>$</code>的意义就变成了匹配行的开始处和结束处。</p>
<div class="note success"><p><strong>注解：</strong></p>
<ol>
<li>对中文/汉字的特殊处理是由.Net提供的正则表达式引擎支持的，其它环境下的具体情况请查看相关文档。</li>
<li>好吧，现在我们说说正则表达式里的单词是什么意思吧：就是不少于一个的连续的<code>\w</code>。不错，这与学习英文时要背的成千上万个同名的东西的确关系不大 :)</li>
</ol>
</div>

<h1 id="字符转义"><a href="#字符转义" class="headerlink" title="字符转义"></a>字符转义</h1><p>有时候在我们查找<code> . </code>，或者<code>*</code>，或者一些元字符本身的话，会有一些问题出现，因为这些元字符已经变成别的意思了，所以我们没有办法指定这些元字符。出现这种情况，我们就得使用<code>\</code>来取消这些字符的特殊意义。所以，我们应该使用<code>\.</code>和<code>\*</code>。当然，要查找<code>\</code>本身，你也得用<code>\\</code>.</p>
<p>例如：<code>deerchao.net</code>匹配<code>deerchao.net</code>，<code>C:\Windows</code>匹配<code>C:\Windows</code>。</p>
<h1 id="重复"><a href="#重复" class="headerlink" title="重复"></a>重复</h1><p>你已经看过了前面的<code>*</code>，<code>+</code>，<code>&#123;2&#125;</code>，<code>&#123;5,12&#125;</code>这几个匹配重复的方式了。下面是正则表达式中所有的限定符(指定数量的代码，例如*,{5,12}等)：</p>
<table>
<thead>
<tr>
<th align="center">代码/语法</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>*</code></td>
<td align="center">重复零次或更多次</td>
</tr>
<tr>
<td align="center"><code>+</code></td>
<td align="center">重复一次或更多次</td>
</tr>
<tr>
<td align="center"><code>?</code></td>
<td align="center">重复零次或一次</td>
</tr>
<tr>
<td align="center"><code>&#123;n&#125;</code></td>
<td align="center">重复n次</td>
</tr>
<tr>
<td align="center"><code>&#123;n,&#125;</code></td>
<td align="center">重复n次或更多次</td>
</tr>
<tr>
<td align="center"><code>&#123;n,m&#125;</code></td>
<td align="center">重复n到m次</td>
</tr>
</tbody></table>
<p>下面是一些使用重复的例子：</p>
<p><code>Windows\d+</code>匹配Windows后面跟1个或更多数字</p>
<p><code>^\w+</code>匹配一行的第一个单词(或整个字符串的第一个单词，具体匹配哪个意思得看选项设置)</p>
<h1 id="正则表达式之字符类"><a href="#正则表达式之字符类" class="headerlink" title="正则表达式之字符类"></a>正则表达式之字符类</h1><p>如果想要查找数字，字母或数字，空白是很简单的，因为对应这些字符集合的元字符是已经存在的了，不过要想匹配像元音字母a，e，i，o，u这些没有预先定义元字符的字符集合该怎么做呢？</p>
<p>有个很简单的方法，只需要在方括号里列出它们就可以了，像<code>[aeiou]</code>就匹配任何一个英文元音字母，<code>[.?!]</code>匹配标点符号(.或?或!)。</p>
<p>我们也可以轻松地指定一个字符<strong>范围</strong>，像<code>[0-9]</code>代表的含意与<code>\d</code>就是完全一致的：一位数字；同理<code>[a-z0-9A-Z_]</code>也完全等同于<code>\w</code>（如果只考虑英文的话）。</p>
<p>下面是一个更复杂的表达式：<code>(?0\d&#123;2&#125;[) -]?\d&#123;8&#125;</code>。</p>
<p>这个表达式可以匹配几种格式的电话号码，像(010)88886666，或022-22334455，或02912345678等。我们对它进行一些分析吧：首先是一个转义字符<code>(</code>,它能出现0次或1次(<code>?</code>),然后是一个<code>0</code>，后面跟着2个数字(<code>\d&#123;2&#125;</code>)，然后是<code>)</code>或<code>-</code>或<code>空格</code>中的一个，它出现1次或不出现(<code>?</code>)，最后是8个数字(<code>\d&#123;8&#125;</code>)。</p>
<div class="note success"><p><strong>注解：</strong><code> (</code>和<code>)</code>也是元字符，后面的分组节里会提到，所以在这里需要使用转义。</p>
</div>

<h1 id="正则表达式的分枝条件"><a href="#正则表达式的分枝条件" class="headerlink" title="正则表达式的分枝条件"></a>正则表达式的分枝条件</h1><p>但是在上节内容介绍的那个表达式也可以用来匹配类似<em>010)12345678</em>或*(022-87654321*这样的错误的格式。怎么办？要想解决这个问题，我们可以使用<strong>分枝条件。</strong>正则表达式里的<strong>分枝条件</strong>指的是有几种规则，只要满足这些规则中的任意一种，都会被当成匹配，因此我们要使用<code>|</code>把这些规则分开。为了更好的理解上述内容，我们来看看几个例子：</p>
<p><code>0\d&#123;2&#125;-\d&#123;8&#125;|0\d&#123;3&#125;-\d&#123;7&#125;</code>这个表达式能匹配两种以连字号分隔的电话号码：一种是三位区号，8位本地号(如010-12345678)，一种是4位区号，7位本地号(0376-2233445)。</p>
<p><code>(0\d&#123;2&#125;)[- ]?\d&#123;8&#125;|0\d&#123;2&#125;[- ]?\d&#123;8&#125;</code>这个表达式匹配3位区号的电话号码，其中区号可以用小括号括起来，也可以不用，区号与本地号间可以用连字号或空格间隔，也可以没有间隔。你可以试试用分枝条件把这个表达式扩展成也支持4位区号的。</p>
<p><code>\d&#123;5&#125;-\d&#123;4&#125;|\d&#123;5&#125;</code>这个表达式用于匹配美国的邮政编码。美国邮编的规则是5位数字，或者用连字号间隔的9位数字。之所以要给出这个例子是因为它能说明一个问题：<strong>使用分枝条件时，要注意各个条件的顺序</strong>。如果你把它改成<code>\d&#123;5&#125;|\d&#123;5&#125;-\d&#123;4&#125;</code>的话，那么就只会匹配5位的邮编(以及9位邮编的前5位)。原因是匹配分枝条件时，将会从左到右地测试每个条件，如果满足了某个分枝的话，就不会去再管其它的条件了。</p>
<h1 id="正则表达式之分组"><a href="#正则表达式之分组" class="headerlink" title="正则表达式之分组"></a>正则表达式之分组</h1><p>在上述章节中我们已经知道直接在字符后面加上限定符就可以重复单个字符，那么多个字符的重复又该如何实现呢？你可以使用小括号来指定子表达式（也称为<strong>分组</strong>），然后对于这个子表达式的重复次数你就可以自行规定了，子表达式也可以进行一些其他的操作，这个在后面会进行介绍。</p>
<p><code>(\d&#123;1,3&#125;.)&#123;3&#125;\d&#123;1,3&#125;</code>是一个简单的IP地址匹配表达式。要理解这个表达式，请按下列顺序分析它：<code>\d&#123;1,3&#125;</code>匹配1到3位的数字，<code>(\d&#123;1,3&#125;.)&#123;3&#125;</code>匹配三位数字加上一个英文句号(这个整体也就是这个<strong>分组</strong>)重复3次，最后再加上一个一到三位的数字<code>(\d&#123;1,3&#125;)</code>。</p>
<p>不幸的是，它也将匹配256.300.888.999这种不可能存在的IP地址。如果能使用算术比较的话，或许能简单地解决这个问题，但是正则表达式中并不提供关于数学的任何功能，所以只能使用冗长的分组，选择，字符类来描述一个正确的IP地址：<code>((2[0-4]\d|25[0-5]|[01]?\d\d?).)&#123;3&#125;(2[0-4]\d|25[0-5]|[01]?\d\d?)</code>。</p>
<p>理解这个表达式的关键是理解<code>2[0-4]\d|25[0-5]|[01]?\d\d?</code>，这里我就不细说了，你自己应该能分析得出来它的意义。</p>
<p><strong>注解：</strong></p>
<ol>
<li>IP地址中每个数字都不能大于255. 经常有人问我，01.02.03.04 这样前面带有0的数字, 是不是正确的IP地址呢? 答案是: 是的, IP 地址里的数字可以包含有前导 0 (leading zeroes).</li>
</ol>
<h1 id="正则表达式之反义"><a href="#正则表达式之反义" class="headerlink" title="正则表达式之反义"></a>正则表达式之反义</h1><p>有时需要查找不属于某个能简单定义的字符类的字符。比如想查找除了数字以外，其它任意字符都行的情况，这时需要用到<strong>反义</strong>：</p>
<table>
<thead>
<tr>
<th align="center">代码/语法</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>\W</code></td>
<td align="center">匹配任意不是字母，数字，下划线，汉字的字符</td>
</tr>
<tr>
<td align="center"><code>\S</code></td>
<td align="center">匹配任意不是空白符的字符</td>
</tr>
<tr>
<td align="center"><code>\D</code></td>
<td align="center">匹配任意非数字的字符</td>
</tr>
<tr>
<td align="center"><code>\B</code></td>
<td align="center">匹配不是单词开头或结束的位置</td>
</tr>
<tr>
<td align="center"><code>[^x]</code></td>
<td align="center">匹配除了x以外的任意字符</td>
</tr>
<tr>
<td align="center"><code>[^aeiou]</code></td>
<td align="center">匹配除了aeiou这几个字母以外的任意字符</td>
</tr>
</tbody></table>
<p>例子：<code>\S+</code>匹配不包含空白符的字符串。</p>
<p><code><a[^>]+></code>匹配用尖括号括起来的以a开头的字符串。</p>
<p>怎么查找<strong>不是某个字符或不在某个字符类里</strong>的字符的方法（反义）我们之前已经提过了。但是如果我们的目的不是去匹配某个字符，而是只想要该字符是否出现过，怎么办？例如，如果我们想要查找的单词中出现了字母q，但是字母q的后面跟着的不是字母u的话，我们可以尝试：</p>
<p><code>\b\w*q[^u]\w*\b</code>匹配包含<strong>后面不是字母u的字母q</strong>的单词。但是如果多做测试(或者你思维足够敏锐，直接就观察出来了)，你会发现，如果q出现在单词的结尾的话，像<strong>Iraq,Benq</strong>，这个表达式就会出错。这是因为<code>[^u]</code>总要匹配一个字符，所以如果q是单词的最后一个字符的话，后面的<code>[^u]</code>将会匹配q后面的单词分隔符(可能是空格，或者是句号或其它的什么)，后面的<code>\w*\b</code>将会匹配下一个单词，于是<code>\b\w*q[^u]\w*\b</code>就能匹配整个<code>Iraq fighting</code>。<strong>负向零宽断言</strong>能解决这样的问题，因为它只匹配一个位置，并不<strong>消费</strong>任何字符。现在，我们可以这样来解决这个题：<code>\b\w*q(?!u)\w*\b</code>。</p>
<p>零宽度负预测先行断言<code>(?!exp)</code>，断言此位置的后面不能匹配表达式exp。例如：<code>\d&#123;3&#125;(?!\d)</code>匹配三位数字，而且这三位数字的后面不能是数字；<code>\b((?!abc)\w)+\b</code>匹配不包含连续字符串abc的单词。</p>
<p>同理，我们可以用<code>(?&lt;!exp)</code>，零宽度负回顾后发断言来断言此位置的前面不能匹配表达式exp：<code>(?&lt;![a-z])\d&#123;7&#125;</code>匹配前面不是小写字母的七位数字。</p>
<p>一个更复杂的例子：<code>(?<=<(\w+)>).*(?=</\1>)</code>匹配不包含属性的简单HTML标签内里的内容。<code>(?<=<(\w+)>)</code>指定了这样的<strong>前缀</strong>：被尖括号括起来的单词(比如可能是<code>)</code>，然后是<code>.*</code>(任意的字符串)，最后是一个<strong>后缀</strong><code>(?=</\1>)</code>。注意后缀里的<code>/</code>，它用到了前面提过的字符转义；<code>\1</code>则是一个反向引用，引用的正是捕获的第一组，前面的<code>(\w+)</code>匹配的内容，这样如果前缀实际上是<b>的话，后缀就是</b>了。整个表达式匹配的是<b>和</b>之间的内容(再次提醒，不包括前缀和后缀本身)。</p>
<p><strong>注解：</strong></p>
<ul>
<li>请详细分析表达式<code>(?<=<(\w+)>).*(?=</\1>)</code>，这个表达式最能表现零宽断言的真正用途。</li>
</ul>
<h1 id="正则表达式之注释"><a href="#正则表达式之注释" class="headerlink" title="正则表达式之注释"></a>正则表达式之注释</h1><p>小括号还有另一种用途，就是通过语法<code>(?#comment)</code>来包含注释。例如：<code>2[0-4]\d(?#200-249)|25[0-5](?#250-255)|[01]?\d\d?(?#0-199)</code>。</p>
<p>如果要包含注释，最好是启用“忽略模式里的空白符”选项，因为这样在编写表达式时能任意的添加空格，Tab，换行，而实际使用时这些都将被忽略。启用这个选项后，在#后面到这一行结束的所有文本都将被当成注释忽略掉。</p>
<p>例如，我们可以前面的一个表达式写成这样：</p>
<p><code>(?<= # 断言要匹配的文本的前缀</code></p>
<p><code><(\w+)> # 查找尖括号括起来的字母或数字(即HTML/XML标签)</code></p>
<p><code>) # 前缀结束</code></p>
<p><code>.* # 匹配任意文本</code></p>
<p><code>(?= # 断言要匹配的文本的后缀</code></p>
<p><code></\1> # 查找尖括号括起来的内容：前面是一个"/"，后面是先前捕获的标签</code></p>
<p><code>) # 后缀结束</code></p>
<h1 id="正则表达式之贪婪与懒惰"><a href="#正则表达式之贪婪与懒惰" class="headerlink" title="正则表达式之贪婪与懒惰"></a>正则表达式之贪婪与懒惰</h1><p>当正则表达式中包含能接受重复的限定符时，通常的行为是（在使整个表达式能得到匹配的前提下）匹配<strong>尽可能多</strong>的字符。以这个表达式为例：<code>a.*b</code>，它将会匹配最长的以a开始，以b结束的字符串。如果用它来搜索aabab的话，它会匹配整个字符串<em>aabab</em>。这被称为<strong>贪婪</strong>匹配。</p>
<p>有时，我们更需要<strong>懒惰</strong>匹配，也就是匹配<strong>尽可能少</strong>的字符。前面给出的限定符都可以被转化为懒惰匹配模式，只要在它后面加上一个问号<code>?</code>。这样<code>.*?</code>就意味着匹配任意数量的重复，但是在能使整个匹配成功的前提下使用最少的重复。现在看看懒惰版的例子吧：</p>
<p><code>a.*?b</code>匹配最短的，以a开始，以b结束的字符串。如果把它应用于<em>aabab</em>的话，它会匹配aab（第一到第三个字符）和ab（第四到第五个字符）。</p>
<table>
<thead>
<tr>
<th align="center">代码/语法</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>*?</code></td>
<td align="center">重复任意次，但尽可能少重复</td>
</tr>
<tr>
<td align="center"><code>+?</code></td>
<td align="center">重复1次或更多次，但尽可能少重复</td>
</tr>
<tr>
<td align="center"><code>??</code></td>
<td align="center">重复0次或1次，但尽可能少重复</td>
</tr>
<tr>
<td align="center"><code>&#123;n,m&#125;?</code></td>
<td align="center">重复n到m次，但尽可能少重复</td>
</tr>
<tr>
<td align="center"><code>&#123;n,&#125;?</code></td>
<td align="center">重复n次以上，但尽可能少重复</td>
</tr>
</tbody></table>
<p><strong>注解：</strong></p>
<ul>
<li>为什么第一个匹配是aab（第一到第三个字符）而不是ab（第二到第三个字符）？简单地说，因为正则表达式有另一条规则，比懒惰／贪婪规则的优先级更高：最先开始的匹配拥有最高的优先权——The match that begins earliest wins。</li>
</ul>
<h1 id="正则表达式之处理选项"><a href="#正则表达式之处理选项" class="headerlink" title="正则表达式之处理选项"></a>正则表达式之处理选项</h1><p>以前介绍的忽略大小写、处理多行等选项可以用来改变处理正则表达式的方式，接下来要来介绍下载.Net中常用到的正则表达式的选项：</p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">IgnoreCase(忽略大小写)</td>
<td align="center">匹配时不区分大小写。</td>
</tr>
<tr>
<td align="center">Multiline(多行模式)</td>
<td align="center">更改<code>^</code>和<code>$</code>的含义，使它们分别在任意一行的行首和行尾匹配，而不仅仅在整个字符串的开头和结尾匹配。(在此模式下,<code>$</code>的精确含意是:匹配\n之前的位置以及字符串结束前的位置.)</td>
</tr>
<tr>
<td align="center">Singleline(单行模式)</td>
<td align="center">更改<code>.</code>的含义，使它与每一个字符匹配（包括换行符\n）。</td>
</tr>
<tr>
<td align="center">IgnorePatternWhitespace(忽略空白)</td>
<td align="center">忽略表达式中的非转义空白并启用由<code>#</code>标记的注释。</td>
</tr>
<tr>
<td align="center">ExplicitCapture(显式捕获)</td>
<td align="center">仅捕获已被显式命名的组。</td>
</tr>
</tbody></table>
<p>一个经常被问到的问题是：是不是只能同时使用多行模式和单行模式中的一种？答案是：不是。这两个选项之间没有任何关系，除了它们的名字比较相似（以至于让人感到疑惑）以外。</p>
<p><strong>注解：</strong></p>
<ul>
<li>在C#中，你可以使用Regex(String, RegexOptions)构造函数来设置正则表达式的处理选项。如：Regex regex = new Regex(@”\ba\w{6}\b”, RegexOptions.IgnoreCase);</li>
</ul>
<h1 id="正则表达式补充"><a href="#正则表达式补充" class="headerlink" title="正则表达式补充"></a>正则表达式补充</h1><p>到此为止，我们已经介绍了有关于正则表达式的大量元素，但是那么复杂的正则表达式，肯定还有一些元素还未提到，作者把那些未被提到的元素整合成如下的列表，其中还包含了语法和简单的说明。如果你觉得列表中的介绍不够详细的话，你也可以根据自己的需要利用更多的资源去学习它们。如果你的电脑中装了MSDN Library，你也能够在里面查到.net下正则表达式的详细文档，如果你没有安装MSDN Library,可以查看<a target="_blank" rel="noopener" href="http://msdn.microsoft.com/zh-cn/library/az24scfc.aspx">关于正则表达式语言元素的MSDN在线文档</a>。</p>
<table>
<thead>
<tr>
<th align="center">代码/语法</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>\a</code></td>
<td align="center">报警字符(打印它的效果是电脑嘀一声)</td>
</tr>
<tr>
<td align="center"><code>\b</code></td>
<td align="center">通常是单词分界位置，但如果在字符类里使用代表退格</td>
</tr>
<tr>
<td align="center"><code>\t</code></td>
<td align="center">制表符，Tab</td>
</tr>
<tr>
<td align="center"><code>\r</code></td>
<td align="center">回车</td>
</tr>
<tr>
<td align="center"><code>\v</code></td>
<td align="center">竖向制表符</td>
</tr>
<tr>
<td align="center"><code>\f</code></td>
<td align="center">换页符</td>
</tr>
<tr>
<td align="center"><code>\n</code></td>
<td align="center">换行符</td>
</tr>
<tr>
<td align="center"><code>\e</code></td>
<td align="center">Escape</td>
</tr>
<tr>
<td align="center"><code>\0nn</code></td>
<td align="center">ASCII代码中八进制代码为nn的字符</td>
</tr>
<tr>
<td align="center"><code>\xnn</code></td>
<td align="center">ASCII代码中十六进制代码为nn的字符</td>
</tr>
<tr>
<td align="center"><code>\unnnn</code></td>
<td align="center">Unicode代码中十六进制代码为nnnn的字符</td>
</tr>
<tr>
<td align="center"><code>\cN</code></td>
<td align="center">ASCII控制字符。比如\cC代表Ctrl+C</td>
</tr>
<tr>
<td align="center"><code>\A</code></td>
<td align="center">字符串开头(类似^，但不受处理多行选项的影响)</td>
</tr>
<tr>
<td align="center"><code>\Z</code></td>
<td align="center">字符串结尾或行尾(不受处理多行选项的影响)</td>
</tr>
<tr>
<td align="center"><code>\z</code></td>
<td align="center">字符串结尾(类似$，但不受处理多行选项的影响)</td>
</tr>
<tr>
<td align="center"><code>\G</code></td>
<td align="center">当前搜索的开头</td>
</tr>
<tr>
<td align="center"><code>\p&#123;name&#125;</code></td>
<td align="center">Unicode中命名为name的字符类，例如\p{IsGreek}</td>
</tr>
<tr>
<td align="center"><code>(?>exp)</code></td>
<td align="center">贪婪子表达式</td>
</tr>
<tr>
<td align="center"><code>(?<x>-<y>exp)</code></td>
<td align="center">平衡组</td>
</tr>
<tr>
<td align="center"><code>(?im-nsx:exp)</code></td>
<td align="center">在子表达式exp中改变处理选项</td>
</tr>
<tr>
<td align="center"><code>(?im-nsx)</code></td>
<td align="center">为表达式后面的部分改变处理选项</td>
</tr>
<tr>
<td align="center"><code>(?(exp)yes|no)</code></td>
<td align="center">把exp当作零宽正向先行断言，如果在这个位置能匹配，使用yes作为此组的表达式；否则使用no</td>
</tr>
<tr>
<td align="center"><code>(?(exp)yes)</code></td>
<td align="center">同上，只是使用空表达式作为no</td>
</tr>
<tr>
<td align="center"><code>(?(name)yes|no)</code></td>
<td align="center">如果命名为name的组捕获到了内容，使用yes作为表达式；否则使用no</td>
</tr>
<tr>
<td align="center"><code>(?(name)yes)</code></td>
<td align="center">同上，只是使用空表达式作为no</td>
</tr>
</tbody></table>
<h1 id="常用正则表达式示例"><a href="#常用正则表达式示例" class="headerlink" title="常用正则表达式示例"></a>常用正则表达式示例</h1><h2 id="使用正则表达式匹配数值范围"><a href="#使用正则表达式匹配数值范围" class="headerlink" title="使用正则表达式匹配数值范围"></a>使用正则表达式匹配数值范围</h2><p>由于正则表达式处理文本而不是数字，因此匹配给定范围内的数字需要格外小心。你不能只写<code>[ 0-2 55 ]</code>来匹配 0 到 255 之间的数字。虽然是有效的正则表达式，但它匹配完全不同的东西。<code>[ 0-2 55 ]</code>是具有三个元素的字符类：字符范围 0-2、字符 5 和字符 5（再次）。该字符类匹配单个数字 0、1、2 或 5，就像<code>[ 0125 ]</code>一样。</p>
<p>由于正则表达式适用于文本，因此正则表达式引擎将<code>0</code>视为单个字符，将<code>255</code>视为三个字符。要匹配从 0 到 255 的所有字符，我们需要一个匹配 1 到 3 个字符的正则表达式。</p>
<p>正则表达式<code>[ 0-9 ]</code>匹配 0 到 9 的一位数。<code>[ 1-9 ] [ 0-9 ]</code>匹配 10 到 99 的两位数。这很容易。</p>
<p>匹配三位数字有点复杂，因为我们需要排除数字 256 到 999。1 <code>[ 0-9 ] [ 0-9 ]处理</code>100 到 199。<code>2 [ 0-4 ] [ 0-9 ]</code>匹配 200 到 249。最后，<code>25 [ 0-5 ]</code>添加 250 到 255。</p>
<p>如您所见，您需要将数字范围拆分为具有相同位数的范围，并且每个范围都允许每个数字具有相同的变化。在我们示例中的 3 位范围内，以 1 开头的数字允许后面的两位数字使用所有 10 位数字，而以 2 开头的数字则限制后面允许的数字。</p>
<p>使用交替将所有这些放在一起，我们得到：<code>[ 0-9 ] | [ 1-9 ] [ 0-9 ] | 1 [ 0-9 ] [ 0-9 ] | 2 [ 0-4 ] [ 0-9 ] | 25 [ 0-5 ]</code>。这匹配了我们想要的数字，但有一点需要注意：正则表达式搜索通常允许部分匹配，因此我们的正则表达式将匹配<code>123</code>中的<code>12345</code>。有两种解决方案。</p>
<h2 id="搜索数值范围"><a href="#搜索数值范围" class="headerlink" title="搜索数值范围"></a>搜索数值范围</h2><p>如果您在较大的文档或输入字符串中搜索这些数字，请使用<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/wordboundaries.html">单词边界</a>来要求在任何有效匹配之前和之后都需要一个非单词字符（或根本没有字符）。然后正则表达式变为<code>\b ( [ 0-9 ] | [ 1-9 ] [ 0-9 ] | 1 [ 0-9 ] [ 0-9 ] | 2 [ 0-4 ] [ 0-9 ] | 25 [ 0-5 ] ) \b</code>。由于交替运算符的优先级最低，因此<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/brackets.html">需要括号</a>将备选方案组合在一起。这样，正则表达式引擎将尝试匹配第一个单词边界，然后尝试所有备选方案，然后尝试匹配它匹配的数字之后的第二个单词边界。正则表达式引擎将所有字母数字字符以及下划线视为单词字符。</p>
<h2 id="验证数值范围"><a href="#验证数值范围" class="headerlink" title="验证数值范围"></a>验证数值范围</h2><p>如果您使用正则表达式验证输入，您可能需要检查整个输入是否包含有效数字。为此，请将单词边界替换为<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/anchors.html">锚点</a>以匹配字符串的开头和结尾：<code>^ ( [ 0-9 ] | [ 1-9 ] [ 0-9 ] | 1 [ 0-9 ] [ 0-9 ] | 2 [ 0-4 ] [ 0-9 ] | 25 [ 0-5 ] )美元</code>。</p>
<p>以下是您可能想要匹配的一些更常见的范围：</p>
<ul>
<li>000..255：<code>^ （[ 01 ] [ 0-9 ] [ 0-9 ] | 2 [ 0-4 ] [ 0-9 ] | 25 [ 0-5 ] ）$</code></li>
<li>0 或 000..255: <code>^ ( [ 01 ] ? [ 0-9 ] ? [ 0-9 ] | 2 [ 0-4 ] [ 0-9 ] | 25 [ 0-5 ] ) $</code></li>
<li>0 或 000..127: <code>^ ( 0 ? [ 0-9 ] ? [ 0-9 ] | 1 [ 01 ] [ 0-9 ] | 12 [ 0-7 ] ) $</code></li>
<li>0..999：<code>^ （[ 0-9 ] | [ 1-9 ] [ 0-9 ] | [ 1-9 ] [ 0-9 ] [ 0-9 ] ）$</code></li>
<li>000..999: <code>^ [ 0-9 ] &#123;3&#125; $</code></li>
<li>0 或 000..999: <code>^ [ 0-9 ] &#123;1,3&#125; $</code></li>
<li>1..999：<code>^ （[ 1-9 ] | [ 1-9 ] [ 0-9 ] | [ 1-9 ] [ 0-9 ] [ 0-9 ] ）$</code></li>
<li>001..999: <code>^ ( 00 [ 1-9 ] | 0 [ 1-9 ] [ 0-9 ] | [ 1-9 ] [ 0-9 ] [ 0-9 ] ) $</code></li>
<li>1 或 001..999: <code>^ ( 0 &#123;0,2&#125; [ 1-9 ] | 0 ? [ 1-9 ] [ 0-9 ] | [ 1-9 ] [ 0-9 ] [ 0-9 ] ) $</code></li>
<li>0 或 00..59: <code>^ [ 0-5 ] ? [ 0-9 ] $</code></li>
<li>0 或 000..366: <code>^ ( [ 012 ] ? [ 0-9 ] ? [ 0-9 ] | 3 [ 0-5 ] [ 0-9 ] | 36 [ 0-6 ] ) $</code></li>
</ul>
<h2 id="用正则表达式匹配浮点数"><a href="#用正则表达式匹配浮点数" class="headerlink" title="用正则表达式匹配浮点数"></a>用正则表达式匹配浮点数</h2><p>此示例说明如何避免不熟悉<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/index.html">正则表达式</a>的人经常犯的常见错误。例如，我们将尝试构建一个可以匹配任何浮点数的正则表达式。我们的正则表达式还应该匹配未给出整数部分的整数和浮点数。我们不会尝试将数字与指数相匹配，例如 1.5e8（科学计数法中的 1.5 亿）。</p>
<p>乍一看，以下正则表达式似乎可以解决问题：<code>[ -+ ] ？[ 0-9 ] * \。? [ 0-9 ] *</code>。这将浮点数定义为<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/optional.html">可选</a>符号，后跟可选的<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/charclass.html">数字</a><a target="_blank" rel="noopener" href="https://www.regular-expressions.info/repeat.html">系列</a>（整数部分），后跟可选的点，然后是另一个可选的数字系列（小数部分）。</p>
<p>用单词拼写正则表达式很明显：这个正则表达式中的所有内容都是可选的。此正则表达式将单独的符号或单独的点视为有效的浮点数。事实上，它甚至将空字符串视为有效的浮点数。如果您尝试使用此正则表达式在文件中查找浮点数，您将在字符串中没有出现浮点数的每个位置获得<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/zerolength.html">零长度匹配。</a></p>
<p>不转义<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/dot.html">点</a>也是一个常见的错误。未转义的点匹配任何字符，包括点。如果我们没有转义点，那么<code>4.4</code>和<code>4X4</code>都将被视为浮点数。</p>
<p>在创建正则表达式时，考虑它不应该匹配的内容比它应该匹配的内容更<em>重要</em>。上面的正则表达式确实匹配正确的浮点数，因为正则表达式引擎是<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/optional.html#greedy">greedy</a>。但它也匹配了许多我们不想要的东西，我们必须排除这些东西。</p>
<p>这是一个更好的尝试：<code>[ -+ ] ? ( [ 0-9 ] * \。[ 0-9 ] + | [ 0-9 ] + )</code>。此正则表达式匹配一个可选符号，该符号后跟零个<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/alternation.html">或</a>多个数字，后跟一个点和一个或多个数字（带有可选整数部分的浮点数），或者后跟一个或多个数字（整数） .</p>
<p>这是一个更好的定义。任何匹配项都必须包含至少一位数字。没有办法绕过<code>[ 0 - 9 ] +</code>部分。我们已经成功排除了我们不想要的匹配项：那些没有数字的匹配项。</p>
<p>我们可以将这个正则表达式优化为：<code>[ -+ ] ? [ 0-9 ] * \。? [ 0-9 ] +</code>。</p>
<p>如果您还想将数字与指数匹配，您可以使用：<code>[ -+ ] ? [ 0-9 ] * \。? [ 0-9 ] + （[ eE ] [ -+ ] ？[ 0-9 ] + ）？</code>. <a target="_blank" rel="noopener" href="https://www.regular-expressions.info/brackets.html">请注意我是如何通过将整个指数部分组合</a>在一起来使整个指数部分成为可选的，而不是使指数中的每个元素都是可选的。</p>
<p>最后，如果要验证特定字符串是否包含浮点数，而不是在较长的文本中查找浮点数，则必须<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/anchors.html">锚定</a>正则表达式：<code>^ [ -+ ] ? [ 0-9 ] * \。? [ 0-9 ] + $</code>或<code>^ [ -+ ] ？[ 0-9 ] * \。? [ 0-9 ] + ( [ eE ] [ -+ ] ? [ 0-9 ] +) ? $</code> . 您可以在<a target="_blank" rel="noopener" href="https://www.regexbuddy.com/library.html">RegexBuddy 的库</a>中找到这些正则表达式的其他变体。</p>
<h2 id="如何查找或验证电子邮件地址"><a href="#如何查找或验证电子邮件地址" class="headerlink" title="如何查找或验证电子邮件地址"></a>如何查找或验证电子邮件地址</h2><p>我收到最多反馈的正则表达式，更不用说“bug”报告了，就是你可以在这个网站的<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/index.html">主页上</a>找到的那个：<code>\b [ AZ 0-9 ._%+ - ] + @ [ AZ 0 -9 。- ] + \。[ AZ ] &#123;2,&#125; \b</code>。我声称，这个正则表达式匹配任何电子邮件地址。我收到的大多数反馈都通过显示一个与此正则表达式不匹配的电子邮件地址来驳斥这种说法。通常，“错误”报告还包括使正则表达式“完美”的建议。</p>
<p>正如我在下面解释的那样，只有当人们接受我对有效电子邮件地址到底是什么以及不是什么的定义时，我的主张才成立。如果您想使用不同的定义，则必须调整正则表达式。匹配一个有效的电子邮件地址是一个完美的例子，它表明（1）在编写正则表达式之前，您必须确切地知道您要匹配的内容，以及不匹配的内容；(2) 在准确和实用之间经常需要权衡取舍。</p>
<p>我上面的正则表达式的优点是它匹配了当今使用的 99% 的电子邮件地址。它匹配的所有电子邮件地址都可以被 99% 的所有电子邮件软件处理。如果您正在寻找快速解决方案，您只需阅读下一段。如果您想了解所有权衡并获得大量可供选择的替代方案，请继续阅读。</p>
<p>如果要使用上面的正则表达式，有两点需要了解。首先，长正则表达式很难很好地格式化段落。所以我没有将<code>az</code>包含在三个字符类中的任何一个中。此正则表达式旨在与您的正则表达式引擎的“不区分大小写”选项打开时使用。（你会惊讶于我收到了多少“错误”报告。）其次，上面的正则表达式是用<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/wordboundaries.html">单词边界</a>分隔的，这使它适合从文件或更大的文本块中提取电子邮件地址。如果要检查用户是否输入了有效的电子邮件地址，请将单词边界替换为<a target="_blank" rel="noopener" href="https://www.regular-expressions.info/anchors.html">字符串开头和字符串结尾的锚点</a>，如下所示：<code>^ [ AZ 0-9 ._%+- ] + @ [ AZ 0-9 。- ] + \。[ AZ ] &#123;2,&#125; $</code>。</p>
<p>上一段也适用于以下所有示例。您可能需要将单词边界更改为字符串开始/结束锚点，反之亦然。而且您必须打开不区分大小写的匹配选项。</p>
<h2 id="如何查找或验证-IP-地址"><a href="#如何查找或验证-IP-地址" class="headerlink" title="如何查找或验证 IP 地址"></a>如何查找或验证 IP 地址</h2><p>匹配 IP 地址是在正则表达式复杂性和准确性之间进行权衡的另一个很好的例子。<code>\b \d &#123;1,3&#125; \. \d &#123;1,3&#125; \. \d &#123;1,3&#125; \. \d &#123;1,3&#125; \b</code>将匹配任何 IP 地址就好了。但也会匹配<code>999.999.999.999</code>，就好像它是一个有效的 IP 地址一样。如果您的正则表达式支持 Unicode，它甚至可以匹配<code>١٢٣.१२३.೧೨೩.๑๒๓</code>。这是否是一个问题取决于您打算应用正则表达式的文件或数据。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wotzc</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/wotzc" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
