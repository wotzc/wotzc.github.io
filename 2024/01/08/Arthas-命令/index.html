<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="命令列表jvm 相关 dashboard - 当前系统的实时数据面板 getstatic - 查看类的静态属性 heapdump - dump java heap, 类似 jmap 命令的 heap dump 功能 jvm - 查看当前 JVM 的信息 logger - 查看和修改 logger mbean - 查看 Mbean 的信息 memory - 查看 JVM 的内存信息 ognl - 执">
<meta property="og:type" content="article">
<meta property="og:title" content="Arthas 命令">
<meta property="og:url" content="http://example.com/2024/01/08/Arthas-%E5%91%BD%E4%BB%A4/index.html">
<meta property="og:site_name" content="Cai">
<meta property="og:description" content="命令列表jvm 相关 dashboard - 当前系统的实时数据面板 getstatic - 查看类的静态属性 heapdump - dump java heap, 类似 jmap 命令的 heap dump 功能 jvm - 查看当前 JVM 的信息 logger - 查看和修改 logger mbean - 查看 Mbean 的信息 memory - 查看 JVM 的内存信息 ognl - 执">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://arthas.aliyun.com/images/arthas-output-recording.png">
<meta property="og:image" content="https://arthas.aliyun.com/images/arthas-output.jpg">
<meta property="og:image" content="https://arthas.aliyun.com/images/arthas-output-svg.jpg">
<meta property="article:published_time" content="2024-01-08T02:01:57.000Z">
<meta property="article:modified_time" content="2024-01-10T02:10:32.589Z">
<meta property="article:author" content="wotzc">
<meta property="article:tag" content="Arthas">
<meta property="article:tag" content="Java诊断工具">
<meta property="article:tag" content="线上问题排查">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="反编译">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://arthas.aliyun.com/images/arthas-output-recording.png">


<link rel="canonical" href="http://example.com/2024/01/08/Arthas-%E5%91%BD%E4%BB%A4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2024/01/08/Arthas-%E5%91%BD%E4%BB%A4/","path":"2024/01/08/Arthas-命令/","title":"Arthas 命令"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Arthas 命令 | Cai</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Cai</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E5%88%97%E8%A1%A8"><span class="nav-number">1.</span> <span class="nav-text">命令列表</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#jvm-%E7%9B%B8%E5%85%B3"><span class="nav-number">1.1.</span> <span class="nav-text">jvm 相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#class-classloader-%E7%9B%B8%E5%85%B3"><span class="nav-number">1.2.</span> <span class="nav-text">class&#x2F;classloader 相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#monitor-watch-trace-%E7%9B%B8%E5%85%B3"><span class="nav-number">1.3.</span> <span class="nav-text">monitor&#x2F;watch&#x2F;trace 相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#profiler-%E7%81%AB%E7%84%B0%E5%9B%BE"><span class="nav-number">1.4.</span> <span class="nav-text">profiler&#x2F;火焰图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%89%B4%E6%9D%83"><span class="nav-number">1.5.</span> <span class="nav-text">鉴权</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#options"><span class="nav-number">1.6.</span> <span class="nav-text">options</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E9%81%93"><span class="nav-number">1.7.</span> <span class="nav-text">管道</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1"><span class="nav-number">1.8.</span> <span class="nav-text">后台异步任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4"><span class="nav-number">1.9.</span> <span class="nav-text">基础命令</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Cat-%E5%91%BD%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">Cat 命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Classloader-%E5%91%BD%E4%BB%A4"><span class="nav-number">3.</span> <span class="nav-text">Classloader 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89-ClassLoader"><span class="nav-number">3.1.</span> <span class="nav-text">列出所有 ClassLoader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1-ClassLoader-%E5%AE%9E%E9%99%85%E4%BD%BF%E7%94%A8-URL-%E5%92%8C%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84-URL"><span class="nav-number">3.2.</span> <span class="nav-text">统计 ClassLoader 实际使用 URL 和未使用的 URL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%97%E5%87%BA-ClassLoader-%E9%87%8C%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%89%80%E6%9C%89%E7%B1%BB"><span class="nav-number">3.3.</span> <span class="nav-text">列出 ClassLoader 里加载的所有类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%B1%BB%E7%9A%84-classloader-%E5%B1%82%E6%AC%A1"><span class="nav-number">3.4.</span> <span class="nav-text">查看类的 classloader 层次</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B-ClassLoader-%E6%A0%91"><span class="nav-number">3.5.</span> <span class="nav-text">查看 ClassLoader 树</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B-URLClassLoader-%E5%AE%9E%E9%99%85%E7%9A%84-urls"><span class="nav-number">3.6.</span> <span class="nav-text">查看 URLClassLoader 实际的 urls</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE-ClassLoader-%E9%87%8C%E7%9A%84%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6"><span class="nav-number">3.7.</span> <span class="nav-text">查找 ClassLoader 里的资源文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Cls-%E5%91%BD%E4%BB%A4"><span class="nav-number">4.</span> <span class="nav-text">Cls 命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Grep-%E5%91%BD%E4%BB%A4"><span class="nav-number">5.</span> <span class="nav-text">Grep 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83"><span class="nav-number">5.1.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%B9%E9%85%8D%E5%B1%95%E7%A4%BA%E7%AC%A6%E5%90%88%E8%8C%83%E6%9C%AC%E6%A0%B7%E5%BC%8F%E7%9A%84%E9%A1%B9"><span class="nav-number">5.1.1.</span> <span class="nav-text">匹配展示符合范本样式的项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#n-%E5%91%BD%E4%BB%A4%E6%98%BE%E7%A4%BA%E8%A1%8C%E5%8F%B7%EF%BC%9A"><span class="nav-number">5.1.2.</span> <span class="nav-text">-n 命令显示行号：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#v-%E5%B1%95%E7%A4%BA%E9%9D%9E%E5%8C%B9%E9%85%8D"><span class="nav-number">5.1.3.</span> <span class="nav-text">-v 展示非匹配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#e-%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D%EF%BC%8C-m-%E8%AE%BE%E5%AE%9A%E6%9C%80%E5%A4%A7%E5%B1%95%E7%A4%BA%E6%9D%A1%E6%95%B0%EF%BC%8C"><span class="nav-number">5.1.4.</span> <span class="nav-text">-e 使用正则表达式匹配，-m 设定最大展示条数，</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%99%A4%E4%BA%86%E6%98%BE%E7%A4%BA%E7%AC%A6%E5%90%88%E8%8C%83%E6%9C%AC%E6%A0%B7%E5%BC%8F%E7%9A%84%E9%82%A3%E4%B8%80%E8%A1%8C%E4%B9%8B%E5%A4%96%EF%BC%8C-A-%E6%8C%87%E5%AE%9A%E6%98%BE%E7%A4%BA%E8%AF%A5%E8%A1%8C%E4%B9%8B%E5%90%8E%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%8C-B-%E6%8C%87%E5%AE%9A%E6%98%BE%E7%A4%BA%E8%AF%A5%E8%A1%8C%E4%B9%8B%E5%89%8D%E7%9A%84%E5%86%85%E5%AE%B9%E3%80%82"><span class="nav-number">5.1.5.</span> <span class="nav-text">除了显示符合范本样式的那一行之外，-A 指定显示该行之后的内容，-B 指定显示该行之前的内容。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dashboard-%E5%91%BD%E4%BB%A4"><span class="nav-number">6.</span> <span class="nav-text">Dashboard 命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#dump-%E5%91%BD%E4%BB%A4"><span class="nav-number">7.</span> <span class="nav-text">dump 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="nav-number">7.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-1"><span class="nav-number">7.2.</span> <span class="nav-text">使用参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#echo-%E5%91%BD%E4%BB%A4"><span class="nav-number">8.</span> <span class="nav-text">echo 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-2"><span class="nav-number">8.1.</span> <span class="nav-text">使用参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Getstatic-%E5%91%BD%E4%BB%A4"><span class="nav-number">9.</span> <span class="nav-text">Getstatic 命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Help-%E5%91%BD%E4%BB%A4"><span class="nav-number">10.</span> <span class="nav-text">Help 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-1"><span class="nav-number">10.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-3"><span class="nav-number">10.2.</span> <span class="nav-text">使用参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#history-%E5%91%BD%E4%BB%A4"><span class="nav-number">11.</span> <span class="nav-text">history 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-2"><span class="nav-number">11.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-4"><span class="nav-number">11.2.</span> <span class="nav-text">使用参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jad-%E5%91%BD%E4%BB%A4"><span class="nav-number">12.</span> <span class="nav-text">Jad 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-3"><span class="nav-number">12.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-5"><span class="nav-number">12.2.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91java-lang-String"><span class="nav-number">12.2.1.</span> <span class="nav-text">反编译java.lang.String</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E6%97%B6%E5%8F%AA%E6%98%BE%E7%A4%BA%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">12.2.2.</span> <span class="nav-text">反编译时只显示源代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E6%8C%87%E5%AE%9A%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">12.2.3.</span> <span class="nav-text">反编译指定的函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E6%97%B6%E4%B8%8D%E6%98%BE%E7%A4%BA%E8%A1%8C%E5%8F%B7"><span class="nav-number">12.2.4.</span> <span class="nav-text">反编译时不显示行号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E7%BC%96%E8%AF%91%E6%97%B6%E6%8C%87%E5%AE%9A-ClassLoader"><span class="nav-number">12.2.5.</span> <span class="nav-text">反编译时指定 ClassLoader</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#jfr-%E5%91%BD%E4%BB%A4"><span class="nav-number">13.</span> <span class="nav-text">jfr 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-4"><span class="nav-number">13.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-JFR-%E8%AE%B0%E5%BD%95"><span class="nav-number">13.2.</span> <span class="nav-text">启动 JFR 记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B-JFR-%E8%AE%B0%E5%BD%95%E7%8A%B6%E6%80%81"><span class="nav-number">13.3.</span> <span class="nav-text">查看 JFR 记录状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dump-jfr-%E8%AE%B0%E5%BD%95"><span class="nav-number">13.4.</span> <span class="nav-text">dump jfr 记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%81%9C%E6%AD%A2-jfr-%E8%AE%B0%E5%BD%95"><span class="nav-number">13.5.</span> <span class="nav-text">停止 jfr 记录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8B-arthas-output-%E4%B8%8B%E9%9D%A2-JFR-%E8%AE%B0%E5%BD%95%E7%9A%84%E7%BB%93%E6%9E%9C"><span class="nav-number">13.6.</span> <span class="nav-text">通过浏览器查看 arthas-output 下面 JFR 记录的结果</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jvm-%E5%91%BD%E4%BB%A4"><span class="nav-number">14.</span> <span class="nav-text">Jvm 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-6"><span class="nav-number">14.1.</span> <span class="nav-text">使用参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#THREAD-%E7%9B%B8%E5%85%B3"><span class="nav-number">14.2.</span> <span class="nav-text">THREAD 相关</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6%E7%9B%B8%E5%85%B3"><span class="nav-number">14.3.</span> <span class="nav-text">文件描述符相关</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Keymap-%E5%91%BD%E4%BB%A4"><span class="nav-number">15.</span> <span class="nav-text">Keymap 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="nav-number">15.1.</span> <span class="nav-text">自定义快捷键</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8E%E5%8F%B0%E5%BC%82%E6%AD%A5%E5%91%BD%E4%BB%A4%E7%9B%B8%E5%85%B3%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="nav-number">15.2.</span> <span class="nav-text">后台异步命令相关快捷键</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Logger-%E5%91%BD%E4%BB%A4"><span class="nav-number">16.</span> <span class="nav-text">Logger 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-7"><span class="nav-number">16.1.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89-logger-%E4%BF%A1%E6%81%AF"><span class="nav-number">16.1.1.</span> <span class="nav-text">查看所有 logger 信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E5%90%8D%E5%AD%97%E7%9A%84-logger-%E4%BF%A1%E6%81%AF"><span class="nav-number">16.1.2.</span> <span class="nav-text">查看指定名字的 logger 信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A-classloader-%E7%9A%84-logger-%E4%BF%A1%E6%81%AF"><span class="nav-number">16.1.3.</span> <span class="nav-text">查看指定 classloader 的 logger 信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0-logger-level"><span class="nav-number">16.1.4.</span> <span class="nav-text">更新 logger level</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-classloader-%E6%9B%B4%E6%96%B0-logger-level"><span class="nav-number">16.1.5.</span> <span class="nav-text">指定 classloader 更新 logger level</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%B2%A1%E6%9C%89-appender-%E7%9A%84-logger-%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="nav-number">16.1.6.</span> <span class="nav-text">查看没有 appender 的 logger 的信息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Mbean-%E5%91%BD%E4%BB%A4"><span class="nav-number">17.</span> <span class="nav-text">Mbean 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-5"><span class="nav-number">17.1.</span> <span class="nav-text">参数说明</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mc-redefine-%E5%91%BD%E4%BB%A4"><span class="nav-number">18.</span> <span class="nav-text">mc-redefine 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#mc"><span class="nav-number">18.1.</span> <span class="nav-text">mc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-8"><span class="nav-number">18.2.</span> <span class="nav-text">使用参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redefine"><span class="nav-number">18.3.</span> <span class="nav-text">redefine</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#retransform-%E5%91%BD%E4%BB%A4"><span class="nav-number">19.</span> <span class="nav-text">retransform 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-9"><span class="nav-number">19.1.</span> <span class="nav-text">使用参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#retransform-%E6%8C%87%E5%AE%9A%E7%9A%84-class-%E6%96%87%E4%BB%B6"><span class="nav-number">19.2.</span> <span class="nav-text">retransform 指定的 .class 文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B-retransform-entry"><span class="nav-number">19.3.</span> <span class="nav-text">查看 retransform entry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A-retransform-entry"><span class="nav-number">19.4.</span> <span class="nav-text">删除指定 retransform entry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%89%80%E6%9C%89-retransform-entry"><span class="nav-number">19.5.</span> <span class="nav-text">删除所有 retransform entry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%BE%E5%BC%8F%E8%A7%A6%E5%8F%91-retransform"><span class="nav-number">19.6.</span> <span class="nav-text">显式触发 retransform</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B6%88%E9%99%A4-retransform-%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="nav-number">19.7.</span> <span class="nav-text">消除 retransform 的影响</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E5%90%88-jad-mc-%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="nav-number">19.8.</span> <span class="nav-text">结合 jad&#x2F;mc 命令使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8A%E4%BC%A0-class-%E6%96%87%E4%BB%B6%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%8A%80%E5%B7%A7"><span class="nav-number">19.9.</span> <span class="nav-text">上传 .class 文件到服务器的技巧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#retransform-%E7%9A%84%E9%99%90%E5%88%B6"><span class="nav-number">19.10.</span> <span class="nav-text">retransform 的限制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Monitor-%E5%91%BD%E4%BB%A4"><span class="nav-number">20.</span> <span class="nav-text">Monitor 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%91%E6%8E%A7%E7%9A%84%E7%BB%B4%E5%BA%A6%E8%AF%B4%E6%98%8E"><span class="nav-number">20.1.</span> <span class="nav-text">监控的维度说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-6"><span class="nav-number">20.2.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-10"><span class="nav-number">20.3.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-Class-%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D%E6%95%B0%E9%87%8F"><span class="nav-number">20.3.1.</span> <span class="nav-text">指定 Class 最大匹配数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%87%E6%BB%A4%E7%BB%9F%E8%AE%A1%E7%BB%93%E6%9E%9C-%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%AF%95%E4%B9%8B%E5%90%8E"><span class="nav-number">20.3.2.</span> <span class="nav-text">计算条件表达式过滤统计结果(方法执行完毕之后)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%87%E6%BB%A4%E7%BB%9F%E8%AE%A1%E7%BB%93%E6%9E%9C-%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%AF%95%E4%B9%8B%E5%89%8D"><span class="nav-number">20.3.3.</span> <span class="nav-text">计算条件表达式过滤统计结果(方法执行完毕之前)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ognl-%E5%91%BD%E4%BB%A4"><span class="nav-number">21.</span> <span class="nav-text">ognl 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-7"><span class="nav-number">21.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-11"><span class="nav-number">21.2.</span> <span class="nav-text">使用参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Options-%E5%91%BD%E4%BB%A4"><span class="nav-number">22.</span> <span class="nav-text">Options 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%9A%84-options"><span class="nav-number">22.0.1.</span> <span class="nav-text">查看所有的 options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-option-%E7%9A%84%E5%80%BC"><span class="nav-number">22.0.2.</span> <span class="nav-text">获取 option 的值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%8C%87%E5%AE%9A%E7%9A%84-option"><span class="nav-number">22.0.3.</span> <span class="nav-text">设置指定的 option</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Perfcounter-%E5%91%BD%E4%BB%A4"><span class="nav-number">23.</span> <span class="nav-text">Perfcounter 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-12"><span class="nav-number">23.1.</span> <span class="nav-text">使用参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#jdk9-%E4%BB%A5%E4%B8%8A%E7%9A%84%E5%BA%94%E7%94%A8"><span class="nav-number">23.2.</span> <span class="nav-text">jdk9 以上的应用</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Plaintext-%E5%91%BD%E4%BB%A4"><span class="nav-number">24.</span> <span class="nav-text">Plaintext 命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Profiler-%E5%91%BD%E4%BB%A4"><span class="nav-number">25.</span> <span class="nav-text">Profiler 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-8"><span class="nav-number">25.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8-profiler"><span class="nav-number">25.2.</span> <span class="nav-text">启动 profiler</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%B7%B2%E9%87%87%E9%9B%86%E7%9A%84-sample-%E7%9A%84%E6%95%B0%E9%87%8F"><span class="nav-number">25.3.</span> <span class="nav-text">获取已采集的 sample 的数量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B-profiler-%E7%8A%B6%E6%80%81"><span class="nav-number">25.4.</span> <span class="nav-text">查看 profiler 状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%81%9C%E6%AD%A2-profiler"><span class="nav-number">25.5.</span> <span class="nav-text">停止 profiler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90-html-%E6%A0%BC%E5%BC%8F%E7%BB%93%E6%9E%9C"><span class="nav-number">25.5.1.</span> <span class="nav-text">生成 html 格式结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8B-arthas-output-%E4%B8%8B%E9%9D%A2%E7%9A%84-profiler-%E7%BB%93%E6%9E%9C"><span class="nav-number">25.6.</span> <span class="nav-text">通过浏览器查看 arthas-output 下面的 profiler 结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#profiler-%E6%94%AF%E6%8C%81%E7%9A%84-events"><span class="nav-number">25.7.</span> <span class="nav-text">profiler 支持的 events</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%81%A2%E5%A4%8D%E9%87%87%E6%A0%B7"><span class="nav-number">25.8.</span> <span class="nav-text">恢复采样</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8execute%E6%9D%A5%E6%89%A7%E8%A1%8C%E5%A4%8D%E6%9D%82%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="nav-number">25.9.</span> <span class="nav-text">使用execute来执行复杂的命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E6%94%AF%E6%8C%81%E7%9A%84-action"><span class="nav-number">25.10.</span> <span class="nav-text">查看所有支持的 action</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC"><span class="nav-number">25.11.</span> <span class="nav-text">查看版本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-framebuf-%E5%8F%82%E6%95%B0"><span class="nav-number">25.12.</span> <span class="nav-text">配置 framebuf 参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-include-exclude-%E6%9D%A5%E8%BF%87%E6%BB%A4%E6%95%B0%E6%8D%AE"><span class="nav-number">25.13.</span> <span class="nav-text">配置 include&#x2F;exclude 来过滤数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="nav-number">25.14.</span> <span class="nav-text">指定执行时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90-jfr-%E6%A0%BC%E5%BC%8F%E7%BB%93%E6%9E%9C"><span class="nav-number">25.15.</span> <span class="nav-text">生成 jfr 格式结果</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E7%9A%84%E7%81%AB%E7%84%B0%E5%9B%BE%E9%87%8C%E7%9A%84-unknown"><span class="nav-number">25.16.</span> <span class="nav-text">生成的火焰图里的 unknown</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Pwd-%E5%91%BD%E4%BB%A4"><span class="nav-number">26.</span> <span class="nav-text">Pwd 命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Quit-stop-%E5%91%BD%E4%BB%A4"><span class="nav-number">27.</span> <span class="nav-text">Quit-stop 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%80%E5%87%BA-Arthas"><span class="nav-number">27.1.</span> <span class="nav-text">退出 Arthas</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BD%BB%E5%BA%95%E9%80%80%E5%87%BA-Arthas"><span class="nav-number">27.2.</span> <span class="nav-text">彻底退出 Arthas</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reset-%E5%91%BD%E4%BB%A4"><span class="nav-number">28.</span> <span class="nav-text">Reset 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-13"><span class="nav-number">28.1.</span> <span class="nav-text">使用参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%98%E5%8E%9F%E6%8C%87%E5%AE%9A%E7%B1%BB"><span class="nav-number">28.2.</span> <span class="nav-text">还原指定类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%98%E5%8E%9F%E6%89%80%E6%9C%89%E7%B1%BB"><span class="nav-number">28.3.</span> <span class="nav-text">还原所有类</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sc-%E5%91%BD%E4%BB%A4"><span class="nav-number">29.</span> <span class="nav-text">Sc 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-9"><span class="nav-number">29.0.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-14"><span class="nav-number">29.0.2.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-classLoader"><span class="nav-number">29.0.2.1.</span> <span class="nav-text">指定 classLoader</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#session-%E5%91%BD%E4%BB%A4"><span class="nav-number">30.</span> <span class="nav-text">session 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-15"><span class="nav-number">30.1.</span> <span class="nav-text">使用参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sm-%E5%91%BD%E4%BB%A4"><span class="nav-number">31.</span> <span class="nav-text">Sm 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-10"><span class="nav-number">31.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-16"><span class="nav-number">31.2.</span> <span class="nav-text">使用参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Stack-%E5%91%BD%E4%BB%A4"><span class="nav-number">32.</span> <span class="nav-text">Stack 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-11"><span class="nav-number">32.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%BE%8B%E5%AD%90"><span class="nav-number">32.2.</span> <span class="nav-text">使用例子</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#stack"><span class="nav-number">32.2.1.</span> <span class="nav-text">stack</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-Class-%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D%E6%95%B0%E9%87%8F-1"><span class="nav-number">32.2.2.</span> <span class="nav-text">指定 Class 最大匹配数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8D%AE%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%9D%A5%E8%BF%87%E6%BB%A4"><span class="nav-number">32.2.3.</span> <span class="nav-text">据条件表达式来过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8D%AE%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E6%9D%A5%E8%BF%87%E6%BB%A4"><span class="nav-number">32.2.4.</span> <span class="nav-text">据执行时间来过滤</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Sysenv-%E5%91%BD%E4%BB%A4"><span class="nav-number">33.</span> <span class="nav-text">Sysenv 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-17"><span class="nav-number">33.1.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">33.1.1.</span> <span class="nav-text">查看所有环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-number">33.1.2.</span> <span class="nav-text">查看单个环境变量</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sysprop-%E5%91%BD%E4%BB%A4"><span class="nav-number">34.</span> <span class="nav-text">sysprop 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-18"><span class="nav-number">34.1.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E5%B1%9E%E6%80%A7"><span class="nav-number">34.1.1.</span> <span class="nav-text">查看所有属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E5%B1%9E%E6%80%A7"><span class="nav-number">34.1.2.</span> <span class="nav-text">查看单个属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%8D%95%E4%B8%AA%E5%B1%9E%E6%80%A7"><span class="nav-number">34.1.3.</span> <span class="nav-text">修改单个属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tee-%E5%91%BD%E4%BB%A4"><span class="nav-number">35.</span> <span class="nav-text">tee 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E7%A4%BA%E8%8C%83"><span class="nav-number">35.1.</span> <span class="nav-text">命令示范</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-sysprop-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E5%8F%A6%E5%A4%96%E5%AD%98%E5%82%A8%E5%9C%A8-tmp-logfile-%E4%B8%AD"><span class="nav-number">35.1.1.</span> <span class="nav-text">将 sysprop 命令执行结果另外存储在&#x2F;tmp&#x2F;logfile 中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%86-sysprop-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E5%8C%B9%E9%85%8Djava-%E5%90%8E%E5%8F%A6%E5%A4%96%E8%BF%BD%E5%8A%A0%E5%9C%A8-tmp-logfile-%E4%B8%AD"><span class="nav-number">35.1.2.</span> <span class="nav-text">将 sysprop 命令执行结果匹配java 后另外追加在&#x2F;tmp&#x2F;logfile 中</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#thread-%E5%91%BD%E4%BB%A4"><span class="nav-number">36.</span> <span class="nav-text">thread 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-12"><span class="nav-number">36.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Thread-%E7%94%A8%E6%B3%95"><span class="nav-number">36.2.</span> <span class="nav-text">Thread 用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E4%B8%80%E9%94%AE%E5%B1%95%E7%A4%BA%E5%BD%93%E5%89%8D%E6%9C%80%E5%BF%99%E7%9A%84%E5%89%8D-N-%E4%B8%AA%E7%BA%BF%E7%A8%8B%E5%B9%B6%E6%89%93%E5%8D%B0%E5%A0%86%E6%A0%88%EF%BC%9A"><span class="nav-number">36.2.1.</span> <span class="nav-text">支持一键展示当前最忙的前 N 个线程并打印堆栈：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%93%E6%B2%A1%E6%9C%89%E5%8F%82%E6%95%B0%E6%97%B6%EF%BC%8C%E6%98%BE%E7%A4%BA%E7%AC%AC%E4%B8%80%E9%A1%B5%E7%BA%BF%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="nav-number">36.2.2.</span> <span class="nav-text">当没有参数时，显示第一页线程信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#thread-%E2%80%93all-%E6%98%BE%E7%A4%BA%E6%89%80%E6%9C%89%E5%8C%B9%E9%85%8D%E7%9A%84%E7%BA%BF%E7%A8%8B"><span class="nav-number">36.2.3.</span> <span class="nav-text">thread –all, 显示所有匹配的线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#thread-id%EF%BC%8C%E6%98%BE%E7%A4%BA%E6%8C%87%E5%AE%9A%E7%BA%BF%E7%A8%8B%E7%9A%84%E8%BF%90%E8%A1%8C%E5%A0%86%E6%A0%88"><span class="nav-number">36.2.4.</span> <span class="nav-text">thread id，显示指定线程的运行堆栈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#thread-b-%E6%89%BE%E5%87%BA%E5%BD%93%E5%89%8D%E9%98%BB%E5%A1%9E%E5%85%B6%E4%BB%96%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%BA%BF%E7%A8%8B"><span class="nav-number">36.2.5.</span> <span class="nav-text">thread -b, 找出当前阻塞其他线程的线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#thread-i-%E6%8C%87%E5%AE%9A%E9%87%87%E6%A0%B7%E6%97%B6%E9%97%B4%E9%97%B4%E9%9A%94"><span class="nav-number">36.2.6.</span> <span class="nav-text">thread -i, 指定采样时间间隔</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#thread-%E2%80%93state%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E7%8A%B6%E6%80%81%E7%9A%84%E7%BA%BF%E7%A8%8B"><span class="nav-number">36.2.7.</span> <span class="nav-text">thread –state，查看指定状态的线程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#trace-%E5%91%BD%E4%BB%A4"><span class="nav-number">37.</span> <span class="nav-text">trace 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-13"><span class="nav-number">37.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">37.2.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-19"><span class="nav-number">37.3.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#trace-%E5%87%BD%E6%95%B0"><span class="nav-number">37.3.1.</span> <span class="nav-text">trace 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-Class-%E5%8C%B9%E9%85%8D%E7%9A%84%E6%9C%80%E5%A4%A7%E6%95%B0%E9%87%8F"><span class="nav-number">37.3.2.</span> <span class="nav-text">指定 Class 匹配的最大数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trace-%E6%AC%A1%E6%95%B0%E9%99%90%E5%88%B6"><span class="nav-number">37.3.3.</span> <span class="nav-text">trace 次数限制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E5%90%AB-jdk-%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">37.3.4.</span> <span class="nav-text">包含 jdk 的函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE%E8%B0%83%E7%94%A8%E8%80%97%E6%97%B6%E8%BF%87%E6%BB%A4"><span class="nav-number">37.3.5.</span> <span class="nav-text">根据调用耗时过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trace-%E5%A4%9A%E4%B8%AA%E7%B1%BB%E6%88%96%E8%80%85%E5%A4%9A%E4%B8%AA%E5%87%BD%E6%95%B0"><span class="nav-number">37.3.6.</span> <span class="nav-text">trace 多个类或者多个函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E9%99%A4%E6%8E%89%E6%8C%87%E5%AE%9A%E7%9A%84%E7%B1%BB"><span class="nav-number">37.3.7.</span> <span class="nav-text">排除掉指定的类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81-trace"><span class="nav-number">37.4.</span> <span class="nav-text">动态 trace</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#trace-%E7%BB%93%E6%9E%9C%E6%97%B6%E9%97%B4%E4%B8%8D%E5%87%86%E7%A1%AE%E9%97%AE%E9%A2%98"><span class="nav-number">37.5.</span> <span class="nav-text">trace 结果时间不准确问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-v-%E5%8F%82%E6%95%B0%E6%89%93%E5%8D%B0%E6%9B%B4%E5%A4%9A%E4%BF%A1%E6%81%AF"><span class="nav-number">37.5.1.</span> <span class="nav-text">使用 -v 参数打印更多信息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tt-%E5%91%BD%E4%BB%A4"><span class="nav-number">38.</span> <span class="nav-text">tt 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><span class="nav-number">38.1.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-20"><span class="nav-number">38.2.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%B0%E5%BD%95%E8%B0%83%E7%94%A8"><span class="nav-number">38.2.1.</span> <span class="nav-text">记录调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-Class-%E6%9C%80%E5%A4%A7%E5%8C%B9%E9%85%8D%E6%95%B0%E9%87%8F-2"><span class="nav-number">38.2.2.</span> <span class="nav-text">指定 Class 最大匹配数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A3%80%E7%B4%A2%E8%B0%83%E7%94%A8%E8%AE%B0%E5%BD%95"><span class="nav-number">38.2.3.</span> <span class="nav-text">检索调用记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E8%B0%83%E7%94%A8%E4%BF%A1%E6%81%AF"><span class="nav-number">38.2.4.</span> <span class="nav-text">查看调用信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%81%9A%E4%B8%80%E6%AC%A1%E8%B0%83%E7%94%A8"><span class="nav-number">38.2.5.</span> <span class="nav-text">重做一次调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">38.2.6.</span> <span class="nav-text">观察表达式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E7%B4%A2%E5%BC%95%E5%88%A0%E9%99%A4%E6%8C%87%E5%AE%9A%E7%9A%84-tt-%E8%AE%B0%E5%BD%95"><span class="nav-number">38.2.7.</span> <span class="nav-text">通过索引删除指定的 tt 记录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%85%E9%99%A4%E6%89%80%E6%9C%89%E7%9A%84-tt-%E8%AE%B0%E5%BD%95"><span class="nav-number">38.2.8.</span> <span class="nav-text">清除所有的 tt 记录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#version-%E5%91%BD%E4%BB%A4"><span class="nav-number">39.</span> <span class="nav-text">version 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-21"><span class="nav-number">39.1.</span> <span class="nav-text">使用参考</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Vmoption-%E5%91%BD%E4%BB%A4"><span class="nav-number">40.</span> <span class="nav-text">Vmoption 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-22"><span class="nav-number">40.1.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E7%9A%84-option"><span class="nav-number">40.1.1.</span> <span class="nav-text">查看所有的 option</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%8C%87%E5%AE%9A%E7%9A%84-option"><span class="nav-number">40.1.2.</span> <span class="nav-text">查看指定的 option</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%8C%87%E5%AE%9A%E7%9A%84-option"><span class="nav-number">40.1.3.</span> <span class="nav-text">更新指定的 option</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%89%93%E5%8D%B0-GC-%E8%AF%A6%E6%83%85"><span class="nav-number">40.1.4.</span> <span class="nav-text">配置打印 GC 详情</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#vmtool-%E5%91%BD%E4%BB%A4"><span class="nav-number">41.</span> <span class="nav-text">vmtool 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE-jvm-%E9%87%8C%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E8%B1%A1"><span class="nav-number">41.1.</span> <span class="nav-text">查找 jvm 里的字符串对象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#limit-%E5%8F%82%E6%95%B0"><span class="nav-number">41.2.</span> <span class="nav-text">limit 参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BE-spring-context"><span class="nav-number">41.3.</span> <span class="nav-text">查找 spring context</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E5%B1%95%E5%BC%80%E5%B1%82%E6%95%B0"><span class="nav-number">41.4.</span> <span class="nav-text">指定返回结果展开层数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">41.5.</span> <span class="nav-text">执行表达式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E8%8E%B7%E5%8F%96-UserController-%E5%B9%B6%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">41.6.</span> <span class="nav-text">直接获取 UserController 并调用方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A-classloader"><span class="nav-number">41.7.</span> <span class="nav-text">指定 classloader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%BA%E5%88%B6-GC"><span class="nav-number">41.8.</span> <span class="nav-text">强制 GC</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#interrupt-%E6%8C%87%E5%AE%9A%E7%BA%BF%E7%A8%8B"><span class="nav-number">41.9.</span> <span class="nav-text">interrupt 指定线程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#watch-%E5%91%BD%E4%BB%A4"><span class="nav-number">42.</span> <span class="nav-text">watch 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-14"><span class="nav-number">42.0.1.</span> <span class="nav-text">参数说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E8%80%83-23"><span class="nav-number">42.0.2.</span> <span class="nav-text">使用参考</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E6%96%B9%E6%B3%95%E5%87%BA%E5%8F%82%E3%80%81this-%E5%AF%B9%E8%B1%A1%E5%92%8C%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">42.0.2.1.</span> <span class="nav-text">观察方法出参、this 对象和返回值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E6%96%B9%E6%B3%95%E5%85%A5%E5%8F%82"><span class="nav-number">42.0.2.2.</span> <span class="nav-text">观察方法入参</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%97%B6%E8%A7%82%E5%AF%9F%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8%E5%89%8D%E5%92%8C%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%E5%90%8E"><span class="nav-number">42.0.2.3.</span> <span class="nav-text">同时观察方法调用前和方法返回后</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E6%95%B4-x-%E7%9A%84%E5%80%BC%EF%BC%8C%E8%A7%82%E5%AF%9F%E5%85%B7%E4%BD%93%E7%9A%84%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0%E5%80%BC"><span class="nav-number">42.0.2.4.</span> <span class="nav-text">调整-x 的值，观察具体的方法参数值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-number">42.0.2.5.</span> <span class="nav-text">条件表达式的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E5%BC%82%E5%B8%B8%E4%BF%A1%E6%81%AF%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-number">42.0.2.6.</span> <span class="nav-text">观察异常信息的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8C%89%E7%85%A7%E8%80%97%E6%97%B6%E8%BF%9B%E8%A1%8C%E8%BF%87%E6%BB%A4"><span class="nav-number">42.0.2.7.</span> <span class="nav-text">按照耗时进行过滤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E5%BD%93%E5%89%8D%E5%AF%B9%E8%B1%A1%E4%B8%AD%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="nav-number">42.0.2.8.</span> <span class="nav-text">观察当前对象中的属性</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#wc-%E5%91%BD%E4%BB%A4"><span class="nav-number">43.</span> <span class="nav-text">wc 命令</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wotzc"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">wotzc</p>
  <div class="site-description" itemprop="description">真正的大师永远都怀着一颗学徒的心</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">78</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/08/Arthas-%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="wotzc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cai">
      <meta itemprop="description" content="真正的大师永远都怀着一颗学徒的心">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Arthas 命令 | Cai">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Arthas 命令
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-01-08 10:01:57" itemprop="dateCreated datePublished" datetime="2024-01-08T10:01:57+08:00">2024-01-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-01-10 10:10:32" itemprop="dateModified" datetime="2024-01-10T10:10:32+08:00">2024-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">Java诊断工具</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="命令列表"><a href="#命令列表" class="headerlink" title="命令列表"></a>命令列表</h1><h2 id="jvm-相关"><a href="#jvm-相关" class="headerlink" title="jvm 相关"></a>jvm 相关</h2><ul>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/dashboard.html">dashboard</a> - 当前系统的实时数据面板</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/getstatic.html">getstatic</a> - 查看类的静态属性</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/heapdump.html">heapdump</a> - dump java heap, 类似 jmap 命令的 heap dump 功能</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/jvm.html">jvm</a> - 查看当前 JVM 的信息</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/logger.html">logger</a> - 查看和修改 logger</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/mbean.html">mbean</a> - 查看 Mbean 的信息</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/memory.html">memory</a> - 查看 JVM 的内存信息</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/ognl.html">ognl</a> - 执行 ognl 表达式</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/perfcounter.html">perfcounter</a> - 查看当前 JVM 的 Perf Counter 信息</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/sysenv.html">sysenv</a> - 查看 JVM 的环境变量</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/sysprop.html">sysprop</a> - 查看和修改 JVM 的系统属性</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/thread.html">thread</a> - 查看当前 JVM 的线程堆栈信息</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/vmoption.html">vmoption</a> - 查看和修改 JVM 里诊断相关的 option</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/vmtool.html">vmtool</a> - 从 jvm 里查询对象，执行 forceGc</li>
</ul>
<h2 id="class-classloader-相关"><a href="#class-classloader-相关" class="headerlink" title="class/classloader 相关"></a>class/classloader 相关</h2><ul>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/classloader.html">classloader</a> - 查看 classloader 的继承树，urls，类加载信息，使用 classloader 去 getResource</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/dump.html">dump</a> - dump 已加载类的 byte code 到特定目录</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/jad.html">jad</a> - 反编译指定已加载类的源码</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/mc.html">mc</a> - 内存编译器，内存编译<code>.java</code>文件为<code>.class</code>文件</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/redefine.html">redefine</a> - 加载外部的<code>.class</code>文件，redefine 到 JVM 里</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/retransform.html">retransform</a> - 加载外部的<code>.class</code>文件，retransform 到 JVM 里</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/sc.html">sc</a> - 查看 JVM 已加载的类信息</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/sm.html">sm</a> - 查看已加载类的方法信息</li>
</ul>
<h2 id="monitor-watch-trace-相关"><a href="#monitor-watch-trace-相关" class="headerlink" title="monitor/watch/trace 相关"></a>monitor/watch/trace 相关</h2><p>注意</p>
<p>请注意，这些命令，都通过字节码增强技术来实现的，会在指定类的方法中插入一些切面来实现数据统计和观测，因此在线上、预发使用时，请尽量明确需要观测的类、方法以及条件，诊断结束要执行 <code>stop</code> 或将增强过的类执行 <code>reset</code> 命令。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/monitor.html">monitor</a> - 方法执行监控</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/stack.html">stack</a> - 输出当前方法被调用的调用路径</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/trace.html">trace</a> - 方法内部调用路径，并输出方法路径上的每个节点上耗时</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/tt.html">tt</a> - 方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/watch.html">watch</a> - 方法执行数据观测</li>
</ul>
<h2 id="profiler-火焰图"><a href="#profiler-火焰图" class="headerlink" title="profiler/火焰图"></a>profiler/火焰图</h2><ul>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/profiler.html">profiler</a> - 使用<a target="_blank" rel="noopener" href="https://github.com/jvm-profiling-tools/async-profiler">async-profiler在新窗口打开</a>对应用采样，生成火焰图</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/jfr.html">jfr</a> - 动态开启关闭 JFR 记录</li>
</ul>
<h2 id="鉴权"><a href="#鉴权" class="headerlink" title="鉴权"></a>鉴权</h2><ul>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/auth.html">auth</a> - 鉴权</li>
</ul>
<h2 id="options"><a href="#options" class="headerlink" title="options"></a>options</h2><ul>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/options.html">options</a> - 查看或设置 Arthas 全局开关</li>
</ul>
<h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2><p>Arthas 支持使用管道对上述命令的结果进行进一步的处理，如<code>sm java.lang.String * | grep &#39;index&#39;</code></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/grep.html">grep</a> - 搜索满足条件的结果</li>
<li>plaintext - 将命令的结果去除 ANSI 颜色</li>
<li>wc - 按行统计输出结果</li>
</ul>
<h2 id="后台异步任务"><a href="#后台异步任务" class="headerlink" title="后台异步任务"></a>后台异步任务</h2><p>当线上出现偶发的问题，比如需要 watch 某个条件，而这个条件一天可能才会出现一次时，异步后台任务就派上用场了，详情请参考<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/async.html">这里</a></p>
<ul>
<li>使用 <code>&gt;</code> 将结果重写向到日志文件，使用 <code>&amp;</code> 指定命令是后台运行，session 断开不影响任务执行（生命周期默认为 1 天）</li>
<li>jobs - 列出所有 job</li>
<li>kill - 强制终止任务</li>
<li>fg - 将暂停的任务拉到前台执行</li>
<li>bg - 将暂停的任务放到后台执行</li>
</ul>
<h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><ul>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/base64.html">base64</a> - base64 编码转换，和 linux 里的 base64 命令类似</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/cat.html">cat</a> - 打印文件内容，和 linux 里的 cat 命令类似</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/cls.html">cls</a> - 清空当前屏幕区域</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/echo.html">echo</a> - 打印参数，和 linux 里的 echo 命令类似</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/grep.html">grep</a> - 匹配查找，和 linux 里的 grep 命令类似</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/help.html">help</a> - 查看命令帮助信息</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/history.html">history</a> - 打印命令历史</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/keymap.html">keymap</a> - Arthas 快捷键列表及自定义快捷键</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/pwd.html">pwd</a> - 返回当前的工作目录，和 linux 命令类似</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/quit.html">quit</a> - 退出当前 Arthas 客户端，其他 Arthas 客户端不受影响</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/reset.html">reset</a> - 重置增强类，将被 Arthas 增强过的类全部还原，Arthas 服务端关闭时会重置所有增强过的类</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/session.html">session</a> - 查看当前会话的信息</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/stop.html">stop</a> - 关闭 Arthas 服务端，所有 Arthas 客户端全部退出</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/tee.html">tee</a> - 复制标准输入到标准输出和指定的文件，和 linux 里的 tee 命令类似</li>
<li><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/version.html">version</a> - 输出当前目标 Java 进程所加载的 Arthas 版本号</li>
</ul>
<hr>
<h1 id="Cat-命令"><a href="#Cat-命令" class="headerlink" title="Cat 命令"></a>Cat 命令</h1><div class="note info no-icon"><p>提示</p>
<p>打印文件内容，和 linux 里的 cat 命令类似。</p>
</div>

<p>使用参考：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat &#x2F;tmp&#x2F;a.txt</span><br></pre></td></tr></table></figure>

<h1 id="Classloader-命令"><a href="#Classloader-命令" class="headerlink" title="Classloader 命令"></a>Classloader 命令</h1><h2 id="列出所有-ClassLoader"><a href="#列出所有-ClassLoader" class="headerlink" title="列出所有 ClassLoader"></a>列出所有 ClassLoader</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classloader -l</span><br></pre></td></tr></table></figure>

<h2 id="统计-ClassLoader-实际使用-URL-和未使用的-URL"><a href="#统计-ClassLoader-实际使用-URL-和未使用的-URL" class="headerlink" title="统计 ClassLoader 实际使用 URL 和未使用的 URL"></a>统计 ClassLoader 实际使用 URL 和未使用的 URL</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classloader --url-stat</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：基于 JVM 目前已加载的所有类统计，不代表 Unused URLs 可以从应用中删掉。因为可能将来需要从 Unused URLs 里加载类，或者需要加载 resources</p>
</blockquote>
<h2 id="列出-ClassLoader-里加载的所有类"><a href="#列出-ClassLoader-里加载的所有类" class="headerlink" title="列出 ClassLoader 里加载的所有类"></a>列出 ClassLoader 里加载的所有类</h2><p>列出上面的<code>org.apache.jasper.servlet.JasperLoader</code> 加载的类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classloader -a --classLoaderClass org.apache.jasper.servlet.JasperLoader | grep hello</span><br></pre></td></tr></table></figure>

<h2 id="查看类的-classloader-层次"><a href="#查看类的-classloader-层次" class="headerlink" title="查看类的 classloader 层次"></a>查看类的 classloader 层次</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc -d org.apache.jsp.jsp.hello_jsp</span><br></pre></td></tr></table></figure>

<h2 id="查看-ClassLoader-树"><a href="#查看-ClassLoader-树" class="headerlink" title="查看 ClassLoader 树"></a>查看 ClassLoader 树</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classloader -t</span><br></pre></td></tr></table></figure>

<h2 id="查看-URLClassLoader-实际的-urls"><a href="#查看-URLClassLoader-实际的-urls" class="headerlink" title="查看 URLClassLoader 实际的 urls"></a>查看 URLClassLoader 实际的 urls</h2><p>比如上面查看到的 spring LaunchedURLClassLoader 为 <code>org.springframework.boot.loader.LaunchedURLClassLoader</code> ，可以通过 <code>-c &lt;hashcode&gt;</code> 参数来指定 classloader，还有一种方法可以通过使用 <code>--classLoaderClass</code> 指定类名，从而查看 URLClassLoader 实际的 urls：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classloader --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader</span><br></pre></td></tr></table></figure>

<h2 id="查找-ClassLoader-里的资源文件"><a href="#查找-ClassLoader-里的资源文件" class="headerlink" title="查找 ClassLoader 里的资源文件"></a>查找 ClassLoader 里的资源文件</h2><p>查找指定的资源文件： <code>classloader --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader -r logback-spring.xml</code></p>
<p>也可以尝试查找类的 class 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">classloader --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader -r java&#x2F;lang&#x2F;String.class</span><br></pre></td></tr></table></figure>

<h1 id="Cls-命令"><a href="#Cls-命令" class="headerlink" title="Cls 命令"></a>Cls 命令</h1><p>通过 <code>cls</code> 命令 可以清空当前屏幕区域。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cls</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Grep-命令"><a href="#Grep-命令" class="headerlink" title="Grep 命令"></a>Grep 命令</h1><div class="note info no-icon"><p>提示</p>
<p>类似传统的 grep 命令。</p>
</div>

<h2 id="使用参考"><a href="#使用参考" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">USAGE:</span><br><span class="line">  grep [-A &lt;value&gt;] [-B &lt;value&gt;] [-C &lt;value&gt;] [-h] [-i] [-v] [-n] [-m &lt;value&gt;] [-e] [--trim-end] pattern</span><br><span class="line"></span><br><span class="line">SUMMARY:</span><br><span class="line">  grep command for pipes.</span><br><span class="line"></span><br><span class="line">EXAMPLES:</span><br><span class="line"> sysprop | grep java</span><br><span class="line"> sysprop | grep java -n</span><br><span class="line"> sysenv | grep -v JAVA</span><br><span class="line"> sysenv | grep -e &quot;(?i)(JAVA|sun)&quot; -m 3  -C 2</span><br><span class="line"> sysenv | grep JAVA -A2 -B3</span><br><span class="line"> thread | grep -m 10 -e  &quot;TIMED_WAITING|WAITING&quot;</span><br><span class="line"></span><br><span class="line">WIKI:</span><br><span class="line">  https://arthas.aliyun.com/doc/grep</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">-A, --after-context &lt;value&gt;                                                    Print NUM lines of trailing context)</span><br><span class="line">-B, --before-context &lt;value&gt;                                                   Print NUM lines of leading context)</span><br><span class="line">-C, --context &lt;value&gt;                                                          Print NUM lines of output context)</span><br><span class="line">-h, --help                                                                     this help</span><br><span class="line">-i, --ignore-case                                                              Perform case insensitive matching.  By default, grep is case sensitive.</span><br><span class="line">-v, --invert-match                                                             Select non-matching lines</span><br><span class="line">-n, --line-number                                                              Print line number with output lines</span><br><span class="line">-m, --max-count &lt;value&gt;                                                        stop after NUM selected lines)</span><br><span class="line">-e, --regex                                                                    Enable regular expression to match</span><br><span class="line">    --trim-end                                                                 Remove whitespaces at the end of the line</span><br><span class="line">&lt;pattern&gt;                                                                      Pattern</span><br></pre></td></tr></table></figure>

<h3 id="匹配展示符合范本样式的项"><a href="#匹配展示符合范本样式的项" class="headerlink" title="匹配展示符合范本样式的项"></a>匹配展示符合范本样式的项</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[arthas@13372]$ sysprop | grep java</span><br><span class="line"> java.specification.version                        1.8</span><br><span class="line"> java.class.path                                   math-game.jar</span><br><span class="line"> java.vm.vendor                                    Oracle Corporation</span><br><span class="line"> java.vendor.url                                   http:&#x2F;&#x2F;java.oracle.com&#x2F;</span><br><span class="line"> java.vm.specification.version                     1.8</span><br><span class="line"> sun.java.launcher                                 SUN_STANDARD</span><br><span class="line"> sun.java.command                                  math-game.jar</span><br><span class="line"> java.specification.vendor                         Oracle Corporation</span><br><span class="line"> java.home                                         D:\developInstall\JDK\jdk1.8.0_161\jre</span><br><span class="line"> java.vm.specification.vendor                      Oracle Corporation</span><br><span class="line"> java.specification.name                           Java Platform API Specification</span><br><span class="line"> java.awt.graphicsenv                              sun.awt.Win32GraphicsEnvironment</span><br><span class="line"> java.runtime.version                              1.8.0_161-b12</span><br><span class="line"> java.endorsed.dirs                                D:\developInstall\JDK\jdk1.8.0_161\jre\lib\endorsed</span><br><span class="line"> java.runtime.name                                 Java(TM) SE Runtime Environment</span><br><span class="line"> java.vm.name                                      Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line"> java.vendor.url.bug                               http:&#x2F;&#x2F;bugreport.sun.com&#x2F;bugreport&#x2F;</span><br><span class="line"> java.io.tmpdir                                    C:\Users\PT-TIA~1\AppData\Local\Temp\</span><br><span class="line"> java.version                                      1.8.0_161</span><br><span class="line"> java.vm.specification.name                        Java Virtual Machine Specification</span><br><span class="line"> java.awt.printerjob                               sun.awt.windows.WPrinterJob</span><br><span class="line"> java.library.path                                 D:\developInstall\JDK\jdk1.8.0_161\bin;C:\Windows\Sun\Java\bin;C:\Windows\system32;C:\Windows;C:\Python27\;C:\Python27\Scripts;D:\app\pt-tianzhencai\product\11.1.0\db_1\bin;C:\Program Files (x86)\Comm</span><br><span class="line">                                                   on Files\Oracle\Java\javapath;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Program Files\TortoiseSVN\bin;C:\Progr</span><br><span class="line"> java.vm.info                                      mixed mode</span><br><span class="line"> java.vendor                                       Oracle Corporation</span><br><span class="line"> java.vm.version                                   25.161-b12</span><br><span class="line"> java.ext.dirs                                     D:\developInstall\JDK\jdk1.8.0_161\jre\lib\ext;C:\Windows\Sun\Java\lib\ext</span><br><span class="line"> java.class.version                                52.0</span><br></pre></td></tr></table></figure>

<h3 id="n-命令显示行号："><a href="#n-命令显示行号：" class="headerlink" title="-n 命令显示行号："></a><code>-n</code> 命令显示行号：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysprop | grep java -n</span><br></pre></td></tr></table></figure>

<h3 id="v-展示非匹配"><a href="#v-展示非匹配" class="headerlink" title="-v 展示非匹配"></a><code>-v</code> 展示非匹配</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysenv | grep -v JAVA</span><br></pre></td></tr></table></figure>

<h3 id="e-使用正则表达式匹配，-m-设定最大展示条数，"><a href="#e-使用正则表达式匹配，-m-设定最大展示条数，" class="headerlink" title="-e 使用正则表达式匹配，-m 设定最大展示条数，"></a><code>-e</code> 使用正则表达式匹配，<code>-m</code> 设定最大展示条数，</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sysenv | grep -e &quot;(?i)(JAVA|sun)&quot; -m 3 -C 2</span><br><span class="line">thread | grep -m 10 -e &quot;TIMED_WAITING|WAITING&quot;</span><br></pre></td></tr></table></figure>

<h3 id="除了显示符合范本样式的那一行之外，-A-指定显示该行之后的内容，-B-指定显示该行之前的内容。"><a href="#除了显示符合范本样式的那一行之外，-A-指定显示该行之后的内容，-B-指定显示该行之前的内容。" class="headerlink" title="除了显示符合范本样式的那一行之外，-A 指定显示该行之后的内容，-B 指定显示该行之前的内容。"></a>除了显示符合范本样式的那一行之外，<code>-A</code> 指定显示该行之后的内容，<code>-B</code> 指定显示该行之前的内容。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysenv | grep JAVA -A2 -B3</span><br></pre></td></tr></table></figure>

<h1 id="Dashboard-命令"><a href="#Dashboard-命令" class="headerlink" title="Dashboard 命令"></a>Dashboard 命令</h1><p>dashboard 命令可以查看当前系统的实时数据面板。</p>
<hr>
<h1 id="dump-命令"><a href="#dump-命令" class="headerlink" title="dump 命令"></a>dump 命令</h1><div class="note info no-icon"><p>提示</p>
<p>dump 已加载类的 bytecode 到特定目录</p>
</div>

<p>dump 命令将 JVM 中实际运行的 class 的 byte code dump 到指定目录，适用场景批量下载指定包目录的 class 字节码；如需反编译单一类、实时查看类信息，可参考 <a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/jad.html">jad</a>。</p>
<h2 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>class-pattern</em></td>
<td align="left">类名表达式匹配</td>
</tr>
<tr>
<td align="right"><code>[c:]</code></td>
<td align="left">类所属 ClassLoader 的 hashcode</td>
</tr>
<tr>
<td align="right"><code>[classLoaderClass:]</code></td>
<td align="left">指定执行表达式的 ClassLoader 的 class name</td>
</tr>
<tr>
<td align="right"><code>[d:]</code></td>
<td align="left">设置类文件的目标目录</td>
</tr>
<tr>
<td align="right">[E]</td>
<td align="left">开启正则表达式匹配，默认为通配符匹配</td>
</tr>
</tbody></table>
<h2 id="使用参考-1"><a href="#使用参考-1" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ dump java.lang.String</span><br><span class="line"> HASHCODE  CLASSLOADER  LOCATION</span><br><span class="line"> null                   /Users/admin/logs/arthas/classdump/java/lang/String.class</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 119 ms.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ dump demo.*</span><br><span class="line"> HASHCODE  CLASSLOADER                                    LOCATION</span><br><span class="line"> 3d4eac69  +-sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69    /Users/admin/logs/arthas/classdump/sun.misc.Launcher<span class="variable">$AppClassLoader</span>-3d4eac69/demo/MathGame.class</span><br><span class="line">             +-sun.misc.Launcher<span class="variable">$ExtClassLoader</span>@66350f69</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 39 ms.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ dump -d /tmp/output java.lang.String</span><br><span class="line"> HASHCODE  CLASSLOADER  LOCATION</span><br><span class="line"> null                   /tmp/output/java/lang/String.class</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 138 ms.</span><br></pre></td></tr></table></figure>

<ul>
<li>指定 classLoader</li>
</ul>
<p>注意 hashcode 是变化的，需要先查看当前的 ClassLoader 信息，提取对应 ClassLoader 的 hashcode。</p>
<p>如果你使用<code>-c</code>，你需要手动输入 hashcode：<code>-c &lt;hashcode&gt;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dump -c 3d4eac69 demo.*</span><br></pre></td></tr></table></figure>

<p>对于只有唯一实例的 ClassLoader 可以通过<code>--classLoaderClass</code>指定 class name，使用起来更加方便：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ dump --classLoaderClass sun.misc.Launcher<span class="variable">$AppClassLoader</span> demo.*</span><br><span class="line"> HASHCODE  CLASSLOADER                                    LOCATION</span><br><span class="line"> 3d4eac69  +-sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69    /Users/admin/logs/arthas/classdump/sun.misc.Launcher<span class="variable">$AppClassLoader</span>-3d4eac69/demo/MathGame.class</span><br><span class="line">             +-sun.misc.Launcher<span class="variable">$ExtClassLoader</span>@66350f69</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 39 ms.</span><br></pre></td></tr></table></figure>

<ul>
<li>注：这里 classLoaderClass 在 java 8 是 sun.misc.Launcher$AppClassLoader，而 java 11 的 classloader 是 jdk.internal.loader.ClassLoaders$AppClassLoader，killercoda 目前环境是 java11。</li>
</ul>
<p><code>--classLoaderClass</code> 的值是 ClassLoader 的类名，只有匹配到唯一的 ClassLoader 实例时才能工作，目的是方便输入通用命令，而<code>-c &lt;hashcode&gt;</code>是动态变化的。</p>
<hr>
<h1 id="echo-命令"><a href="#echo-命令" class="headerlink" title="echo 命令"></a>echo 命令</h1><div class="note info no-icon"><p>提示</p>
<p>打印参数，和 linux 里的 echo 命令类似。</p>
</div>

<h2 id="使用参考-2"><a href="#使用参考-2" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="Getstatic-命令"><a href="#Getstatic-命令" class="headerlink" title="Getstatic 命令"></a>Getstatic 命令</h1><ul>
<li>推荐直接使用<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/arthas-tutorials.html?language=cn&id=ognl">ognl</a>命令，更加灵活。</li>
</ul>
<p>通过 <code>getstatic</code> 命令可以方便的查看类的静态属性。使用方法为<code>getstatic class_name field_name</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ getstatic demo.MathGame random</span><br><span class="line">field: random</span><br><span class="line">@Random[</span><br><span class="line">    serialVersionUID=@Long[3905348978240129619],</span><br><span class="line">    seed=@AtomicLong[120955813885284],</span><br><span class="line">    multiplier=@Long[25214903917],</span><br><span class="line">    addend=@Long[11],</span><br><span class="line">    mask=@Long[281474976710655],</span><br><span class="line">    DOUBLE_UNIT=@Double[1.1102230246251565E-16],</span><br><span class="line">    BadBound=@String[bound must be positive],</span><br><span class="line">    BadRange=@String[bound must be greater than origin],</span><br><span class="line">    BadSize=@String[size must be non-negative],</span><br><span class="line">    seedUniquifier=@AtomicLong[-3282039941672302964],</span><br><span class="line">    nextNextGaussian=@Double[0.0],</span><br><span class="line">    haveNextNextGaussian=@Boolean[<span class="literal">false</span>],</span><br><span class="line">    serialPersistentFields=@ObjectStreamField[][isEmpty=<span class="literal">false</span>;size=3],</span><br><span class="line">    unsafe=@Unsafe[sun.misc.Unsafe@2eaa1027],</span><br><span class="line">    seedOffset=@Long[24],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>指定 classLoader</li>
</ul>
<p>注意 hashcode 是变化的，需要先查看当前的 ClassLoader 信息，使用<code>sc -d &lt;ClassName&gt;</code>提取对应 ClassLoader 的 hashcode。</p>
<p>如果你使用<code>-c</code>，你需要手动输入 hashcode：<code>-c &lt;hashcode&gt;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ getstatic -c 3d4eac69 demo.MathGame random</span><br></pre></td></tr></table></figure>

<p>对于只有唯一实例的 ClassLoader 可以通过<code>--classLoaderClass</code>指定 class name，使用起来更加方便：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getstatic --classLoaderClass sun.misc.Launcher$AppClassLoader demo.MathGame random</span><br></pre></td></tr></table></figure>

<ul>
<li>注: 这里 classLoaderClass 在 java 8 是 sun.misc.Launcher$AppClassLoader，而java 11的classloader是jdk.internal.loader.ClassLoaders$AppClassLoader，killercoda 目前环境是 java11。</li>
</ul>
<p><code>--classLoaderClass</code> 的值是 ClassLoader 的类名，只有匹配到唯一的 ClassLoader 实例时才能工作，目的是方便输入通用命令，而<code>-c &lt;hashcode&gt;</code>是动态变化的。</p>
<hr>
<h1 id="Help-命令"><a href="#Help-命令" class="headerlink" title="Help 命令"></a>Help 命令</h1><p>查看命令帮助信息，可以查看当前 arthas 版本支持的指令，或者查看具体指令的使用说明。</p>
<div class="note info no-icon"><p>提示</p>
<p>[help 指令]的等同于[指令 -help]，都是查看具体指令的使用说明。</p>
</div>

<h2 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right">不接参数</td>
<td align="left">查询当前 arthas 版本支持的指令以及指令描述</td>
</tr>
<tr>
<td align="right">[name:]</td>
<td align="left">查询具体指令的使用说明</td>
</tr>
</tbody></table>
<h2 id="使用参考-3"><a href="#使用参考-3" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ help dashboard</span><br><span class="line"> USAGE:</span><br><span class="line">  dashboard [-h] [-i &lt;value&gt;] [-n &lt;value&gt;]</span><br><span class="line"></span><br><span class="line">SUMMARY:</span><br><span class="line">  Overview of target jvm&#39;s thread, memory, gc, vm, tomcat info.</span><br><span class="line"></span><br><span class="line">EXAMPLES:</span><br><span class="line">  dashboard</span><br><span class="line">  dashboard -n 10</span><br><span class="line">  dashboard -i 2000</span><br><span class="line"></span><br><span class="line">WIKI:</span><br><span class="line">  https:&#x2F;&#x2F;arthas.aliyun.com&#x2F;doc&#x2F;dashboard</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">-h, --help                              this help</span><br><span class="line">-i, --interval &lt;value&gt;                  The interval (in ms) between two executions, default is 5000 ms.</span><br><span class="line">-n, --number-of-execution &lt;value&gt;       The number of times this command will be executed.</span><br></pre></td></tr></table></figure>

<h1 id="history-命令"><a href="#history-命令" class="headerlink" title="history 命令"></a>history 命令</h1><p>打印命令历史。</p>
<div class="note info no-icon"><p>提示</p>
<p>历史指令会通过一个名叫 history 的文件持久化，所以 history 指令可以查看当前 arthas 服务器的所有历史命令，而不仅只是当前次会话使用过的命令。</p>
</div>

<h2 id="参数说明-2"><a href="#参数说明-2" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right">[c:]</td>
<td align="left">清空历史指令</td>
</tr>
<tr>
<td align="right">[n:]</td>
<td align="left">显示最近执行的 n 条指令</td>
</tr>
</tbody></table>
<h2 id="使用参考-4"><a href="#使用参考-4" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查看最近执行的3条指令</span><br><span class="line">$ history 3</span><br><span class="line">  269  thread</span><br><span class="line">  270  cls</span><br><span class="line">  271  history 3</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#清空指令</span><br><span class="line">$ history -c</span><br><span class="line">$ history 3</span><br><span class="line"> 1  history 3</span><br></pre></td></tr></table></figure>

<h1 id="Jad-命令"><a href="#Jad-命令" class="headerlink" title="Jad 命令"></a>Jad 命令</h1><p><code>jad</code> 命令 将 JVM 中实际运行的 class 的 byte code 反编译成 java 代码，便于你理解业务逻辑；</p>
<ul>
<li>在 Arthas Console 上，反编译出来的源码是带语法高亮的，阅读更方便</li>
<li>当然，反编译出来的 java 代码可能会存在语法错误，但不影响你进行阅读理解</li>
</ul>
<h2 id="参数说明-3"><a href="#参数说明-3" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>class-pattern</em></td>
<td align="left">类名表达式匹配</td>
</tr>
<tr>
<td align="right"><code>[c:]</code></td>
<td align="left">类所属 ClassLoader 的 hashcode</td>
</tr>
<tr>
<td align="right"><code>[classLoaderClass:]</code></td>
<td align="left">指定执行表达式的 ClassLoader 的 class name</td>
</tr>
<tr>
<td align="right">[E]</td>
<td align="left">开启正则表达式匹配，默认为通配符匹配</td>
</tr>
</tbody></table>
<h2 id="使用参考-5"><a href="#使用参考-5" class="headerlink" title="使用参考"></a>使用参考</h2><h3 id="反编译java-lang-String"><a href="#反编译java-lang-String" class="headerlink" title="反编译java.lang.String"></a>反编译<code>java.lang.String</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ jad java.lang.String</span><br><span class="line"></span><br><span class="line">ClassLoader:</span><br><span class="line"></span><br><span class="line">Location:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * Decompiled with CFR.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> java.io.ObjectStreamField;</span><br><span class="line">        <span class="keyword">import</span> java.io.Serializable;</span><br><span class="line">...</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span></span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">Serializable</span>,</span></span><br><span class="line"><span class="class">        <span class="title">Comparable</span>&lt;<span class="title">String</span>&gt;,</span></span><br><span class="line"><span class="class">        <span class="title">CharSequence</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">char</span>[] value;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">int</span> hash;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">6849794470754667710L</span>;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ObjectStreamField[] serialPersistentFields = <span class="keyword">new</span> ObjectStreamField[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Comparator&lt;String&gt; CASE_INSENSITIVE_ORDER = <span class="keyword">new</span> CaseInsensitiveComparator();</span><br><span class="line">...</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">String</span><span class="params">(<span class="keyword">byte</span>[] byArray, <span class="keyword">int</span> n, <span class="keyword">int</span> n2, Charset charset)</span> </span>&#123;</span><br><span class="line"><span class="comment">/*460*/</span>         <span class="keyword">if</span> (charset == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;charset&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">/*462*/</span>         String.checkBounds(byArray, n, n2);</span><br><span class="line"><span class="comment">/*463*/</span>         <span class="keyword">this</span>.value = StringCoding.decode(charset, byArray, n, n2);</span><br><span class="line">            &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="反编译时只显示源代码"><a href="#反编译时只显示源代码" class="headerlink" title="反编译时只显示源代码"></a>反编译时只显示源代码</h3><p>默认情况下，反编译结果里会带有<code>ClassLoader</code>信息，通过<code>--source-only</code>选项，可以只打印源代码。方便和<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/mc.html">mc</a>/<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/retransform.html">retransform</a>命令结合使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ jad --source-only demo.MathGame</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Decompiled with CFR 0_132.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.PrintStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MathGame</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> illegalArgumentCount = <span class="number">0</span>;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="反编译指定的函数"><a href="#反编译指定的函数" class="headerlink" title="反编译指定的函数"></a>反编译指定的函数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ jad demo.MathGame main</span><br><span class="line"></span><br><span class="line">ClassLoader:</span><br><span class="line">+-sun.misc.Launcher$AppClassLoader@<span class="number">232204</span>a1</span><br><span class="line">  +-sun.misc.Launcher$ExtClassLoader@<span class="number">7f</span>31245a</span><br><span class="line"></span><br><span class="line">Location:</span><br><span class="line">/<span class="keyword">private</span>/tmp/math-game.jar</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">           MathGame game = <span class="keyword">new</span> MathGame();</span><br><span class="line">           <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"><span class="comment">/*16*/</span>         game.run();</span><br><span class="line"><span class="comment">/*17*/</span>         TimeUnit.SECONDS.sleep(<span class="number">1L</span>);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<h3 id="反编译时不显示行号"><a href="#反编译时不显示行号" class="headerlink" title="反编译时不显示行号"></a>反编译时不显示行号</h3><p><code>--lineNumber</code> 参数默认值为 true，显示指定为 false 则不打印行号。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ jad demo.MathGame main --lineNumber <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">ClassLoader:</span><br><span class="line">+-sun.misc.Launcher$AppClassLoader@<span class="number">232204</span>a1</span><br><span class="line">  +-sun.misc.Launcher$ExtClassLoader@<span class="number">7f</span>31245a</span><br><span class="line"></span><br><span class="line">Location:</span><br><span class="line">/<span class="keyword">private</span>/tmp/math-game.jar</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    MathGame game = <span class="keyword">new</span> MathGame();</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        game.run();</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1L</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反编译时指定-ClassLoader"><a href="#反编译时指定-ClassLoader" class="headerlink" title="反编译时指定 ClassLoader"></a>反编译时指定 ClassLoader</h3><div class="note info no-icon"><p>提示</p>
<p>当有多个 <code>ClassLoader</code> 都加载了这个类时，<code>jad</code> 命令会输出对应 <code>ClassLoader</code> 实例的 <code>hashcode</code>，然后你只需要重新执行 <code>jad</code> 命令，并使用参数 <code>-c &lt;hashcode&gt;</code> 就可以反编译指定 ClassLoader 加载的那个类了；</p>
</div>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ jad org.apache.log4j.Logger</span><br><span class="line"></span><br><span class="line">Found more than one class for: org.apache.log4j.Logger, Please use jad -c hashcode org.apache.log4j.Logger</span><br><span class="line">HASHCODE  CLASSLOADER</span><br><span class="line"><span class="number">69d</span>caba4  +-monitor<span class="string">&#x27;s ModuleClassLoader</span></span><br><span class="line"><span class="string">6e51ad67  +-java.net.URLClassLoader@6e51ad67</span></span><br><span class="line"><span class="string">            +-sun.misc.Launcher$AppClassLoader@6951a712</span></span><br><span class="line"><span class="string">            +-sun.misc.Launcher$ExtClassLoader@6fafc4c2</span></span><br><span class="line"><span class="string">2bdd9114  +-pandora-qos-service&#x27;</span>s ModuleClassLoader</span><br><span class="line"><span class="number">4</span>c0df5f8  +-pandora-framework<span class="string">&#x27;s ModuleClassLoader</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Affect(row-cnt:0) cost in 38 ms.</span></span><br><span class="line"><span class="string">$ jad org.apache.log4j.Logger -c 69dcaba4</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ClassLoader:</span></span><br><span class="line"><span class="string">+-monitor&#x27;</span>s ModuleClassLoader</span><br><span class="line"></span><br><span class="line">Location:</span><br><span class="line">/Users/admin/app/log4j-<span class="number">1.2</span>.<span class="number">14.</span>jar</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.apache.log4j;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.spi.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Logger</span> <span class="keyword">extends</span> <span class="title">Category</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String FQCN;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Logger</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">Affect(row-cnt:<span class="number">1</span>) cost in <span class="number">190</span> ms.</span><br></pre></td></tr></table></figure>

<p>对于只有唯一实例的 ClassLoader 还可以通过<code>--classLoaderClass</code>指定 class name，使用起来更加方便：</p>
<p><code>--classLoaderClass</code> 的值是 ClassLoader 的类名，只有匹配到唯一的 ClassLoader 实例时才能工作，目的是方便输入通用命令，而<code>-c &lt;hashcode&gt;</code>是动态变化的。</p>
<h1 id="jfr-命令"><a href="#jfr-命令" class="headerlink" title="jfr 命令"></a>jfr 命令</h1><div class="note info no-icon"><p>提示</p>
<p>Java Flight Recorder (JFR) 是一种用于收集有关正在运行的 Java 应用程序的诊断和分析数据的工具。它集成到 Java 虚拟机 (JVM) 中，几乎不会造成性能开销，因此即使在负载较重的生产环境中也可以使用。</p>
</div>

<p><code>jfr</code> 命令支持在程序动态运行过程中开启和关闭 JFR 记录。 记录收集有关 event 的数据。事件在特定时间点发生在 JVM 或 Java 应用程序中。每个事件都有一个名称、一个时间戳和一个可选的有效负载。负载是与事件相关的数据，例如 CPU 使用率、事件前后的 Java 堆大小、锁持有者的线程 ID 等。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jfr 命令基本运行结构是 jfr cmd [actionArg]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意： JDK8 的 8u262 版本之后才支持 jfr</p>
</blockquote>
<h2 id="参数说明-4"><a href="#参数说明-4" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>cmd</em></td>
<td align="left">要执行的操作 支持的命令【start，status，dump，stop】</td>
</tr>
<tr>
<td align="right"><em>actionArg</em></td>
<td align="left">属性名模式</td>
</tr>
<tr>
<td align="right">[n:]</td>
<td align="left">记录名称</td>
</tr>
<tr>
<td align="right">[r:]</td>
<td align="left">记录 id 值</td>
</tr>
<tr>
<td align="right">[dumponexit:]</td>
<td align="left">程序退出时，是否要 dump 出 .jfr 文件，默认为 false</td>
</tr>
<tr>
<td align="right">[d:]</td>
<td align="left">延迟多久后启动 JFR 记录，支持带单位配置，eg: 60s, 2m, 5h, 3d. 不带单位就是秒，默认无延迟</td>
</tr>
<tr>
<td align="right">[duration:]</td>
<td align="left">JFR 记录持续时间，支持单位配置，不带单位就是秒，默认一直记录</td>
</tr>
<tr>
<td align="right">[s:]</td>
<td align="left">采集 Event 的详细配置文件，默认是 default.jfc 位于 <code>$JAVA_HOME/lib/jfr/default.jfc</code></td>
</tr>
<tr>
<td align="right">[f:]</td>
<td align="left">将输出转储到指定路径</td>
</tr>
<tr>
<td align="right">[maxage:]</td>
<td align="left">缓冲区数据最大文件记录保存时间，支持单位配置，不带单位就是秒，默认是不限制</td>
</tr>
<tr>
<td align="right">[maxsize:]</td>
<td align="left">缓冲区的最大文件大小，支持单位配置， 不带单位是字节，m 或者 M 代表 MB，g 或者 G 代表 GB。</td>
</tr>
<tr>
<td align="right">[state:]</td>
<td align="left">jfr 记录状态</td>
</tr>
</tbody></table>
<h2 id="启动-JFR-记录"><a href="#启动-JFR-记录" class="headerlink" title="启动 JFR 记录"></a>启动 JFR 记录</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ jfr start</span><br><span class="line">Started recording 1. No limit specified, using maxsize=250MB as default.</span><br></pre></td></tr></table></figure>

<div class="note info no-icon"><p>提示</p>
<p>默认情况下，开启的是默认参数的 jfr 记录</p>
</div>

<p>启动 jfr 记录，指定记录名，记录持续时间，记录文件保存路径。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jfr start -n myRecording --duration 60s -f /tmp/myRecording.jfr</span><br><span class="line">Started recording 2. The result will be written to:</span><br><span class="line">/tmp/myRecording.jfr</span><br></pre></td></tr></table></figure>

<h2 id="查看-JFR-记录状态"><a href="#查看-JFR-记录状态" class="headerlink" title="查看 JFR 记录状态"></a>查看 JFR 记录状态</h2><p>默认是查看所有 JFR 记录信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jfr status</span><br><span class="line">Recording: recording=1 name=Recording-1 (running)</span><br><span class="line">Recording: recording=2 name=myRecording duration=PT1M (closed)</span><br></pre></td></tr></table></figure>

<p>查看指定记录 id 的记录信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ jfr status -r 1</span><br><span class="line">Recording: recording=1 name=Recording-1 (running)</span><br></pre></td></tr></table></figure>

<p>查看指定状态的记录信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ jfr status --state closed</span><br><span class="line">Recording: recording=2 name=myRecording duration=PT1M (closed)</span><br></pre></td></tr></table></figure>

<h2 id="dump-jfr-记录"><a href="#dump-jfr-记录" class="headerlink" title="dump jfr 记录"></a>dump jfr 记录</h2><p><code>jfr dump</code> 会输出从开始到运行该命令这段时间内的记录到 JFR 文件，且不会停止 <code>jfr</code> 的记录<br>指定记录输出路径</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jfr dump -r 1 -f /tmp/myRecording1.jfr</span><br><span class="line">Dump recording 1, The result will be written to:</span><br><span class="line">/tmp/myRecording1.jfr</span><br></pre></td></tr></table></figure>

<p>不指定文件输出路径，默认是保存到<code>arthas-output</code>目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jfr dump -r 1</span><br><span class="line">Dump recording 1, The result will be written to:</span><br><span class="line">/tmp/<span class="built_in">test</span>/arthas-output/20220819-200915.jfr</span><br></pre></td></tr></table></figure>

<h2 id="停止-jfr-记录"><a href="#停止-jfr-记录" class="headerlink" title="停止 jfr 记录"></a>停止 jfr 记录</h2><p>不指定记录输出路径，默认是保存到<code>arthas-output</code>目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ jfr stop -r 1</span><br><span class="line">Stop recording 1, The result will be written to:</span><br><span class="line">/tmp/<span class="built_in">test</span>/arthas-output/20220819-202049.jfr</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意一条记录只能停止一次。</p>
</blockquote>
<p>也可以指定记录输出路径。</p>
<h2 id="通过浏览器查看-arthas-output-下面-JFR-记录的结果"><a href="#通过浏览器查看-arthas-output-下面-JFR-记录的结果" class="headerlink" title="通过浏览器查看 arthas-output 下面 JFR 记录的结果"></a>通过浏览器查看 arthas-output 下面 JFR 记录的结果</h2><p>默认情况下，arthas 使用 8563 端口，则可以打开： <a target="_blank" rel="noopener" href="http://localhost:8563/arthas-output/%E5%9C%A8%E6%96%B0%E7%AA%97%E5%8F%A3%E6%89%93%E5%BC%80">http://localhost:8563/arthas-output/在新窗口打开</a>  查看到<code>arthas-output</code>目录下面的 JFR 记录结果：</p>
<p><img src="https://arthas.aliyun.com/images/arthas-output-recording.png" alt="img"></p>
<p>生成的结果可以用支持 jfr 格式的工具来查看。比如：</p>
<ul>
<li>JDK Mission Control ： <a target="_blank" rel="noopener" href="https://github.com/openjdk/jmc">https://github.com/openjdk/jmc</a></li>
</ul>
<hr>
<h1 id="Jvm-命令"><a href="#Jvm-命令" class="headerlink" title="Jvm 命令"></a>Jvm 命令</h1><div class="note info no-icon"><p>提示</p>
<p>查看当前 JVM 信息</p>
</div>

<h2 id="使用参考-6"><a href="#使用参考-6" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">$ jvm</span><br><span class="line">RUNTIME</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MACHINE-NAME                   37@ff267334bb65</span><br><span class="line"> JVM-START-TIME                 2020-07-23 07:50:36</span><br><span class="line"> MANAGEMENT-SPEC-VERSION        1.2</span><br><span class="line"> SPEC-NAME                      Java Virtual Machine Specification</span><br><span class="line"> SPEC-VENDOR                    Oracle Corporation</span><br><span class="line"> SPEC-VERSION                   1.8</span><br><span class="line"> VM-NAME                        Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line"> VM-VENDOR                      Oracle Corporation</span><br><span class="line"> VM-VERSION                     25.201-b09</span><br><span class="line"> INPUT-ARGUMENTS                []</span><br><span class="line"> CLASS-PATH                     demo-arthas-spring-boot.jar</span><br><span class="line"> BOOT-CLASS-PATH                /usr/lib/jvm/java-8-oracle/jre/lib/resources.jar:/usr/lib/jvm/java-8-oracle/j</span><br><span class="line">                                re/lib/rt.jar:/usr/lib/jvm/java-8-oracle/jre/lib/sunrsasign.jar:/usr/lib/jvm/</span><br><span class="line">                                java-8-oracle/jre/lib/jsse.jar:/usr/lib/jvm/java-8-oracle/jre/lib/jce.jar:/us</span><br><span class="line">                                r/lib/jvm/java-8-oracle/jre/lib/charsets.jar:/usr/lib/jvm/java-8-oracle/jre/l</span><br><span class="line">                                ib/jfr.jar:/usr/lib/jvm/java-8-oracle/jre/classes</span><br><span class="line"> LIBRARY-PATH                   /usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CLASS-LOADING</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> LOADED-CLASS-COUNT             7529</span><br><span class="line"> TOTAL-LOADED-CLASS-COUNT       7529</span><br><span class="line"> UNLOADED-CLASS-COUNT           0</span><br><span class="line"> IS-VERBOSE                     false</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> COMPILATION</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> NAME                           HotSpot 64-Bit Tiered Compilers</span><br><span class="line"> TOTAL-COMPILE-TIME             14921(ms)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> GARBAGE-COLLECTORS</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> PS Scavenge                            name : PS Scavenge</span><br><span class="line"> [count/time (ms)]                      collectionCount : 7</span><br><span class="line">                                        collectionTime : 68</span><br><span class="line"></span><br><span class="line"> PS MarkSweep                           name : PS MarkSweep</span><br><span class="line"> [count/time (ms)]                      collectionCount : 1</span><br><span class="line">                                        collectionTime : 47</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MEMORY-MANAGERS</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> CodeCacheManager               Code Cache</span><br><span class="line"></span><br><span class="line"> Metaspace Manager              Metaspace</span><br><span class="line">                                Compressed Class Space</span><br><span class="line"></span><br><span class="line"> Copy                           Eden Space</span><br><span class="line">                                Survivor Space</span><br><span class="line"></span><br><span class="line"> MarkSweepCompact               Eden Space</span><br><span class="line">                                Survivor Space</span><br><span class="line">                                Tenured Gen</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MEMORY</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> HEAP-MEMORY-USAGE                      init : 268435456(256.0 MiB)</span><br><span class="line"> [memory in bytes]                      used : 18039504(17.2 MiB)</span><br><span class="line">                                        committed : 181403648(173.0 MiB)</span><br><span class="line">                                        max : 3817865216(3.6 GiB)</span><br><span class="line"></span><br><span class="line"> NO-HEAP-MEMORY-USAGE                   init : 2555904(2.4 MiB)</span><br><span class="line"> [memory in bytes]                      used : 33926216(32.4 MiB)</span><br><span class="line">                                        committed : 35176448(33.5 MiB)</span><br><span class="line">                                        max : -1(-1 B)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> OPERATING-SYSTEM</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> OS                             Linux</span><br><span class="line"> ARCH                           amd64</span><br><span class="line"> PROCESSORS-COUNT               3</span><br><span class="line"> LOAD-AVERAGE                   29.53</span><br><span class="line"> VERSION                        4.15.0-52-generic</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> THREAD</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> COUNT                          30</span><br><span class="line"> DAEMON-COUNT                   24</span><br><span class="line"> PEAK-COUNT                     31</span><br><span class="line"> STARTED-COUNT                  36</span><br><span class="line"> DEADLOCK-COUNT                 0</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> FILE-DESCRIPTOR</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br><span class="line"> MAX-FILE-DESCRIPTOR-COUNT      1048576</span><br><span class="line"> OPEN-FILE-DESCRIPTOR-COUNT     100</span><br><span class="line">Affect(row-cnt:0) cost in 88 ms.</span><br></pre></td></tr></table></figure>

<h2 id="THREAD-相关"><a href="#THREAD-相关" class="headerlink" title="THREAD 相关"></a>THREAD 相关</h2><ul>
<li>COUNT: JVM 当前活跃的线程数</li>
<li>DAEMON-COUNT: JVM 当前活跃的守护线程数</li>
<li>PEAK-COUNT: 从 JVM 启动开始曾经活着的最大线程数</li>
<li>STARTED-COUNT: 从 JVM 启动开始总共启动过的线程次数</li>
<li>DEADLOCK-COUNT: JVM 当前死锁的线程数</li>
</ul>
<h2 id="文件描述符相关"><a href="#文件描述符相关" class="headerlink" title="文件描述符相关"></a>文件描述符相关</h2><ul>
<li>MAX-FILE-DESCRIPTOR-COUNT：JVM 进程最大可以打开的文件描述符数</li>
<li>OPEN-FILE-DESCRIPTOR-COUNT：JVM 当前打开的文件描述符数</li>
</ul>
<hr>
<h1 id="Keymap-命令"><a href="#Keymap-命令" class="headerlink" title="Keymap 命令"></a>Keymap 命令</h1><p><code>keymap</code>命令输出当前的快捷键映射表：</p>
<p>默认的快捷键如下：</p>
<table>
<thead>
<tr>
<th>快捷键</th>
<th>快捷键说明</th>
<th>命令名称</th>
<th>命令说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>&quot;\C-a&quot;</code></td>
<td>ctrl + a</td>
<td>beginning-of-line</td>
<td>跳到行首</td>
</tr>
<tr>
<td><code>&quot;\C-e&quot;</code></td>
<td>ctrl + e</td>
<td>end-of-line</td>
<td>跳到行尾</td>
</tr>
<tr>
<td><code>&quot;\C-f&quot;</code></td>
<td>ctrl + f</td>
<td>forward-word</td>
<td>向前移动一个单词</td>
</tr>
<tr>
<td><code>&quot;\C-b&quot;</code></td>
<td>ctrl + b</td>
<td>backward-word</td>
<td>向后移动一个单词</td>
</tr>
<tr>
<td><code>&quot;\e[D&quot;</code></td>
<td>键盘左方向键</td>
<td>backward-char</td>
<td>光标向前移动一个字符</td>
</tr>
<tr>
<td><code>&quot;\e[C&quot;</code></td>
<td>键盘右方向键</td>
<td>forward-char</td>
<td>光标向后移动一个字符</td>
</tr>
<tr>
<td><code>&quot;\e[B&quot;</code></td>
<td>键盘下方向键</td>
<td>next-history</td>
<td>下翻显示下一个命令</td>
</tr>
<tr>
<td><code>&quot;\e[A&quot;</code></td>
<td>键盘上方向键</td>
<td>previous-history</td>
<td>上翻显示上一个命令</td>
</tr>
<tr>
<td><code>&quot;\C-h&quot;</code></td>
<td>ctrl + h</td>
<td>backward-delete-char</td>
<td>向后删除一个字符</td>
</tr>
<tr>
<td><code>&quot;\C-?&quot;</code></td>
<td>ctrl + shift + /</td>
<td>backward-delete-char</td>
<td>向后删除一个字符</td>
</tr>
<tr>
<td><code>&quot;\C-u&quot;</code></td>
<td>ctrl + u</td>
<td>undo</td>
<td>撤销上一个命令，相当于清空当前行</td>
</tr>
<tr>
<td><code>&quot;\C-d&quot;</code></td>
<td>ctrl + d</td>
<td>delete-char</td>
<td>删除当前光标所在字符</td>
</tr>
<tr>
<td><code>&quot;\C-k&quot;</code></td>
<td>ctrl + k</td>
<td>kill-line</td>
<td>删除当前光标到行尾的所有字符</td>
</tr>
<tr>
<td><code>&quot;\C-i&quot;</code></td>
<td>ctrl + i</td>
<td>complete</td>
<td>自动补全，相当于敲<code>TAB</code></td>
</tr>
<tr>
<td><code>&quot;\C-j&quot;</code></td>
<td>ctrl + j</td>
<td>accept-line</td>
<td>结束当前行，相当于敲回车</td>
</tr>
<tr>
<td><code>&quot;\C-m&quot;</code></td>
<td>ctrl + m</td>
<td>accept-line</td>
<td>结束当前行，相当于敲回车</td>
</tr>
<tr>
<td><code>&quot;\C-w&quot;</code></td>
<td></td>
<td>backward-delete-word</td>
<td></td>
</tr>
<tr>
<td><code>&quot;\C-x\e[3~&quot;</code></td>
<td></td>
<td>backward-kill-line</td>
<td></td>
</tr>
<tr>
<td><code>&quot;\e\C-?&quot;</code></td>
<td></td>
<td>backward-kill-word</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>任何时候 <code>tab</code> 键，会根据当前的输入给出提示</li>
<li>命令后敲 <code>-</code> 或 <code>--</code> ，然后按 <code>tab</code> 键，可以展示出此命令具体的选项</li>
</ul>
<h2 id="自定义快捷键"><a href="#自定义快捷键" class="headerlink" title="自定义快捷键"></a>自定义快捷键</h2><p>在当前用户目录下新建<code>$USER_HOME/.arthas/conf/inputrc</code>文件，加入自定义配置。</p>
<p>假设我是 vim 的重度用户，我要把<code>ctrl+h</code>设置为光标向前一个字符，则设置如下，首先拷贝默认配置</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&quot;\C-a&quot;: beginning-of-line</span><br><span class="line">&quot;\C-e&quot;: end-of-line</span><br><span class="line">&quot;\C-f&quot;: forward-word</span><br><span class="line">&quot;\C-b&quot;: backward-word</span><br><span class="line">&quot;\e[D&quot;: backward-char</span><br><span class="line">&quot;\e[C&quot;: forward-char</span><br><span class="line">&quot;\e[B&quot;: next-history</span><br><span class="line">&quot;\e[A&quot;: previous-history</span><br><span class="line">&quot;\C-h&quot;: backward-delete-char</span><br><span class="line">&quot;\C-?&quot;: backward-delete-char</span><br><span class="line">&quot;\C-u&quot;: undo</span><br><span class="line">&quot;\C-d&quot;: delete-char</span><br><span class="line">&quot;\C-k&quot;: kill-line</span><br><span class="line">&quot;\C-i&quot;: complete</span><br><span class="line">&quot;\C-j&quot;: accept-line</span><br><span class="line">&quot;\C-m&quot;: accept-line</span><br><span class="line">&quot;\C-w&quot;: backward-delete-word</span><br><span class="line">&quot;\C-x\e[3~&quot;: backward-kill-line</span><br><span class="line">&quot;\e\C-?&quot;: backward-kill-word</span><br></pre></td></tr></table></figure>

<p>然后把<code>&quot;\C-h&quot;: backward-delete-char</code>换成<code>&quot;\C-h&quot;: backward-char</code>，然后重新连接即可。</p>
<h2 id="后台异步命令相关快捷键"><a href="#后台异步命令相关快捷键" class="headerlink" title="后台异步命令相关快捷键"></a>后台异步命令相关快捷键</h2><ul>
<li>ctrl + c: 终止当前命令</li>
<li>ctrl + z: 挂起当前命令，后续可以 bg/fg 重新支持此命令，或 kill 掉</li>
<li>ctrl + a: 回到行首</li>
<li>ctrl + e: 回到行尾</li>
</ul>
<h1 id="Logger-命令"><a href="#Logger-命令" class="headerlink" title="Logger 命令"></a>Logger 命令</h1><div class="note info no-icon"><p>提示</p>
<p>查看 logger 信息，更新 logger level</p>
</div>

<h2 id="使用参考-7"><a href="#使用参考-7" class="headerlink" title="使用参考"></a>使用参考</h2><h3 id="查看所有-logger-信息"><a href="#查看所有-logger-信息" class="headerlink" title="查看所有 logger 信息"></a>查看所有 logger 信息</h3><p>以下面的<code>logback.xml</code>为例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;APPLICATION&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>app.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>mylog-%d&#123;yyyy-MM-dd&#125;.%i.txt<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>60<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">totalSizeCap</span>&gt;</span>2GB<span class="tag">&lt;/<span class="name">totalSizeCap</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%logger&#123;35&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ASYNC&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.AsyncAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;APPLICATION&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%-4relative [%thread] %-5level %logger&#123;35&#125; - %msg %n</span><br><span class="line">            <span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>utf8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ASYNC&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用<code>logger</code>命令打印的结果是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[arthas@2062]$ logger</span><br><span class="line"> name                                   ROOT</span><br><span class="line"> class                                  ch.qos.logback.classic.Logger</span><br><span class="line"> classLoader                            sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line"> classLoaderHash                        2a139a55</span><br><span class="line"> level                                  INFO</span><br><span class="line"> effectiveLevel                         INFO</span><br><span class="line"> additivity                             <span class="literal">true</span></span><br><span class="line"> codeSource                             file:/Users/hengyunabc/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar</span><br><span class="line"> appenders                              name            CONSOLE</span><br><span class="line">                                        class           ch.qos.logback.core.ConsoleAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        target          System.out</span><br><span class="line">                                        name            APPLICATION</span><br><span class="line">                                        class           ch.qos.logback.core.rolling.RollingFileAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        file            app.log</span><br><span class="line">                                        name            ASYNC</span><br><span class="line">                                        class           ch.qos.logback.classic.AsyncAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        appenderRef     [APPLICATION]</span><br></pre></td></tr></table></figure>

<p>从<code>appenders</code>的信息里，可以看到</p>
<ul>
<li><code>CONSOLE</code> logger 的 target 是<code>System.out</code></li>
<li><code>APPLICATION</code> logger 是<code>RollingFileAppender</code>，它的 file 是<code>app.log</code></li>
<li><code>ASYNC</code>它的<code>appenderRef</code>是<code>APPLICATION</code>，即异步输出到文件里</li>
</ul>
<h3 id="查看指定名字的-logger-信息"><a href="#查看指定名字的-logger-信息" class="headerlink" title="查看指定名字的 logger 信息"></a>查看指定名字的 logger 信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[arthas@2062]$ logger -n org.springframework.web</span><br><span class="line"> name                                   org.springframework.web</span><br><span class="line"> class                                  ch.qos.logback.classic.Logger</span><br><span class="line"> classLoader                            sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line"> classLoaderHash                        2a139a55</span><br><span class="line"> level                                  null</span><br><span class="line"> effectiveLevel                         INFO</span><br><span class="line"> additivity                             <span class="literal">true</span></span><br><span class="line"> codeSource                             file:/Users/hengyunabc/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar</span><br></pre></td></tr></table></figure>

<h3 id="查看指定-classloader-的-logger-信息"><a href="#查看指定-classloader-的-logger-信息" class="headerlink" title="查看指定 classloader 的 logger 信息"></a>查看指定 classloader 的 logger 信息</h3><p>注意 hashcode 是变化的，需要先查看当前的 ClassLoader 信息，提取对应 ClassLoader 的 hashcode。</p>
<p>如果你使用<code>-c</code>，你需要手动输入 hashcode：<code>-c &lt;hashcode&gt;</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[arthas@2062]$ logger -c 2a139a55</span><br><span class="line"> name                                   ROOT</span><br><span class="line"> class                                  ch.qos.logback.classic.Logger</span><br><span class="line"> classLoader                            sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line"> classLoaderHash                        2a139a55</span><br><span class="line"> level                                  DEBUG</span><br><span class="line"> effectiveLevel                         DEBUG</span><br><span class="line"> additivity                             <span class="literal">true</span></span><br><span class="line"> codeSource                             file:/Users/hengyunabc/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar</span><br><span class="line"> appenders                              name            CONSOLE</span><br><span class="line">                                        class           ch.qos.logback.core.ConsoleAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        target          System.out</span><br><span class="line">                                        name            APPLICATION</span><br><span class="line">                                        class           ch.qos.logback.core.rolling.RollingFileAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        file            app.log</span><br><span class="line">                                        name            ASYNC</span><br><span class="line">                                        class           ch.qos.logback.classic.AsyncAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        appenderRef     [APPLICATION]</span><br></pre></td></tr></table></figure>

<p>对于只有唯一实例的 ClassLoader 可以通过<code>--classLoaderClass</code>指定 class name，使用起来更加方便：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger --classLoaderClass sun.misc.Launcher$AppClassLoader</span><br></pre></td></tr></table></figure>

<ul>
<li>注: 这里 classLoaderClass 在 java 8 是 sun.misc.Launcher$AppClassLoader，而java 11的classloader是jdk.internal.loader.ClassLoaders$AppClassLoader。</li>
</ul>
<p><code>--classLoaderClass</code> 的值是 ClassLoader 的类名，只有匹配到唯一的 ClassLoader 实例时才能工作，目的是方便输入通用命令，而<code>-c &lt;hashcode&gt;</code>是动态变化的。</p>
<h3 id="更新-logger-level"><a href="#更新-logger-level" class="headerlink" title="更新 logger level"></a>更新 logger level</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[arthas@2062]$ logger --name ROOT --level debug</span><br><span class="line">update logger level success.</span><br></pre></td></tr></table></figure>

<h3 id="指定-classloader-更新-logger-level"><a href="#指定-classloader-更新-logger-level" class="headerlink" title="指定 classloader 更新 logger level"></a>指定 classloader 更新 logger level</h3><p>默认情况下，logger 命令会在 SystemClassloader 下执行，如果应用是传统的<code>war</code>应用，或者 spring boot fat jar 启动的应用，那么需要指定 classloader。</p>
<p>可以先用 <code>sc -d yourClassName</code> 来查看具体的 classloader hashcode，然后在更新 level 时指定 classloader：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[arthas@2062]$ logger -c 2a139a55 --name ROOT --level debug</span><br></pre></td></tr></table></figure>

<h3 id="查看没有-appender-的-logger-的信息"><a href="#查看没有-appender-的-logger-的信息" class="headerlink" title="查看没有 appender 的 logger 的信息"></a>查看没有 appender 的 logger 的信息</h3><p>默认情况下，<code>logger</code>命令只打印有 appender 的 logger 的信息。如果想查看没有<code>appender</code>的 logger 的信息，可以加上参数<code>--include-no-appender</code>。</p>
<p>注意，通常输出结果会很长。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[arthas@2062]$ logger --include-no-appender</span><br><span class="line"> name                                   ROOT</span><br><span class="line"> class                                  ch.qos.logback.classic.Logger</span><br><span class="line"> classLoader                            sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line"> classLoaderHash                        2a139a55</span><br><span class="line"> level                                  DEBUG</span><br><span class="line"> effectiveLevel                         DEBUG</span><br><span class="line"> additivity                             <span class="literal">true</span></span><br><span class="line"> codeSource                             file:/Users/hengyunabc/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar</span><br><span class="line"> appenders                              name            CONSOLE</span><br><span class="line">                                        class           ch.qos.logback.core.ConsoleAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        target          System.out</span><br><span class="line">                                        name            APPLICATION</span><br><span class="line">                                        class           ch.qos.logback.core.rolling.RollingFileAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        file            app.log</span><br><span class="line">                                        name            ASYNC</span><br><span class="line">                                        class           ch.qos.logback.classic.AsyncAppender</span><br><span class="line">                                        classLoader     sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line">                                        classLoaderHash 2a139a55</span><br><span class="line">                                        appenderRef     [APPLICATION]</span><br><span class="line"></span><br><span class="line"> name                                   com</span><br><span class="line"> class                                  ch.qos.logback.classic.Logger</span><br><span class="line"> classLoader                            sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line"> classLoaderHash                        2a139a55</span><br><span class="line"> level                                  null</span><br><span class="line"> effectiveLevel                         DEBUG</span><br><span class="line"> additivity                             <span class="literal">true</span></span><br><span class="line"> codeSource                             file:/Users/hengyunabc/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar</span><br><span class="line"></span><br><span class="line"> name                                   com.alibaba</span><br><span class="line"> class                                  ch.qos.logback.classic.Logger</span><br><span class="line"> classLoader                            sun.misc.Launcher<span class="variable">$AppClassLoader</span>@2a139a55</span><br><span class="line"> classLoaderHash                        2a139a55</span><br><span class="line"> level                                  null</span><br><span class="line"> effectiveLevel                         DEBUG</span><br><span class="line"> additivity                             <span class="literal">true</span></span><br><span class="line"> codeSource                             file:/Users/hengyunabc/.m2/repository/ch/qos/logback/logback-classic/1.2.3/logback-classic-1.2.3.jar</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Mbean-命令"><a href="#Mbean-命令" class="headerlink" title="Mbean 命令"></a>Mbean 命令</h1><div class="note info no-icon"><p>提示</p>
<p>查看 Mbean 的信息</p>
</div>

<p>这个命令可以便捷的查看或监控 Mbean 的属性信息。</p>
<h2 id="参数说明-5"><a href="#参数说明-5" class="headerlink" title="参数说明"></a>参数说明</h2><hr>
<h1 id="mc-redefine-命令"><a href="#mc-redefine-命令" class="headerlink" title="mc-redefine 命令"></a>mc-redefine 命令</h1><h2 id="mc"><a href="#mc" class="headerlink" title="mc"></a>mc</h2><blockquote>
<p>Memory Compiler/内存编译器，编译<code>.java</code> 文件生成<code>.class</code> 。</p>
</blockquote>
<h2 id="使用参考-8"><a href="#使用参考-8" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc /tmp/Test.java</span><br></pre></td></tr></table></figure>

<p>可以通过<code>-c</code>参数指定 classloader：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc -c 327a647b /tmp/Test.java</span><br></pre></td></tr></table></figure>

<p>也可以通过<code>--classLoaderClass</code>参数指定 ClassLoader：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mc --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader /tmp/UserController.java -d /tmp</span><br><span class="line">Memory compiler output:</span><br><span class="line">/tmp/com/example/demo/arthas/user/UserController.class</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 346 ms</span><br></pre></td></tr></table></figure>

<p>可以通过<code>-d</code>命令指定输出目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc -d /tmp/output /tmp/ClassA.java /tmp/ClassB.java</span><br></pre></td></tr></table></figure>

<p>编译生成<code>.class</code>文件之后，可以结合<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/retransform.html">retransform</a>命令实现热更新代码。</p>
<details class="note "><summary><p>warn no-icon</p>
</summary>
<p>注意</p>
<p>注意，mc 命令有可能失败。如果编译失败可以在本地编译好 .class 文件，再上传到服务器。具体参考<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/retransform.html">retransform</a>命令说明。</p>

</details>

<h2 id="redefine"><a href="#redefine" class="headerlink" title="redefine"></a>redefine</h2><div class="note info no-icon"><p>提示</p>
<p>推荐使用 retransform 命令</p>
</div>

<ul>
<li>redefine 的 class 不能修改、添加、删除类的 field 和 method，包括方法参数、方法名称及返回值</li>
<li>如果 mc 失败，可以在本地开发环境编译好 class 文件，上传到目标系统，使用 redefine 热加载 class</li>
<li>目前 redefine 和 watch/trace/jad/tt 等命令冲突，以后重新实现 redefine 功能会解决此问题</li>
</ul>
<details class="note "><summary><p>warn no-icon</p>
</summary>
<p>注意</p>
<p>注意， redefine 后的原来的类不能恢复，redefine 有可能失败（比如增加了新的 field），参考 jdk 本身的文档。</p>

</details>

<div class="note info no-icon"><p>提示</p>
<p><code>reset</code>命令对<code>redefine</code>的类无效。如果想重置，需要<code>redefine</code>原始的字节码。</p>
</div>

<div class="note info no-icon"><p>提示</p>
<p><code>redefine</code>命令和<code>jad</code>/<code>watch</code>/<code>trace</code>/<code>monitor</code>/<code>tt</code>等命令会冲突。执行完<code>redefine</code>之后，如果再执行上面提到的命令，则会把<code>redefine</code>的字节码重置。 原因是 jdk 本身 redefine 和 Retransform 是不同的机制，同时使用两种机制来更新字节码，只有最后修改的会生效。</p>
</div>

<hr>
<h1 id="retransform-命令"><a href="#retransform-命令" class="headerlink" title="retransform 命令"></a>retransform 命令</h1><div class="note info no-icon"><p>提示</p>
<p>加载外部的 .class 文件，retransform jvm 已加载的类。</p>
</div>

<h2 id="使用参考-9"><a href="#使用参考-9" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">retransform /tmp/Test.class</span><br><span class="line">retransform -l</span><br><span class="line">retransform -d 1                    <span class="comment"># delete retransform entry</span></span><br><span class="line">retransform --deleteAll             <span class="comment"># delete all retransform entries</span></span><br><span class="line">retransform --classPattern demo.*   <span class="comment"># triger retransform classes</span></span><br><span class="line">retransform -c 327a647b /tmp/Test.class /tmp/Test\<span class="variable">$Inner</span>.class</span><br><span class="line">retransform --classLoaderClass <span class="string">&#x27;sun.misc.Launcher$AppClassLoader&#x27;</span> /tmp/Test.class</span><br></pre></td></tr></table></figure>

<h2 id="retransform-指定的-class-文件"><a href="#retransform-指定的-class-文件" class="headerlink" title="retransform 指定的 .class 文件"></a>retransform 指定的 .class 文件</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ retransform /tmp/MathGame.class</span><br><span class="line">retransform success, size: 1, classes:</span><br><span class="line">demo.MathGame</span><br></pre></td></tr></table></figure>

<p>加载指定的 .class 文件，然后解析出 class name，再 retransform jvm 中已加载的对应的类。每加载一个 <code>.class</code> 文件，则会记录一个 retransform entry.</p>
<div class="note info no-icon"><p>提示</p>
<p>如果多次执行 retransform 加载同一个 class 文件，则会有多条 retransform entry.</p>
</div>

<h2 id="查看-retransform-entry"><a href="#查看-retransform-entry" class="headerlink" title="查看 retransform entry"></a>查看 retransform entry</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ retransform -l</span><br><span class="line">Id              ClassName       TransformCount  LoaderHash      LoaderClassName</span><br><span class="line">1               demo.MathGame   1               null            null</span><br></pre></td></tr></table></figure>

<ul>
<li>TransformCount 统计在 ClassFileTransformer#transform 函数里尝试返回 entry 对应的 .class 文件的次数，但并不表明 transform 一定成功。</li>
</ul>
<h2 id="删除指定-retransform-entry"><a href="#删除指定-retransform-entry" class="headerlink" title="删除指定 retransform entry"></a>删除指定 retransform entry</h2><p>需要指定 id：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retransform -d 1</span><br></pre></td></tr></table></figure>

<h2 id="删除所有-retransform-entry"><a href="#删除所有-retransform-entry" class="headerlink" title="删除所有 retransform entry"></a>删除所有 retransform entry</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">retransform --deleteAll</span><br></pre></td></tr></table></figure>

<h2 id="显式触发-retransform"><a href="#显式触发-retransform" class="headerlink" title="显式触发 retransform"></a>显式触发 retransform</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ retransform --classPattern demo.MathGame</span><br><span class="line">retransform success, size: 1, classes:</span><br><span class="line">demo.MathGame</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：对于同一个类，当存在多个 retransform entry 时，如果显式触发 retransform ，则最后添加的 entry 生效(id 最大的)。</p>
</blockquote>
<h2 id="消除-retransform-的影响"><a href="#消除-retransform-的影响" class="headerlink" title="消除 retransform 的影响"></a>消除 retransform 的影响</h2><p>如果对某个类执行 retransform 之后，想消除影响，则需要：</p>
<ul>
<li>删除这个类对应的 retransform entry</li>
<li>重新触发 retransform</li>
</ul>
<div class="note info no-icon"><p>提示</p>
<p>如果不清除掉所有的 retransform entry，并重新触发 retransform ，则 arthas stop 时，retransform 过的类仍然生效。</p>
</div>

<h2 id="结合-jad-mc-命令使用"><a href="#结合-jad-mc-命令使用" class="headerlink" title="结合 jad/mc 命令使用"></a>结合 jad/mc 命令使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jad --source-only com.example.demo.arthas.user.UserController &gt; /tmp/UserController.java</span><br><span class="line"></span><br><span class="line">mc /tmp/UserController.java -d /tmp</span><br><span class="line"></span><br><span class="line">retransform /tmp/com/example/demo/arthas/user/UserController.class</span><br></pre></td></tr></table></figure>

<ul>
<li>jad 命令反编译，然后可以用其它编译器，比如 vim 来修改源码</li>
<li>mc 命令来内存编译修改过的代码</li>
<li>用 retransform 命令加载新的字节码</li>
</ul>
<h2 id="上传-class-文件到服务器的技巧"><a href="#上传-class-文件到服务器的技巧" class="headerlink" title="上传 .class 文件到服务器的技巧"></a>上传 .class 文件到服务器的技巧</h2><p>使用<code>mc</code>命令来编译<code>jad</code>的反编译的代码有可能失败。可以在本地修改代码，编译好后再上传到服务器上。有的服务器不允许直接上传文件，可以使用<code>base64</code>命令来绕过。</p>
<ol>
<li><p>在本地先转换<code>.class</code>文件为 base64，再保存为 result.txt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64 &lt; Test.class &gt; result.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p>到服务器上，新建并编辑<code>result.txt</code>，复制本地的内容，粘贴再保存</p>
</li>
<li><p>把服务器上的 <code>result.txt</code>还原为<code>.class</code></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">base64 -d &lt; result.txt &gt; Test.class</span><br></pre></td></tr></table></figure>
</li>
<li><p>用 md5 命令计算哈希值，校验是否一致</p>
</li>
</ol>
<h2 id="retransform-的限制"><a href="#retransform-的限制" class="headerlink" title="retransform 的限制"></a>retransform 的限制</h2><ul>
<li>不允许新增加 field/method</li>
<li>正在跑的函数，没有退出不能生效，比如下面新增加的<code>System.out.println</code>，只有<code>run()</code>函数里的会生效</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MathGame</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        MathGame game = <span class="keyword">new</span> MathGame();</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            game.run();</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">            <span class="comment">// 这个不生效，因为代码一直跑在 while里</span></span><br><span class="line">            System.out.println(<span class="string">&quot;in loop&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 这个生效，因为run()函数每次都可以完整结束</span></span><br><span class="line">        System.out.println(<span class="string">&quot;call run()&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> number = random.nextInt();</span><br><span class="line">            List&lt;Integer&gt; primeFactors = primeFactors(number);</span><br><span class="line">            print(number, primeFactors);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.out.println(String.format(<span class="string">&quot;illegalArgumentCount:%3d, &quot;</span>, illegalArgumentCount) + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Monitor-命令"><a href="#Monitor-命令" class="headerlink" title="Monitor 命令"></a>Monitor 命令</h1><div class="note info no-icon"><p>提示</p>
<p>方法执行监控</p>
</div>

<p>对匹配 <code>class-pattern</code>／<code>method-pattern</code>／<code>condition-express</code>的类、方法的调用进行监控。</p>
<p><code>monitor</code> 命令是一个非实时返回命令.</p>
<p>实时返回命令是输入之后立即返回，而非实时返回的命令，则是不断的等待目标 Java 进程返回信息，直到用户输入 <code>Ctrl+C</code> 为止。</p>
<p>服务端是以任务的形式在后台跑任务，植入的代码随着任务的中止而不会被执行，所以任务关闭后，不会对原有性能产生太大影响，而且原则上，任何 Arthas 命令不会引起原有业务逻辑的改变。</p>
<h2 id="监控的维度说明"><a href="#监控的维度说明" class="headerlink" title="监控的维度说明"></a>监控的维度说明</h2><table>
<thead>
<tr>
<th align="right">监控项</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right">timestamp</td>
<td align="left">时间戳</td>
</tr>
<tr>
<td align="right">class</td>
<td align="left">Java 类</td>
</tr>
<tr>
<td align="right">method</td>
<td align="left">方法（构造方法、普通方法）</td>
</tr>
<tr>
<td align="right">total</td>
<td align="left">调用次数</td>
</tr>
<tr>
<td align="right">success</td>
<td align="left">成功次数</td>
</tr>
<tr>
<td align="right">fail</td>
<td align="left">失败次数</td>
</tr>
<tr>
<td align="right">rt</td>
<td align="left">平均 RT</td>
</tr>
<tr>
<td align="right">fail-rate</td>
<td align="left">失败率</td>
</tr>
</tbody></table>
<h2 id="参数说明-6"><a href="#参数说明-6" class="headerlink" title="参数说明"></a>参数说明</h2><p>方法拥有一个命名参数 <code>[c:]</code>，意思是统计周期（cycle of output），拥有一个整型的参数值</p>
<table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>class-pattern</em></td>
<td align="left">类名表达式匹配</td>
</tr>
<tr>
<td align="right"><em>method-pattern</em></td>
<td align="left">方法名表达式匹配</td>
</tr>
<tr>
<td align="right"><em>condition-express</em></td>
<td align="left">条件表达式</td>
</tr>
<tr>
<td align="right">[E]</td>
<td align="left">开启正则表达式匹配，默认为通配符匹配</td>
</tr>
<tr>
<td align="right"><code>[c:]</code></td>
<td align="left">统计周期，默认值为 120 秒</td>
</tr>
<tr>
<td align="right">[b]</td>
<td align="left">在<strong>方法调用之前</strong>计算 condition-express</td>
</tr>
<tr>
<td align="right"><code>[m &lt;arg&gt;]</code></td>
<td align="left">指定 Class 最大匹配数量，默认值为 50。长格式为<code>[maxMatch &lt;arg&gt;]</code>。</td>
</tr>
</tbody></table>
<h2 id="使用参考-10"><a href="#使用参考-10" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ monitor -c 5 demo.MathGame primeFactors</span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 94 ms.</span><br><span class="line"> timestamp            class          method        total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2018-12-03 19:06:38  demo.MathGame  primeFactors  5      1        4     1.15        80.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method        total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2018-12-03 19:06:43  demo.MathGame  primeFactors  5      3        2     42.29       40.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method        total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2018-12-03 19:06:48  demo.MathGame  primeFactors  5      3        2     67.92       40.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method        total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2018-12-03 19:06:53  demo.MathGame  primeFactors  5      2        3     0.25        60.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method        total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2018-12-03 19:06:58  demo.MathGame  primeFactors  1      1        0     0.45        0.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method        total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2018-12-03 19:07:03  demo.MathGame  primeFactors  2      2        0     3182.72     0.00%</span><br></pre></td></tr></table></figure>

<h3 id="指定-Class-最大匹配数量"><a href="#指定-Class-最大匹配数量" class="headerlink" title="指定 Class 最大匹配数量"></a>指定 Class 最大匹配数量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ monitor -c 1 -m 1 demo.MathGame primeFactors</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count:1 , method count:1) cost <span class="keyword">in</span> 384 ms, listenerId: 6.</span><br><span class="line"> timestamp            class          method        total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2022-12-25 21:12:58  demo.MathGame  primeFactors  1      1        0     0.18        0.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method        total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2022-12-25 21:12:59  demo.MathGame  primeFactors  0      0        0     0.00       0.00%</span><br></pre></td></tr></table></figure>

<h3 id="计算条件表达式过滤统计结果-方法执行完毕之后"><a href="#计算条件表达式过滤统计结果-方法执行完毕之后" class="headerlink" title="计算条件表达式过滤统计结果(方法执行完毕之后)"></a>计算条件表达式过滤统计结果(方法执行完毕之后)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">monitor -c 5 demo.MathGame primeFactors <span class="string">&quot;params[0] &lt;= 2&quot;</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 19 ms, listenerId: 5</span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">-----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:36  demo.MathGame  primeFactors    5       3       2      0.09       40.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:41  demo.MathGame  primeFactors    5       2       3      0.11       60.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:46  demo.MathGame  primeFactors    5       1       4      0.06       80.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:51  demo.MathGame  primeFactors    5       1       4      0.12       80.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:56  demo.MathGame  primeFactors    5       3       2      0.15       40.00%</span><br></pre></td></tr></table></figure>

<h3 id="计算条件表达式过滤统计结果-方法执行完毕之前"><a href="#计算条件表达式过滤统计结果-方法执行完毕之前" class="headerlink" title="#计算条件表达式过滤统计结果(方法执行完毕之前)"></a><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/monitor.html#%E8%AE%A1%E7%AE%97%E6%9D%A1%E4%BB%B6%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%BF%87%E6%BB%A4%E7%BB%9F%E8%AE%A1%E7%BB%93%E6%9E%9C-%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E5%AE%8C%E6%AF%95%E4%B9%8B%E5%89%8D">#</a>计算条件表达式过滤统计结果(方法执行完毕之前)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">monitor -b -c 5 com.test.testes.MathGame primeFactors <span class="string">&quot;params[0] &lt;= 2&quot;</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 21 ms, listenerId: 4</span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:41:57  demo.MathGame  primeFactors    1       0        1      0.10      100.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:02  demo.MathGame  primeFactors    3       0        3      0.06      100.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:07  demo.MathGame  primeFactors    2       0        2      0.06      100.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:12  demo.MathGame  primeFactors    1       0        1      0.05      100.00%</span><br><span class="line"></span><br><span class="line"> timestamp            class          method         total  success  fail  avg-rt(ms)  fail-rate</span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"> 2020-09-02 09:42:17  demo.MathGame  primeFactors    2       0        2      0.10      100.00%</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ognl-命令"><a href="#ognl-命令" class="headerlink" title="ognl 命令"></a>ognl 命令</h1><p>在 Arthas 里，有一个单独的 ognl 命令，可以动态执行代码。</p>
<p>查看用法：<code>ognl --help</code></p>
<h2 id="参数说明-7"><a href="#参数说明-7" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>express</em></td>
<td align="left">执行的表达式</td>
</tr>
<tr>
<td align="right"><code>[c:]</code></td>
<td align="left">执行表达式的 ClassLoader 的 hashcode，默认值是 SystemClassLoader</td>
</tr>
<tr>
<td align="right"><code>[classLoaderClass:]</code></td>
<td align="left">指定执行表达式的 ClassLoader 的 class name</td>
</tr>
<tr>
<td align="right">[x]</td>
<td align="left">结果对象的展开层次，默认值 1</td>
</tr>
</tbody></table>
<h2 id="使用参考-11"><a href="#使用参考-11" class="headerlink" title="使用参考"></a>使用参考</h2><ul>
<li>OGNL 特殊用法请参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/71">https://github.com/alibaba/arthas/issues/71在新窗口打开</a></li>
<li>OGNL 表达式官方指南：<a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-ognl/language-guide.html">https://commons.apache.org/proper/commons-ognl/language-guide.html在新窗口打开</a></li>
</ul>
<p>调用静态函数：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ognl <span class="string">&#x27;@java.lang.System@out.println(&quot;hello&quot;)&#x27;</span></span><br><span class="line">null</span><br></pre></td></tr></table></figure>

<p>获取静态类的静态字段：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ ognl <span class="string">&#x27;@demo.MathGame@random&#x27;</span></span><br><span class="line">@Random[</span><br><span class="line">    serialVersionUID=@Long[3905348978240129619],</span><br><span class="line">    seed=@AtomicLong[125451474443703],</span><br><span class="line">    multiplier=@Long[25214903917],</span><br><span class="line">    addend=@Long[11],</span><br><span class="line">    mask=@Long[281474976710655],</span><br><span class="line">    DOUBLE_UNIT=@Double[1.1102230246251565E-16],</span><br><span class="line">    BadBound=@String[bound must be positive],</span><br><span class="line">    BadRange=@String[bound must be greater than origin],</span><br><span class="line">    BadSize=@String[size must be non-negative],</span><br><span class="line">    seedUniquifier=@AtomicLong[-3282039941672302964],</span><br><span class="line">    nextNextGaussian=@Double[0.0],</span><br><span class="line">    haveNextNextGaussian=@Boolean[<span class="literal">false</span>],</span><br><span class="line">    serialPersistentFields=@ObjectStreamField[][isEmpty=<span class="literal">false</span>;size=3],</span><br><span class="line">    unsafe=@Unsafe[sun.misc.Unsafe@28ea5898],</span><br><span class="line">    seedOffset=@Long[24],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>通过 hashcode 指定 ClassLoader：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ classloader -t</span><br><span class="line">+-BootstrapClassLoader</span><br><span class="line">+-jdk.internal.loader.ClassLoaders<span class="variable">$PlatformClassLoader</span>@301ec38b</span><br><span class="line">  +-com.taobao.arthas.agent.ArthasClassloader@472067c7</span><br><span class="line">  +-jdk.internal.loader.ClassLoaders<span class="variable">$AppClassLoader</span>@4b85612c</span><br><span class="line">    +-org.springframework.boot.loader.LaunchedURLClassLoader@7f9a81e8</span><br><span class="line"></span><br><span class="line">$ ognl -c 7f9a81e8 @org.springframework.boot.SpringApplication@logger</span><br><span class="line">@Slf4jLocationAwareLog[</span><br><span class="line">    FQCN=@String[org.apache.commons.logging.LogAdapter<span class="variable">$Slf4jLocationAwareLog</span>],</span><br><span class="line">    name=@String[org.springframework.boot.SpringApplication],</span><br><span class="line">    logger=@Logger[Logger[org.springframework.boot.SpringApplication]],</span><br><span class="line">]</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<p>注意 hashcode 是变化的，需要先查看当前的 ClassLoader 信息，提取对应 ClassLoader 的 hashcode。</p>
<p>对于只有唯一实例的 ClassLoader 可以通过 class name 指定，使用起来更加方便：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ognl --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader  @org.springframework.boot.SpringApplication@logger</span><br><span class="line">@Slf4jLocationAwareLog[</span><br><span class="line">    FQCN=@String[org.apache.commons.logging.LogAdapter<span class="variable">$Slf4jLocationAwareLog</span>],</span><br><span class="line">    name=@String[org.springframework.boot.SpringApplication],</span><br><span class="line">    logger=@Logger[Logger[org.springframework.boot.SpringApplication]],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>执行多行表达式，赋值给临时变量，返回一个 List：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ognl <span class="string">&#x27;#value1=@System@getProperty(&quot;java.home&quot;), #value2=@System@getProperty(&quot;java.runtime.name&quot;), &#123;#value1, #value2&#125;&#x27;</span></span><br><span class="line">@ArrayList[</span><br><span class="line">    @String[/opt/java/8.0.181-zulu/jre],</span><br><span class="line">    @String[OpenJDK Runtime Environment],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h1 id="Options-命令"><a href="#Options-命令" class="headerlink" title="Options 命令"></a>Options 命令</h1><blockquote>
<p>全局开关</p>
</blockquote>
<table>
<thead>
<tr>
<th>名称</th>
<th>默认值</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>unsafe</td>
<td>false</td>
<td>是否支持对系统级别的类进行增强，打开该开关可能导致把 JVM 搞挂，请慎重选择！</td>
</tr>
<tr>
<td>dump</td>
<td>false</td>
<td>是否支持被增强了的类 dump 到外部文件中，如果打开开关，class 文件会被 dump 到<code>/$&#123;application working dir&#125;/arthas-class-dump/</code> 目录下，具体位置详见控制台输出</td>
</tr>
<tr>
<td>batch-re-transform</td>
<td>true</td>
<td>是否支持批量对匹配到的类执行 retransform 操作</td>
</tr>
<tr>
<td>json-format</td>
<td>false</td>
<td>是否支持 json 化的输出</td>
</tr>
<tr>
<td>disable-sub-class</td>
<td>false</td>
<td>是否禁用子类匹配，默认在匹配目标类的时候会默认匹配到其子类，如果想精确匹配，可以关闭此开关</td>
</tr>
<tr>
<td>support-default-method</td>
<td>true</td>
<td>是否支持匹配到 default method，默认会查找 interface，匹配里面的 default method。参考 <a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/1105">#1105</a></td>
</tr>
<tr>
<td>save-result</td>
<td>false</td>
<td>是否打开执行结果存日志功能，打开之后所有命令的运行结果都将保存到<code>~/logs/arthas-cache/result.log</code> 中</td>
</tr>
<tr>
<td>job-timeout</td>
<td>1d</td>
<td>异步后台任务的默认超时时间，超过这个时间，任务自动停止；比如设置 1d, 2h, 3m, 25s，分别代表天、小时、分、秒</td>
</tr>
<tr>
<td>print-parent-fields</td>
<td>true</td>
<td>是否打印在 parent class 里的 filed</td>
</tr>
</tbody></table>
<h3 id="查看所有的-options"><a href="#查看所有的-options" class="headerlink" title="查看所有的 options"></a>查看所有的 options</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options</span><br></pre></td></tr></table></figure>

<h3 id="获取-option-的值"><a href="#获取-option-的值" class="headerlink" title="获取 option 的值"></a>获取 option 的值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options json-format</span><br></pre></td></tr></table></figure>

<blockquote>
<p>默认情况下<code>json-format</code> 为 false，如果希望<code>watch</code> /<code>tt</code> 等命令结果以 json 格式输出，则可以设置<code>json-format</code> 为 true。</p>
</blockquote>
<h3 id="设置指定的-option"><a href="#设置指定的-option" class="headerlink" title="设置指定的 option"></a>设置指定的 option</h3><p>例如，想打开执行结果存日志功能首先查看日志，发现无记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;root&#x2F;logs&#x2F;arthas-cache&#x2F;result.log</span><br></pre></td></tr></table></figure>

<p>输入如下命令即可激活记录日志功能：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">options save-result true</span><br></pre></td></tr></table></figure>

<p>稍候片刻，再次查看，发现出现记录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;root&#x2F;logs&#x2F;arthas-cache&#x2F;result.log</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Perfcounter-命令"><a href="#Perfcounter-命令" class="headerlink" title="Perfcounter 命令"></a>Perfcounter 命令</h1><p>查看当前 JVM 的 Perf Counter 信息</p>
<h2 id="使用参考-12"><a href="#使用参考-12" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ perfcounter</span><br><span class="line"> java.ci.totalTime                            2325637411</span><br><span class="line"> java.cls.loadedClasses                       3403</span><br><span class="line"> java.cls.sharedLoadedClasses                 0</span><br><span class="line"> java.cls.sharedUnloadedClasses               0</span><br><span class="line"> java.cls.unloadedClasses                     0</span><br><span class="line"> java.property.java.version                   11.0.4</span><br><span class="line"> java.property.java.vm.info                   mixed mode</span><br><span class="line"> java.property.java.vm.name                   OpenJDK 64-Bit Server VM</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>可以用<code>-d</code>参数打印更多信息：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ perfcounter -d</span><br><span class="line"> Name                                   Variability   Units        Value</span><br><span class="line">---------------------------------------------------------------------------------</span><br><span class="line"> java.ci.totalTime                      Monotonic     Ticks        3242526906</span><br><span class="line"> java.cls.loadedClasses                 Monotonic     Events       3404</span><br><span class="line"> java.cls.sharedLoadedClasses           Monotonic     Events       0</span><br><span class="line"> java.cls.sharedUnloadedClasses         Monotonic     Events       0</span><br><span class="line"> java.cls.unloadedClasses               Monotonic     Events       0</span><br></pre></td></tr></table></figure>

<h2 id="jdk9-以上的应用"><a href="#jdk9-以上的应用" class="headerlink" title="jdk9 以上的应用"></a>jdk9 以上的应用</h2><p>如果没有打印出信息，应用在启动时，加下面的参数：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--add-opens java.base/jdk.internal.perf=ALL-UNNAMED --add-exports java.base/jdk.internal.perf=ALL-UNNAMED --add-opens java.management/sun.management.counter.perf=ALL-UNNAMED --add-opens java.management/sun.management.counter=ALL-UNNAMED</span><br></pre></td></tr></table></figure>

<h1 id="Plaintext-命令"><a href="#Plaintext-命令" class="headerlink" title="Plaintext 命令"></a>Plaintext 命令</h1><p>将输出结果去除 ANSI 颜色</p>
<p>示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jad demo.MathGame main</span><br><span class="line">jad demo.MathGame main | plaintext</span><br></pre></td></tr></table></figure>

<h1 id="Profiler-命令"><a href="#Profiler-命令" class="headerlink" title="Profiler 命令"></a>Profiler 命令</h1><blockquote>
<p>使用<a target="_blank" rel="noopener" href="https://github.com/jvm-profiling-tools/async-profiler">async-profiler</a>生成火焰图</p>
</blockquote>
<p><code>profiler</code> 命令支持生成应用热点的火焰图。本质上是通过不断的采样，然后把收集到的采样结果生成火焰图。</p>
<p><code>profiler</code> 命令基本运行结构是 <code>profiler action [actionArg]</code></p>
<h2 id="参数说明-8"><a href="#参数说明-8" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>action</em></td>
<td align="left">要执行的操作</td>
</tr>
<tr>
<td align="right"><em>actionArg</em></td>
<td align="left">属性名模式</td>
</tr>
<tr>
<td align="right">[i:]</td>
<td align="left">采样间隔（单位：ns）（默认值：10’000’000，即 10 ms）</td>
</tr>
<tr>
<td align="right">[f:]</td>
<td align="left">将输出转储到指定路径</td>
</tr>
<tr>
<td align="right">[d:]</td>
<td align="left">运行评测指定秒</td>
</tr>
<tr>
<td align="right">[e:]</td>
<td align="left">要跟踪哪个事件（cpu, alloc, lock, cache-misses 等），默认是 cpu</td>
</tr>
</tbody></table>
<h2 id="启动-profiler"><a href="#启动-profiler" class="headerlink" title="启动 profiler"></a>启动 profiler</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ profiler start</span><br><span class="line">Started [cpu] profiling</span><br></pre></td></tr></table></figure>

<p>提示</p>
<p>默认情况下，生成的是 cpu 的火焰图，即 event 为<code>cpu</code>。可以用<code>--event</code>参数来指定。</p>
<h2 id="获取已采集的-sample-的数量"><a href="#获取已采集的-sample-的数量" class="headerlink" title="获取已采集的 sample 的数量"></a>获取已采集的 sample 的数量</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ profiler getSamples</span><br><span class="line">23</span><br></pre></td></tr></table></figure>

<h2 id="查看-profiler-状态"><a href="#查看-profiler-状态" class="headerlink" title="查看 profiler 状态"></a>查看 profiler 状态</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ profiler status</span><br><span class="line">[cpu] profiling is running <span class="keyword">for</span> 4 seconds</span><br></pre></td></tr></table></figure>

<p>可以查看当前 profiler 在采样哪种<code>event</code>和采样时间。</p>
<h2 id="停止-profiler"><a href="#停止-profiler" class="headerlink" title="停止 profiler"></a>停止 profiler</h2><h3 id="生成-html-格式结果"><a href="#生成-html-格式结果" class="headerlink" title="生成 html 格式结果"></a>生成 html 格式结果</h3><p>默认情况下，结果文件是<code>html</code>格式，也可以用<code>--format</code>参数指定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ profiler stop --format html</span><br><span class="line">profiler output file: /tmp/<span class="built_in">test</span>/arthas-output/20211207-111550.html</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>或者在<code>--file</code>参数里用文件名指名格式。比如<code>--file /tmp/result.html</code> 。</p>
<h2 id="通过浏览器查看-arthas-output-下面的-profiler-结果"><a href="#通过浏览器查看-arthas-output-下面的-profiler-结果" class="headerlink" title="通过浏览器查看 arthas-output 下面的 profiler 结果"></a>通过浏览器查看 arthas-output 下面的 profiler 结果</h2><p>默认情况下，arthas 使用 3658 端口，则可以打开： <a target="_blank" rel="noopener" href="http://localhost:3658/arthas-output/">http://localhost:3658/arthas-output/在新窗口打开</a> 查看到<code>arthas-output</code>目录下面的 profiler 结果：</p>
<p><img src="https://arthas.aliyun.com/images/arthas-output.jpg" alt="img"></p>
<p>点击可以查看具体的结果：</p>
<p><img src="https://arthas.aliyun.com/images/arthas-output-svg.jpg" alt="img"></p>
<p>提示</p>
<p>如果是 chrome 浏览器，可能需要多次刷新。</p>
<h2 id="profiler-支持的-events"><a href="#profiler-支持的-events" class="headerlink" title="profiler 支持的 events"></a>profiler 支持的 events</h2><p>在不同的平台，不同的 OS 下面，支持的 events 各有不同。比如在 macos 下面：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ profiler list</span><br><span class="line">Basic events:</span><br><span class="line">  cpu</span><br><span class="line">  alloc</span><br><span class="line">  lock</span><br><span class="line">  wall</span><br><span class="line">  itimer</span><br></pre></td></tr></table></figure>

<p>在 linux 下面</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ profiler list</span><br><span class="line">Basic events:</span><br><span class="line">  cpu</span><br><span class="line">  alloc</span><br><span class="line">  lock</span><br><span class="line">  wall</span><br><span class="line">  itimer</span><br><span class="line">Perf events:</span><br><span class="line">  page-faults</span><br><span class="line">  context-switches</span><br><span class="line">  cycles</span><br><span class="line">  instructions</span><br><span class="line">  cache-references</span><br><span class="line">  cache-misses</span><br><span class="line">  branches</span><br><span class="line">  branch-misses</span><br><span class="line">  bus-cycles</span><br><span class="line">  L1-dcache-load-misses</span><br><span class="line">  LLC-load-misses</span><br><span class="line">  dTLB-load-misses</span><br><span class="line">  mem:breakpoint</span><br><span class="line">  trace:tracepoint</span><br></pre></td></tr></table></figure>

<p>如果遇到 OS 本身的权限/配置问题，然后  缺少部分 event，可以参考<code>async-profiler</code>本身文档：<a target="_blank" rel="noopener" href="https://github.com/jvm-profiling-tools/async-profiler">async-profiler在新窗口打开</a></p>
<p>可以用<code>--event</code>参数指定要采样的事件，比如对<code>alloc</code>事件进入采样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ profiler start --event alloc</span><br></pre></td></tr></table></figure>

<h2 id="恢复采样"><a href="#恢复采样" class="headerlink" title="恢复采样"></a>恢复采样</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ profiler resume</span><br><span class="line">Started [cpu] profiling</span><br></pre></td></tr></table></figure>

<p><code>start</code>和<code>resume</code>的区别是：<code>start</code>是新开始采样，<code>resume</code>会保留上次<code>stop</code>时的数据。</p>
<p>通过执行<code>profiler getSamples</code>可以查看 samples 的数量来验证。</p>
<h2 id="使用execute来执行复杂的命令"><a href="#使用execute来执行复杂的命令" class="headerlink" title="使用execute来执行复杂的命令"></a>使用<code>execute</code>来执行复杂的命令</h2><p>比如开始采样：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler execute <span class="string">&#x27;start,framebuf=5000000&#x27;</span></span><br></pre></td></tr></table></figure>

<p>停止采样，并保存到指定文件里：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler execute <span class="string">&#x27;stop,file=/tmp/result.html&#x27;</span></span><br></pre></td></tr></table></figure>

<p>具体的格式参考： <a target="_blank" rel="noopener" href="https://github.com/jvm-profiling-tools/async-profiler/blob/v2.5/src/arguments.cpp#L50">arguments.cpp在新窗口打开</a></p>
<h2 id="查看所有支持的-action"><a href="#查看所有支持的-action" class="headerlink" title="查看所有支持的 action"></a>查看所有支持的 action</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ profiler actions</span><br><span class="line">Supported Actions: [resume, dumpCollapsed, getSamples, start, list, execute, version, stop, load, dumpFlat, actions, dumpTraces, status]</span><br></pre></td></tr></table></figure>

<h2 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ profiler version</span><br><span class="line">Async-profiler 1.6 built on Sep  9 2019</span><br><span class="line">Copyright 2019 Andrei Pangin</span><br></pre></td></tr></table></figure>

<h2 id="配置-framebuf-参数"><a href="#配置-framebuf-参数" class="headerlink" title="配置 framebuf 参数"></a>配置 framebuf 参数</h2><blockquote>
<p>如果遇到生成的火焰图有 <code>[frame_buffer_overflow]</code>，则需要增大 framebuf（默认值是 1’000’000），可以显式配置，比如：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler start --framebuf 5000000</span><br></pre></td></tr></table></figure>

<h2 id="配置-include-exclude-来过滤数据"><a href="#配置-include-exclude-来过滤数据" class="headerlink" title="配置 include/exclude 来过滤数据"></a>配置 include/exclude 来过滤数据</h2><p>如果应用比较复杂，生成的内容很多，想只关注部分数据，可以通过 include/exclude 来过滤。比如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler start --include <span class="string">&#x27;java/*&#x27;</span> --include <span class="string">&#x27;demo/*&#x27;</span> --exclude <span class="string">&#x27;*Unsafe.park*&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>include/exclude 都支持设置多个值 ，但是需要配置在命令行的最后。</p>
</blockquote>
<h2 id="指定执行时间"><a href="#指定执行时间" class="headerlink" title="指定执行时间"></a>指定执行时间</h2><p>比如，希望 profiler 执行 300 秒自动结束，可以用 <code>-d</code>/<code>--duration</code> 参数指定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler start --duration 300</span><br></pre></td></tr></table></figure>

<h2 id="生成-jfr-格式结果"><a href="#生成-jfr-格式结果" class="headerlink" title="生成 jfr 格式结果"></a>生成 jfr 格式结果</h2><blockquote>
<p>注意，jfr 只支持在 <code>start</code>时配置。如果是在<code>stop</code>时指定，则不会生效。</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profiler start --file /tmp/test.jfr</span><br></pre></td></tr></table></figure>

<p><code>file</code>参数支持一些变量：</p>
<ul>
<li>时间戳： <code>--file /tmp/test-%t.jfr</code></li>
<li>进程 ID： <code>--file /tmp/test-%p.jfr</code></li>
</ul>
<p>生成的结果可以用支持 jfr 格式的工具来查看。比如：</p>
<ul>
<li>JDK Mission Control ： <a target="_blank" rel="noopener" href="https://github.com/openjdk/jmc">https://github.com/openjdk/jmc</a></li>
<li>JProfiler ： <a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/1416">https://github.com/alibaba/arthas/issues/1416</a></li>
</ul>
<h2 id="生成的火焰图里的-unknown"><a href="#生成的火焰图里的-unknown" class="headerlink" title="生成的火焰图里的 unknown"></a>生成的火焰图里的 unknown</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/jvm-profiling-tools/async-profiler/discussions/409">https://github.com/jvm-profiling-tools/async-profiler/discussions/409</a></li>
</ul>
<hr>
<h1 id="Pwd-命令"><a href="#Pwd-命令" class="headerlink" title="Pwd 命令"></a>Pwd 命令</h1><p>通过 pwd 命令可以获知当前的工作目录，和 linux 命令类似</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br></pre></td></tr></table></figure>

<h1 id="Quit-stop-命令"><a href="#Quit-stop-命令" class="headerlink" title="Quit-stop 命令"></a>Quit-stop 命令</h1><h2 id="退出-Arthas"><a href="#退出-Arthas" class="headerlink" title="退出 Arthas"></a>退出 Arthas</h2><p>用 <code>exit</code> 或者 <code>quit</code> 命令可以退出 Arthas。</p>
<p>退出 Arthas 之后，还可以再次用 <code>java -jar arthas-boot.jar</code> 来连接。</p>
<h2 id="彻底退出-Arthas"><a href="#彻底退出-Arthas" class="headerlink" title="彻底退出 Arthas"></a>彻底退出 Arthas</h2><p>exit/quit 命令 只是退出当前 session，arthas server 还在目标进程中运行。</p>
<p>想完全退出 Arthas，可以执行 <code>stop</code> 命令。</p>
<hr>
<h1 id="Reset-命令"><a href="#Reset-命令" class="headerlink" title="Reset 命令"></a>Reset 命令</h1><div class="note info no-icon"><p>提示</p>
<p>重置增强类，将被 Arthas 增强过的类全部还原，Arthas 服务端<code>stop</code>时会重置所有增强过的类</p>
</div>

<h2 id="使用参考-13"><a href="#使用参考-13" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ reset -h</span><br><span class="line"> USAGE:</span><br><span class="line">   reset [-h] [-E] [class-pattern]</span><br><span class="line"></span><br><span class="line"> SUMMARY:</span><br><span class="line">   Reset all the enhanced classes</span><br><span class="line"></span><br><span class="line"> EXAMPLES:</span><br><span class="line">   reset</span><br><span class="line">   reset *List</span><br><span class="line">   reset -E .*List</span><br><span class="line"></span><br><span class="line"> OPTIONS:</span><br><span class="line"> -h, --help                                                         this help</span><br><span class="line"> -E, --regex                                                        Enable regular expression to match (wildcard matching by default)</span><br><span class="line"> &lt;class-pattern&gt;                                                    Path and classname of Pattern Matching</span><br></pre></td></tr></table></figure>

<h2 id="还原指定类"><a href="#还原指定类" class="headerlink" title="还原指定类"></a>还原指定类</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ trace Test test</span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost in 57 ms.</span><br><span class="line">`---ts=2017-10-26 17:10:33;thread_name=main;id=1;is_daemon=false;priority=5;TCCL=sun.misc.Launcher$AppClassLoader@14dad5dc</span><br><span class="line">    `---[0.590102ms] Test:test()</span><br><span class="line"></span><br><span class="line">`---ts=2017-10-26 17:10:34;thread_name=main;id=1;is_daemon=false;priority=5;TCCL=sun.misc.Launcher$AppClassLoader@14dad5dc</span><br><span class="line">    `---[0.068692ms] Test:test()</span><br><span class="line"></span><br><span class="line">$ reset Test</span><br><span class="line">Affect(class-cnt:1 , method-cnt:0) cost in 11 ms.</span><br></pre></td></tr></table></figure>

<h2 id="还原所有类"><a href="#还原所有类" class="headerlink" title="还原所有类"></a>还原所有类</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ trace Test test</span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost in 15 ms.</span><br><span class="line">`---ts=2017-10-26 17:12:06;thread_name=main;id=1;is_daemon=false;priority=5;TCCL=sun.misc.Launcher$AppClassLoader@14dad5dc</span><br><span class="line">    `---[0.128518ms] Test:test()</span><br><span class="line"></span><br><span class="line">$ reset</span><br><span class="line">Affect(class-cnt:1 , method-cnt:0) cost in 9 ms.</span><br></pre></td></tr></table></figure>

<h1 id="Sc-命令"><a href="#Sc-命令" class="headerlink" title="Sc 命令"></a>Sc 命令</h1><blockquote>
<p>查看 JVM 已加载的类信息</p>
</blockquote>
<p>“Search-Class”的简写，这个命令能搜索出所有已经加载到 JVM 中的 Class 信息，这个命令支持的参数有 <code>[d]</code> 、<code>[E]</code> 、<code>[f]</code> 和 <code>[x:]</code> 。</p>
<h3 id="参数说明-9"><a href="#参数说明-9" class="headerlink" title="参数说明"></a>参数说明</h3><table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td><em>class-pattern</em></td>
<td>类名表达式匹配</td>
</tr>
<tr>
<td><em>method-pattern</em></td>
<td>方法名表达式匹配</td>
</tr>
<tr>
<td>[d]</td>
<td>输出当前类的详细信息，包括这个类所加载的原始文件来源、类的声明、加载的 ClassLoader 等详细信息。 如果一个类被多个 ClassLoader 所加载，则会出现多次</td>
</tr>
<tr>
<td>[E]</td>
<td>开启正则表达式匹配，默认为通配符匹配</td>
</tr>
<tr>
<td>[f]</td>
<td>输出当前类的成员变量信息（需要配合参数-d 一起使用）</td>
</tr>
<tr>
<td>[x:]</td>
<td>指定输出静态变量时属性的遍历深度，默认为 0，即直接使用 <code>toString</code> 输出</td>
</tr>
<tr>
<td><code>[c:]</code></td>
<td>指定 class 的 ClassLoader 的 hashcode</td>
</tr>
<tr>
<td><code>[classLoaderClass:]</code></td>
<td>指定执行表达式的 ClassLoader 的 class name</td>
</tr>
<tr>
<td><code>[n:]</code></td>
<td>具有详细信息的匹配类的最大数量（默认为 100）</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/sc.html">sc 命令文档</a></p>
<blockquote>
<p>class-pattern 支持全限定名，如 com.taobao.test.AAA，也支持 com/taobao/test/AAA 这样的格式，这样，我们从异常堆栈里面把类名拷贝过来的时候，不需要在手动把<code>/</code> 替换为<code>.</code> 啦。</p>
</blockquote>
<blockquote>
<p>sc 默认开启了子类匹配功能，也就是说所有当前类的子类也会被搜索出来，想要精确的匹配，请打开<code>options disable-sub-class true</code> 开关</p>
</blockquote>
<h3 id="使用参考-14"><a href="#使用参考-14" class="headerlink" title="使用参考"></a>使用参考</h3><ul>
<li>模糊搜索 <code>sc demo.*</code></li>
<li>打印类的详细信息 <code>sc -d demo.MathGame</code></li>
</ul>
<h4 id="指定-classLoader"><a href="#指定-classLoader" class="headerlink" title="指定 classLoader"></a>指定 classLoader</h4><p>注意 hashcode 是变化的，需要先查看当前的 ClassLoader 信息，提取对应 ClassLoader 的 hashcode。<br>如果你使用<code>-c</code> ，你需要手动输入 hashcode：<code>-c &lt;hashcode&gt;</code><br>对于只有唯一实例的 ClassLoader 可以通过<code>--classLoaderClass</code> 指定 class name，使用起来更加方便：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc --classLoaderClass jdk.internal.loader.ClassLoaders$AppClassLoader -d demo*</span><br></pre></td></tr></table></figure>

<ul>
<li>注：这里 classLoaderClass 在 java 8 是 sun.misc.Launcher$AppClassLoader，而 java 11 的 classloader 是 jdk.internal.loader.ClassLoaders$AppClassLoader，killercoda 目前环境是 java11。</li>
</ul>
<p><code>--classLoaderClass</code> 的值是 ClassLoader 的类名，只有匹配到唯一的 ClassLoader 实例时才能工作，目的是方便输入通用命令，而<code>-c &lt;hashcode&gt;</code> 是动态变化的。</p>
<ul>
<li>打印出类的 Field 信息 <code>sc -d -f demo.MathGame</code></li>
</ul>
<hr>
<h1 id="session-命令"><a href="#session-命令" class="headerlink" title="session 命令"></a>session 命令</h1><p>查看当前会话的信息，显示当前绑定的 pid 以及会话 id。</p>
<blockquote>
<p>提示</p>
<p>如果配置了 tunnel server，会追加打印 代理 id、tunnel 服务器的 url 以及连接状态。</p>
<p>如果使用了 staturl 做统计，会追加显示 statUrl 地址。</p>
</blockquote>
<h2 id="使用参考-15"><a href="#使用参考-15" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ session</span><br><span class="line">  Name        Value</span><br><span class="line">--------------------------------------------------</span><br><span class="line"> JAVA_PID    14584</span><br><span class="line"> SESSION_ID  c2073d3b-443a-4a9b-9249-0c5d24a5756c</span><br></pre></td></tr></table></figure>

<h1 id="Sm-命令"><a href="#Sm-命令" class="headerlink" title="Sm 命令"></a>Sm 命令</h1><blockquote>
<p>提示</p>
<p>查看已加载类的方法信息</p>
</blockquote>
<p>“Search-Method” 的简写，这个命令能搜索出所有已经加载了 Class 信息的方法信息。</p>
<p><code>sm</code> 命令只能看到由当前类所声明 (declaring) 的方法，父类则无法看到。</p>
<h2 id="参数说明-10"><a href="#参数说明-10" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>class-pattern</em></td>
<td align="left">类名表达式匹配</td>
</tr>
<tr>
<td align="right"><em>method-pattern</em></td>
<td align="left">方法名表达式匹配</td>
</tr>
<tr>
<td align="right">[d]</td>
<td align="left">展示每个方法的详细信息</td>
</tr>
<tr>
<td align="right">[E]</td>
<td align="left">开启正则表达式匹配，默认为通配符匹配</td>
</tr>
<tr>
<td align="right"><code>[c:]</code></td>
<td align="left">指定 class 的 ClassLoader 的 hashcode</td>
</tr>
<tr>
<td align="right"><code>[classLoaderClass:]</code></td>
<td align="left">指定执行表达式的 ClassLoader 的 class name</td>
</tr>
<tr>
<td align="right"><code>[n:]</code></td>
<td align="left">具有详细信息的匹配类的最大数量（默认为 100）</td>
</tr>
</tbody></table>
<h2 id="使用参考-16"><a href="#使用参考-16" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">$ sm java.lang.String</span><br><span class="line">java.lang.String-&gt;&lt;init&gt;</span><br><span class="line">java.lang.String-&gt;equals</span><br><span class="line">java.lang.String-&gt;toString</span><br><span class="line">java.lang.String-&gt;hashCode</span><br><span class="line">java.lang.String-&gt;compareTo</span><br><span class="line">java.lang.String-&gt;indexOf</span><br><span class="line">java.lang.String-&gt;valueOf</span><br><span class="line">java.lang.String-&gt;checkBounds</span><br><span class="line">java.lang.String-&gt;length</span><br><span class="line">java.lang.String-&gt;isEmpty</span><br><span class="line">java.lang.String-&gt;charAt</span><br><span class="line">java.lang.String-&gt;codePointAt</span><br><span class="line">java.lang.String-&gt;codePointBefore</span><br><span class="line">java.lang.String-&gt;codePointCount</span><br><span class="line">java.lang.String-&gt;offsetByCodePoints</span><br><span class="line">java.lang.String-&gt;getChars</span><br><span class="line">java.lang.String-&gt;getBytes</span><br><span class="line">java.lang.String-&gt;contentEquals</span><br><span class="line">java.lang.String-&gt;nonSyncContentEquals</span><br><span class="line">java.lang.String-&gt;equalsIgnoreCase</span><br><span class="line">java.lang.String-&gt;compareToIgnoreCase</span><br><span class="line">java.lang.String-&gt;regionMatches</span><br><span class="line">java.lang.String-&gt;startsWith</span><br><span class="line">java.lang.String-&gt;endsWith</span><br><span class="line">java.lang.String-&gt;indexOfSupplementary</span><br><span class="line">java.lang.String-&gt;lastIndexOf</span><br><span class="line">java.lang.String-&gt;lastIndexOfSupplementary</span><br><span class="line">java.lang.String-&gt;substring</span><br><span class="line">java.lang.String-&gt;subSequence</span><br><span class="line">java.lang.String-&gt;concat</span><br><span class="line">java.lang.String-&gt;replace</span><br><span class="line">java.lang.String-&gt;matches</span><br><span class="line">java.lang.String-&gt;contains</span><br><span class="line">java.lang.String-&gt;replaceFirst</span><br><span class="line">java.lang.String-&gt;replaceAll</span><br><span class="line">java.lang.String-&gt;split</span><br><span class="line">java.lang.String-&gt;join</span><br><span class="line">java.lang.String-&gt;toLowerCase</span><br><span class="line">java.lang.String-&gt;toUpperCase</span><br><span class="line">java.lang.String-&gt;trim</span><br><span class="line">java.lang.String-&gt;toCharArray</span><br><span class="line">java.lang.String-&gt;format</span><br><span class="line">java.lang.String-&gt;copyValueOf</span><br><span class="line">java.lang.String-&gt;intern</span><br><span class="line">Affect(row-cnt:44) cost <span class="keyword">in</span> 1342 ms.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ sm -d java.lang.String toString</span><br><span class="line"> declaring-class  java.lang.String</span><br><span class="line"> method-name      toString</span><br><span class="line"> modifier         public</span><br><span class="line"> annotation</span><br><span class="line"> parameters</span><br><span class="line"> <span class="built_in">return</span>           java.lang.String</span><br><span class="line"> exceptions</span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 3 ms.</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Stack-命令"><a href="#Stack-命令" class="headerlink" title="Stack 命令"></a>Stack 命令</h1><div class="note info no-icon"><p>提示</p>
<p>输出当前方法被调用的调用路径</p>
</div>

<p>很多时候我们都知道一个方法被执行，但这个方法被执行的路径非常多，或者你根本就不知道这个方法是从那里被执行了，此时你需要的是 stack 命令。</p>
<h2 id="参数说明-11"><a href="#参数说明-11" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>class-pattern</em></td>
<td align="left">类名表达式匹配</td>
</tr>
<tr>
<td align="right"><em>method-pattern</em></td>
<td align="left">方法名表达式匹配</td>
</tr>
<tr>
<td align="right"><em>condition-express</em></td>
<td align="left">条件表达式</td>
</tr>
<tr>
<td align="right">[E]</td>
<td align="left">开启正则表达式匹配，默认为通配符匹配</td>
</tr>
<tr>
<td align="right"><code>[n:]</code></td>
<td align="left">执行次数限制</td>
</tr>
<tr>
<td align="right"><code>[m &lt;arg&gt;]</code></td>
<td align="left">指定 Class 最大匹配数量，默认值为 50。长格式为<code>[maxMatch &lt;arg&gt;]</code>。</td>
</tr>
</tbody></table>
<p>这里重点要说明的是观察表达式，观察表达式的构成主要由 ognl 表达式组成，所以你可以这样写<code>&quot;&#123;params,returnObj&#125;&quot;</code>，只要是一个合法的 ognl 表达式，都能被正常支持。</p>
<p>观察的维度也比较多，主要体现在参数 <code>advice</code> 的数据结构上。<code>Advice</code> 参数最主要是封装了通知节点的所有信息。</p>
<p>请参考<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/advice-class.html">表达式核心变量</a>中关于该节点的描述。</p>
<ul>
<li>特殊用法请参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/71">https://github.com/alibaba/arthas/issues/71在新窗口打开</a></li>
<li>OGNL 表达式官网：<a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-ognl/language-guide.html">https://commons.apache.org/proper/commons-ognl/language-guide.html在新窗口打开</a></li>
</ul>
<h2 id="使用例子"><a href="#使用例子" class="headerlink" title="使用例子"></a>使用例子</h2><h3 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ stack demo.MathGame primeFactors</span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 36 ms.</span><br><span class="line">ts=2018-12-04 01:32:19;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    @demo.MathGame.run()</span><br><span class="line">        at demo.MathGame.main(MathGame.java:16)</span><br></pre></td></tr></table></figure>

<h3 id="指定-Class-最大匹配数量-1"><a href="#指定-Class-最大匹配数量-1" class="headerlink" title="指定 Class 最大匹配数量"></a>指定 Class 最大匹配数量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ stack demo.MathGame primeFactors -m 1</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count:1 , method count:1) cost <span class="keyword">in</span> 561 ms, listenerId: 5.</span><br><span class="line">ts=2022-12-25 21:07:07;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@b4aac2</span><br><span class="line">    @demo.MathGame.primeFactors()</span><br><span class="line">        at demo.MathGame.run(MathGame.java:46)</span><br><span class="line">        at demo.MathGame.main(MathGame.java:38)</span><br></pre></td></tr></table></figure>

<h3 id="据条件表达式来过滤"><a href="#据条件表达式来过滤" class="headerlink" title="据条件表达式来过滤"></a>据条件表达式来过滤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ stack demo.MathGame primeFactors <span class="string">&#x27;params[0]&lt;0&#x27;</span> -n 2</span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 30 ms.</span><br><span class="line">ts=2018-12-04 01:34:27;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    @demo.MathGame.run()</span><br><span class="line">        at demo.MathGame.main(MathGame.java:16)</span><br><span class="line"></span><br><span class="line">ts=2018-12-04 01:34:30;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    @demo.MathGame.run()</span><br><span class="line">        at demo.MathGame.main(MathGame.java:16)</span><br><span class="line"></span><br><span class="line">Command execution <span class="built_in">times</span> exceed <span class="built_in">limit</span>: 2, so <span class="built_in">command</span> will <span class="built_in">exit</span>. You can <span class="built_in">set</span> it with -n option.</span><br></pre></td></tr></table></figure>

<h3 id="据执行时间来过滤"><a href="#据执行时间来过滤" class="headerlink" title="据执行时间来过滤"></a>据执行时间来过滤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ stack demo.MathGame primeFactors <span class="string">&#x27;#cost&gt;5&#x27;</span></span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 35 ms.</span><br><span class="line">ts=2018-12-04 01:35:58;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    @demo.MathGame.run()</span><br><span class="line">        at demo.MathGame.main(MathGame.java:16)</span><br></pre></td></tr></table></figure>

<h1 id="Sysenv-命令"><a href="#Sysenv-命令" class="headerlink" title="Sysenv 命令"></a>Sysenv 命令</h1><div class="note info no-icon"><p>提示</p>
<p>查看当前 JVM 的环境属性( System Environment Variables )</p>
</div>

<h2 id="使用参考-17"><a href="#使用参考-17" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">USAGE:</span><br><span class="line">  sysenv [-h] [env-name]</span><br><span class="line"></span><br><span class="line">SUMMARY:</span><br><span class="line">  Display the system env.</span><br><span class="line"></span><br><span class="line">EXAMPLES:</span><br><span class="line">  sysenv</span><br><span class="line">  sysenv USER</span><br><span class="line"></span><br><span class="line">WIKI:</span><br><span class="line">  https://arthas.aliyun.com/doc/sysenv</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">-h, --help                                                 this help</span><br><span class="line">&lt;env-name&gt;                                                 env name</span><br></pre></td></tr></table></figure>

<h3 id="查看所有环境变量"><a href="#查看所有环境变量" class="headerlink" title="查看所有环境变量"></a>查看所有环境变量</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ sysenv</span><br><span class="line"> KEY                      VALUE</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> PATH                     /Users/admin/.sdkman/candidates/visualvm/current/bin:/Users/admin/.sdkman/candidates/ja</span><br><span class="line">                          va/current/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Applications/Wireshark.app/Contents/</span><br><span class="line">                          MacOS</span><br><span class="line"> SDKMAN_VERSION           5.7.3+337</span><br><span class="line"> JAVA_HOME                /Users/admin/.sdkman/candidates/java/current</span><br><span class="line"> JAVA_MAIN_CLASS_65244    demo.MathGame</span><br><span class="line"> TERM                     xterm-256color</span><br><span class="line"> LANG                     zh_CN.UTF-8</span><br><span class="line"> AUTOJUMP_SOURCED         1</span><br><span class="line"> COLORTERM                truecolor</span><br><span class="line"> LOGNAME                  admin</span><br><span class="line"> XPC_SERVICE_NAME         0</span><br><span class="line"> PWD                      /Users/admin/code/ali/arthas/demo</span><br><span class="line"> TERM_PROGRAM_VERSION     3.2.5</span><br><span class="line"> _                        /Users/admin/.sdkman/candidates/java/current/bin/java</span><br><span class="line"> SHELL                    /bin/bash</span><br><span class="line"> TERM_PROGRAM             iTerm.app</span><br><span class="line"> SDKMAN_PLATFORM          Darwin</span><br><span class="line"> USER                     admin</span><br><span class="line"> ITERM_PROFILE            Default</span><br><span class="line"> TMPDIR                   /var/folders/0r/k561bkk917gg972stqclbz9h0000gn/T/</span><br><span class="line"> XPC_FLAGS                0x0</span><br><span class="line"> TERM_SESSION_ID          w0t4p0:60BC264D-9649-42AC-A7E4-AF85B69F93F8</span><br><span class="line"> __CF_USER_TEXT_ENCODING  0x1F5:0x19:0x34</span><br><span class="line"> Apple_PubSub_Socket_Ren  /private/tmp/com.apple.launchd.DwmmjSQsll/Render</span><br><span class="line"> der</span><br><span class="line"> COLORFGBG                7;0</span><br><span class="line"> HOME                     /Users/admin</span><br><span class="line"> SHLVL                    1</span><br><span class="line"> AUTOJUMP_ERROR_PATH      /Users/admin/Library/autojump/errors.log</span><br></pre></td></tr></table></figure>

<h3 id="查看单个环境变量"><a href="#查看单个环境变量" class="headerlink" title="查看单个环境变量"></a>查看单个环境变量</h3><blockquote>
<p>提示</p>
<p>支持通过<code>TAB</code>键自动补全</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sysenv USER</span><br><span class="line">USER=admin</span><br></pre></td></tr></table></figure>

<h1 id="sysprop-命令"><a href="#sysprop-命令" class="headerlink" title="sysprop 命令"></a>sysprop 命令</h1><div class="note info no-icon"><p>提示</p>
<p>查看当前 JVM 的系统属性( System Property )</p>
</div>

<h2 id="使用参考-18"><a href="#使用参考-18" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">USAGE:</span><br><span class="line">  sysprop [-h] [property-name] [property-value]</span><br><span class="line"></span><br><span class="line">SUMMARY:</span><br><span class="line">  Display, and change all the system properties.</span><br><span class="line"></span><br><span class="line">EXAMPLES:</span><br><span class="line">sysprop</span><br><span class="line">sysprop file.encoding</span><br><span class="line">sysprop production.mode true</span><br><span class="line"></span><br><span class="line">WIKI:</span><br><span class="line">  https://arthas.aliyun.com/doc/sysprop</span><br><span class="line"></span><br><span class="line">OPTIONS:</span><br><span class="line">-h, --help                                  this help</span><br><span class="line">&lt;property-name&gt;                             property name</span><br><span class="line">&lt;property-value&gt;                            property value</span><br></pre></td></tr></table></figure>

<h3 id="查看所有属性"><a href="#查看所有属性" class="headerlink" title="查看所有属性"></a>查看所有属性</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">$ sysprop</span><br><span class="line"> KEY                                                  VALUE</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> java.runtime.name                                    Java(TM) SE Runtime Environment</span><br><span class="line"> sun.boot.library.path                                /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib</span><br><span class="line"> java.vm.version                                      25.51-b03</span><br><span class="line"> user.country.format                                  CN</span><br><span class="line"> gopherProxySet                                       false</span><br><span class="line"> java.vm.vendor                                       Oracle Corporation</span><br><span class="line"> java.vendor.url                                      http://java.oracle.com/</span><br><span class="line"> path.separator                                       :</span><br><span class="line"> java.vm.name                                         Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line"> file.encoding.pkg                                    sun.io</span><br><span class="line"> user.country                                         US</span><br><span class="line"> sun.java.launcher                                    SUN_STANDARD</span><br><span class="line"> sun.os.patch.level                                   unknown</span><br><span class="line"> java.vm.specification.name                           Java Virtual Machine Specification</span><br><span class="line"> user.dir                                             /private/var/tmp</span><br><span class="line"> java.runtime.version                                 1.8.0_51-b16</span><br><span class="line"> java.awt.graphicsenv                                 sun.awt.CGraphicsEnvironment</span><br><span class="line"> java.endorsed.dirs                                   /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib/endors</span><br><span class="line">                                                      ed</span><br><span class="line"> os.arch                                              x86_64</span><br><span class="line"> java.io.tmpdir                                       /var/folders/2c/tbxwzs4s4sbcvh7frbcc7n000000gn/T/</span><br><span class="line"> line.separator</span><br><span class="line"></span><br><span class="line"> java.vm.specification.vendor                         Oracle Corporation</span><br><span class="line"> os.name                                              Mac OS X</span><br><span class="line"> sun.jnu.encoding                                     UTF-8</span><br><span class="line"> java.library.path                                    /Users/wangtao/Library/Java/Extensions:/Library/Java/Extensions:/Network/Libra</span><br><span class="line">                                                      ry/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.</span><br><span class="line"> sun.nio.ch.bugLevel</span><br><span class="line"> java.specification.name                              Java Platform API Specification</span><br><span class="line"> java.class.version                                   52.0</span><br><span class="line"> sun.management.compiler                              HotSpot 64-Bit Tiered Compilers</span><br><span class="line"> os.version                                           10.12.6</span><br><span class="line"> user.home                                            /Users/wangtao</span><br><span class="line"> user.timezone                                        Asia/Shanghai</span><br><span class="line"> java.awt.printerjob                                  sun.lwawt.macosx.CPrinterJob</span><br><span class="line"> file.encoding                                        UTF-8</span><br><span class="line"> java.specification.version                           1.8</span><br><span class="line"> user.name                                            wangtao</span><br><span class="line"> java.class.path                                      .</span><br><span class="line"> java.vm.specification.version                        1.8</span><br><span class="line"> sun.arch.data.model                                  64</span><br><span class="line"> java.home                                            /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre</span><br><span class="line"> sun.java.command                                     Test</span><br><span class="line"> java.specification.vendor                            Oracle Corporation</span><br><span class="line"> user.language                                        en</span><br><span class="line"> awt.toolkit                                          sun.lwawt.macosx.LWCToolkit</span><br><span class="line"> java.vm.info                                         mixed mode</span><br><span class="line"> java.version                                         1.8.0_51</span><br><span class="line"> java.ext.dirs                                        /Users/wangtao/Library/Java/Extensions:/Library/Java/JavaVirtualMachines/jdk1.</span><br><span class="line">                                                      8.0_51.jdk/Contents/Home/jre/lib/ext:/Library/Java/Extensions:/Network/Library</span><br><span class="line">                                                      /Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java</span><br><span class="line"> sun.boot.class.path                                  /Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/lib/resour</span><br><span class="line">                                                      ces.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/li</span><br><span class="line">                                                      b/rt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/Home/jre/l</span><br><span class="line">                                                      ib/sunrsasign.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Contents/H</span><br><span class="line">                                                      ome/jre/lib/jsse.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Content</span><br><span class="line">                                                      s/Home/jre/lib/jce.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_51.jdk/Conte</span><br><span class="line">                                                      nts/Home/jre/lib/charsets.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_51.jd</span><br><span class="line">                                                      k/Contents/Home/jre/lib/jfr.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_51.</span><br><span class="line">                                                      jdk/Contents/Home/jre/classes</span><br><span class="line"> java.vendor                                          Oracle Corporation</span><br><span class="line"> file.separator                                       /</span><br><span class="line"> java.vendor.url.bug                                  http://bugreport.sun.com/bugreport/</span><br><span class="line"> sun.cpu.endian                                       little</span><br><span class="line"> sun.io.unicode.encoding                              UnicodeBig</span><br><span class="line"> sun.cpu.isalist</span><br></pre></td></tr></table></figure>

<h3 id="查看单个属性"><a href="#查看单个属性" class="headerlink" title="查看单个属性"></a>查看单个属性</h3><blockquote>
<p>提示</p>
<p>支持通过<code>TAB</code>键自动补全</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sysprop java.version</span><br><span class="line">java.version=1.8.0_51</span><br></pre></td></tr></table></figure>

<h3 id="修改单个属性"><a href="#修改单个属性" class="headerlink" title="修改单个属性"></a>修改单个属性</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sysprop user.country</span><br><span class="line">user.country=US</span><br><span class="line">$ sysprop user.country CN</span><br><span class="line">Successfully changed the system property.</span><br><span class="line">user.country=CN</span><br></pre></td></tr></table></figure>

<h1 id="tee-命令"><a href="#tee-命令" class="headerlink" title="tee 命令"></a>tee 命令</h1><p>类似传统的 <a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/tee.html">tee 命令</a> 用于读取标准输入的数据，并将其内容输出成文件。</p>
<p>tee 指令会从标准输入设备读取数据，将其内容输出到标准输出设备，同时保存成文件。</p>
<p>使用 <code>tee -h</code> 查看帮助信息</p>
<h2 id="命令示范"><a href="#命令示范" class="headerlink" title="命令示范"></a>命令示范</h2><h3 id="将-sysprop-命令执行结果另外存储在-tmp-logfile-中"><a href="#将-sysprop-命令执行结果另外存储在-tmp-logfile-中" class="headerlink" title="将 sysprop 命令执行结果另外存储在/tmp/logfile 中"></a>将 sysprop 命令执行结果另外存储在<code>/tmp/logfile</code> 中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysprop | tee &#x2F;tmp&#x2F;logfile</span><br></pre></td></tr></table></figure>

<p>查看<code>/tmp/logfile</code> 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;tmp&#x2F;logfile</span><br></pre></td></tr></table></figure>

<h3 id="将-sysprop-命令执行结果匹配java-后另外追加在-tmp-logfile-中"><a href="#将-sysprop-命令执行结果匹配java-后另外追加在-tmp-logfile-中" class="headerlink" title="将 sysprop 命令执行结果匹配java 后另外追加在/tmp/logfile 中"></a>将 sysprop 命令执行结果匹配<code>java</code> 后另外追加在<code>/tmp/logfile</code> 中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysprop | grep java | tee -a &#x2F;path&#x2F;to&#x2F;logfile</span><br></pre></td></tr></table></figure>

<p>查看<code>/tmp/logfile</code> 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;tmp&#x2F;logfile</span><br></pre></td></tr></table></figure>

<h1 id="thread-命令"><a href="#thread-命令" class="headerlink" title="thread 命令"></a>thread 命令</h1><p>查看当前线程信息，查看线程的堆栈</p>
<h2 id="参数说明-12"><a href="#参数说明-12" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>线程 id</td>
</tr>
<tr>
<td>[n:]</td>
<td>指定最忙的前 N 个线程并打印堆栈</td>
</tr>
<tr>
<td>[b]</td>
<td>找出当前阻塞其他线程的线程</td>
</tr>
<tr>
<td>[i ]</td>
<td>指定 cpu 占比统计的采样间隔，单位为毫秒</td>
</tr>
<tr>
<td>[–all]</td>
<td>显示所有匹配的线程</td>
</tr>
</tbody></table>
<h2 id="Thread-用法"><a href="#Thread-用法" class="headerlink" title="Thread 用法"></a>Thread 用法</h2><h3 id="支持一键展示当前最忙的前-N-个线程并打印堆栈："><a href="#支持一键展示当前最忙的前-N-个线程并打印堆栈：" class="headerlink" title="支持一键展示当前最忙的前 N 个线程并打印堆栈："></a>支持一键展示当前最忙的前 N 个线程并打印堆栈：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread -n 3</span><br></pre></td></tr></table></figure>

<ul>
<li>没有线程 ID，包含<code>[Internal]</code> 表示为 JVM 内部线程，参考<code>dashboard</code> 命令的介绍。</li>
<li><code>cpuUsage</code> 为采样间隔时间内线程的 CPU 使用率，与<code>dashboard</code> 命令的数据一致。</li>
<li><code>deltaTime</code> 为采样间隔时间内线程的增量 CPU 时间，小于 1ms 时被取整显示为 0ms。</li>
<li><code>time</code> 线程运行总 CPU 时间。</li>
</ul>
<p>注意：线程栈为第二采样结束时获取，不能表明采样间隔时间内该线程都是在处理相同的任务。建议间隔时间不要太长，可能间隔时间越大越不准确。 可以根据具体情况尝试指定不同的间隔时间，观察输出结果。</p>
<h3 id="当没有参数时，显示第一页线程信息"><a href="#当没有参数时，显示第一页线程信息" class="headerlink" title="当没有参数时，显示第一页线程信息"></a>当没有参数时，显示第一页线程信息</h3><p>默认按照 CPU 增量时间降序排列，只显示第一页数据，避免滚屏。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread</span><br></pre></td></tr></table></figure>

<h3 id="thread-–all-显示所有匹配的线程"><a href="#thread-–all-显示所有匹配的线程" class="headerlink" title="thread –all, 显示所有匹配的线程"></a>thread –all, 显示所有匹配的线程</h3><p>显示所有匹配线程信息，有时需要获取全部 JVM 的线程数据进行分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread --all</span><br></pre></td></tr></table></figure>

<h3 id="thread-id，显示指定线程的运行堆栈"><a href="#thread-id，显示指定线程的运行堆栈" class="headerlink" title="thread id，显示指定线程的运行堆栈"></a>thread id，显示指定线程的运行堆栈</h3><p>查看线程 ID 16 的栈：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread 16</span><br></pre></td></tr></table></figure>

<h3 id="thread-b-找出当前阻塞其他线程的线程"><a href="#thread-b-找出当前阻塞其他线程的线程" class="headerlink" title="thread -b, 找出当前阻塞其他线程的线程"></a>thread -b, 找出当前阻塞其他线程的线程</h3><p>有时候我们发现应用卡住了，通常是由于某个线程拿住了某个锁，并且其他线程都在等待这把锁造成的。为了排查这类问题，arthas 提供了<code>thread -b</code> ，一键找出那个罪魁祸首。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread -b</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>，目前只支持找出 synchronized 关键字阻塞住的线程，如果是<code>java.util.concurrent.Lock</code> ，目前还不支持。</p>
<h3 id="thread-i-指定采样时间间隔"><a href="#thread-i-指定采样时间间隔" class="headerlink" title="thread -i, 指定采样时间间隔"></a>thread -i, 指定采样时间间隔</h3><ul>
<li><code>thread -i 1000</code> : 统计最近 1000ms 内的线程 CPU 时间。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread -i 1000</span><br></pre></td></tr></table></figure>

<ul>
<li><code>thread -n 3 -i 1000</code> : 列出 1000ms 内最忙的 3 个线程栈</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread -n 3 -i 1000</span><br></pre></td></tr></table></figure>

<h3 id="thread-–state，查看指定状态的线程"><a href="#thread-–state，查看指定状态的线程" class="headerlink" title="thread –state，查看指定状态的线程"></a>thread –state，查看指定状态的线程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">thread --state WAITING</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="trace-命令"><a href="#trace-命令" class="headerlink" title="trace 命令"></a>trace 命令</h1><div class="note info no-icon"><p>提示</p>
<p>方法内部调用路径，并输出方法路径上的每个节点上耗时</p>
</div>

<p><code>trace</code> 命令能主动搜索 <code>class-pattern</code>／<code>method-pattern</code> 对应的方法调用路径，渲染和统计整个调用链路上的所有性能开销和追踪调用链路。</p>
<h2 id="参数说明-13"><a href="#参数说明-13" class="headerlink" title="参数说明"></a>参数说明</h2><table>
<thead>
<tr>
<th align="right">参数名称</th>
<th align="left">参数说明</th>
</tr>
</thead>
<tbody><tr>
<td align="right"><em>class-pattern</em></td>
<td align="left">类名表达式匹配</td>
</tr>
<tr>
<td align="right"><em>method-pattern</em></td>
<td align="left">方法名表达式匹配</td>
</tr>
<tr>
<td align="right"><em>condition-express</em></td>
<td align="left">条件表达式</td>
</tr>
<tr>
<td align="right">[E]</td>
<td align="left">开启正则表达式匹配，默认为通配符匹配</td>
</tr>
<tr>
<td align="right"><code>[n:]</code></td>
<td align="left">命令执行次数</td>
</tr>
<tr>
<td align="right"><code>#cost</code></td>
<td align="left">方法执行耗时</td>
</tr>
<tr>
<td align="right"><code>[m &lt;arg&gt;]</code></td>
<td align="left">指定 Class 最大匹配数量，默认值为 50。长格式为<code>[maxMatch &lt;arg&gt;]</code>。</td>
</tr>
</tbody></table>
<p>这里重点要说明的是<code>条件表达式</code>，<code>条件表达式</code>的构成主要由 ognl 表达式组成，所以你可以这样写<code>&quot;params[0]&lt;0&quot;</code>，只要是一个合法的 ognl 表达式，都能被正常支持。</p>
<p>请参考<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/advice-class.html">表达式核心变量</a>中关于该节点的描述。</p>
<ul>
<li>特殊用法请参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/71">https://github.com/alibaba/arthas/issues/71在新窗口打开</a></li>
<li>OGNL 表达式官网：<a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-ognl/language-guide.html">https://commons.apache.org/proper/commons-ognl/language-guide.html在新窗口打开</a></li>
</ul>
<p>很多时候我们只想看到某个方法的 rt 大于某个时间之后的 trace 结果，现在 Arthas 可以按照方法执行的耗时来进行过滤了，例如<code>trace *StringUtils isBlank &#39;#cost&gt;100&#39;</code>表示当执行时间超过 100ms 的时候，才会输出 trace 的结果。</p>
<div class="note info no-icon"><p>提示</p>
<p>watch/stack/trace 这个三个命令都支持<code>#cost</code></p>
</div>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul>
<li><p><code>trace</code> 能方便的帮助你定位和发现因 RT 高而导致的性能问题缺陷，但其每次只能跟踪一级方法的调用链路。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/597">Trace 命令的实现原理在新窗口打开</a></p>
</li>
<li><p>3.3.0 版本后，可以使用动态 Trace 功能，不断增加新的匹配类，参考下面的示例。</p>
</li>
<li><p>目前不支持 <code>trace java.lang.Thread getName</code>，参考 issue: <a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/1610">#1610在新窗口打开</a> ，考虑到不是非常必要场景，且修复有一定难度，因此当前暂不修复</p>
</li>
</ul>
<h2 id="使用参考-19"><a href="#使用参考-19" class="headerlink" title="使用参考"></a>使用参考</h2><h3 id="trace-函数"><a href="#trace-函数" class="headerlink" title="trace 函数"></a>trace 函数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ trace demo.MathGame run</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 28 ms.</span><br><span class="line">`---ts=2019-12-04 00:45:08;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[0.617465ms] demo.MathGame:run()</span><br><span class="line">        `---[0.078946ms] demo.MathGame:primeFactors() <span class="comment">#24 [throws Exception]</span></span><br><span class="line"></span><br><span class="line">`---ts=2019-12-04 00:45:09;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[1.276874ms] demo.MathGame:run()</span><br><span class="line">        `---[0.03752ms] demo.MathGame:primeFactors() <span class="comment">#24 [throws Exception]</span></span><br></pre></td></tr></table></figure>

<div class="note info no-icon"><p>提示</p>
<p>结果里的 <code>#24</code>，表示在 run 函数里，在源文件的第<code>24</code>行调用了<code>primeFactors()</code>函数。</p>
</div>

<h3 id="指定-Class-匹配的最大数量"><a href="#指定-Class-匹配的最大数量" class="headerlink" title="指定 Class 匹配的最大数量"></a>指定 Class 匹配的最大数量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ trace demo.MathGame run -m 1</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 412 ms, listenerId: 4</span><br><span class="line">`---ts=2022-12-25 21:00:00;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@b4aac2</span><br><span class="line">    `---[0.762093ms] demo.MathGame:run()</span><br><span class="line">        `---[30.21% 0.230241ms] demo.MathGame:primeFactors() <span class="comment">#46 [throws Exception]</span></span><br><span class="line"></span><br><span class="line">`---ts=2022-12-25 21:00:10;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@b4aac2</span><br><span class="line">    `---[0.315298ms] demo.MathGame:run()</span><br><span class="line">        `---[13.95% 0.043995ms] demo.MathGame:primeFactors() <span class="comment">#46 [throws Exception]</span></span><br></pre></td></tr></table></figure>

<h3 id="trace-次数限制"><a href="#trace-次数限制" class="headerlink" title="trace 次数限制"></a>trace 次数限制</h3><p>如果方法调用的次数很多，那么可以用<code>-n</code>参数指定捕捉结果的次数。比如下面的例子里，捕捉到一次调用就退出命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ trace demo.MathGame run -n 1</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 20 ms.</span><br><span class="line">`---ts=2019-12-04 00:45:53;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[0.549379ms] demo.MathGame:run()</span><br><span class="line">        +---[0.059839ms] demo.MathGame:primeFactors() <span class="comment">#24</span></span><br><span class="line">        `---[0.232887ms] demo.MathGame:<span class="built_in">print</span>() <span class="comment">#25</span></span><br><span class="line"></span><br><span class="line">Command execution <span class="built_in">times</span> exceed <span class="built_in">limit</span>: 1, so <span class="built_in">command</span> will <span class="built_in">exit</span>. You can <span class="built_in">set</span> it with -n option.</span><br></pre></td></tr></table></figure>

<h3 id="包含-jdk-的函数"><a href="#包含-jdk-的函数" class="headerlink" title="包含 jdk 的函数"></a>包含 jdk 的函数</h3><ul>
<li><code>--skipJDKMethod &lt;value&gt; </code>skip jdk method trace, default value true.</li>
</ul>
<p>默认情况下，trace 不会包含 jdk 里的函数调用，如果希望 trace jdk 里的函数，需要显式设置<code>--skipJDKMethod false</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ trace --skipJDKMethod <span class="literal">false</span> demo.MathGame run</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 60 ms.</span><br><span class="line">`---ts=2019-12-04 00:44:41;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[1.357742ms] demo.MathGame:run()</span><br><span class="line">        +---[0.028624ms] java.util.Random:nextInt() <span class="comment">#23</span></span><br><span class="line">        +---[0.045534ms] demo.MathGame:primeFactors() <span class="comment">#24 [throws Exception]</span></span><br><span class="line">        +---[0.005372ms] java.lang.StringBuilder:&lt;init&gt;() <span class="comment">#28</span></span><br><span class="line">        +---[0.012257ms] java.lang.Integer:valueOf() <span class="comment">#28</span></span><br><span class="line">        +---[0.234537ms] java.lang.String:format() <span class="comment">#28</span></span><br><span class="line">        +---[min=0.004539ms,max=0.005778ms,total=0.010317ms,count=2] java.lang.StringBuilder:append() <span class="comment">#28</span></span><br><span class="line">        +---[0.013777ms] java.lang.Exception:getMessage() <span class="comment">#28</span></span><br><span class="line">        +---[0.004935ms] java.lang.StringBuilder:toString() <span class="comment">#28</span></span><br><span class="line">        `---[0.06941ms] java.io.PrintStream:println() <span class="comment">#28</span></span><br><span class="line"></span><br><span class="line">`---ts=2019-12-04 00:44:42;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[3.030432ms] demo.MathGame:run()</span><br><span class="line">        +---[0.010473ms] java.util.Random:nextInt() <span class="comment">#23</span></span><br><span class="line">        +---[0.023715ms] demo.MathGame:primeFactors() <span class="comment">#24 [throws Exception]</span></span><br><span class="line">        +---[0.005198ms] java.lang.StringBuilder:&lt;init&gt;() <span class="comment">#28</span></span><br><span class="line">        +---[0.006405ms] java.lang.Integer:valueOf() <span class="comment">#28</span></span><br><span class="line">        +---[0.178583ms] java.lang.String:format() <span class="comment">#28</span></span><br><span class="line">        +---[min=0.011636ms,max=0.838077ms,total=0.849713ms,count=2] java.lang.StringBuilder:append() <span class="comment">#28</span></span><br><span class="line">        +---[0.008747ms] java.lang.Exception:getMessage() <span class="comment">#28</span></span><br><span class="line">        +---[0.019768ms] java.lang.StringBuilder:toString() <span class="comment">#28</span></span><br><span class="line">        `---[0.076457ms] java.io.PrintStream:println() <span class="comment">#28</span></span><br></pre></td></tr></table></figure>

<h3 id="根据调用耗时过滤"><a href="#根据调用耗时过滤" class="headerlink" title="根据调用耗时过滤"></a>根据调用耗时过滤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ trace demo.MathGame run <span class="string">&#x27;#cost &gt; 10&#x27;</span></span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 41 ms.</span><br><span class="line">`---ts=2018-12-04 01:12:02;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[12.033735ms] demo.MathGame:run()</span><br><span class="line">        +---[0.006783ms] java.util.Random:nextInt()</span><br><span class="line">        +---[11.852594ms] demo.MathGame:primeFactors()</span><br><span class="line">        `---[0.05447ms] demo.MathGame:<span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<div class="note info no-icon"><p>提示</p>
<p>只会展示耗时大于 10ms 的调用路径，有助于在排查问题的时候，只关注异常情况</p>
</div>

<ul>
<li>是不是很眼熟，没错，在 JProfiler 等收费软件中你曾经见识类似的功能，这里你将可以通过命令就能打印出指定调用路径。 友情提醒下，<code>trace</code> 在执行的过程中本身是会有一定的性能开销，在统计的报告中并未像 JProfiler 一样预先减去其自身的统计开销。所以这统计出来有些许的不准，渲染路径上调用的类、方法越多，性能偏差越大。但还是能让你看清一些事情的。</li>
<li>[12.033735ms] 的含义，<code>12.033735</code> 的含义是：当前节点在当前步骤的耗时，单位为毫秒</li>
<li>[0,0,0ms,11]xxx:yyy() [throws Exception]，对该方法中相同的方法调用进行了合并，<code>0,0,0ms,11</code> 表示方法调用耗时，<code>min,max,total,count</code>；<code>throws Exception</code> 表明该方法调用中存在异常返回</li>
<li>这里存在一个统计不准确的问题，就是所有方法耗时加起来可能会小于该监测方法的总耗时，这个是由于 Arthas 本身的逻辑会有一定的耗时</li>
</ul>
<h3 id="trace-多个类或者多个函数"><a href="#trace-多个类或者多个函数" class="headerlink" title="trace 多个类或者多个函数"></a>trace 多个类或者多个函数</h3><p>trace 命令只会 trace 匹配到的函数里的子调用，并不会向下 trace 多层。因为 trace 是代价比较贵的，多层 trace 可能会导致最终要 trace 的类和函数非常多。</p>
<p>可以用正则表匹配路径上的多个类和函数，一定程度上达到多层 trace 的效果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trace -E com.test.ClassA|org.test.ClassB method1|method2|method3</span><br></pre></td></tr></table></figure>

<h3 id="排除掉指定的类"><a href="#排除掉指定的类" class="headerlink" title="排除掉指定的类"></a>排除掉指定的类</h3><p>使用 <code>--exclude-class-pattern</code> 参数可以排除掉指定的类，比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">trace javax.servlet.Filter * --exclude-class-pattern com.demo.TestFilter</span><br></pre></td></tr></table></figure>

<h2 id="动态-trace"><a href="#动态-trace" class="headerlink" title="动态 trace"></a>动态 trace</h2><div class="note info no-icon"><p>提示</p>
<p>3.3.0 版本后支持。</p>
</div>

<p>打开终端 1，trace 上面 demo 里的<code>run</code>函数，可以看到打印出 <code>listenerId: 1</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[arthas@59161]$ trace demo.MathGame run</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 112 ms, listenerId: 1</span><br><span class="line">`---ts=2020-07-09 16:48:11;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[1.389634ms] demo.MathGame:run()</span><br><span class="line">        `---[0.123934ms] demo.MathGame:primeFactors() <span class="comment">#24 [throws Exception]</span></span><br><span class="line"></span><br><span class="line">`---ts=2020-07-09 16:48:12;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[3.716391ms] demo.MathGame:run()</span><br><span class="line">        +---[3.182813ms] demo.MathGame:primeFactors() <span class="comment">#24</span></span><br><span class="line">        `---[0.167786ms] demo.MathGame:<span class="built_in">print</span>() <span class="comment">#25</span></span><br></pre></td></tr></table></figure>

<p>现在想要深入子函数<code>primeFactors</code>，可以打开一个新终端 2，使用<code>telnet localhost 3658</code>连接上 arthas，再 trace <code>primeFactors</code>时，指定<code>listenerId</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[arthas@59161]$ trace demo.MathGame primeFactors --listenerId 1</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 34 ms, listenerId: 1</span><br></pre></td></tr></table></figure>

<p>这时终端 2 打印的结果，说明已经增强了一个函数：<code>Affect(class count: 1 , method count: 1)</code>，但不再打印更多的结果。</p>
<p>再查看终端 1，可以发现 trace 的结果增加了一层，打印了<code>primeFactors</code>函数里的内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">`---ts=2020-07-09 16:49:29;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[0.492551ms] demo.MathGame:run()</span><br><span class="line">        `---[0.113929ms] demo.MathGame:primeFactors() <span class="comment">#24 [throws Exception]</span></span><br><span class="line">            `---[0.061462ms] demo.MathGame:primeFactors()</span><br><span class="line">                `---[0.001018ms] throw:java.lang.IllegalArgumentException() <span class="comment">#46</span></span><br><span class="line"></span><br><span class="line">`---ts=2020-07-09 16:49:30;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@3d4eac69</span><br><span class="line">    `---[0.409446ms] demo.MathGame:run()</span><br><span class="line">        +---[0.232606ms] demo.MathGame:primeFactors() <span class="comment">#24</span></span><br><span class="line">        |   `---[0.1294ms] demo.MathGame:primeFactors()</span><br><span class="line">        `---[0.084025ms] demo.MathGame:<span class="built_in">print</span>() <span class="comment">#25</span></span><br></pre></td></tr></table></figure>

<p>通过指定<code>listenerId</code>的方式动态 trace，可以不断深入。另外 <code>watch</code>/<code>tt</code>/<code>monitor</code>等命令也支持类似的功能。</p>
<h2 id="trace-结果时间不准确问题"><a href="#trace-结果时间不准确问题" class="headerlink" title="trace 结果时间不准确问题"></a>trace 结果时间不准确问题</h2><p>比如下面的结果里：<code>0.705196 &gt; (0.152743 + 0.145825)</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ trace demo.MathGame run -n 1</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 66 ms, listenerId: 1</span><br><span class="line">`---ts=2021-02-08 11:27:36;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@232204a1</span><br><span class="line">    `---[0.705196ms] demo.MathGame:run()</span><br><span class="line">        +---[0.152743ms] demo.MathGame:primeFactors() <span class="comment">#24</span></span><br><span class="line">        `---[0.145825ms] demo.MathGame:<span class="built_in">print</span>() <span class="comment">#25</span></span><br></pre></td></tr></table></figure>

<p>那么其它的时间消耗在哪些地方？</p>
<ol>
<li><p>没有被 trace 到的函数。比如<code>java.*</code> 下的函数调用默认会忽略掉。通过增加<code>--skipJDKMethod false</code>参数可以打印出来。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ trace demo.MathGame run --skipJDKMethod <span class="literal">false</span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 35 ms, listenerId: 2</span><br><span class="line">`---ts=2021-02-08 11:27:48;thread_name=main;id=1;is_daemon=<span class="literal">false</span>;priority=5;TCCL=sun.misc.Launcher<span class="variable">$AppClassLoader</span>@232204a1</span><br><span class="line">    `---[0.810591ms] demo.MathGame:run()</span><br><span class="line">        +---[0.034568ms] java.util.Random:nextInt() <span class="comment">#23</span></span><br><span class="line">        +---[0.119367ms] demo.MathGame:primeFactors() <span class="comment">#24 [throws Exception]</span></span><br><span class="line">        +---[0.017407ms] java.lang.StringBuilder:&lt;init&gt;() <span class="comment">#28</span></span><br><span class="line">        +---[0.127922ms] java.lang.String:format() <span class="comment">#57</span></span><br><span class="line">        +---[min=0.01419ms,max=0.020221ms,total=0.034411ms,count=2] java.lang.StringBuilder:append() <span class="comment">#57</span></span><br><span class="line">        +---[0.021911ms] java.lang.Exception:getMessage() <span class="comment">#57</span></span><br><span class="line">        +---[0.015643ms] java.lang.StringBuilder:toString() <span class="comment">#57</span></span><br><span class="line">        `---[0.086622ms] java.io.PrintStream:println() <span class="comment">#57</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>非函数调用的指令消耗。比如 <code>i++</code>, <code>getfield</code>等指令。</p>
</li>
<li><p>在代码执行过程中，JVM 可能出现停顿，比如 GC，进入同步块等。</p>
</li>
</ol>
<h3 id="使用-v-参数打印更多信息"><a href="#使用-v-参数打印更多信息" class="headerlink" title="使用 -v 参数打印更多信息"></a>使用 -v 参数打印更多信息</h3><div class="note info no-icon"><p>提示</p>
<p>watch/trace/monitor/stack/tt 命令都支持 <code>-v</code> 参数</p>
</div>

<p>当命令执行之后，没有输出结果。有两种可能：</p>
<ol>
<li>匹配到的函数没有被执行</li>
<li>条件表达式结果是 false</li>
</ol>
<p>但用户区分不出是哪种情况。</p>
<p>使用 <code>-v</code>选项，则会打印<code>Condition express</code>的具体值和执行结果，方便确认。</p>
<hr>
<h1 id="tt-命令"><a href="#tt-命令" class="headerlink" title="tt 命令"></a>tt 命令</h1><div class="note info no-icon"><p>提示</p>
<p>方法执行数据的时空隧道，记录下指定方法每次调用的入参和返回信息，并能对这些不同的时间下调用进行观测</p>
</div>

<p><code>watch</code> 虽然很方便和灵活，但需要提前想清楚观察表达式的拼写，这对排查问题而言要求太高，因为很多时候我们并不清楚问题出自于何方，只能靠蛛丝马迹进行猜测。</p>
<p>这个时候如果能记录下当时方法调用的所有入参和返回值、抛出的异常会对整个问题的思考与判断非常有帮助。</p>
<p>于是乎，TimeTunnel 命令就诞生了。</p>
<h2 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h2><ul>
<li>tt 命令的实现是：把函数的入参/返回值等，保存到一个<code>Map&lt;Integer, TimeFragment&gt;</code>里，默认的大小是 100。</li>
<li>tt 相关功能在使用完之后，需要手动释放内存，否则长时间可能导致OOM。退出 arthas 不会自动清除 tt 的缓存 map。</li>
</ul>
<h2 id="使用参考-20"><a href="#使用参考-20" class="headerlink" title="使用参考"></a>使用参考</h2><h3 id="记录调用"><a href="#记录调用" class="headerlink" title="记录调用"></a>记录调用</h3><p>对于一个最基本的使用来说，就是记录下当前方法的每次调用环境现场。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ tt -t demo.MathGame primeFactors</span><br><span class="line">Press Ctrl+C to abort.</span><br><span class="line">Affect(class-cnt:1 , method-cnt:1) cost <span class="keyword">in</span> 66 ms.</span><br><span class="line"> INDEX   TIMESTAMP            COST(ms)  IS-RET  IS-EXP   OBJECT         CLASS                          METHOD</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000    2018-12-04 11:15:38  1.096236  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1001    2018-12-04 11:15:39  0.191848  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1002    2018-12-04 11:15:40  0.069523  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1003    2018-12-04 11:15:41  0.186073  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1004    2018-12-04 11:15:42  17.76437  <span class="literal">true</span>    <span class="literal">false</span>    0x4b67cf4d     MathGame                       primeFactors</span><br></pre></td></tr></table></figure>

<h3 id="指定-Class-最大匹配数量-2"><a href="#指定-Class-最大匹配数量-2" class="headerlink" title="指定 Class 最大匹配数量"></a>指定 Class 最大匹配数量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ tt -t -m 1 demo.MathGame primeFactors</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count:1 , method count:1) cost <span class="keyword">in</span> 130 ms, listenerId: 1.</span><br><span class="line"> INDEX   TIMESTAMP            COST(ms)  IS-RET  IS-EXP   OBJECT         CLASS                          METHOD</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000    2022-12-25 19:41:45  2.629929  <span class="literal">true</span>    <span class="literal">false</span>    0x3bf400       MathGame                       primeFactors</span><br><span class="line"> 1001    2022-12-25 19:41:55  0.146161  <span class="literal">false</span>   <span class="literal">true</span>     0x3bf400       MathGame                       primeFactors</span><br></pre></td></tr></table></figure>

<ul>
<li><p>命令参数解析</p>
<ul>
<li><p><code>-t</code></p>
<p>tt 命令有很多个主参数，<code>-t</code> 就是其中之一。这个参数的表明希望记录下类 <code>*Test</code> 的 <code>print</code> 方法的每次执行情况。</p>
</li>
<li><p><code>-n 3</code></p>
<p>当你执行一个调用量不高的方法时可能你还能有足够的时间用 <code>CTRL+C</code> 中断 tt 命令记录的过程，但如果遇到调用量非常大的方法，瞬间就能将你的 JVM 内存撑爆。</p>
<p>此时你可以通过 <code>-n</code> 参数指定你需要记录的次数，当达到记录次数时 Arthas 会主动中断 tt 命令的记录过程，避免人工操作无法停止的情况。</p>
</li>
<li><p><code>-m 1</code></p>
<p>通过 <code>-m</code> 参数指定 Class 匹配的最大数量，防止匹配到的 Class 数量太多导致 JVM 挂起，默认值是 50。</p>
</li>
</ul>
</li>
<li><p>表格字段说明</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>表格字段</th>
<th>字段解释</th>
</tr>
</thead>
<tbody><tr>
<td>INDEX</td>
<td>时间片段记录编号，每一个编号代表着一次调用，后续 tt 还有很多命令都是基于此编号指定记录操作，非常重要。</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>方法执行的本机时间，记录了这个时间片段所发生的本机时间</td>
</tr>
<tr>
<td>COST(ms)</td>
<td>方法执行的耗时</td>
</tr>
<tr>
<td>IS-RET</td>
<td>方法是否以正常返回的形式结束</td>
</tr>
<tr>
<td>IS-EXP</td>
<td>方法是否以抛异常的形式结束</td>
</tr>
<tr>
<td>OBJECT</td>
<td>执行对象的<code>hashCode()</code>，注意，曾经有人误认为是对象在 JVM 中的内存地址，但很遗憾他不是。但他能帮助你简单的标记当前执行方法的类实体</td>
</tr>
<tr>
<td>CLASS</td>
<td>执行的类名</td>
</tr>
<tr>
<td>METHOD</td>
<td>执行的方法名</td>
</tr>
</tbody></table>
<ul>
<li><p>条件表达式</p>
<p>不知道大家是否有在使用过程中遇到以下困惑</p>
<ul>
<li>Arthas 似乎很难区分出重载的方法</li>
<li>我只需要观察特定参数，但是 tt 却全部都给我记录了下来</li>
</ul>
<p>条件表达式也是用 <code>OGNL</code> 来编写，核心的判断对象依然是 <code>Advice</code> 对象。除了 <code>tt</code> 命令之外，<code>watch</code>、<code>trace</code>、<code>stack</code> 命令也都支持条件表达式。</p>
</li>
<li><p>解决方法重载</p>
<p><code>tt -t *Test print params.length==1</code></p>
<p>通过制定参数个数的形式解决不同的方法签名，如果参数个数一样，你还可以这样写</p>
<p><code>tt -t *Test print &#39;params[1] instanceof Integer&#39;</code></p>
</li>
<li><p>解决指定参数</p>
<p><code>tt -t *Test print params[0].mobile==&quot;13989838402&quot;</code></p>
</li>
<li><p>构成条件表达式的 <code>Advice</code> 对象</p>
<p>前边看到了很多条件表达式中，都使用了 <code>params[0]</code>，有关这个变量的介绍，请参考<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/advice-class.html">表达式核心变量</a></p>
</li>
</ul>
<h3 id="检索调用记录"><a href="#检索调用记录" class="headerlink" title="检索调用记录"></a>检索调用记录</h3><p>当你用 <code>tt</code> 记录了一大片的时间片段之后，你希望能从中筛选出自己需要的时间片段，这个时候你就需要对现有记录进行检索。</p>
<p>假设我们有这些记录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ tt -l</span><br><span class="line"> INDEX   TIMESTAMP            COST(ms)  IS-RET  IS-EXP   OBJECT         CLASS                          METHOD</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000    2018-12-04 11:15:38  1.096236  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1001    2018-12-04 11:15:39  0.191848  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1002    2018-12-04 11:15:40  0.069523  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1003    2018-12-04 11:15:41  0.186073  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1004    2018-12-04 11:15:42  17.76437  <span class="literal">true</span>    <span class="literal">false</span>    0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line">                              9</span><br><span class="line"> 1005    2018-12-04 11:15:43  0.4776    <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line">Affect(row-cnt:6) cost <span class="keyword">in</span> 4 ms.</span><br></pre></td></tr></table></figure>

<p>我需要筛选出 <code>primeFactors</code> 方法的调用信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ tt -s <span class="string">&#x27;method.name==&quot;primeFactors&quot;&#x27;</span></span><br><span class="line"> INDEX   TIMESTAMP            COST(ms)  IS-RET  IS-EXP   OBJECT         CLASS                          METHOD</span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000    2018-12-04 11:15:38  1.096236  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1001    2018-12-04 11:15:39  0.191848  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1002    2018-12-04 11:15:40  0.069523  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1003    2018-12-04 11:15:41  0.186073  <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line"> 1004    2018-12-04 11:15:42  17.76437  <span class="literal">true</span>    <span class="literal">false</span>    0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line">                              9</span><br><span class="line"> 1005    2018-12-04 11:15:43  0.4776    <span class="literal">false</span>   <span class="literal">true</span>     0x4b67cf4d     MathGame                       primeFactors</span><br><span class="line">Affect(row-cnt:6) cost <span class="keyword">in</span> 607 ms.</span><br></pre></td></tr></table></figure>

<p>你需要一个 <code>-s</code> 参数。同样的，搜索表达式的核心对象依旧是 <code>Advice</code> 对象。</p>
<h3 id="查看调用信息"><a href="#查看调用信息" class="headerlink" title="查看调用信息"></a>查看调用信息</h3><p>对于具体一个时间片的信息而言，你可以通过 <code>-i</code> 参数后边跟着对应的 <code>INDEX</code> 编号查看到他的详细信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ tt -i 1003</span><br><span class="line"> INDEX            1003</span><br><span class="line"> GMT-CREATE       2018-12-04 11:15:41</span><br><span class="line"> COST(ms)         0.186073</span><br><span class="line"> OBJECT           0x4b67cf4d</span><br><span class="line"> CLASS            demo.MathGame</span><br><span class="line"> METHOD           primeFactors</span><br><span class="line"> IS-RETURN        <span class="literal">false</span></span><br><span class="line"> IS-EXCEPTION     <span class="literal">true</span></span><br><span class="line"> PARAMETERS[0]    @Integer[-564322413]</span><br><span class="line"> THROW-EXCEPTION  java.lang.IllegalArgumentException: number is: -564322413, need &gt;= 2</span><br><span class="line">                      at demo.MathGame.primeFactors(MathGame.java:46)</span><br><span class="line">                      at demo.MathGame.run(MathGame.java:24)</span><br><span class="line">                      at demo.MathGame.main(MathGame.java:16)</span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 11 ms.</span><br></pre></td></tr></table></figure>

<h3 id="重做一次调用"><a href="#重做一次调用" class="headerlink" title="重做一次调用"></a>重做一次调用</h3><p>当你稍稍做了一些调整之后，你可能需要前端系统重新触发一次你的调用，此时得求爷爷告奶奶的需要前端配合联调的同学再次发起一次调用。而有些场景下，这个调用不是这么好触发的。</p>
<p><code>tt</code> 命令由于保存了当时调用的所有现场信息，所以我们可以自己主动对一个 <code>INDEX</code> 编号的时间片自主发起一次调用，从而解放你的沟通成本。此时你需要 <code>-p</code> 参数。通过 <code>--replay-times</code> 指定 调用次数，通过 <code>--replay-interval</code> 指定多次调用间隔(单位 ms, 默认 1000ms)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ tt -i 1004 -p</span><br><span class="line"> RE-INDEX       1004</span><br><span class="line"> GMT-REPLAY     2018-12-04 11:26:00</span><br><span class="line"> OBJECT         0x4b67cf4d</span><br><span class="line"> CLASS          demo.MathGame</span><br><span class="line"> METHOD         primeFactors</span><br><span class="line"> PARAMETERS[0]  @Integer[946738738]</span><br><span class="line"> IS-RETURN      <span class="literal">true</span></span><br><span class="line"> IS-EXCEPTION   <span class="literal">false</span></span><br><span class="line"> COST(ms)         0.186073</span><br><span class="line"> RETURN-OBJ     @ArrayList[</span><br><span class="line">                    @Integer[2],</span><br><span class="line">                    @Integer[11],</span><br><span class="line">                    @Integer[17],</span><br><span class="line">                    @Integer[2531387],</span><br><span class="line">                ]</span><br><span class="line">Time fragment[1004] successfully replayed.</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 14 ms.</span><br></pre></td></tr></table></figure>

<p>你会发现结果虽然一样，但调用的路径发生了变化，由原来的程序发起变成了 Arthas 自己的内部线程发起的调用了。</p>
<h3 id="观察表达式"><a href="#观察表达式" class="headerlink" title="观察表达式"></a>观察表达式</h3><p><code>-w, --watch-express</code> 观察时空隧道使用<code>ognl</code> 表达式</p>
<ul>
<li>使用<a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/advice-class.html">表达式核心变量</a>中所有变量作为已知条件编写表达式。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[arthas@10718]$ tt -t demo.MathGame run -n 5</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 56 ms, listenerId: 1</span><br><span class="line"> INDEX      TIMESTAMP                   COST(ms)     IS-RET     IS-EXP      OBJECT              CLASS                                     METHOD</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000       2021-01-08 21:54:17         0.901091     <span class="literal">true</span>       <span class="literal">false</span>       0x7699a589          MathGame                                  run</span><br><span class="line">[arthas@10718]$ tt -w <span class="string">&#x27;target.illegalArgumentCount&#x27;</span>  -x 1 -i 1000</span><br><span class="line">@Integer[60]</span><br><span class="line">Affect(row-cnt:1) cost <span class="keyword">in</span> 7 ms.</span><br></pre></td></tr></table></figure>

<ul>
<li>获取类的静态字段、调用类的静态方法</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[arthas@10718]$ tt -t demo.MathGame run -n 5</span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost <span class="keyword">in</span> 56 ms, listenerId: 1</span><br><span class="line"> INDEX      TIMESTAMP                   COST(ms)     IS-RET     IS-EXP      OBJECT              CLASS                                     METHOD</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000       2021-01-08 21:54:17         0.901091     <span class="literal">true</span>       <span class="literal">false</span>       0x7699a589          MathGame                                  run</span><br><span class="line">[arthas@10718]$ tt -w <span class="string">&#x27;@demo.MathGame@random.nextInt(100)&#x27;</span>  -x 1 -i 1000</span><br><span class="line">@Integer[46]</span><br></pre></td></tr></table></figure>

<p>注意这里使用 <code>com.taobao.arthas.core.advisor.Advice#getLoader</code>加载,使用精确<code>classloader</code> <a target="_blank" rel="noopener" href="https://arthas.aliyun.com/doc/ognl.html">ognl</a>更好。</p>
<p>高级用法 <a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/482">获取 spring context 调用 bean 方法在新窗口打开</a></p>
<ul>
<li><p>需要强调的点</p>
<ol>
<li><p><strong>ThreadLocal 信息丢失</strong></p>
<p>很多框架偷偷的将一些环境变量信息塞到了发起调用线程的 ThreadLocal 中，由于调用线程发生了变化，这些 ThreadLocal 线程信息无法通过 Arthas 保存，所以这些信息将会丢失。</p>
<p>一些常见的 CASE 比如：鹰眼的 TraceId 等。</p>
</li>
<li><p><strong>引用的对象</strong></p>
<p>需要强调的是，<code>tt</code> 命令是将当前环境的对象引用保存起来，但仅仅也只能保存一个引用而已。如果方法内部对入参进行了变更，或者返回的对象经过了后续的处理，那么在 <code>tt</code> 查看的时候将无法看到当时最准确的值。这也是为什么 <code>watch</code> 命令存在的意义。</p>
</li>
</ol>
</li>
</ul>
<h3 id="通过索引删除指定的-tt-记录"><a href="#通过索引删除指定的-tt-记录" class="headerlink" title="通过索引删除指定的 tt 记录"></a>通过索引删除指定的 tt 记录</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt -d 1001</span><br></pre></td></tr></table></figure>

<h3 id="清除所有的-tt-记录"><a href="#清除所有的-tt-记录" class="headerlink" title="清除所有的 tt 记录"></a>清除所有的 tt 记录</h3><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt --delete-all</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="version-命令"><a href="#version-命令" class="headerlink" title="version 命令"></a>version 命令</h1><p>输出当前目标 Java 进程所加载的 Arthas 版本号</p>
<h2 id="使用参考-21"><a href="#使用参考-21" class="headerlink" title="使用参考"></a>使用参考</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ version</span><br><span class="line"> 3.5.1</span><br></pre></td></tr></table></figure>

<h1 id="Vmoption-命令"><a href="#Vmoption-命令" class="headerlink" title="Vmoption 命令"></a>Vmoption 命令</h1><h2 id="使用参考-22"><a href="#使用参考-22" class="headerlink" title="使用参考"></a>使用参考</h2><h3 id="查看所有的-option"><a href="#查看所有的-option" class="headerlink" title="查看所有的 option"></a>查看所有的 option</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[arthas@56963]$ vmoption</span><br><span class="line"> KEY                    VALUE                   ORIGIN                 WRITEABLE</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line"> HeapDumpBeforeFullGC   <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> HeapDumpAfterFullGC    <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> HeapDumpOnOutOfMemory  <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> Error</span><br><span class="line"> HeapDumpPath                                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> CMSAbortablePrecleanW  100                     DEFAULT                <span class="literal">true</span></span><br><span class="line"> aitMillis</span><br><span class="line"> CMSWaitDuration        2000                    DEFAULT                <span class="literal">true</span></span><br><span class="line"> CMSTriggerInterval     -1                      DEFAULT                <span class="literal">true</span></span><br><span class="line"> PrintGC                <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> PrintGCDetails         <span class="literal">true</span>                    MANAGEMENT             <span class="literal">true</span></span><br><span class="line"> PrintGCDateStamps      <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> PrintGCTimeStamps      <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> PrintGCID              <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> PrintClassHistogramBe  <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> foreFullGC</span><br><span class="line"> PrintClassHistogramAf  <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> terFullGC</span><br><span class="line"> PrintClassHistogram    <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br><span class="line"> MinHeapFreeRatio       0                       DEFAULT                <span class="literal">true</span></span><br><span class="line"> MaxHeapFreeRatio       100                     DEFAULT                <span class="literal">true</span></span><br><span class="line"> PrintConcurrentLocks   <span class="literal">false</span>                   DEFAULT                <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="查看指定的-option"><a href="#查看指定的-option" class="headerlink" title="查看指定的 option"></a>查看指定的 option</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vmoption PrintGC</span><br><span class="line"> KEY                 VALUE                ORIGIN              WRITEABLE</span><br><span class="line">---------------------------------------------------------------------------------</span><br><span class="line"> PrintGC             <span class="literal">false</span>                MANAGEMENT          <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="更新指定的-option"><a href="#更新指定的-option" class="headerlink" title="更新指定的 option"></a>更新指定的 option</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ vmoption PrintGC <span class="literal">true</span></span><br><span class="line">Successfully updated the vm option.</span><br><span class="line"> NAME     BEFORE-VALUE  AFTER-VALUE</span><br><span class="line">------------------------------------</span><br><span class="line"> PrintGC  <span class="literal">false</span>         <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>再使用<code>vmtool</code> 命令执行强制 GC，则可以在<code>Tab 1</code> 看到打印出 GC 日志：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action forceGc</span><br></pre></td></tr></table></figure>

<h3 id="配置打印-GC-详情"><a href="#配置打印-GC-详情" class="headerlink" title="配置打印 GC 详情"></a>配置打印 GC 详情</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmoption PrintGCDetails true</span><br></pre></td></tr></table></figure>

<p>再使用<code>vmtool</code> 命令执行强制 GC，则可以在<code>Tab 1</code> 看到打印出 GC 详情：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action forceGc</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="vmtool-命令"><a href="#vmtool-命令" class="headerlink" title="vmtool 命令"></a>vmtool 命令</h1><div class="note info no-icon"><p>提示</p>
<p>@since 3.5.1</p>
</div>

<p><code>vmtool</code> 利用<code>JVMTI</code>接口，实现查询内存对象，强制 GC 等功能。</p>
<h2 id="查找-jvm-里的字符串对象"><a href="#查找-jvm-里的字符串对象" class="headerlink" title="查找 jvm 里的字符串对象"></a>查找 jvm 里的字符串对象</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className java.lang.String</span><br></pre></td></tr></table></figure>

<h2 id="limit-参数"><a href="#limit-参数" class="headerlink" title="limit 参数"></a>limit 参数</h2><blockquote>
<p>通过 <code>--limit</code> 参数，可以限制返回值数量，避免获取超大数据时对 JVM 造成压力。默认值是 10。</p>
</blockquote>
<p>所以上面的命令实际上等值于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className java.lang.String --limit 10</span><br></pre></td></tr></table></figure>

<p>如果设置<code>--limit</code> 为负数，则遍历所有对象。</p>
<p>下面使用<code>vmtool</code> 命令查找 spring 里的对象。</p>
<h2 id="查找-spring-context"><a href="#查找-spring-context" class="headerlink" title="查找 spring context"></a>查找 spring context</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.springframework.context.ApplicationContext</span><br></pre></td></tr></table></figure>

<h2 id="指定返回结果展开层数"><a href="#指定返回结果展开层数" class="headerlink" title="指定返回结果展开层数"></a>指定返回结果展开层数</h2><blockquote>
<p><code>getInstances</code> action 返回结果绑定到<code>instances</code> 变量上，它是数组。</p>
</blockquote>
<blockquote>
<p>通过 <code>-x</code> /<code>--expand</code> 参数可以指定结果的展开层次，默认值是 1。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.springframework.context.ApplicationContext -x 2</span><br></pre></td></tr></table></figure>

<h2 id="执行表达式"><a href="#执行表达式" class="headerlink" title="执行表达式"></a>执行表达式</h2><blockquote>
<p><code>getInstances</code> action 返回结果绑定到<code>instances</code> 变量上，它是数组。可以通过<code>--express</code> 参数执行指定的表达式。</p>
</blockquote>
<p>查找所有的 spring beans 名字：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.springframework.context.ApplicationContext --express &#39;instances[0].getBeanDefinitionNames()&#39;</span><br></pre></td></tr></table></figure>

<p>调用<code>userController.findUserById(1)</code> 函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.springframework.context.ApplicationContext --express &#39;instances[0].getBean(&quot;userController&quot;).findUserById(1)&#39;</span><br></pre></td></tr></table></figure>

<h2 id="直接获取-UserController-并调用方法"><a href="#直接获取-UserController-并调用方法" class="headerlink" title="直接获取 UserController 并调用方法"></a>直接获取 UserController 并调用方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className com.example.demo.arthas.user.UserController --express &#39;instances[0].findUserById(1)&#39;</span><br></pre></td></tr></table></figure>

<h2 id="指定-classloader"><a href="#指定-classloader" class="headerlink" title="指定 classloader"></a>指定 classloader</h2><p>可以通过<code>sc</code> 命令查找到加载 class 的 classloader。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc -d org.springframework.context.ApplicationContext</span><br></pre></td></tr></table></figure>

<p>通过上面命令得到 <code>org.springframework.boot.loader.LaunchedURLClassLoader</code> hashcode 之后用<code>-c</code> / <code>--classloader</code> 参数指定，这里使用 <code>--classLoaderClass </code>来指定 classloader</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --classLoaderClass org.springframework.boot.loader.LaunchedURLClassLoader --className org.springframework.context.ApplicationContext</span><br></pre></td></tr></table></figure>

<h2 id="强制-GC"><a href="#强制-GC" class="headerlink" title="强制 GC"></a>强制 GC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action forceGc</span><br></pre></td></tr></table></figure>

<h2 id="interrupt-指定线程"><a href="#interrupt-指定线程" class="headerlink" title="interrupt 指定线程"></a>interrupt 指定线程</h2><p>thread id 通过<code>-t</code>参数指定，可以使用 <code>thread</code>命令获取。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action interruptThread -t 1</span><br></pre></td></tr></table></figure>

<h1 id="watch-命令"><a href="#watch-命令" class="headerlink" title="watch 命令"></a>watch 命令</h1><blockquote>
<p>方法执行数据观测</p>
</blockquote>
<p>让你能方便的观察到指定方法的调用情况。能观察到的范围为：<code>返回值</code> 、<code>抛出异常</code> 、<code>入参</code> ，通过编写 OGNL 表达式进行对应变量的查看。</p>
<h3 id="参数说明-14"><a href="#参数说明-14" class="headerlink" title="参数说明"></a>参数说明</h3><p>watch 的参数比较多，主要是因为它能在 4 个不同的场景观察对象</p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td><em>class-pattern</em></td>
<td>类名表达式匹配</td>
</tr>
<tr>
<td><em>method-pattern</em></td>
<td>方法名表达式匹配</td>
</tr>
<tr>
<td><em>express</em></td>
<td>观察表达式，默认值：<code>&#123;params, target, returnObj&#125;</code></td>
</tr>
<tr>
<td><em>condition-express</em></td>
<td>条件表达式</td>
</tr>
<tr>
<td>[b]</td>
<td>在<strong>方法调用之前</strong>观察</td>
</tr>
<tr>
<td>[e]</td>
<td>在<strong>方法异常之后</strong>观察</td>
</tr>
<tr>
<td>[s]</td>
<td>在<strong>方法返回之后</strong>观察</td>
</tr>
<tr>
<td>[f]</td>
<td>在<strong>方法结束之后</strong>(正常返回和异常返回) 观察</td>
</tr>
<tr>
<td>[E]</td>
<td>开启正则表达式匹配，默认为通配符匹配</td>
</tr>
<tr>
<td>[x:]</td>
<td>指定输出结果的属性遍历深度，默认为 1</td>
</tr>
</tbody></table>
<p>这里重点要说明的是观察表达式，观察表达式的构成主要由 ognl 表达式组成，所以你可以这样写<code>&quot;&#123;params,returnObj&#125;&quot;</code> ，只要是一个合法的 ognl 表达式，都能被正常支持。</p>
<p>观察的维度也比较多，主要体现在参数 <code>advice</code> 的数据结构上。<code>Advice</code> 参数最主要是封装了通知节点的所有信息。请参考<a target="_blank" rel="noopener" href="https://killercoda.com/arthas/course/arthas-tutorials-cn/advice-class.md">表达式核心变量</a>中关于该节点的描述。</p>
<ul>
<li>特殊用法请参考：<a target="_blank" rel="noopener" href="https://github.com/alibaba/arthas/issues/71">https://github.com/alibaba/arthas/issues/71</a></li>
<li>OGNL 表达式官网：<a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-ognl/language-guide.html">https://commons.apache.org/proper/commons-ognl/language-guide.html</a></li>
</ul>
<p><strong>特别说明</strong>：</p>
<ul>
<li>watch 命令定义了 4 个观察事件点，即 <code>-b</code> 方法调用前，<code>-e</code> 方法异常后，<code>-s</code> 方法返回后，<code>-f</code> 方法结束后</li>
<li>4 个观察事件点 <code>-b</code> 、<code>-e</code> 、<code>-s</code> 默认关闭，<code>-f</code> 默认打开，当指定观察点被打开后，在相应事件点会对观察表达式进行求值并输出</li>
<li>这里要注意<code>方法入参</code> 和<code>方法出参</code> 的区别，有可能在中间被修改导致前后不一致，除了 <code>-b</code> 事件点 <code>params</code> 代表方法入参外，其余事件都代表方法出参</li>
<li>当使用 <code>-b</code> 时，由于观察事件点是在方法调用前，此时返回值或异常均不存在</li>
</ul>
<h3 id="使用参考-23"><a href="#使用参考-23" class="headerlink" title="使用参考"></a>使用参考</h3><h4 id="观察方法出参、this-对象和返回值"><a href="#观察方法出参、this-对象和返回值" class="headerlink" title="观察方法出参、this 对象和返回值"></a>观察方法出参、this 对象和返回值</h4><blockquote>
<p>观察表达式，默认值是<code>&#123;params, target, returnObj&#125;</code> 。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors -x 2</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<ul>
<li>从运行结果里，说明函数被执行了两次，第一次结果是<code>location=AtExceptionExit</code> ，说明函数抛出异常了，因此<code>returnObj</code> 是 null</li>
<li>在第二次结果里是<code>location=AtExit</code> ，说明函数正常返回，因此可以看到<code>returnObj</code> 结果是一个 ArrayList</li>
</ul>
<h4 id="观察方法入参"><a href="#观察方法入参" class="headerlink" title="观察方法入参"></a>观察方法入参</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params,returnObj&#125;&quot; -x 2 -b</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<ul>
<li>对比前一个例子，返回值为空（事件点为方法执行前，因此获取不到返回值）</li>
</ul>
<h4 id="同时观察方法调用前和方法返回后"><a href="#同时观察方法调用前和方法返回后" class="headerlink" title="同时观察方法调用前和方法返回后"></a>同时观察方法调用前和方法返回后</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params,target,returnObj&#125;&quot; -x 2 -b -s -n 2</span><br></pre></td></tr></table></figure>

<ul>
<li>参数里<code>-n 2</code> ，表示只执行两次</li>
<li>这里输出结果中，第一次输出的是方法调用前的观察表达式的结果，第二次输出的是方法返回后的表达式的结果</li>
<li>结果的输出顺序和事件发生的先后顺序一致，和命令中 <code>-s -b</code> 的顺序无关</li>
</ul>
<h4 id="调整-x-的值，观察具体的方法参数值"><a href="#调整-x-的值，观察具体的方法参数值" class="headerlink" title="调整-x 的值，观察具体的方法参数值"></a>调整<code>-x</code> 的值，观察具体的方法参数值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params,target&#125;&quot; -x 3</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<ul>
<li><code>-x</code> 表示遍历深度，可以调整来打印具体的参数和结果内容，默认值是 1。</li>
</ul>
<h4 id="条件表达式的例子"><a href="#条件表达式的例子" class="headerlink" title="条件表达式的例子"></a>条件表达式的例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params[0],target&#125;&quot; &quot;params[0]&lt;0&quot;</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<ul>
<li>只有满足条件的调用，才会有响应。</li>
<li><code>watch-express</code> 单个值可以不加’{}’，多个值需要加’{a,b,c}’。</li>
<li><code>condition-express</code> 不能加’{}’，可以使用逗号分隔子表达式，取表达式最后一个值来判断。</li>
<li>如果 watch 的方法存在同名的其它重载方法，可以通过下面的办法进行过滤：</li>
<li>根据参数类型进行过滤</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#39;&#123;params, params[0].class.name&#125;&#39; &#39;params[0].class.name &#x3D;&#x3D; &quot;java.lang.Integer&quot;&#39;</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<ul>
<li>根据参数个数进行过滤</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#39;&#123;params, params.length&#125;&#39; &#39;params.length&#x3D;&#x3D;1&#39;</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<h4 id="观察异常信息的例子"><a href="#观察异常信息的例子" class="headerlink" title="观察异常信息的例子"></a>观察异常信息的例子</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &quot;&#123;params[0],throwExp&#125;&quot; -e -x 2</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<ul>
<li><code>-e</code> 表示抛出异常时才触发</li>
<li>express 中，表示异常信息的变量是<code>throwExp</code></li>
</ul>
<p>根据异常类型或者 message 进行过滤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#39;&#123;params, throwExp&#125;&#39; &#39;#msg&#x3D;throwExp.toString(), #msg.contains(&quot;IllegalArgumentException&quot;)&#39; -e -x 2</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<h4 id="按照耗时进行过滤"><a href="#按照耗时进行过滤" class="headerlink" title="按照耗时进行过滤"></a>按照耗时进行过滤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#39;&#123;params, returnObj&#125;&#39; &#39;#cost&gt;200&#39; -x 2</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<ul>
<li><code>#cost&gt;200</code> (单位是<code>ms</code> ) 表示只有当耗时大于 200ms 时才会输出，过滤掉执行时间小于 200ms 的调用</li>
</ul>
<h4 id="观察当前对象中的属性"><a href="#观察当前对象中的属性" class="headerlink" title="观察当前对象中的属性"></a>观察当前对象中的属性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#39;target&#39;</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<p>如果想查看方法运行前后，当前对象中的属性，可以使用<code>target</code> 关键字，代表当前对象<br>然后使用<code>target.field_name</code> 访问当前对象的某个属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch demo.MathGame primeFactors &#39;target.illegalArgumentCount&#39;</span><br></pre></td></tr></table></figure>

<p>按 <code>Q</code> 或者 <code>Ctrl+c</code> 退出</p>
<h1 id="wc-命令"><a href="#wc-命令" class="headerlink" title="wc 命令"></a>wc 命令</h1><p>按行统计输出结果</p>
<p>通过 <code>jad demo.MathGame main</code> 输出 <code>demo.MathGame</code> 类的 <code>main</code> 方法</p>
<p>计算输出结果行数 <code>jad demo.MathGame main | wc -l</code></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Arthas/" rel="tag"># Arthas</a>
              <a href="/tags/Java%E8%AF%8A%E6%96%AD%E5%B7%A5%E5%85%B7/" rel="tag"># Java诊断工具</a>
              <a href="/tags/%E7%BA%BF%E4%B8%8A%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" rel="tag"># 线上问题排查</a>
              <a href="/tags/JVM/" rel="tag"># JVM</a>
              <a href="/tags/%E5%8F%8D%E7%BC%96%E8%AF%91/" rel="tag"># 反编译</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/01/05/Arthas%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/" rel="prev" title="Arthas进阶教程">
                  <i class="fa fa-angle-left"></i> Arthas进阶教程
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">wotzc</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/wotzc" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
